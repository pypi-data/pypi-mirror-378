[project]
name = "arbor-ai"
version = "0.2.7"
description = "A framework for optimizing DSPy programs"
authors = [
    {name = "Noah Ziems", email = "nziems2@nd.edu"}
]
readme = "README.md"
requires-python = ">=3.11"
dependencies = [
    "torch>=2.7.0",
    "fastapi",
    "uvicorn",
    "click",
    "python-multipart",
    "pydantic-settings",
    "vllm>=0.9.1",
    "transformers",
    "trl==0.19.1",
    "peft",
    "ray>=2.9",
    "setuptools (>=76.0.0,<79.0.1)",
    "pyzmq>=26.4.0",
    "pyyaml>=6.0.2",
    "wandb",
    "httpx",
    "coolname",
    "jq>=1.8.0",
    "textual",
    "verifiers",
]

[project.scripts]
arbor = "arbor.cli:cli"

[dependency-groups]
dev = [
    # Core server dependencies without heavy ML libs (used for development on Mac)
    "fastapi",
    "uvicorn",
    "click",
    "python-multipart",
    "pydantic-settings",
    "pyzmq>=26.4.0",
    "pyyaml>=6.0.2",
    "httpx",
    "coolname",
    "psutil",
    "requests",
    "openai",  # Lightweight OpenAI client for tests
    # Dev tools
    "black",
    "pytest",
    "pytest-timeout",
    "pytest-cov",
    "isort",
    "pre-commit",
]

[tool.setuptools.packages.find]
where = ["."]
include = ["arbor", "arbor.*"]
exclude = ["tests", "tests.*"]

[tool.coverage.run]
source = ["arbor"]
omit = [
    "*/tests/*",
    "*/test_*",
    "*/__pycache__/*",
    "*/migrations/*",
    "*/venv/*",
    "*/.venv/*",
    "examples/*",
    "arbor/server/services/scripts/*",
    "arbor/server/services/inference/vllm_serve.py",
    "arbor/server/services/inference/vllm_client.py",
]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "if self.debug:",
    "if settings.DEBUG",
    "raise AssertionError",
    "raise NotImplementedError",
    "if 0:",
    "if __name__ == .__main__.:",
    "class .*\\bProtocol\\):",
    "@(abc\\.)?abstractmethod",
]

[tool.uv]
package = true

[project.urls]
Homepage = "https://github.com/Ziems/arbor"
Issues = "https://github.com/Ziems/arbor/issues"
