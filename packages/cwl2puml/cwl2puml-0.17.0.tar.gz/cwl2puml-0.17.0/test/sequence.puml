/'
 ' Diagram generated by cwl2puml v0.14.0
 ' timestamp: 2025-09-20T09:51:50.893
 '/
@startuml
autonumber "<b>[000]"





entity "Workflow runner" as wfrunner
activate wfrunner


    
== Water bodies detection based on NDWI and otsu threshold applied to Sentinel-2 COG STAC items ==
control "water-bodies" as water_bodies_or
activate water_bodies_or

        
wfrunner -> water_bodies_or : ""stac_api_endpoint""
        
wfrunner -> water_bodies_or : ""search_request""
        
wfrunner -> water_bodies_or : ""bands""
        


    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
            
    
participant discovery
activate discovery

        
water_bodies_or -> discovery : ""api_endpoint"" (from ""stac_api_endpoint"")
        
water_bodies_or -> discovery : ""search_request"" (from ""search_request"")
        

        
water_bodies_or <-- discovery : ""search_output""
        
deactivate discovery
    

    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
            
    
participant convert_search
activate convert_search

        
water_bodies_or -> convert_search : ""search_results"" (from ""discovery/search_output"")
        
water_bodies_or -> convert_search : ""search_request"" (from ""search_request"")
        

        
water_bodies_or <-- convert_search : ""items""
        
water_bodies_or <-- convert_search : ""aoi""
        
deactivate convert_search
    

    

    
        
    
        
    
        
    
        
    
        
            
box "Water body detection based on NDWI and otsu threshold"
control "detect_water_body" as detect_water_body_or
activate detect_water_body_or

                
water_bodies_or -> detect_water_body_or : ""item"" (from ""convert_search/items"")
                
water_bodies_or -> detect_water_body_or : ""aoi"" (from ""convert_search/aoi"")
                
water_bodies_or -> detect_water_body_or : ""bands"" (from ""bands"")
                


    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
            
    
participant crop
activate crop

        
detect_water_body_or -> crop : ""item"" (from ""item"")
        
detect_water_body_or -> crop : ""aoi"" (from ""aoi"")
        
detect_water_body_or -> crop : ""epsg"" (from ""epsg"")
        
detect_water_body_or -> crop : ""band"" (from ""bands"")
        

        
detect_water_body_or <-- crop : ""cropped""
        
deactivate crop
    

    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
            
    
participant normalized_difference
activate normalized_difference

        
detect_water_body_or -> normalized_difference : ""rasters"" (from ""crop/cropped"")
        

        
detect_water_body_or <-- normalized_difference : ""ndwi""
        
deactivate normalized_difference
    

    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
            
    
participant otsu
activate otsu

        
detect_water_body_or -> otsu : ""raster"" (from ""normalized_difference/ndwi"")
        

        
detect_water_body_or <-- otsu : ""binary_mask_item""
        
deactivate otsu
    




                
water_bodies_or <-- detect_water_body_or : ""detected_water_body"" (from ""otsu/binary_mask_item"")
                

deactivate detect_water_body_or
end box
        
    
        
    
        
    
        
    
        
    
            
    

    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
            
    
participant stac
activate stac

        
water_bodies_or -> stac : ""item"" (from ""convert_search/items"")
        
water_bodies_or -> stac : ""rasters"" (from ""water_bodies/detected_water_body"")
        

        
water_bodies_or <-- stac : ""temp_stac_catalog""
        
deactivate stac
    

    

    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
            
    
participant stac_zarr
activate stac_zarr

        
water_bodies_or -> stac_zarr : ""stac_catalog"" (from ""stac/temp_stac_catalog"")
        

        
water_bodies_or <-- stac_zarr : ""zarr_stac_catalog""
        
deactivate stac_zarr
    




        
wfrunner <-- water_bodies_or : ""zarr_stac_catalog"" (from ""stac_zarr/zarr_stac_catalog"")
        
wfrunner <-- water_bodies_or : ""stac_catalog"" (from ""stac/temp_stac_catalog"")
        

deactivate water_bodies_or
    

    

    

    

    

    

    

    

    


deactivate wfrunner

@enduml