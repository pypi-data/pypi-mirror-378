Metadata-Version: 2.4
Name: lsyiot-livegbs-sdk
Version: 1.0.1
Summary: LiveGBS GB28181å›½æ ‡æµåª’ä½“æœåŠ¡Pythonæ¥å£
Home-page: https://github.com/9kl/lsyiot_livegbs_sdk
Author: fhp
Author-email: fhp <chinafengheping@outlook.com>
License: Apache-2.0
Project-URL: Homepage, https://github.com/9kl/lsyiot_livegbs_sdk
Project-URL: Documentation, https://github.com/9kl/lsyiot_livegbs_sdk#readme
Project-URL: Repository, https://github.com/9kl/lsyiot_livegbs_sdk.git
Project-URL: Bug Tracker, https://github.com/9kl/lsyiot_livegbs_sdk/issues
Keywords: livegbs,gb28181,streaming,video,surveillance,sdk
Classifier: Development Status :: 5 - Production/Stable
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: Apache Software License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Classifier: Topic :: Multimedia :: Video
Classifier: Topic :: System :: Networking
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: requests>=2.25.0
Dynamic: author
Dynamic: home-page
Dynamic: license-file
Dynamic: requires-python

# LiveGBS Python SDK

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ LiveGBS GB28181 å›½æ ‡æµåª’ä½“æœåŠ¡ Python SDKï¼Œæä¾›äº†å®Œæ•´çš„ API æ¥å£å°è£…ï¼ŒåŒ…æ‹¬ç”¨æˆ·è®¤è¯ã€è®¾å¤‡ç®¡ç†ã€ç›´æ’­æµæ§åˆ¶ã€è§†é¢‘æ°´å°ã€è®¾å¤‡æ§åˆ¶ç­‰åŠŸèƒ½ã€‚

## ğŸŒŸ ç‰¹æ€§

- ğŸ” **å®Œæ•´çš„è®¤è¯ç®¡ç†** - ç”¨æˆ·ç™»å½•ã€é€€å‡ºã€å¯†ç ä¿®æ”¹
- ğŸ“± **è®¾å¤‡ç®¡ç†** - è®¾å¤‡åˆ—è¡¨ã€è®¾å¤‡ä¿¡æ¯ã€é€šé“åˆ—è¡¨ã€åœ¨çº¿ç»Ÿè®¡
- ğŸ¬ **ç›´æ’­æµæ§åˆ¶** - å¼€å§‹/åœæ­¢ç›´æ’­ã€è·å–å¤šç§æ’­æ”¾æ ¼å¼
- ğŸ·ï¸ **è§†é¢‘æ°´å°** - åŠ¨æ€æ·»åŠ æ–‡å­—æ°´å°ï¼Œæ”¯æŒä½ç½®ã€é¢œè‰²ã€å¤§å°å®šåˆ¶
- ğŸ® **è®¾å¤‡æ§åˆ¶** - äº‘å°æ§åˆ¶ã€ç„¦ç‚¹å…‰åœˆã€é¢„ç½®ä½ç®¡ç†ã€çœ‹å®ˆä½è®¾ç½®
- ğŸ›¡ï¸ **å®Œå–„çš„é”™è¯¯å¤„ç†** - è‡ªå®šä¹‰å¼‚å¸¸ç±»å’Œè¯¦ç»†é”™è¯¯ä¿¡æ¯
- ğŸ“Š **ç±»å‹æç¤ºæ”¯æŒ** - å®Œæ•´çš„ç±»å‹æ³¨è§£ï¼ŒIDE å‹å¥½
- ğŸ§ª **ç»è¿‡å®é™…éªŒè¯** - åœ¨çœŸå® GB28181 è®¾å¤‡ä¸Šæµ‹è¯•éªŒè¯

## ğŸ“¦ å®‰è£…

### ä½¿ç”¨ pip å®‰è£…ï¼ˆæ¨èï¼‰

```bash
pip install lsyiot-livegbs-sdk
```

### ä»æºç å®‰è£…

```bash
git clone https://github.com/your-repo/lsyiot_livegbs_sdk.git
cd lsyiot_livegbs_sdk
pip install -e .
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ä½¿ç”¨

```python
from lsyiot_livegbs_sdk import LiveGBSAPI

# åˆ›å»º API å®¢æˆ·ç«¯
client = LiveGBSAPI('http://your-livegbs-server:port')

# ç™»å½•
login_result = client.login('username', 'password')
print(f"ç™»å½•æˆåŠŸï¼ŒURLToken: {login_result.url_token}")

# è®¾ç½®è®¤è¯ä»¤ç‰Œï¼ˆæ¨èï¼‰
client.session.headers.update({"Authorization": f"Bearer {login_result.url_token}"})

# è·å–è®¾å¤‡åˆ—è¡¨
device_list = client.get_device_list()
print(f"è®¾å¤‡æ•°é‡: {device_list.device_count}")
```

### å®Œæ•´ç¤ºä¾‹

```python
from lsyiot_livegbs_sdk import LiveGBSAPI, StreamStartResponse
from lsyiot_livegbs_sdk.exceptions import LiveGBSError

def main():
    # æœåŠ¡å™¨é…ç½®
    server_url = "http://your-server:port"
    username = "your-username"
    password = "your-password"
    
    # è®¾å¤‡é…ç½®
    device_serial = "your-device-serial"
    channel = 1

    client = LiveGBSAPI(server_url)

    try:
        # 1. ç”¨æˆ·è®¤è¯
        login_result = client.login(username, password)
        client.session.headers.update({"Authorization": f"Bearer {login_result.url_token}"})
        
        # 2. è®¾å¤‡ç®¡ç†
        devices = client.get_device_list()
        if devices.device_count > 0:
            device = devices.device_list[0]
            print(f"è®¾å¤‡: {device.name}, åœ¨çº¿: {device.online}")
        
        # 3. å¼€å§‹ç›´æ’­
        stream = client.start_stream(
            serial=device_serial,
            channel=channel,
            audio="config",
            transport="UDP"
        )
        print(f"ç›´æ’­å¼€å§‹: {stream.stream_id}")
        print(f"WEBRTCæ’­æ”¾åœ°å€: {stream.webrtc}")
        
        # 4. è®¾ç½®è§†é¢‘æ°´å°
        client.stream_osd(
            serial=device_serial,
            code=device_serial,
            text="Live Stream",
            color="white",
            x="10", y="10", size=24
        )
        
        # 5. äº‘å°æ§åˆ¶
        client.ptz_control(
            serial=device_serial,
            channel=channel,
            command="left",
            speed=100
        )
        
        # 6. åœæ­¢ç›´æ’­
        client.stop_stream(serial=device_serial, channel=channel)
        
    except LiveGBSError as e:
        print(f"æ“ä½œå¤±è´¥: {e}")

if __name__ == "__main__":
    main()
```

## ğŸ“– API æ–‡æ¡£

### è®¤è¯ç®¡ç†

#### ç”¨æˆ·ç™»å½•
```python
login_result = client.login(username, password, url_token_only=False, token_timeout=604800)
# è¿”å›: LoginResponse å¯¹è±¡ï¼ŒåŒ…å« cookie_token, url_token, token_timeout ç­‰
```

#### é€€å‡ºç™»å½•
```python
logout_result = client.logout()
# è¿”å›: ModifyPasswordResponse å¯¹è±¡
```

#### ä¿®æ”¹å¯†ç 
```python
modify_result = client.modify_password(old_password, new_password)
# è¿”å›: ModifyPasswordResponse å¯¹è±¡
```

### è®¾å¤‡ç®¡ç†

#### æŸ¥è¯¢è®¾å¤‡åˆ—è¡¨
```python
device_list = client.get_device_list(start=0, limit=100, q="search_keyword")
# è¿”å›: DeviceListResponse å¯¹è±¡ï¼ŒåŒ…å«è®¾å¤‡æ•°é‡å’Œè®¾å¤‡åˆ—è¡¨
```

#### æŸ¥è¯¢å•ä¸ªè®¾å¤‡ä¿¡æ¯
```python
device_info = client.get_device_info(serial="device_serial")
# è¿”å›: Device å¯¹è±¡ï¼ŒåŒ…å«è®¾å¤‡è¯¦ç»†ä¿¡æ¯
```

#### æŸ¥è¯¢è®¾å¤‡é€šé“åˆ—è¡¨
```python
channel_list = client.get_device_channel_list(
    serial="device_serial",
    channel_type="all",
    limit=1000
)
# è¿”å›: DeviceChannelListResponse å¯¹è±¡
```

#### æŸ¥è¯¢è®¾å¤‡åœ¨çº¿ç»Ÿè®¡
```python
stats = client.get_device_online_stats()
# è¿”å›: OnlineStatsResponse å¯¹è±¡
print(f"è®¾å¤‡åœ¨çº¿ç‡: {stats.device_online_rate:.2%}")
```

### ç›´æ’­æµæ§åˆ¶

#### å¼€å§‹ç›´æ’­
```python
stream = client.start_stream(
    serial="device_serial",
    channel=1,                    # é€šé“åºå·
    audio="config",               # éŸ³é¢‘è®¾ç½®: true/false/config
    transport="UDP",              # ä¼ è¾“æ¨¡å¼: TCP/UDP/config
    streamnumber=0,               # ç æµç¼–å·: 0-ä¸»ç æµ, 1-å­ç æµ
    check_channel_status=False    # æ˜¯å¦æ£€æŸ¥é€šé“çŠ¶æ€
)
# è¿”å›: StreamStartResponse å¯¹è±¡
print(f"WEBRTC: {stream.webrtc}")
print(f"FLV: {stream.flv}")
print(f"RTMP: {stream.rtmp}")
print(f"HLS: {stream.hls}")
```

#### åœæ­¢ç›´æ’­
```python
stop_result = client.stop_stream(
    serial="device_serial",
    channel=1,
    check_outputs=False    # æ˜¯å¦æ£€æŸ¥åœ¨çº¿äººæ•°
)
# è¿”å›: StreamStopResponse å¯¹è±¡
```

### è§†é¢‘æ°´å°

#### è®¾ç½®è§†é¢‘æ°´å°
```python
osd_result = client.stream_osd(
    serial="device_serial",
    code="channel_code",
    streamid="stream_id",         # å¯é€‰
    text="æ°´å°æ–‡å­—",
    color="white",                # æ–‡å­—é¢œè‰²
    border_color="black",         # è¾¹æ¡†é¢œè‰²
    x="10",                       # æ°´å¹³ä½ç½®
    y="10",                       # å‚ç›´ä½ç½®
    size=24                       # å­—ä½“å¤§å°
)
# è¿”å›: StreamOSDResponse å¯¹è±¡
```

### è®¾å¤‡æ§åˆ¶

#### äº‘å°æ§åˆ¶
```python
ptz_result = client.ptz_control(
    serial="device_serial",
    command="left",               # æ§åˆ¶æŒ‡ä»¤
    channel=1,
    speed=129                     # é€Ÿåº¦ 0-255
)
# æ”¯æŒçš„æŒ‡ä»¤: left, right, up, down, upleft, upright, downleft, downright, zoomin, zoomout, stop
```

#### ç„¦ç‚¹å…‰åœˆæ§åˆ¶
```python
fi_result = client.fi_control(
    serial="device_serial",
    command="focusnear",          # æ§åˆ¶æŒ‡ä»¤
    channel=1,
    speed=129
)
# æ”¯æŒçš„æŒ‡ä»¤: focusnear, focusfar, irisin, irisout, stop
```

#### é¢„ç½®ä½æ§åˆ¶
```python
# è®¾ç½®é¢„ç½®ä½
preset_result = client.preset_control(
    serial="device_serial",
    command="set",
    preset=1,                     # é¢„ç½®ä½ç¼–å· 1-255
    channel=1,
    name="é‡è¦ä½ç½®"               # é¢„ç½®ä½åç§°
)

# è·³è½¬åˆ°é¢„ç½®ä½
preset_result = client.preset_control(
    serial="device_serial",
    command="goto",
    preset=1,
    channel=1
)

# åˆ é™¤é¢„ç½®ä½
preset_result = client.preset_control(
    serial="device_serial",
    command="remove",
    preset=1,
    channel=1
)
```

#### çœ‹å®ˆä½æ§åˆ¶
```python
home_result = client.home_position_control(
    serial="device_serial",
    resettime=60,                 # è‡ªåŠ¨å½’ä½æ—¶é—´é—´éš”(ç§’)
    presetindex=1,                # è°ƒç”¨é¢„ç½®ä½ç¼–å·
    channel=1,
    enabled=True,                 # ä½¿èƒ½å¼€å…³
    timeout=15                    # è¶…æ—¶æ—¶é—´(ç§’)
)
```

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†

SDK æä¾›äº†å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼š

```python
from lsyiot_livegbs_sdk.exceptions import (
    LiveGBSError,           # åŸºç¡€å¼‚å¸¸ç±»
    LiveGBSNetworkError,    # ç½‘ç»œé”™è¯¯
    LiveGBSAPIError,        # APIé”™è¯¯
    LiveGBSParseError       # æ•°æ®è§£æé”™è¯¯
)

try:
    result = client.login(username, password)
except LiveGBSNetworkError as e:
    print(f"ç½‘ç»œé”™è¯¯: {e}")
except LiveGBSAPIError as e:
    print(f"APIé”™è¯¯: {e}, çŠ¶æ€ç : {e.error_code}")
except LiveGBSParseError as e:
    print(f"æ•°æ®è§£æé”™è¯¯: {e}")
except LiveGBSError as e:
    print(f"SDKé”™è¯¯: {e}")
```

## ğŸ“Š å“åº”å¯¹è±¡

æ‰€æœ‰ API æ–¹æ³•éƒ½è¿”å›ç›¸åº”çš„å“åº”å¯¹è±¡ï¼ŒåŒ…å«å®Œæ•´çš„æ•°æ®å’Œä¾¿æ·æ–¹æ³•ï¼š

### LoginResponse
```python
login_result = client.login(username, password)
print(login_result.cookie_token)    # Cookieä»¤ç‰Œ
print(login_result.url_token)       # URLä»¤ç‰Œ
print(login_result.token_timeout)   # ä»¤ç‰Œè¶…æ—¶æ—¶é—´
```

### StreamStartResponse
```python
stream = client.start_stream(serial, channel)
print(stream.stream_id)             # æµID
print(stream.webrtc)                # WEBRTCæ’­æ”¾åœ°å€
print(stream.video_resolution)      # è§†é¢‘åˆ†è¾¨ç‡ (å±æ€§æ–¹æ³•)
print(stream.is_streaming)          # æ˜¯å¦æ­£åœ¨ç›´æ’­ (å±æ€§æ–¹æ³•)
```

### Device
```python
device = client.get_device_info(serial)
print(device.name)                  # è®¾å¤‡åç§°
print(device.online)                # åœ¨çº¿çŠ¶æ€
print(device.channel_count)         # é€šé“æ•°é‡
```

## ğŸ”§ é…ç½®é€‰é¡¹

### åˆ›å»ºå®¢æˆ·ç«¯æ—¶çš„é…ç½®
```python
client = LiveGBSAPI(
    base_url='http://your-server:port',
    timeout=30,                     # è¯·æ±‚è¶…æ—¶æ—¶é—´(ç§’)
    verify=True                     # æ˜¯å¦éªŒè¯SSLè¯ä¹¦
)
```

### è‡ªå®šä¹‰è¯·æ±‚å¤´
```python
client.session.headers.update({
    'User-Agent': 'My-App/1.0',
    'Authorization': f'Bearer {token}'
})
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. è®¤è¯ç®¡ç†
```python
# æ¨èï¼šä½¿ç”¨ URLToken è¿›è¡ŒAPIè®¤è¯
login_result = client.login(username, password)
client.session.headers.update({"Authorization": f"Bearer {login_result.url_token}"})

# æ£€æŸ¥ä»¤ç‰Œæ˜¯å¦å³å°†è¿‡æœŸ
if time.time() + 3600 > login_result.token_timeout:
    # é‡æ–°ç™»å½•æˆ–åˆ·æ–°ä»¤ç‰Œ
    login_result = client.login(username, password)
```

### 2. è®¾å¤‡æ§åˆ¶
```python
# äº‘å°æ§åˆ¶åè¦åŠæ—¶åœæ­¢
client.ptz_control(serial, "left", speed=100)
time.sleep(2)  # è½¬åŠ¨2ç§’
client.ptz_control(serial, "stop")  # åœæ­¢è½¬åŠ¨

# é¢„ç½®ä½ç®¡ç†
try:
    # è®¾ç½®é¢„ç½®ä½
    client.preset_control(serial, "set", preset=1, name="ç›‘æ§ç‚¹A")
    # ä½¿ç”¨é¢„ç½®ä½
    client.preset_control(serial, "goto", preset=1)
except ValueError as e:
    print(f"é¢„ç½®ä½å‚æ•°é”™è¯¯: {e}")
```

### 3. ç›´æ’­æµç®¡ç†
```python
# å¼€å§‹ç›´æ’­å‰æ£€æŸ¥è®¾å¤‡çŠ¶æ€
device = client.get_device_info(serial)
if device.online:
    stream = client.start_stream(serial, channel, check_channel_status=True)
    # ä½¿ç”¨æµ...
    client.stop_stream(serial, channel)
else:
    print("è®¾å¤‡ç¦»çº¿ï¼Œæ— æ³•å¼€å§‹ç›´æ’­")
```

### 4. é”™è¯¯å¤„ç†å’Œé‡è¯•
```python
import time
from lsyiot_livegbs_sdk.exceptions import LiveGBSNetworkError

def robust_api_call(func, *args, max_retries=3, **kwargs):
    for attempt in range(max_retries):
        try:
            return func(*args, **kwargs)
        except LiveGBSNetworkError as e:
            if attempt == max_retries - 1:
                raise
            print(f"ç½‘ç»œé”™è¯¯ï¼Œ{2**attempt}ç§’åé‡è¯•...")
            time.sleep(2**attempt)

# ä½¿ç”¨ç¤ºä¾‹
device_list = robust_api_call(client.get_device_list)
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [APIå®ç°æ€»ç»“](./STREAM_API_SUMMARY.md) - ç›´æ’­æµAPIè¯¦ç»†è¯´æ˜
- [è§†é¢‘æ°´å°åŠŸèƒ½](./OSD_API_SUMMARY.md) - è§†é¢‘æ°´å°APIè¯¦ç»†è¯´æ˜  
- [è®¾å¤‡æ§åˆ¶åŠŸèƒ½](./CONTROL_API_SUMMARY.md) - è®¾å¤‡æ§åˆ¶APIè¯¦ç»†è¯´æ˜
- [ä»£ç é‡æ„è¯´æ˜](./REFACTOR_SUMMARY.md) - ä»£ç ç»“æ„ä¼˜åŒ–è®°å½•

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

### å¼€å‘ç¯å¢ƒè®¾ç½®
```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/lsyiot_livegbs_sdk.git
cd lsyiot_livegbs_sdk

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
# æˆ–
.venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
pip install -e .
```

### è¿è¡Œæµ‹è¯•
```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-cov

# è¿è¡Œæµ‹è¯•
pytest tests/ -v --cov=lsyiot_livegbs_sdk
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ Apache License 2.0 è®¸å¯è¯ã€‚è¯¦æƒ…è¯·è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ”– ç‰ˆæœ¬å†å²

### v1.0.0 (2025-09-22)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ” å®Œæ•´çš„è®¤è¯ç®¡ç†åŠŸèƒ½
- ğŸ“± è®¾å¤‡ç®¡ç†å’ŒæŸ¥è¯¢åŠŸèƒ½
- ğŸ¬ ç›´æ’­æµæ§åˆ¶åŠŸèƒ½
- ğŸ·ï¸ è§†é¢‘æ°´å°åŠŸèƒ½
- ğŸ® è®¾å¤‡æ§åˆ¶åŠŸèƒ½ï¼ˆäº‘å°ã€ç„¦ç‚¹ã€é¢„ç½®ä½ã€çœ‹å®ˆä½ï¼‰
- ğŸ›¡ï¸ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç±»å‹æç¤º
- ğŸ“Š ç»è¿‡å®é™…è®¾å¤‡éªŒè¯

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å¸®åŠ©ï¼š

- ğŸ› [æäº¤ Issue](https://github.com/your-repo/lsyiot_livegbs_sdk/issues)
- ğŸ“§ å‘é€é‚®ä»¶åˆ°: your-email@example.com
- ğŸ“– æŸ¥çœ‹[è¯¦ç»†æ–‡æ¡£](https://your-docs-site.com)

---

## â­ Star History

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ä¸è¦å¿˜è®°ç»™å®ƒä¸€ä¸ª â­ï¼

[![Star History Chart](https://api.star-history.com/svg?repos=your-repo/lsyiot_livegbs_sdk&type=Date)](https://star-history.com/#your-repo/lsyiot_livegbs_sdk&Date)
