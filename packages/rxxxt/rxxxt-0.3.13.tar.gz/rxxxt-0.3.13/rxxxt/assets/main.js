(()=>{var ye=Object.defineProperty;var ie=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var se=(e,n,t)=>n in e?ye(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,Z=(e,n)=>{for(var t in n||(n={}))Se.call(n,t)&&se(e,t,n[t]);if(ie)for(var t of ie(n))Ae.call(n,t)&&se(e,t,n[t]);return e};var oe="rxxxt-on-",le=()=>new Date().getTime(),de=new WeakMap;function F(e){var t,r,a;let n=de.get(e);return n===void 0&&(n=JSON.stringify([e.context_id,e.handler_name,(t=e.options.debounce)!=null?t:null,(r=e.options.prevent_default)!=null?r:null,(a=e.options.throttle)!=null?a:null,...Object.entries(e.param_map).sort((l,f)=>l[0].localeCompare(f[0]))]),de.set(e,n)),n}function Ce(e){var t;let n=new Map;for(let r of e.getAttributeNames())if(r.startsWith(oe)){let a=r.substring(oe.length),l=JSON.parse(atob((t=e.getAttribute(r))!=null?t:""));n.set(a,l)}return n}function Ue(e,n){let t=e;try{for(let r of n.split("."))t=t[r];return typeof t=="string"||typeof t=="number"||typeof t=="boolean"?t:void 0}catch(r){return}}function ue(e){let n=0,t=new WeakMap,r=new WeakMap,a=new Map,l=new Set,f=(o,p)=>{var u,b,v,C,A;let g=(u=t.get(o))!=null?u:[],E=g.filter(m=>l.has(m.descriptor.context_id));E.length!==g.length&&(t.set(o,E),y(o),g=E);for(let m of g.filter(M=>M.event===p.type)){let M=Z(Z({$handler_name:m.descriptor.handler_name},(b=m.descriptor.options.default_params)!=null?b:{}),Object.fromEntries(Object.entries(m.descriptor.param_map).map(R=>[R[0],Ue(p,R[1])])));if(a.set(m.submitId,{context_id:m.descriptor.context_id,data:M}),m.timeoutHandle&&(clearTimeout(m.timeoutHandle),m.timeoutHandle=void 0),m.descriptor.options.prevent_default&&p.preventDefault(),!m.descriptor.options.no_trigger){let R=Math.max(0,(v=m.descriptor.options.debounce)!=null?v:0,((C=m.lastCall)!=null?C:0)+((A=m.descriptor.options.throttle)!=null?A:0)-le());m.timeoutHandle=setTimeout(()=>{a.has(m.submitId)&&(m.lastCall=le(),e())},R)}}},y=o=>{var E,u,b;let p=(E=r.get(o))!=null?E:new Map;r.set(o,p);let g=new Set((b=(u=t.get(o))==null?void 0:u.map(v=>v.event))!=null?b:[]);for(let v of Array.from(p.keys()))g.has(v)||(o.removeEventListener(v,p.get(v)),p.delete(v));for(let v of g)if(!p.has(v)){let C=A=>f(o,A);o.addEventListener(v,C),p.set(v,C)}},U=()=>{let o=new Map(a);return a.clear(),o},O=o=>{var E;o.tagName==="RXXXT-META"&&l.add(o.id);let p=new Map(((E=t.get(o))!=null?E:[]).filter(u=>u.tag=="local").map(u=>[u.event,u])),g=Ce(o);for(let u of p.values())g.has(u.event)||T(o,u.event,u.descriptor,"local");for(let u of g.entries())p.has(u[0])?p.get(u[0]).descriptor=u[1]:S(o,u[0],u[1],"local")},N=o=>{o.tagName==="RXXXT-META"&&l.delete(o.id)},S=(o,p,g,E="global")=>{var C;let u=F(g),b=(C=t.get(o))!=null?C:[];t.set(o,b);let v=b.find(A=>A.event===p&&F(A.descriptor)===u&&A.tag==E);v===void 0?b.push({descriptor:g,event:p,submitId:++n,tag:E}):v.descriptor=g,y(o)},T=(o,p,g,E="global")=>{var b;let u=F(g);t.set(o,((b=t.get(o))!=null?b:[]).filter(v=>v.event!=p||F(v.descriptor)!==u||v.tag!==E)),y(o)};return{registerEvent:S,unregisterEvent:T,onElementUpdated:O,onElementDeleted:N,popPendingEvents:U}}function pe(e){let n,t=!1,r=!1,a=!1,l,f=new Map,y=()=>{if(t){r=!0;return}t=!0,r=!1;for(let S of e.popPendingEvents())f.set(S[0],S[1]);l(Array.from(f.values()))},U=(S,T)=>{f.clear(),e.onUpdate(S,T),t=!1,r&&y()},O=()=>{n==null||n.close(),n=void 0,l=async S=>{var o;let T=await fetch(location.href,{method:"POST",body:JSON.stringify({state_token:e.stateToken,events:S}),headers:{"Content-Type":"application/json"},credentials:"include"});if(T.ok){let p=await T.json();U(p.html_parts,p.events),e.stateToken=(o=p.state_token)!=null?o:e.stateToken}else throw new Error("Update failed! Server responded with ".concat(T.statusText," (").concat(T.status,")."))}},N=()=>{if(n!==void 0){console.warn("tried to switch to websocket again, despite using it already");return}let S=async o=>n==null?void 0:n.send(JSON.stringify({type:"update",events:o,location:location.href.substring(location.origin.length)})),T=new URL(location.href);T.protocol=location.protocol=="https:"?"wss":"ws",n=new WebSocket(T),n.addEventListener("close",O),n.addEventListener("open",()=>{l=S,n==null||n.send(JSON.stringify({type:"init",state_token:e.stateToken,enable_state_updates:e.enableWebSocketStateUpdates}))}),n.addEventListener("message",o=>{var g;if(typeof o.data!="string")return;let p=JSON.parse(o.data);e.stateToken=(g=p.state_token)!=null?g:e.stateToken,U(p.html_parts,p.events)})};return O(),{useHTTP:O,useWebSocket:N,update:()=>{a||(a=!0,setTimeout(()=>{a=!1,y()},0))}}}var ce=11;function Oe(e,n){var t=n.attributes,r,a,l,f,y;if(!(n.nodeType===ce||e.nodeType===ce)){for(var U=t.length-1;U>=0;U--)r=t[U],a=r.name,l=r.namespaceURI,f=r.value,l?(a=r.localName||a,y=e.getAttributeNS(l,a),y!==f&&(r.prefix==="xmlns"&&(a=r.name),e.setAttributeNS(l,a,f))):(y=e.getAttribute(a),y!==f&&e.setAttribute(a,f));for(var O=e.attributes,N=O.length-1;N>=0;N--)r=O[N],a=r.name,l=r.namespaceURI,l?(a=r.localName||a,n.hasAttributeNS(l,a)||e.removeAttributeNS(l,a)):n.hasAttribute(a)||e.removeAttribute(a)}}var J,Ne="http://www.w3.org/1999/xhtml",w=typeof document>"u"?void 0:document,ke=!!w&&"content"in w.createElement("template"),_e=!!w&&w.createRange&&"createContextualFragment"in w.createRange();function De(e){var n=w.createElement("template");return n.innerHTML=e,n.content.childNodes[0]}function He(e){J||(J=w.createRange(),J.selectNode(w.body));var n=J.createContextualFragment(e);return n.childNodes[0]}function Ie(e){var n=w.createElement("body");return n.innerHTML=e,n.childNodes[0]}function Me(e){return e=e.trim(),ke?De(e):_e?He(e):Ie(e)}function G(e,n){var t=e.nodeName,r=n.nodeName,a,l;return t===r?!0:(a=t.charCodeAt(0),l=r.charCodeAt(0),a<=90&&l>=97?t===r.toUpperCase():l<=90&&a>=97?r===t.toUpperCase():!1)}function Pe(e,n){return!n||n===Ne?w.createElement(e):w.createElementNS(n,e)}function Re(e,n){for(var t=e.firstChild;t;){var r=t.nextSibling;n.appendChild(t),t=r}return n}function ee(e,n,t){e[t]!==n[t]&&(e[t]=n[t],e[t]?e.setAttribute(t,""):e.removeAttribute(t))}var fe={OPTION:function(e,n){var t=e.parentNode;if(t){var r=t.nodeName.toUpperCase();r==="OPTGROUP"&&(t=t.parentNode,r=t&&t.nodeName.toUpperCase()),r==="SELECT"&&!t.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!n.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),t.selectedIndex=-1)}ee(e,n,"selected")},INPUT:function(e,n){ee(e,n,"checked"),ee(e,n,"disabled"),e.value!==n.value&&(e.value=n.value),n.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,n){var t=n.value;e.value!==t&&(e.value=t);var r=e.firstChild;if(r){var a=r.nodeValue;if(a==t||!t&&a==e.placeholder)return;r.nodeValue=t}},SELECT:function(e,n){if(!n.hasAttribute("multiple")){for(var t=-1,r=0,a=e.firstChild,l,f;a;)if(f=a.nodeName&&a.nodeName.toUpperCase(),f==="OPTGROUP")l=a,a=l.firstChild;else{if(f==="OPTION"){if(a.hasAttribute("selected")){t=r;break}r++}a=a.nextSibling,!a&&l&&(a=l.nextSibling,l=null)}e.selectedIndex=t}}},B=1,ve=11,ge=3,me=8;function H(){}function Le(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function We(e){return function(t,r,a){if(a||(a={}),typeof r=="string")if(t.nodeName==="#document"||t.nodeName==="HTML"||t.nodeName==="BODY"){var l=r;r=w.createElement("html"),r.innerHTML=l}else r=Me(r);else r.nodeType===ve&&(r=r.firstElementChild);var f=a.getNodeKey||Le,y=a.onBeforeNodeAdded||H,U=a.onNodeAdded||H,O=a.onBeforeElUpdated||H,N=a.onElUpdated||H,S=a.onBeforeNodeDiscarded||H,T=a.onNodeDiscarded||H,o=a.onBeforeElChildrenUpdated||H,p=a.skipFromChildren||H,g=a.addChild||function(i,s){return i.appendChild(s)},E=a.childrenOnly===!0,u=Object.create(null),b=[];function v(i){b.push(i)}function C(i,s){if(i.nodeType===B)for(var h=i.firstChild;h;){var d=void 0;s&&(d=f(h))?v(d):(T(h),h.firstChild&&C(h,s)),h=h.nextSibling}}function A(i,s,h){S(i)!==!1&&(s&&s.removeChild(i),T(i),C(i,h))}function m(i){if(i.nodeType===B||i.nodeType===ve)for(var s=i.firstChild;s;){var h=f(s);h&&(u[h]=s),m(s),s=s.nextSibling}}m(t);function M(i){U(i);for(var s=i.firstChild;s;){var h=s.nextSibling,d=f(s);if(d){var c=u[d];c&&G(s,c)?(s.parentNode.replaceChild(c,s),X(c,s)):M(s)}else M(s);s=h}}function R(i,s,h){for(;s;){var d=s.nextSibling;(h=f(s))?v(h):A(s,i,!0),s=d}}function X(i,s,h){var d=f(s);if(d&&delete u[d],!h){var c=O(i,s);if(c===!1||(c instanceof HTMLElement&&(i=c,m(i)),e(i,s),N(i),o(i,s)===!1))return}i.nodeName!=="TEXTAREA"?xe(i,s):fe.TEXTAREA(i,s)}function xe(i,s){var h=p(i,s),d=s.firstChild,c=i.firstChild,L,k,W,K,_;e:for(;d;){for(K=d.nextSibling,L=f(d);!h&&c;){if(W=c.nextSibling,d.isSameNode&&d.isSameNode(c)){d=K,c=W;continue e}k=f(c);var j=c.nodeType,D=void 0;if(j===d.nodeType&&(j===B?(L?L!==k&&((_=u[L])?W===_?D=!1:(i.insertBefore(_,c),k?v(k):A(c,i,!0),c=_,k=f(c)):D=!1):k&&(D=!1),D=D!==!1&&G(c,d),D&&X(c,d)):(j===ge||j==me)&&(D=!0,c.nodeValue!==d.nodeValue&&(c.nodeValue=d.nodeValue))),D){d=K,c=W;continue e}k?v(k):A(c,i,!0),c=W}if(L&&(_=u[L])&&G(_,d))h||g(i,_),X(_,d);else{var Q=y(d);Q!==!1&&(Q&&(d=Q),d.actualize&&(d=d.actualize(i.ownerDocument||w)),g(i,d),M(d))}d=K,c=W}R(i,c,k);var ae=fe[i.nodeName];ae&&ae(i,s)}var x=t,$=x.nodeType,re=r.nodeType;if(!E){if($===B)re===B?G(t,r)||(T(t),x=Re(t,Pe(r.nodeName,r.namespaceURI))):x=r;else if($===ge||$===me){if(re===$)return x.nodeValue!==r.nodeValue&&(x.nodeValue=r.nodeValue),x;x=r}}if(x===r)T(t);else{if(r.isSameNode&&r.isSameNode(x))return;if(X(x,r,E),b)for(var z=0,we=b.length;z<we;z++){var Y=u[b[z]];Y&&A(Y,Y.parentNode,!1)}}return!E&&x!==t&&t.parentNode&&(x.actualize&&(x=x.actualize(t.ownerDocument||w)),t.parentNode.replaceChild(x,t)),x}}var Be=We(Oe),he=Be;var Ve="root",q=new Map,I,Ee={stateToken:"",enableWebSocketStateUpdates:!1,onUpdate:(e,n)=>{for(let t of e)Te(t);ne(n)},popPendingEvents:()=>P.popPendingEvents()},V=pe(Ee),P=ue(V.update),Te=e=>{let n;if(e===void 0){let t=document.getElementById(Ve);if(t===null)throw new Error("Update target not found!");n=t}else{let t=document.createElement("div");t.innerHTML=e;let r=t.children.item(0);if(r===null||r.tagName!=="rxxxt-meta".toUpperCase())throw new Error("Invalid update root!");let a=document.getElementById(r.id);if(a===null)throw new Error("Update target not found!");n=a,he(n,r,{onNodeDiscarded:l=>{l instanceof Element&&P.onElementDeleted(l)}})}for(let t of n.getElementsByTagName("*"))P.onElementUpdated(t)},Xe={custom:e=>{var n;for(let t of(n=q.get(e.name))!=null?n:[])try{t(e.data)}catch(r){console.error(r)}},navigate:e=>{let n=new URL(e.location,location.href);I===void 0||I.origin!==n.origin||!n.pathname.startsWith(I.pathname)?location.assign(n):(window.history.pushState({},"",e.location),e.requires_refresh&&V.update())},"use-websocket":e=>{e.websocket?V.useWebSocket():V.useHTTP()},"set-cookie":e=>{var t;let n=["".concat(e.name,"=").concat((t=e.value)!=null?t:"")];typeof e.path=="string"&&n.push("path=".concat(e.path)),typeof e.expires=="string"&&n.push("expires=".concat(new Date(e.expires).toUTCString())),typeof e.max_age=="number"&&n.push("max-age=".concat(e.max_age)),typeof e.domain=="string"&&n.push("domain=".concat(e.domain)),e.secure&&n.push("secure"),e.http_only&&n.push("httponly"),document.cookie=n.join(";")},"event-modify-window":e=>{e.mode==="add"?P.registerEvent(window,e.name,e.descriptor):e.mode==="remove"&&P.unregisterEvent(window,e.name,e.descriptor)},"event-modify-query-selector":e=>{let n;if(e.all)n=Array.from(document.querySelectorAll(e.selector));else{let t=document.querySelector(e.selector);n=t===null?[]:[t]}for(let t of n)e.mode==="add"?P.registerEvent(t,e.name,e.descriptor):e.mode==="remove"&&P.unregisterEvent(t,e.name,e.descriptor)}},ne=e=>e.forEach(n=>Xe[n.event](n)),be={on:(e,n)=>{var r;let t=(r=q.get(e))!=null?r:new Set;q.set(e,t),t.add(n)},off:(e,n)=>{var r;return((r=q.get(e))!=null?r:new Set).delete(n)},navigate:e=>{ne([{event:"navigate",location:new URL(e,location.href).href,requires_refresh:!0}])},init:e=>{I=new URL(location.href),I.pathname.endsWith(e.path)?I.pathname=I.pathname.slice(0,I.pathname.length-e.path.length):console.warn("Invalid base url!"),window.addEventListener("popstate",V.update),Ee.stateToken=e.state_token,ne(e.events),Te()}};window.rxxxt=be;var te=document.getElementById("rxxxt-init-data");te!=null&&te.textContent!==null?be.init(JSON.parse(te.textContent)):console.warn("failed to initialize rxxxt. init data not found.");})();
