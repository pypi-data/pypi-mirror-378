{% set keys = h.get_column_names(data) %}
{% set unique_id = h.generate_unique_element_id() %}

<table
    class="{{ table_classes }} {% if nested and toggle_more %}table-sm table-inner{% endif %}"
    {% if not nested and toggle_more %}data-module="table-toggle-more"{% endif %}>
    <thead>
        <tr>
            {% for key in keys %}
                <th scope="col" {% if loop.last and nested and collapse_inner_table %}class="position-relative"{% endif %}>
                    {{ key | capitalize }}

                    {% if loop.last and nested and collapse_inner_table %}
                        <button class="btn btn-sm position-absolute end-0" data-bs-toggle="collapse" data-bs-target="{{ '#' + unique_id }}">
                            <i class="fa-solid fa-chevron-down"></i>
                        </button>
                    {% endif %}
                </th>
            {% endfor %}
        </tr>
    </thead>
    <tbody {% if nested and collapse_inner_table %}class="collapse" id="{{ unique_id }}"{% endif %}>
        {% for row in data %}
            <tr {% if loop.index > toggle_more_threshold and not nested and toggle_more%} class="toggle-more" {% endif %}>
                {% for key in keys %}
                    <td>
                        {% snippet 'resource_docs/view/render.html',
                            data=row[key],
                            view_type=h.detect_view_type(row[key]),
                            nested=1,
                            toggle_more=toggle_more,
                            table_classes=table_classes,
                            toggle_more_threshold=toggle_more_threshold,
                            collapse_inner_table=collapse_inner_table
                        %}
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
    </tbody>
</table>
