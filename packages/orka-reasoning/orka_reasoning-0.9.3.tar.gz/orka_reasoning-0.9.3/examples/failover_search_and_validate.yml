orchestrator:
  id: orka-ui
  strategy: decision-tree
  queue: orka:generated
  agents:
    - answer_9
    - test_failover
    - need_answer
    - router_answer
agents:
  - id: answer_9
    type: local_llm
    model: gpt-oss:20b
    model_url: http://localhost:11434/api/generate
    provider: ollama
    temperature: 0.5
    queue: orka:answer_9
    prompt: >
      Rephrase this input in a more understandable way: "{{ input }}". Make it clearer and more concise.
  - id: test_failover
    type: failover
    input: answer_9
    children:
      - id: failing_test_agent1
        type: failing
        queue: orka:failing_test_agent1
      - id: actual_working_agent
        type: duckduckgo
        queue: orka:actual_working_agent
        prompt: "{{ input }}"
    depends_on:
      - failing_test_agent1
      - actual_working_agent
      - answer_9
  - id: need_answer
    type: local_llm
    model: gpt-oss:20b
    model_url: http://localhost:11434/api/generate
    provider: ollama
    temperature: 0.1
    queue: orka:is_fact
    prompt: "Does '{{ input }}' ask a question that requires an answer, or is it an assertion that requires fact validation? Return true if it is a question, false if it is an assertion. Answer with exactly 'true' or 'false' only."
    depends_on:
      - test_failover
  - id: router_answer
    type: router
    params:
      decision_key: need_answer
      routing_map:
        "true":
          - test_failover2
        "false":
          - validate_fact
    depends_on:
      - need_answer
  - id: test_failover2
    type: failover
    input: router_answer
    children:
      - id: failing_test_agent2
        type: failing
        queue: orka:failing_test_agent2
      - id: build_answer
        type: local_llm
        model: gpt-oss:20b
        model_url: http://localhost:11434/api/generate
        provider: ollama
        temperature: 0.7
        queue: orka:validation_queue
        prompt: |
          Given this question "{{ input }}", and the search results below, return a compelling answer. Be comprehensive and helpful.
          
          Search Results:
          {% if previous_outputs.test_failover %}
          {{ previous_outputs.test_failover | join('\n') if previous_outputs.test_failover is iterable and previous_outputs.test_failover is not string else previous_outputs.test_failover }}
          {% else %}
          No search results available
          {% endif %}
    depends_on:
      - router_answer
      - failing_test_agent2
      - build_answer
  - id: validate_fact
    type: local_llm
    model: gpt-oss:20b
    model_url: http://localhost:11434/api/generate
    provider: ollama
    temperature: 0.3
    queue: orka:validation_queue
    prompt: |
      Validate the following assertion based on the search results. 
      
      Assertion: {{ input }}
      
      Search Results:
      {% if previous_outputs.test_failover %}
      {{ previous_outputs.test_failover | join('\n') if previous_outputs.test_failover is iterable and previous_outputs.test_failover is not string else previous_outputs.test_failover }}
      {% else %}
      No search results available
      {% endif %}
      
      Return a thorough fact-checking analysis based on the available information.
    depends_on:
      - router_answer
