[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "langgraph-executor"
dynamic = ["version"]
description = "LangGraph python RPC server executable by the langgraph-go orchestrator."
readme = "README.md"
# TODO: License
requires-python = ">=3.11"
dependencies = [
    "grpcio>=1.73.1",
    "protobuf>=6.31.1,<7",
    "langgraph>=0.6.5",
    "psutil>=7.0.0",
    "langgraph-distributed-utils>=0.0.1a3",
    "orjson>=3.9.7",
]

[project.packages]
find = { where = ["."] }

[tool.hatch.version]
path = "langgraph_executor/__init__.py"

[dependency-groups]
dev = [
    "ruff>=0.11.12",
    "pytest>=8.3.5",
    "protobuf>=6.31.1",
    "grpcio-tools>=1.73.1",
    "pytest-watcher>=0.4.3",
    "pytest-repeat>=0.9.4",
]


[tool.ruff]
exclude = [
    "venv",
    "build",
    "dist",
    "runtime/pb",
    "server/pb",
    "langgraph_executor/pb",
]
[tool.ruff.lint]
select = [
    "E",      # pycodestyle errors
    "F",      # pyflakes
    "I",      # isort (import sorting)
    "TID251", # banned imports
    "UP",     # pyupgrade (Python version-specific fixes)
    "B",      # flake8-bugbear (common bugs)
    "SIM",    # flake8-simplify (code simplification)
    "RUF",    # ruff-specific rules
]
ignore = [
    "E501",   # line too long (handled by formatter)
    "B006",   # mutable default arguments (sometimes intentional)
    "B904",   # raise without from inside except (sometimes intentional)
    "SIM102", # nested if statements (sometimes clearer)
]
[tool.ruff.lint.flake8-tidy-imports.banned-api]
"typing.TypedDict".msg = "Use typing_extensions.TypedDict instead."
"langgraph.graph.state.CompiledStateGraph".msg = "Use langgraph.pregel.Pregel instead."

[tool.hatch.build]
include = ["langgraph_executor"]
exclude = ["protos/", "docs/"]

[tool.hatch.build.targets.sdist]
exclude = [
    "tests/",
    "protos/",
    "docs/",
    ".github/",
    "dist/",
    "dist*/**",
    "examples.py",
    "examples/",
    ".editorconfig",
    ".langgraph_api",
    "*.ipynb",
    ".python-version",
    ".editorconfig",
    ".venv*/**",
    "pytest.ini",
    ".dockerignore",
]

[tool.pytest-watcher]
now = true
delay = 3
patterns = ["*.py", "../api/**/*.py"]

[tool.pytest.ini_options]
# --strict-markers will raise errors on unknown marks.
# https://docs.pytest.org/en/7.1.x/how-to/mark.html#raising-errors-on-unknown-marks
#
# https://docs.pytest.org/en/7.1.x/reference/reference.html
# --strict-config       any warnings encountered while parsing the `pytest`
#                       section of the configuration file raise errors.
addopts = "--strict-markers --strict-config --durations=5 -vv"

[tool.uv.sources]
langgraph-distributed-utils = { path = "../distributed_utils_py", editable = true}
