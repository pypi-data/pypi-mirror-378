# Dependency Management

## Overview

This document explains the dependency management approach used in ValidateLite and the recent improvements made to separate production and development dependencies.

## Current Structure

### Files

- **`requirements.in`**: High-level production dependencies (unpinned versions)
- **`requirements.txt`**: Pinned production dependencies (generated by pip-compile)
- **`requirements-dev.in`**: High-level development dependencies (unpinned versions)
- **`requirements-dev.txt`**: Pinned development dependencies (generated by pip-compile)
- **`pyproject.toml`**: Modern Python project configuration with dependencies
- **`scripts/update_requirements.py`**: Convenience script for managing requirements

### Production Dependencies

The following packages are considered production dependencies and are included in `requirements.txt`:

#### Core CLI Dependencies
- `click>=8.0.0`: CLI framework
- `rich>=13.0.0`: Colored output and formatting

#### Data Processing
- `pandas>=2.0.0`: Data manipulation and analysis
- `numpy>=1.26.0`: Numerical computing

#### Database ORM and Drivers
- `sqlalchemy[asyncio]>=2.0.0`: Database ORM with async support
- `aiomysql>=0.2.0`: Async MySQL driver
- `asyncpg>=0.29.0`: Async PostgreSQL driver
- `aiosqlite>=0.19.0`: Async SQLite driver
- `mysqlclient>=2.2.0`: MySQL driver
- `psycopg2-binary>=2.9.0`: PostgreSQL driver
- `pymysql>=1.1.0`: Pure Python MySQL driver
- `pyodbc>=5.0.0`: ODBC driver

#### Data Validation and Configuration
- `pydantic>=2.0.0`: Data validation
- `pydantic-settings>=2.2.0`: Settings management
- `python-dotenv>=1.0.0`: Environment variable loading

#### Date and Time Processing
- `python-dateutil>=2.8.0`: Date utilities
- `pytz>=2024.1`: Timezone support

#### Security and Authentication
- `passlib>=1.7.0`: Password hashing
- `python-jose>=3.3.0`: JWT handling

#### Web and UI Components
- `streamlit>=1.32.0`: Web application framework
- `plotly>=5.19.0`: Interactive plotting
- `python-multipart>=0.0.9`: Multipart form data

#### Database Migration
- `alembic>=1.13.0`: Database migration tool

### Development Dependencies

The following packages are considered development dependencies and are included in `requirements-dev.txt`:

#### Testing Framework
- `pytest>=8.0.0`: Testing framework
- `pytest-asyncio>=0.23.0`: Async testing support
- `pytest-cov>=4.1.0`: Coverage reporting
- `pytest-mock>=3.11.0`: Mocking support
- `pytest-html>=4.1.0`: HTML test reports

#### Code Formatting and Quality
- `black>=24.2.0`: Code formatter
- `isort>=5.13.0`: Import sorter
- `flake8>=7.0.0`: Linter
- `mypy>=1.8.0`: Type checker
- `pylint>=2.17.0`: Code analysis

#### Pre-commit Hooks
- `pre-commit>=3.6.0`: Git hooks framework

#### Security and Code Analysis
- `bandit>=1.7.5`: Security linter
- `safety>=2.3.5`: Dependency vulnerability checker

#### Property-based Testing
- `hypothesis>=6.88.0`: Property-based testing

#### Documentation
- `sphinx>=7.0.0`: Documentation generator
- `sphinx-rtd-theme>=1.2.0`: Read the Docs theme

#### Excel Support for Testing
- `openpyxl>=3.1.0`: Excel file handling

#### Type Stubs
- `pandas-stubs>=2.2.0`: Pandas type stubs
- `sqlalchemy-stubs>=0.4`: SQLAlchemy type stubs
- `types-psutil>=6.9.0`: psutil type stubs
- `types-python-dateutil>=2.8.19`: python-dateutil type stubs
- `types-pytz>=2023.3.1`: pytz type stubs
- `types-PyYAML>=6.0.12`: PyYAML type stubs
- `types-requests>=2.31.0`: requests type stubs
- `types-setuptools>=68.1.0`: setuptools type stubs
- `types-six>=1.16.21`: six type stubs
- `types-toml>=0.10.8`: toml type stubs

#### System Monitoring
- `psutil>=5.9.0`: System and process utilities

## Recent Changes

### Before
- `requirements.txt` contained both production and development dependencies
- `requirements-dev.txt` included all production dependencies via `-r requirements.txt`
- No clear separation between production and development needs
- Manual version pinning without tooling

### After
- **Clean separation**: Production dependencies only in `requirements.txt`
- **Development isolation**: Development dependencies only in `requirements-dev.txt`
- **pip-tools integration**: Automated dependency pinning and management
- **Better maintainability**: Clear distinction between runtime and development needs

## Usage

### For Production Deployment

```bash
# Install only production dependencies
pip install -r requirements.txt
```

### For Development

```bash
# Install both production and development dependencies
pip install -r requirements.txt
pip install -r requirements-dev.txt
```

### Using pip-tools (Recommended for Development)

```bash
# Install pip-tools
pip install pip-tools

# Generate pinned requirements from .in files
python scripts/update_requirements.py

# Install dependencies
pip install -r requirements.txt
pip install -r requirements-dev.txt
```

### Adding New Dependencies

#### Production Dependencies
1. Add to `requirements.in`:
   ```bash
   echo "new-package>=1.0.0" >> requirements.in
   ```
2. Regenerate pinned requirements:
   ```bash
   python scripts/update_requirements.py
   ```

#### Development Dependencies
1. Add to `requirements-dev.in`:
   ```bash
   echo "new-dev-package>=1.0.0" >> requirements-dev.in
   ```
2. Regenerate pinned requirements:
   ```bash
   python scripts/update_requirements.py
   ```

### Updating Dependencies

```bash
# Update all dependencies to latest compatible versions
python scripts/update_requirements.py
```

## Benefits

1. **Reduced Production Footprint**: Production deployments only install necessary runtime dependencies
2. **Better Security**: Fewer dependencies in production reduces attack surface
3. **Faster Deployments**: Smaller dependency set means faster installation
4. **Clear Separation**: Developers know exactly what's needed for development vs. production
5. **Reproducible Builds**: Pinned versions ensure consistent environments
6. **Easy Maintenance**: pip-tools automates dependency management

## Migration Notes

If you're migrating from the old requirements structure:

1. **Production deployments**: No changes needed, continue using `pip install -r requirements.txt`
2. **Development environments**: Install both files: `pip install -r requirements.txt && pip install -r requirements-dev.txt`
3. **CI/CD pipelines**: Update to install both files for development environments

## Troubleshooting

### Common Issues

1. **Missing dependencies**: Ensure you're installing both `requirements.txt` and `requirements-dev.txt` for development
2. **Version conflicts**: Use pip-tools to resolve conflicts automatically
3. **Type stub issues**: Some type stubs may have compatibility issues; remove problematic ones as needed

### Getting Help

- Check the [DEVELOPMENT_SETUP.md](DEVELOPMENT_SETUP.md) for detailed setup instructions
- Review the [pyproject.toml](../pyproject.toml) for the complete dependency specification
- Use `python scripts/update_requirements.py --help` for script usage
