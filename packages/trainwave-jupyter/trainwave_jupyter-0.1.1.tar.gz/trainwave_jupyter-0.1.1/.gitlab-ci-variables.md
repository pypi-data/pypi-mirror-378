# GitLab CI Variables Setup

This document describes the environment variables that need to be configured in your GitLab project for the CI/CD pipeline to work properly.

## Required Variables

### For PyPI Publishing (`publish:pypi` job)

- **`PYPI_TOKEN`** (Required for publishing)
  - Description: PyPI API token for uploading packages
  - Type: Variable
  - Protected: Yes (recommended)
  - Masked: Yes (recommended)
  - How to get:
    1. Go to [PyPI.org](https://pypi.org) and log in
    2. Go to Account Settings → API tokens
    3. Create a new API token with scope "Entire account" or "Specific project: trainwave-jupyter"
    4. Copy the token (it starts with `pypi-`)

### For NPM Publishing (`publish:npm` job) - Optional

- **`NPM_TOKEN`** (Optional, only if you want to publish to npm)
  - Description: NPM authentication token
  - Type: Variable
  - Protected: Yes (recommended)
  - Masked: Yes (recommended)
  - How to get:
    1. Go to [npmjs.com](https://www.npmjs.com) and log in
    2. Go to Access Tokens in your account settings
    3. Generate a new token with "Automation" type
    4. Copy the token

## How to Set Variables in GitLab

1. Go to your GitLab project
2. Navigate to **Settings** → **CI/CD**
3. Expand the **Variables** section
4. Click **Add variable**
5. Fill in the variable details:
   - **Key**: The variable name (e.g., `PYPI_TOKEN`)
   - **Value**: The token value
   - **Type**: Variable
   - **Environment scope**: All (default)
   - **Protect variable**: Check this if you want to limit access to protected branches only
   - **Mask variable**: Check this to hide the value in job logs
   - **Expand variable reference**: Leave unchecked

## Security Best Practices

- Always use **Protected** and **Masked** for sensitive tokens
- Use project-specific tokens when possible (e.g., PyPI project token instead of account token)
- Regularly rotate your tokens
- Never commit tokens to your repository

## Testing the Setup

After setting up the variables, you can test the pipeline by:

1. Making a commit to the `main` branch (this will trigger the test jobs)
2. Going to **CI/CD** → **Pipelines** in your GitLab project
3. Manually triggering the build and publish jobs when ready to release

## Troubleshooting

### Common Issues

1. **"Authentication failed" errors**: Check that your tokens are correctly set and not expired
2. **"Package already exists" errors**: Make sure to increment the version number in `package.json` and `pyproject.toml` before publishing
3. **"Permission denied" errors**: Ensure your tokens have the correct permissions for the target registry

### Getting Help

- Check the GitLab CI/CD logs for detailed error messages
- Verify that all required variables are set in the project settings
- Ensure your tokens are valid and have the correct permissions
