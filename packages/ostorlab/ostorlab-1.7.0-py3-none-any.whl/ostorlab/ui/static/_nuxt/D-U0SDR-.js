import{c as ne,Y as E,_ as ue}from"./CEcGv1tb.js";import{W as re,X as ie,Y as de,Z as ce,$ as pe,j as $,a0 as me,a1 as ve,a2 as R,a3 as W,z as l,a4 as M,a5 as fe,a6 as ge,a7 as Ve,d as ye,r as m,a as be,o as Ae,a8 as Y,J as B,v as A,A as o,x as v,t as z,B as c,y as p,a9 as H,U as w,Q as J,aa as L,L as K,S as Q,R as Se,T as Ce,ab as ke,V as X}from"./Drw0dDXY.js";import{u as xe,V as _e,b as Ge,a as he}from"./Dl6276N_.js";import{_ as we,V as Te}from"./DepNdJqZ.js";import{a as D,b as Fe,A as Ue}from"./D5dkpzGL.js";import{u as Ie}from"./DSKYwBdE.js";import{V as Z,a as Pe}from"./BN2GUHPa.js";import{_ as Ne}from"./DlAUqK2U.js";const Ee=ie({...ge(),...fe(Ve(),["inline"])},"VCheckbox"),q=re()({name:"VCheckbox",inheritAttrs:!1,props:Ee(),emits:{"update:modelValue":n=>!0,"update:focused":n=>!0},setup(n,T){let{attrs:S,slots:s}=T;const f=de(n,"modelValue"),{isFocused:C,focus:k,blur:u}=ce(n),r=pe(),g=$(()=>n.id||`checkbox-${r}`);return me(()=>{const[F,x]=ve(S),i=R.filterProps(n),U=W.filterProps(n);return l(R,M({class:["v-checkbox",n.class]},F,i,{modelValue:f.value,"onUpdate:modelValue":V=>f.value=V,id:g.value,focused:C.value,style:n.style}),{...s,default:V=>{let{id:y,messagesId:b,isDisabled:I,isReadonly:P,isValid:_}=V;return l(W,M(U,{id:y.value,"aria-describedby":b.value,disabled:I.value,readonly:P.value},x,{error:_.value===!1,modelValue:f.value,"onUpdate:modelValue":d=>f.value=d,onFocus:k,onBlur:u}),s)}})}),{}}}),Be=ne(ue),Le={class:"pb-5"},De={key:0,class:"mb-0"},$e={key:1,class:"mb-0"},Me={class:"d-flex align-center custom-option"},je={class:"d-flex align-center custom-option"},Oe={class:"mb-4"},Re="yaml",We=ye({__name:"AgentGroupForm",props:{agentGroup:{type:Object,default:()=>({id:"",key:"",name:"",description:"",agents:{agents:[]}})},isEditMode:{type:Boolean,default:!1},scanner:{type:Object,default:()=>({endpoint:"",name:"",apiKey:""})}},emits:["close-form"],setup(n,{emit:T}){const S={id:"",key:"",name:"",description:"",agents:{agents:[]}},s=n,f=m(),C=T,k=xe(),u=m(S),r=m(""),g=Object.keys(D).map(t=>({title:D[t],icon:Fe[t]})),F=t=>t.toLowerCase().split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),x=Object.values(D).reduce((t,e)=>(t[e]=F(e),t),{}),i=m([]),U=t=>i.value.includes(t.title),V=t=>{if(t.title==="Select All"){b();return}const e=i.value.findIndex(N=>N===t.title);e===-1?i.value.push(t.value):i.value.splice(e,1)},y=$(()=>i.value.length===g.length),b=()=>{y.value===!0?i.value=[]:i.value=g.map(t=>t.title)},I={theme:"vs",wordWrap:"on",wordWrapColumn:"on",fontFamily:"Fira Code",automaticLayout:!0,minimap:{enabled:!1},Placeholder:!0,PlaceholderText:"Start typing here"},{$axios:P}=be(),_=new Ue(P),d=m(null),j=m([]),G=m(!1);Ae(()=>{r.value="",s.agentGroup!==null&&s.agentGroup!==void 0&&s.agentGroup.yamlSource!==null&&s.agentGroup.yamlSource!==void 0&&(r.value=s.agentGroup.yamlSource),s.scanner!==null&&s.scanner!==void 0&&(d.value=s.scanner)});const h=$(()=>d.value!=null&&r.value.trim()!==""),ee=t=>{const e=E.stringify(E.parse(t));if(e!=null)return e},te=async()=>{if(h.value===!0&&u.value!==null)try{const t=ee(r.value);if(d.value!==null&&t!==null&&t!==void 0){const e=E.parse(t);s.isEditMode==!0&&await _.deleteAgentGroup(d.value,parseInt(u.value.id)),await _.createAgentGroup({scanner:d.value,agentGroup:{description:u.value.description||"",agents:e==null?void 0:e.agents,name:u.value.name,assetTypes:i.value}})}O(),C("close-form"),k.reportSuccess("Agent group saved successfully.")}catch(t){k.reportError((t==null?void 0:t.message)||"Failed to save Agent group information. Please try again.")}},O=()=>{u.value=S,r.value="",d.value=null},ae=()=>{O(),C("close-form")},le=t=>{const e=(t.name||"").trim()!=="";return{title:e?t.name:t.endpoint,subtitle:e?t.endpoint:""}};Y(()=>s.agentGroup,t=>{var e;u.value={...t},r.value=((e=s.agentGroup)==null?void 0:e.yamlSource)||""},{immediate:!0,deep:!0}),Y(()=>r,t=>{r.value=t.value},{immediate:!0,deep:!0});const oe=Ie();return j.value=oe.scanners||[],(t,e)=>{const N=Be;return A(),B(Te,{ref_key:"form",ref:f,modelValue:h.value,"onUpdate:modelValue":e[8]||(e[8]=a=>h.value=a),onSubmit:L(te,["prevent"])},{default:o(()=>[v("div",Le,[l(Z,{modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),items:j.value,"item-props":le,"hide-details":"",variant:"outlined","item-title":"endpoint",density:"compact",clearable:"","return-object":"",disabled:n.isEditMode,label:"Select a scanner",placeholder:"Select or create a scanner for the agent group"},{selection:o(({item:a})=>[(a.raw.name||"").trim()!==""?(A(),z("p",De,[c(p(a.raw.name)+" (",1),v("code",null,p(a.raw.endpoint),1),e[9]||(e[9]=c(") "))])):(A(),z("code",$e,p(a.raw.endpoint),1))]),"no-data":o(()=>[v("p",{class:"create-scanner mb-0 pl-4 py-0",onClick:e[0]||(e[0]=a=>G.value=!0)}," Create New Scanner ")]),_:1},8,["modelValue","items","disabled"]),l(Pe,{modelValue:G.value,"onUpdate:modelValue":e[3]||(e[3]=a=>G.value=a),persistent:"","max-width":"600px"},{default:o(()=>[l(_e,null,{default:o(()=>[l(Ge,null,{default:o(()=>e[10]||(e[10]=[v("span",{class:"headline"},"Create New Scanner",-1)])),_:1}),l(he,null,{default:o(()=>[l(we,{onCloseForm:e[2]||(e[2]=a=>G.value=!1)})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),l(H,{modelValue:u.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>u.value.name=a),variant:"outlined",density:"compact",label:"Agent Group Name",placeholder:"Agent Group Name"},null,8,["modelValue"]),l(H,{modelValue:u.value.description,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value.description=a),variant:"outlined",density:"compact",label:"Agent Group Description",placeholder:"Agent Group Description"},null,8,["modelValue"]),l(Z,{modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value=a),class:"mb-4",items:w(g),"hide-details":"",variant:"outlined",density:"compact",clearable:"",multiple:"",label:"Choose Asset Types",placeholder:"Choose Asset Types"},{selection:o(({item:a})=>[(A(),B(Ce,{key:a.value,variant:"outlined"},{default:o(()=>[l(K,{class:"ml-0",size:"18",start:""},{default:o(()=>[c(p(a.raw.icon),1)]),_:2},1024),c(" "+p(w(x)[a.title]),1)]),_:2},1024))]),"prepend-item":o(()=>[l(J,{disabled:w(g).length===0,onClick:b},{default:o(()=>[v("div",Me,[l(q,{"model-value":y.value,class:"mt-5",onClick:L(b,["stop"])},null,8,["model-value"]),l(Q,null,{default:o(()=>[c(p(y.value===!0?"Deselect All":"Select All"),1)]),_:1})])]),_:1},8,["disabled"]),l(Se)]),item:o(({item:a})=>[(A(),B(J,M(a,{key:a.value,title:"",onClick:se=>V(a)}),{default:o(()=>[v("div",je,[l(q,{"model-value":U(a),class:"mt-5",onClick:L(se=>V(a),["stop"])},null,8,["model-value","onClick"]),l(K,null,{default:o(()=>[c(p(a.raw.icon),1)]),_:2},1024),l(Q,{class:"ml-3"},{default:o(()=>[c(p(w(x)[a.title]),1)]),_:2},1024)])]),_:2},1040,["onClick"]))]),_:1},8,["modelValue","items"]),v("div",Oe,[l(ke,null,{default:o(()=>e[11]||(e[11]=[c(" Agent Group Definition ")])),_:1}),l(N,{modelValue:r.value,"onUpdate:modelValue":e[7]||(e[7]=a=>r.value=a),lang:Re,options:I,style:{"min-height":"300px"}},null,8,["modelValue"])]),l(X,{class:"me-2",type:"submit",color:"success",text:"Save","prepend-icon":"mdi-check",disabled:!h.value},null,8,["disabled"]),l(X,{text:"Cancel","prepend-icon":"mdi-close",onClick:ae})]),_:1},8,["modelValue"])}}}),qe=Ne(We,[["__scopeId","data-v-5fbf6fc2"]]);export{qe as A};
