import{W as pe,X as fe,j as R,ax as p,az as ge,a0 as he,z as t,a4 as w,aR as Se,O as V,R as Y,d as q,H as be,t as D,v as d,g as f,A as s,V as C,B as l,L as B,T as ve,y,M as ye,N as De,P as z,J as k,Q as ke,x as Ve,S as Pe,I as we,K as Ce}from"./Drw0dDXY.js";import{d as Te,O as Ae,e as Re,u as Be,V as $,b as W,D as $e,c as Ee}from"./Dl6276N_.js";import{S as Ie}from"./BHg-Hw-P.js";import{D as Le}from"./DhtSED-n.js";import{c as Oe,a as Ne,b as Me,d as He,u as Fe,p as Ge,e as Ue,f as _e,g as je,h as Xe,i as Ye,j as qe,k as G,l as U,m as _,n as j,o as ze,q as We,r as Je,D as Ke}from"./CEjUWhr1.js";import{_ as J}from"./DlAUqK2U.js";import{S as Qe}from"./AyrZIlXI.js";import{u as Ze}from"./DSKYwBdE.js";import{V as xe}from"./DXuxIPpi.js";import{V as X}from"./2ttuFdm1.js";import"./CM2z5-Yq.js";import"./BO5QyVBF.js";import"./BN2GUHPa.js";const et=fe({itemsLength:{type:[Number,String],required:!0},...Je(),...We(),...ze()},"VDataTableServer"),tt=pe()({name:"VDataTableServer",props:et(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,o){let{attrs:T,slots:a}=o;const{groupBy:g}=Oe(e),{sortBy:m,multiSort:h,mustSort:S}=Ne(e),{page:c,itemsPerPage:u}=Me(e),n=R(()=>parseInt(e.itemsLength,10)),{columns:r,headers:P}=He(e,{groupBy:g,showSelect:p(e,"showSelect"),showExpand:p(e,"showExpand")}),{items:b}=Fe(e,r),{toggleSort:E}=Ge({sortBy:m,multiSort:h,mustSort:S,page:c}),{opened:K,isGroupOpen:Q,toggleGroup:Z,extractRows:x}=Ue({groupBy:g,sortBy:m}),{pageCount:ee,setItemsPerPage:te}=_e({page:c,itemsPerPage:u,itemsLength:n}),{flatItems:I}=je(b,g,K),{isSelected:ae,select:se,selectAll:oe,toggleSelect:ne,someSelected:re,allSelected:le}=Xe(e,{allItems:b,currentPage:b}),{isExpanded:ie,toggleExpand:de}=Ye(e),L=R(()=>x(b.value));qe({page:c,itemsPerPage:u,sortBy:m,groupBy:g,search:p(e,"search")}),Se("v-data-table",{toggleSort:E,sortBy:m}),ge({VDataTableRows:{hideNoData:p(e,"hideNoData"),noDataText:p(e,"noDataText"),loading:p(e,"loading"),loadingText:p(e,"loadingText")}});const i=R(()=>({page:c.value,itemsPerPage:u.value,sortBy:m.value,pageCount:ee.value,toggleSort:E,setItemsPerPage:te,someSelected:re.value,allSelected:le.value,isSelected:ae,select:se,selectAll:oe,toggleSelect:ne,isExpanded:ie,toggleExpand:de,isGroupOpen:Q,toggleGroup:Z,items:L.value.map(A=>A.raw),internalItems:L.value,groupedItems:I.value,columns:r.value,headers:P.value}));he(()=>{const A=G.filterProps(e),ce=U.filterProps(e),ue=_.filterProps(e),me=j.filterProps(e);return t(j,w({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},me),{top:()=>{var v;return(v=a.top)==null?void 0:v.call(a,i.value)},default:()=>{var v,O,N,M,H,F;return a.default?a.default(i.value):t(V,null,[(v=a.colgroup)==null?void 0:v.call(a,i.value),!e.hideDefaultHeader&&t("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[t(U,w(ce,{sticky:e.fixedHeader}),a)]),(O=a.thead)==null?void 0:O.call(a,i.value),!e.hideDefaultBody&&t("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(N=a["body.prepend"])==null?void 0:N.call(a,i.value),a.body?a.body(i.value):t(_,w(T,ue,{items:I.value}),a),(M=a["body.append"])==null?void 0:M.call(a,i.value)]),(H=a.tbody)==null?void 0:H.call(a,i.value),(F=a.tfoot)==null?void 0:F.call(a,i.value)])},bottom:()=>a.bottom?a.bottom(i.value):!e.hideDefaultFooter&&t(V,null,[t(Y,null,null),t(G,A,{prepend:a["footer.prepend"]})])})})}}),at=[{title:"Target",align:"left",sortable:!1,key:"asset"},{title:"Title",align:"left",sortable:!1,key:"title",width:"24%"},{title:"Created time (UTC)",align:"left",sortable:!1,key:"CreatedTime",width:"14%"},{title:"Progress",align:"left",sortable:!1,key:"Progress",width:"8%"},{title:"Risk Rating",align:"left",sortable:!1,key:"RiskRating",width:"10%"}],st=q({components:{OXOAssets:Ae,DfScanProgress:Le,DfRisk:Te,DfConfirmationModal:Ke},props:{scanner:{type:Object,required:!0}},data(){return{selected:[],service:new Ie(this.$axios),scans:[],deleteScanDialog:!1,loading:!0,options:{itemsPerPage:15,page:1,sortDesc:[!0],sortBy:[{key:"CreatedTime",order:"desc"}]},onActionScan:null,stopDialog:!1,headers:at,currentPage:0}},watch:{options:{handler(){this.fetchScans()},deep:!0}},methods:{...be(Be,["reportSuccess","reportError"]),goToScan(e,o){this.$router.push({name:"scan-scanner-scan",params:{scan:o.item.id,scanner:Re(this.scanner.endpoint)}})},stopScans(e){this.onActionScan=e,this.stopDialog=!0},async confirmStopSelectedScans(){try{await this.service.stopScans(this.scanner,this.selected),await this.fetchScans()}catch(e){this.reportError((e==null?void 0:e.message)||"An error occurred while stopping the scans")}finally{this.onActionScan=null,this.selected=[]}},deleteScans(e){this.onActionScan=e,this.deleteScanDialog=!0},async confirmDeleteSelectedScans(){if(!(this.onActionScan===null||this.onActionScan===void 0)){try{this.loading=!0,await this.service.deleteScans(this.scanner,this.selected),this.reportSuccess("Scans deleted successfully")}catch(e){this.reportError(`An error occurred while deleting the scan: ${e==null?void 0:e.message}`)}finally{this.onActionScan=null,this.loading=!1,this.selected=[]}await this.fetchScans()}},async fetchScans(){this.loading=!0;try{if(!this.scanner)return;this.scans=await this.service.getScans(this.scanner,{numberElements:this.options.itemsPerPage,page:this.options.page})}catch(e){this.reportError(`An error occurred while fetching scans from: ${this.scanner.name||this.scanner.endpoint}: ${e.message}`)}finally{this.loading=!1}}}}),ot={class:"d-flex align-center"};function nt(e,o,T,a,g,m){const h=f("DfConfirmationModal"),S=f("DfScanProgress"),c=f("DfRisk"),u=f("OXOAssets");return d(),D("div",null,[t(h,{modelValue:e.stopDialog,"onUpdate:modelValue":o[0]||(o[0]=n=>e.stopDialog=n),title:"Are you sure you would like to stop the selected scans?",description:"A stopped scan cannot be resumed.","cancel-button-text":"Cancel","confirm-button-text":"Stop","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-stop-circle-outline",onConfirm:e.confirmStopSelectedScans},null,8,["modelValue","onConfirm"]),t(h,{modelValue:e.deleteScanDialog,"onUpdate:modelValue":o[1]||(o[1]=n=>e.deleteScanDialog=n),title:"Are you sure you would like to archive the selected scans?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-archive-arrow-down-outline",onConfirm:e.confirmDeleteSelectedScans},null,8,["modelValue","onConfirm"]),t($,{variant:"outlined",class:"mb-5"},{default:s(()=>[t(C,{icon:e.mdi-e.refresh,disabled:e.selected.length===0,class:"mx-1 my-1",onClick:e.stopScans},{default:s(()=>[t(B,{start:""},{default:s(()=>o[4]||(o[4]=[l(" mdi-stop-circle-outline ")])),_:1}),o[5]||(o[5]=l("Stop "))]),_:1},8,["icon","disabled","onClick"]),t(C,{disabled:e.selected.length===0,class:"mx-1 my-1",onClick:e.deleteScans},{default:s(()=>[t(B,{start:""},{default:s(()=>o[6]||(o[6]=[l(" mdi-trash-can-outline ")])),_:1}),o[7]||(o[7]=l("Delete "))]),_:1},8,["disabled","onClick"])]),_:1}),t($,{variant:"outlined"},{default:s(()=>[t(W,{class:"pt-2 pl-2"},{default:s(()=>[t(ve,{label:""},{default:s(()=>[l(y(e.scanner.name||e.scanner.endpoint),1)]),_:1})]),_:1}),t(tt,{options:e.options,"onUpdate:options":o[2]||(o[2]=n=>e.options=n),modelValue:e.selected,"onUpdate:modelValue":o[3]||(o[3]=n=>e.selected=n),hover:"","show-select":"",headers:e.headers,items:e.scans,"items-length":e.service.totalScans,loading:e.loading,"items-per-page-options":[15,50,200,-1],"items-per-page":e.options.itemsPerPage,density:"comfortable","onClick:row":e.goToScan},{"item.Progress":s(({item:n})=>[t(S,{progress:n.progress||"unknown"},null,8,["progress"])]),"item.RiskRating":s(({item:n})=>[t(c,{risk:n.riskRating||"unknown"},null,8,["risk"])]),"item.CreatedTime":s(({item:n})=>[l(y(e.$moment(n.createdTime).format("MMMM Do YYYY, k:mm:ss")),1)]),"item.Action":s(({item:n})=>[t(ye,{bottom:"",left:"","offset-y":""},{activator:s(({props:r})=>[t(C,w({icon:"mdi-dots-vertical"},r,{variant:"flat",size:"small"}),null,16)]),default:s(()=>[t(De,{density:"compact"},{default:s(()=>[(d(!0),D(V,null,z(e.actions,(r,P)=>(d(),D(V,null,[r.divider!==void 0?(d(),k(Y,{key:`divider-${P}`,class:"mb-2 mt-2"})):(d(),k(ke,{key:`item-${P}`,density:"compact",disabled:r.disabled?r.disabled(n):!1,onClick:b=>r.action&&r.action(n)},{default:s(()=>[Ve("div",ot,[t(B,{start:""},{default:s(()=>[l(y(r.icon),1)]),_:2},1024),t(Pe,null,{default:s(()=>[l(y(r.title),1)]),_:2},1024)])]),_:2},1032,["disabled","onClick"]))],64))),256))]),_:2},1024)]),_:2},1024)]),"item.asset":s(({item:n})=>[t(u,{assets:n.assets||[]},null,8,["assets"])]),"item.title":s(({item:n})=>[l(y(n.title||"-"),1)]),_:2},1032,["options","modelValue","headers","items","items-length","loading","items-per-page","onClick:row"])]),_:1})])}const rt=J(st,[["render",nt]]),lt=q({components:{ScanList:rt,DfBreadcrumbs:$e,SvgLoader:Qe},data(){return{loading:!0,breadcrumbs:[{text:"Scans",to:"/scan/list",exact:!0,disabled:!0}]}},computed:{...we(Ze,["scanners"])},mounted(){this.loading=!1}});function it(e,o,T,a,g,m){const h=f("DfBreadcrumbs"),S=f("SvgLoader"),c=f("scan-list");return d(),D("div",null,[t(h,{breadcrumbs:e.breadcrumbs,class:"mb-5"},null,8,["breadcrumbs"]),t(xe,{justify:"center"},{default:s(()=>[e.loading===!0?(d(),k(S,{key:0})):e.loading===!1&&e.scanners.length>0?(d(!0),D(V,{key:1},z(e.scanners,u=>(d(),k(X,{key:u.endpoint,cols:"12"},{default:s(()=>[t(c,{scanner:u},null,8,["scanner"])]),_:2},1024))),128)):e.loading===!1&&e.scanners.length===0?(d(),k(X,{key:2,content:"center","align-self":"center"},{default:s(()=>[t($,{variant:"outlined"},{default:s(()=>[t(W,null,{default:s(()=>o[0]||(o[0]=[l("No scanners found")])),_:1}),t(Ee,null,{default:s(()=>[t(C,{variant:"elevated",color:"accent",to:"/scanners"},{default:s(()=>o[1]||(o[1]=[l(" Add Scanner ")])),_:1})]),_:1})]),_:1})]),_:1})):Ce("",!0)]),_:1})])}const kt=J(lt,[["render",it]]);export{kt as default};
