import{d as _,H as I,I as D,g as d,t as m,v as r,z as o,J as i,K as g,A as n,V as b,L as C,M,N as V,O as G,P as k,Q as w,B as c,y as v,R as N,S as T,T as S}from"./Drw0dDXY.js";import{u as E,V as f,D as P,a as Y,b as K,c as R}from"./Dl6276N_.js";import{Y as z}from"./CEcGv1tb.js";import{A as O}from"./D-U0SDR-.js";import{A as W}from"./D5dkpzGL.js";import{D as H,V as J}from"./CEjUWhr1.js";import{u as $}from"./DSKYwBdE.js";import{_ as F}from"./DlAUqK2U.js";import{S as Q}from"./AyrZIlXI.js";import{V as U}from"./2ttuFdm1.js";import"./CM2z5-Yq.js";import"./DepNdJqZ.js";import"./BN2GUHPa.js";import"./BO5QyVBF.js";const j=_({components:{DfConfirmationModal:H,AgentGroupForm:O},data(){return{loading:!0,agentGroupService:new W(this.$axios),agentGroups:[],headers:[{title:"Key",align:"left",sortable:!1,key:"key",width:"10%"},{title:"Description",align:"left",sortable:!1,key:"description",width:"14%"},{title:"Agents",align:"left",sortable:!1,key:"agents",width:"20%"},{title:"Actions",align:"left",sortable:!1,key:"actions",width:"5%"}],onActionAgentGroup:null,itemsPerPage:15,editorLanguage:"yaml",editorOptions:{theme:"vs",wordWrap:"on",wordWrapColumn:"on",fontFamily:"Fira Code",automaticLayout:!0,minimap:{enabled:!1}},deleteAgentGroupDialog:!1,showForm:!1,selectedAgentGroup:null,expandedItem:null}},computed:{...D($,["scanners"]),actions(){return[{title:"Edit",action:e=>this.updateAgentGroup(e),icon:"mdi-pencil-outline",color:"primary",divider:!0},{title:"Delete",action:e=>this.deleteAgentGroup(e),icon:"mdi-delete",color:"red"}]}},watch:{selectedAgentGroup(e){this.selectedAgentGroup=e}},mounted(){this.fetchAgentGroups()},methods:{...I(E,["reportSuccess","reportError"]),async fetchAgentGroups(){this.agentGroups=[],this.loading=!0;try{const e=this.scanners.map(async t=>{try{const a=await this.agentGroupService.getAgentGroups(t);Array.isArray(a)==!0&&this.agentGroups.push(...a.map(l=>({...l,scanner:t})))}catch(a){this.reportError((a==null?void 0:a.message)||"Error fetching agent groups")}});await Promise.allSettled(e)}finally{this.loading=!1}},parseYaml(e){try{return z.parse(e).agents||[]}catch{return[]}},getVisibleAgents(e){return this.parseYaml(e).slice(0,4)},getRemainingCount(e){const t=this.parseYaml(e);return Math.max(0,t.length-4)},deleteAgentGroup(e){this.onActionAgentGroup=e,this.deleteAgentGroupDialog=!0},async confirmDeleteAgentGroup(){if(this.onActionAgentGroup!=null)try{this.loading=!0,this.onActionAgentGroup!==null&&this.onActionAgentGroup.id!==void 0&&(await this.agentGroupService.deleteAgentGroup(this.onActionAgentGroup.scanner,parseInt(this.onActionAgentGroup.id)),this.reportSuccess("Agent group deleted successfully"),this.agentGroups=this.agentGroups.filter(e=>{var t;return e.id!==((t=this.onActionAgentGroup)==null?void 0:t.id)}))}catch(e){this.reportError((e==null?void 0:e.message)||"An error occurred while deleting the agent group")}finally{this.onActionAgentGroup=null,this.loading=!1}},updateAgentGroup(e){this.selectedAgentGroup=e,this.showForm=!0,window.scrollTo({top:0,behavior:"smooth"})},onCloseForm(){this.showForm=!1,this.selectedAgentGroup=null,this.loading=!0,this.fetchAgentGroups()},formatAgentKey(e){const t=e.split("/"),a=t[1],l=t[2];return a==="ostorlab"?`@${l}`:`@${a}/${l}`},createAgentGroup(e){return e!==null&&e.id!==null&&e.id!==void 0?{id:e.id,name:e.name,key:e.key,yamlSource:e.yamlSource,description:e.description,agents:{agents:[]}}:null}}});function q(e,t,a,l,L,B){const h=d("DfConfirmationModal"),A=d("AgentGroupForm"),y=d("v-list-item-content");return r(),m("div",null,[o(h,{modelValue:e.deleteAgentGroupDialog,"onUpdate:modelValue":t[0]||(t[0]=s=>e.deleteAgentGroupDialog=s),title:"Are you sure you would like to delete this Agent group?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-delete-outline",onConfirm:e.confirmDeleteAgentGroup},null,8,["modelValue","onConfirm"]),e.showForm===!0?(r(),i(f,{key:0,variant:"outlined",class:"pa-4 mb-4"},{default:n(()=>{var s;return[o(A,{"agent-group":e.createAgentGroup(e.selectedAgentGroup),scanner:(s=e.selectedAgentGroup)==null?void 0:s.scanner,"is-edit-mode":!0,onCloseForm:e.onCloseForm},null,8,["agent-group","scanner","onCloseForm"])]}),_:1})):g("",!0),o(f,{variant:"outlined"},{default:n(()=>[o(J,{loading:e.loading,hover:"",headers:e.headers,items:e.agentGroups,"items-per-page-options":[15,50,200,-1],"items-per-page":e.itemsPerPage,density:"comfortable"},{"item.agents":n(({item:s})=>[o(V,{dense:""},{default:n(()=>[o(w,null,{default:n(()=>[o(y,null,{default:n(()=>[o(T,{class:"chip-container"},{default:n(()=>[(r(!0),m(G,null,k(e.getVisibleAgents(s.yamlSource),(u,p)=>(r(),i(S,{key:p,class:"mr-1"},{default:n(()=>[c(v(e.formatAgentKey(u.key)),1)]),_:2},1024))),128)),e.getRemainingCount(s.yamlSource)>0?(r(),i(S,{key:0,class:"mr-1",color:"grey lighten-2","text-color":"black",style:{"min-width":"50px",padding:"0 12px"}},{default:n(()=>[c(" +"+v(e.getRemainingCount(s.yamlSource)),1)]),_:2},1024)):g("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),"item.actions":n(({item:s})=>[o(b,{variant:"text",size:"small",icon:!0},{default:n(()=>[o(C,{icon:"mdi-dots-vertical"}),o(M,{activator:"parent",location:"bottom"},{default:n(()=>[o(V,{density:"compact",class:"py-0"},{default:n(()=>[(r(!0),m(G,null,k(e.actions,(u,p)=>(r(),m(G,{key:`item-${u.title}-${p}`},[o(w,{onClick:ee=>u.action(s)},{default:n(()=>[o(C,{start:"",size:"small",icon:u.icon},null,8,["icon"]),c(" "+v(u.title),1)]),_:2},1032,["onClick"]),p!==e.actions.length-1?(r(),i(N,{key:0})):g("",!0)],64))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["loading","headers","items","items-per-page"])]),_:1})])}const X=F(j,[["render",q],["__scopeId","data-v-f579388a"]]),Z=_({components:{AgentGroupsList:X,DfBreadcrumbs:P,SvgLoader:Q},data(){return{loading:!0,breadcrumbs:[{text:"Agent Groups",to:"/agent-groups/list",exact:!0,disabled:!0}],showForm:!1}},computed:{...D($,["scanners"])},mounted(){this.loading=!1}});function x(e,t,a,l,L,B){const h=d("DfBreadcrumbs"),A=d("SvgLoader"),y=d("AgentGroupsList");return r(),m("div",null,[o(h,{breadcrumbs:e.breadcrumbs,class:"mb-5"},null,8,["breadcrumbs"]),o(f,{variant:"outlined",class:"my-4"},{default:n(()=>[o(Y,null,{default:n(()=>[o(b,{color:"accent","prepend-icon":"mdi-plus",to:"/agent-groups/new"},{default:n(()=>t[0]||(t[0]=[c(" New ")])),_:1})]),_:1})]),_:1}),e.loading===!0?(r(),i(A,{key:0})):e.loading===!1&&e.scanners.length>0?(r(),i(y,{key:1})):e.loading===!1&&e.scanners.length===0?(r(),i(U,{key:2,content:"center","align-self":"center"},{default:n(()=>[o(f,{variant:"outlined"},{default:n(()=>[o(K,null,{default:n(()=>t[1]||(t[1]=[c("No scanners found")])),_:1}),o(R,null,{default:n(()=>[o(b,{variant:"elevated",color:"accent",to:"/scanners"},{default:n(()=>t[2]||(t[2]=[c(" Add Scanner ")])),_:1})]),_:1})]),_:1})]),_:1})):g("",!0)])}const fe=F(Z,[["render",x]]);export{fe as default};
