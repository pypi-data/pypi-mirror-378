import{Y as W,c as J,_ as Q}from"./CEcGv1tb.js";import{d as Y,t as c,v as r,z as s,A as n,V as T,x as d,y,aa as z,g as f,H as Z,I as _,ac as $,a4 as P,B as u,L as D,R as A,N as x,Q as V,S as w,J as g,T as S,ad as ee,ae as te,af as ae,K as se}from"./Drw0dDXY.js";import{d as q,V as B,D as ne,O as ie,e as O,u as oe,b as G,a as le}from"./Dl6276N_.js";import{s as re,V as de,a as ue}from"./D3kt_xS_.js";import{S as pe}from"./BHg-Hw-P.js";import{V as ce,D as me}from"./CEjUWhr1.js";import{_ as F}from"./DlAUqK2U.js";import{a as ge}from"./BN2GUHPa.js";import{u as fe}from"./DSKYwBdE.js";import{D as be}from"./DhtSED-n.js";import{V as j}from"./DXuxIPpi.js";import{V as K}from"./CM2z5-Yq.js";import{V as U}from"./2ttuFdm1.js";import"./bFv45aNM.js";import"./XAOFwQJZ.js";import"./BO5QyVBF.js";const he={info:1,important:2,secure:3,hardening:4,potentially:5,low:6,medium:7,high:8,critical:9},ye=Y({name:"VulnzTable",components:{DfRisk:q},props:{vulnz:{type:Array,required:!0,default:()=>[]},vulnerabilityPreviewLoading:{type:Boolean,default:!1},selectedVulnerabilityKey:{type:String,required:!0}},emits:["goToDetail","goToDetailNewTab","showVulnDetails"],data(){return{headers:[{title:"Show",value:"show",align:"left",width:"4%"},{title:"Risk | CVSS",value:"risk",align:"left",width:"7%"},{title:"Title",value:"title",align:"left",minWidth:"350"},{title:"Short description",value:"description",align:"left"}]}},computed:{kbVulnerabilities(){var t,i,b,k,h,m,o,p,C,I,N,R,L;const e=[];for(const a of this.vulnz)if(((t=a==null?void 0:a.kb)==null?void 0:t.title)==="Use of Outdated Vulnerable Component"){let v=!1;for(const l of a.vulnerabilities.vulnerabilities)if((l==null?void 0:l.metadata)===null||(l==null?void 0:l.metadata)===void 0)v||(e.push({key:l==null?void 0:l.id,goToVulnId:!1,risk:l==null?void 0:l.customRiskRating,title:a.kb.title,securityIssue:a.kb.securityIssue,privacyIssue:a.kb.privacyIssue,targetedByMalware:a.kb.targetedByMalware,targetedByRansomware:a.kb.targetedByRansomware,targetedByNationState:a.kb.targetedByNationState,hasPublicExploit:a.kb.hasPublicExploit,cvssV3:a.highestCvssV3BaseScore,description:a.kb.shortDescription,descriptionFormat:a.kb.shortDescriptionFormat,kb:a.kb}),v=!0);else{const X=(i=l==null?void 0:l.metadata)==null?void 0:i.find(E=>E.name==="dependency_name").value,H=(b=l==null?void 0:l.metadata)==null?void 0:b.find(E=>E.name==="dependency_version").value;e.push({key:l.id,goToVulnId:!0,risk:l.customRiskRating,cvssV3:l.customCvssV3BaseScore,title:`${a.kb.title} for ${X} version ${H}`,securityIssue:a.kb.securityIssue,privacyIssue:a.kb.privacyIssue,targetedByMalware:a.kb.targetedByMalware,targetedByRansomware:a.kb.targetedByRansomware,targetedByNationState:a.kb.targetedByNationState,hasPublicExploit:a.kb.hasPublicExploit,description:a.kb.shortDescription,descriptionFormat:a.kb.shortDescriptionFormat,kb:a.kb})}}else e.push({key:(k=a==null?void 0:a.kb)==null?void 0:k.title,goToVulnId:!1,risk:a.highestRiskRating,title:(h=a==null?void 0:a.kb)==null?void 0:h.title,securityIssue:(m=a==null?void 0:a.kb)==null?void 0:m.securityIssue,privacyIssue:(o=a==null?void 0:a.kb)==null?void 0:o.privacyIssue,targetedByMalware:(p=a==null?void 0:a.kb)==null?void 0:p.targetedByMalware,targetedByRansomware:(C=a==null?void 0:a.kb)==null?void 0:C.targetedByRansomware,targetedByNationState:(I=a==null?void 0:a.kb)==null?void 0:I.targetedByNationState,hasPublicExploit:(N=a==null?void 0:a.kb)==null?void 0:N.hasPublicExploit,cvssV3:a.highestCvssV3BaseScore,description:(R=a==null?void 0:a.kb)==null?void 0:R.shortDescription,descriptionFormat:(L=a==null?void 0:a.kb)==null?void 0:L.shortDescriptionFormat,kb:a.kb});return re(e).by([{desc:a=>{var v;return he[((v=a==null?void 0:a.risk)==null?void 0:v.toLocaleLowerCase())||""]}},{desc:a=>a.cvssV3}])}},methods:{goToDetail(e){this.$emit("goToDetail",e)},goToDetailNewTab(e){this.$emit("goToDetailNewTab",e)},showVulnDetails(e){this.$emit("showVulnDetails",e)}}}),ke=["onClick","onMouseup"],ve=["onClick","onMouseup"];function De(e,t,i,b,k,h){const m=f("DfRisk");return r(),c("div",null,[s(ce,{hover:"",headers:e.headers,items:e.kbVulnerabilities,"items-per-page":-1},{"item.risk":n(({item:o})=>[s(m,{"cvss-score":o.cvssV3,risk:o.risk,class:"cursor-pointer",onClick:p=>e.goToDetail(o),onMouseup:z(p=>e.goToDetailNewTab(o),["middle"])},null,8,["cvss-score","risk","onClick","onMouseup"])]),"item.title":n(({item:o})=>[d("div",{class:"cursor-pointer",onClick:p=>e.goToDetail(o),onMouseup:z(p=>e.goToDetailNewTab(o),["middle"])},y(o.title),41,ke)]),"item.description":n(({item:o})=>[d("div",{class:"cursor-pointer",onClick:p=>e.goToDetail(o),onMouseup:z(p=>e.goToDetailNewTab(o),["middle"])},y(o.description),41,ve)]),"item.show":n(({item:o})=>[s(T,{size:"small",variant:"text",disabled:e.vulnerabilityPreviewLoading===!0&&o.key!==e.selectedVulnerabilityKey,loading:e.vulnerabilityPreviewLoading===!0&&o.key===e.selectedVulnerabilityKey,icon:"mdi-magnify",onClick:p=>e.showVulnDetails(o)},null,8,["disabled","loading","onClick"])]),_:2},1032,["headers","items"])])}const Ve=F(ye,[["render",De]]),we=Y({name:"VulnerabilityDetailDialog",components:{VulnerabilityDetail:de},props:{modelValue:{type:Boolean,default:!1},vuln:{type:Object,default:null},scanId:{type:Number,required:!0},scanner:{type:Object,required:!0}},emits:["update:modelValue","update:loading","afterLeave"],data(){return{loading:!1,dialog:!1}},computed:{vulnKey(){var e;return(e=this.vuln)==null?void 0:e.key}},watch:{modelValue:{immediate:!0,handler(e){this.dialog=e}},dialog(e){this.$emit("update:modelValue",e)},loading(e){this.$emit("update:loading",e),this.vuln!==null&&this.vuln!==void 0&&(e===!0?this.dialog=!1:this.dialog=!0)}}}),Se={id:"vulnerability-detail-container"};function $e(e,t,i,b,k,h){const m=f("VulnerabilityDetail");return r(),c("div",Se,[s(ge,{ref:"dialogRef",modelValue:e.dialog,"onUpdate:modelValue":t[1]||(t[1]=o=>e.dialog=o),scrollable:"",attach:"",eager:"","max-width":"50%",transition:"slide-x-transition",class:"ml-auto",onAfterLeave:t[2]||(t[2]=o=>e.$emit("afterLeave"))},{default:n(()=>[s(B,{class:"dialog-card pa-2",loading:e.loading,style:{"min-height":"100vh"}},{default:n(()=>[s(m,{loading:e.loading,"onUpdate:loading":t[0]||(t[0]=o=>e.loading=o),"vuln-title":e.vulnKey,"scan-id":e.scanId,scanner:e.scanner,"show-breadcrumbs":!1},null,8,["loading","vuln-title","scan-id","scanner"])]),_:1},8,["loading"])]),_:1},8,["modelValue"])])}const Te=F(we,[["render",$e]]),M=1,Be=Y({name:"Index",components:{DfRisk:q,OXOAssets:ie,DfScanProgress:be,DfConfirmationModal:me,VulnzTable:Ve,VunerabilityDetailDialog:Te,DfBreadcrumbs:ne},data(){return{scanner:{endpoint:"",name:"",apiKey:""},vulenrabilityLoading:!1,vulnDetailsDialog:!1,selectedVulnerability:null,options:{page:1,itemsPerPage:15},vulnerabilityService:new ue(this.$axios),scanService:new pe(this.$axios),kb:null,title:"",progress:"UNKNOWN",riskRating:"UNKNOWN",vulns:[],loadingDialog:!0,stopBtnLoading:!1,deleteScanDialog:!1,archiveBtnLoading:!1,stopScanDialog:!1,assets:[],agentGroup:null,show:!1,editorLanguage:"yaml",editorOptions:{theme:"vs",wordWrap:"on",wordWrapColumn:"on",fontFamily:"Fira Code",automaticLayout:!0,minimap:{enabled:!1},readOnly:!0},breadcrumbs:[{text:"scans",disabled:!1,to:"/scan/list",exact:!0},{text:"Scan",disabled:!1,to:`/scan/${(this._.provides[$]||this.$route).params.scan}`,exact:!0,scans:[]}]}},computed:{..._(fe,["scanners"]),scanId(){return(this._.provides[$]||this.$route).params.scan===void 0||(this._.provides[$]||this.$route).params.scan===null?(this.reportError("Scan ID not provided"),0):parseInt((this._.provides[$]||this.$route).params.scan)},AgentGroupYaml(){var t,i;const e=(t=this.agentGroup)==null?void 0:t.yamlSource;return e==null?"No agent group found":`# Agent Group ID: ${(i=this.agentGroup)==null?void 0:i.id}
${W.stringify(W.parse(e))}`},totalVulnerabilities(){var e;return((e=this.vulns)==null?void 0:e.length)||0}},async mounted(){const e=this.scanners.find(t=>O(t.endpoint)===(this._.provides[$]||this.$route).params.scanner);e===void 0?(this.reportError("Scanner not found"),this.$router.push({name:"scan-list"})):(this.scanner=e,await Promise.allSettled([this.fetchKBVulnerabilities(),this.fetchScans()]),this.updateBreadcrumbs())},methods:{...Z(oe,["reportError","reportInfo","reportSuccess"]),async fetchKBVulnerabilities(){var e,t;try{this.loadingDialog=!0;const i=await this.vulnerabilityService.getKBVulnerabilities(this.scanner,this.scanId);this.kb=i,this.vulns=(i==null?void 0:i.kbVulnerabilities)||[],this.title=i==null?void 0:i.title,this.assets=i==null?void 0:i.assets,this.progress=(e=i==null?void 0:i.progress)==null?void 0:e.toLowerCase(),this.riskRating=(t=i==null?void 0:i.riskRating)==null?void 0:t.toLowerCase(),this.agentGroup=i==null?void 0:i.agentGroup}catch(i){this.reportError(`An error was encountered while fetching the scan: ${i}`)}finally{this.loadingDialog=!1}},showVulnDetails(e){this.selectedVulnerability=e,this.vulnDetailsDialog=!0},goToDetail(e){this.$router.push({name:"scan-scanner-scan-vuln-vuln",params:{scan:this.scanId,scanner:O(this.scanner.endpoint),vuln:e.key??e.kb.id}})},goToDetailNewTab(e){const t=this.$router.resolve(`/scan/${O(this.scanner.endpoint)}/${this.scanId}/vuln/${e.key??e.kb.id}`);window.open(t.href,"_blank")},async fetchScans(){this.breadcrumbs[M].scans=await this.scanService.getScans(this.scanner,{page:1,numberElements:20})},updateBreadcrumbs(){var t,i,b;((i=((t=this.breadcrumbs[M])==null?void 0:t.scans)||[])==null?void 0:i.find(k=>{var h;return k.id===((h=this.kb)==null?void 0:h.id)}))===void 0&&(this.breadcrumbs[M].scans=[...((b=this.breadcrumbs[M])==null?void 0:b.scans)||[],this.kb])},async stopScan(){try{this.stopBtnLoading=!0,await this.scanService.stopScans(this.scanner,[this.scanId]),await this.fetchKBVulnerabilities()}catch(e){this.reportError((e==null?void 0:e.message)||"Error Stopping scan.")}finally{this.stopBtnLoading=!1}},async deleteScan(){try{this.loadingDialog=!0,await this.scanService.deleteScans(this.scanner,[this.scanId]),this.reportSuccess("Scan deleted successfully"),this.$router.push("/scan/list")}catch(e){this.reportError(`An error occurred while deleting the scan: ${e.message}`)}finally{this.loadingDialog=!1}},async exportScan(){try{this.loadingDialog=!0,this.reportInfo("Scan export in progress, this process may take some time."),await this.scanService.exportScan(this.scanner,this.scanId),this.reportSuccess("Scan exported successfully")}catch(e){this.reportError((e==null?void 0:e.message)||"An error occurred while exporting the scan")}finally{this.loadingDialog=!1}}}}),Ce=J(Q),Ie={key:0,class:"mb-0"},Ne={key:1},Re={key:1},Le={key:0,class:"mb-0"},Ae={key:1},Me={key:1},Ee={key:0},ze={key:1};function Pe(e,t,i,b,k,h){const m=f("DfConfirmationModal"),o=f("VunerabilityDetailDialog"),p=f("DfBreadcrumbs"),C=f("OXOAssets"),I=f("DfScanProgress"),N=f("DfRisk"),R=Ce,L=f("VulnzTable");return r(),c("div",null,[s(m,{modelValue:e.deleteScanDialog,"onUpdate:modelValue":t[0]||(t[0]=a=>e.deleteScanDialog=a),title:"Are you sure you would like to archive this scan?","cancel-button-text":"Cancel","confirm-button-text":"Delete","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-archive-arrow-down-outline",onConfirm:e.deleteScan},null,8,["modelValue","onConfirm"]),s(m,{modelValue:e.stopScanDialog,"onUpdate:modelValue":t[1]||(t[1]=a=>e.stopScanDialog=a),title:"Are you sure you would like to stop the scan?",description:"A stopped scan cannot be resumed.","cancel-button-text":"Cancel","confirm-button-text":"Stop","cancel-icon":"mdi-close","confirm-icon":"mdi-check","confirm-button-color":"secondary","card-icon":"mdi-stop-circle-outline",onConfirm:e.stopScan},null,8,["modelValue","onConfirm"]),s(o,{loading:e.vulenrabilityLoading,"onUpdate:loading":t[2]||(t[2]=a=>e.vulenrabilityLoading=a),"model-value":e.vulnDetailsDialog,"onUpdate:modelValue":t[3]||(t[3]=a=>e.vulnDetailsDialog=a),vuln:e.selectedVulnerability,"scan-id":e.scanId,scanner:e.scanner,onAfterLeave:t[4]||(t[4]=a=>e.selectedVulnerability=null)},null,8,["loading","model-value","vuln","scan-id","scanner"]),s(p,{"scan-id":e.scanId,breadcrumbs:e.breadcrumbs,scanner:e.scanner,class:"mb-5"},null,8,["scan-id","breadcrumbs","scanner"]),s(B,{class:"d-flex pl-3 py-3 mt-3",variant:"outlined"},{default:n(()=>[s(K,{bottom:""},{activator:n(({props:a})=>[s(T,P({disabled:e.progress==="stopped"||e.progress==="done"||e.loadingDialog===!0,loading:e.stopBtnLoading,class:"mr-2"},a,{onClick:t[5]||(t[5]=v=>e.stopScanDialog=!0)}),{default:n(()=>[s(D,{start:""},{default:n(()=>t[9]||(t[9]=[u(" mdi-stop-circle-outline ")])),_:1}),t[10]||(t[10]=u(" Stop "))]),_:2},1040,["disabled","loading"])]),default:n(()=>[t[11]||(t[11]=d("span",null,"Stops scan. Stopped scans can't be restarted.",-1))]),_:1}),s(K,{bottom:""},{activator:n(({props:a})=>[s(T,P({loading:e.archiveBtnLoading,class:"mr-2"},a,{onClick:t[6]||(t[6]=v=>e.deleteScanDialog=!0)}),{default:n(()=>[s(D,{start:""},{default:n(()=>t[12]||(t[12]=[u(" mdi-delete-outline ")])),_:1}),t[13]||(t[13]=u(" Delete "))]),_:2},1040,["loading"])]),default:n(()=>[t[14]||(t[14]=d("span",null,"Archives scan and removes all findings and artifacts.",-1))]),_:1}),s(K,{bottom:""},{activator:n(({props:a})=>[s(T,P({class:"mr-2"},a,{onClick:e.exportScan}),{default:n(()=>[s(D,{start:""},{default:n(()=>t[15]||(t[15]=[u(" mdi-file-export-outline ")])),_:1}),t[16]||(t[16]=u(" Export "))]),_:2},1040,["onClick"])]),default:n(()=>[t[17]||(t[17]=d("span",null,"Exports scan to a zip file.",-1))]),_:1})]),_:1}),s(j,{class:"mt-4 align-stretch"},{default:n(()=>[s(U,{cols:"12",lg:"12"},{default:n(()=>[s(B,{loading:e.loadingDialog,height:"100%",variant:"outlined"},{default:n(()=>[s(G,null,{default:n(()=>[s(D,{start:""},{default:n(()=>t[18]||(t[18]=[u(" mdi-shield-check-outline ")])),_:1}),t[19]||(t[19]=u(" Scan Details "))]),_:1}),s(A),s(x,null,{default:n(()=>[s(V,null,{default:n(()=>[s(w,{class:"d-flex align-center"},{default:n(()=>[t[20]||(t[20]=d("p",{class:"mb-0 mr-2"}," Title: ",-1)),e.title!==null&&e.title!==""?(r(),c("p",Ie,y(e.title),1)):(r(),c("div",Ne,[e.loadingDialog===!0?(r(),g(S,{key:0,variant:"tonal",size:"small",label:"",style:{width:"80px"}})):(r(),c("span",Re,"-"))]))]),_:1})]),_:1}),s(V,null,{default:n(()=>[s(w,{class:"d-flex align-center"},{default:n(()=>[t[21]||(t[21]=d("p",{class:"mb-0 mr-2"}," Targets: ",-1)),e.loadingDialog===!0?(r(),g(S,{key:0,variant:"tonal",label:"",style:{width:"90px"}})):(r(),g(C,{key:1,assets:e.assets},null,8,["assets"]))]),_:1})]),_:1}),s(V,null,{default:n(()=>[s(w,{class:"d-flex align-center"},{default:n(()=>[t[22]||(t[22]=d("p",{class:"mb-0 mr-2"}," Progress: ",-1)),e.loadingDialog===!0?(r(),g(S,{key:0,variant:"tonal",size:"small",label:"",style:{width:"60px"}})):(r(),g(I,{key:1,progress:e.progress},null,8,["progress"]))]),_:1})]),_:1}),s(V,null,{default:n(()=>[s(w,{class:"d-flex align-center"},{default:n(()=>[t[23]||(t[23]=d("p",{class:"mb-0 mr-2"}," Risk Rating: ",-1)),e.loadingDialog===!0?(r(),g(S,{key:0,variant:"tonal",size:"small",label:"",style:{width:"60px"}})):(r(),g(N,{key:1,risk:e.riskRating},null,8,["risk"]))]),_:1})]),_:1}),s(V,null,{default:n(()=>[s(w,{class:"d-flex align-center"},{default:n(()=>[t[24]||(t[24]=d("p",{class:"mb-0 mr-2"}," Date: ",-1)),e.loadingDialog===!1&&e.kb!==null?(r(),c("p",Le,y(e.$moment(e.kb.createdTime).format("MMMM Do YYYY, k:mm:ss")),1)):(r(),c("div",Ae,[e.loadingDialog===!0?(r(),g(S,{key:0,variant:"tonal",size:"x-small",label:"",style:{width:"180px"}})):(r(),c("span",Me,"-"))]))]),_:1})]),_:1}),s(V,null,{default:n(()=>[s(w,{class:"d-flex align-center"},{default:n(()=>[t[26]||(t[26]=d("p",{class:"mb-0 mr-2"}," Scanner: ",-1)),d("div",null,[(e.scanner.name||"").trim()!==""?(r(),c("p",Ee,[u(y(e.scanner.name)+" (",1),d("code",null,y(e.scanner.endpoint),1),t[25]||(t[25]=u(") "))])):(r(),c("code",ze,y(e.scanner.endpoint),1))])]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}),s(B,{class:"mt-12",variant:"outlined"},{default:n(()=>[s(G,{class:"cursor-pointer",onClick:t[7]||(t[7]=a=>e.show=!e.show)},{default:n(()=>[s(j,{align:"center",justify:"space-between",class:"w-100"},{default:n(()=>[s(U,{class:"d-flex align-center"},{default:n(()=>[s(D,{start:""},{default:n(()=>t[27]||(t[27]=[u(" mdi-format-list-group ")])),_:1}),t[28]||(t[28]=d("span",null,"Agent Group",-1))]),_:1}),s(U,{class:"d-flex justify-end"},{default:n(()=>[s(T,{icon:e.show?"mdi-chevron-up":"mdi-chevron-down",elevation:"0"},null,8,["icon"])]),_:1})]),_:1})]),_:1}),s(A),s(ee,null,{default:n(()=>[te(d("div",null,[s(A),s(le,null,{default:n(()=>[s(R,{modelValue:e.AgentGroupYaml,"onUpdate:modelValue":t[8]||(t[8]=a=>e.AgentGroupYaml=a),lang:e.editorLanguage,options:e.editorOptions,style:{"min-height":"300px"}},null,8,["modelValue","lang","options"])]),_:1})],512),[[ae,e.show]])]),_:1})]),_:1}),s(B,{loading:e.loadingDialog,class:"mt-12",justify:"space-around",variant:"outlined"},{default:n(()=>[s(G,null,{default:n(()=>[s(D,{start:""},{default:n(()=>t[29]||(t[29]=[u(" mdi-bug-outline ")])),_:1}),t[30]||(t[30]=u(" Vulnerabilities ")),e.totalVulnerabilities!==null?(r(),g(S,{key:0,size:"small",class:"ml-2"},{default:n(()=>[u(y(e.totalVulnerabilities),1)]),_:1})):se("",!0)]),_:1}),s(A),s(L,{"vulnerability-preview-loading":e.vulenrabilityLoading,vulnz:e.vulns,"selected-vulnerability-key":e.selectedVulnerability!==null?e.selectedVulnerability.key:null,onGoToDetail:e.goToDetail,onGoToDetailNewTab:e.goToDetailNewTab,onShowVulnDetails:e.showVulnDetails},null,8,["vulnerability-preview-loading","vulnz","selected-vulnerability-key","onGoToDetail","onGoToDetailNewTab","onShowVulnDetails"])]),_:1},8,["loading"])])}const et=F(Be,[["render",Pe],["__scopeId","data-v-e8c5b85a"]]);export{et as default};
