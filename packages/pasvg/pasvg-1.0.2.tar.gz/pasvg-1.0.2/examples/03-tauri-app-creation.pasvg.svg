<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" 
     viewBox="0 0 1400 1000"
     data-pasvg-version="1.0"
     data-project-name="Tutorial 3: Tauri Desktop Application from Scraped Webpage">

<!-- PASVG: Project Artifact SVG -->
<defs>
    <style><![CDATA[
        .pasvg-title { font-family: Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #2563eb; }
        .pasvg-subtitle { font-family: Arial, sans-serif; font-size: 14px; fill: #6b7280; }
        .pasvg-section { font-family: Arial, sans-serif; font-size: 12px; fill: #374151; }
        .pasvg-code { font-family: monospace; font-size: 10px; fill: #1f2937; }
    ]]></style>
</defs>

<!-- Project metadata -->
<metadata>
    <project xmlns="http://whyml.org/pasvg/1.0">
        <name>Tutorial 3: Tauri Desktop Application from Scraped Webpage</name>
        <description>This tutorial demonstrates how to scrape a webpage with WhyML, convert it to a YAML manifest, and build a cross-platform desktop application using Tauri with Rust and JavaScript.</description>
        <version>1.0.0</version>
        <platforms>Windows, Linux</platforms>
        <technologies>Tauri</technologies>
        <build-targets>Desktop</build-targets>
    </project>
</metadata>

<!-- Visual Layout -->
<rect width="100%" height="100%" fill="#ffffff"/>
<rect x="0" y="0" width="1400" height="80" fill="#dbeafe" stroke="#3b82f6"/>

<text x="20" y="35" class="pasvg-title">Tutorial 3: Tauri Desktop Application from Scraped Webpage</text>
<text x="20" y="55" class="pasvg-subtitle">This tutorial demonstrates how to scrape a webpage with WhyML, convert it to a YAML manifest, and build a cross-platform desktop application using Tauri with Rust and JavaScript.</text>

<!-- Technology badges -->
<g transform="translate(20, 90)">

    <g transform="translate(0, 0)">
        <rect width="60" height="20" rx="10" fill="#3b82f6" opacity="0.1"/>
        <text x="30" y="14" text-anchor="middle" class="pasvg-section" fill="#3b82f6">Tauri</text>
    </g>
</g>

<!-- File overview -->
<g transform="translate(20, 150)">
    <text x="0" y="0" class="pasvg-title" font-size="18">Project Files (7)</text>

    <text x="0" y="20" class="pasvg-section">📄 src/manifest.yaml (manifest)</text>

    <text x="0" y="38" class="pasvg-section">📄 scripts/generate-app.py (source)</text>

    <text x="0" y="56" class="pasvg-section">📄 src-tauri/tauri.conf.json (config)</text>

    <text x="0" y="74" class="pasvg-section">📄 src/main.js (source)</text>

    <text x="0" y="92" class="pasvg-section">📄 src/style.css (web)</text>

    <text x="0" y="110" class="pasvg-section">📄 package.json (config)</text>

    <text x="0" y="128" class="pasvg-section">📄 scripts/webpage-to-tauri.sh (script)</text>
</g>

<!-- Embedded Source Files -->

<foreignObject id="file_0" data-filename="src/manifest.yaml" 
              data-type="manifest" data-language="yaml" 
              data-section="Step 3: Convert Scraped Content to App Manifest" style="display: none;">
    <![CDATA[metadata:
  name: "Scraped Website App"
  description: "Desktop app created from scraped webpage"
  version: "1.0.0"
  author: "WhyML Generator"

config:
  app_type: "desktop"
  framework: "tauri"
  window_title: "{{site_name}} - Desktop App"
  window_width: 1200
  window_height: 800
  resizable: true

variables:
  site_name: "Example Blog"
  primary_color: "#2563eb"
  background_color: "#ffffff"

structure:
  - tag: "div"
    attributes:
      id: "app"
      class: "app-container"
    children:
      - tag: "header"
        attributes:
          class: "app-header"
        children:
          - tag: "h1"
            attributes:
              class: "app-title"
            content: "{{site_name}}"
          - tag: "div"
            attributes:
              class: "app-controls"
            children:
              - tag: "button"
                attributes:
                  id: "refresh-btn"
                  class: "control-btn"
                content: "Refresh"
              - tag: "button"
                attributes:
                  id: "settings-btn"
                  class: "control-btn"
                content: "Settings"
      
      - tag: "main"
        attributes:
          class: "app-content"
        children:
          - tag: "div"
            attributes:
              id: "scraped-content"
              class: "content-area"
            content: "<!-- Scraped content will be loaded here -->"
      
      - tag: "footer"
        attributes:
          class: "app-footer"
        children:
          - tag: "p"
            content: "Powered by WhyML + Tauri"

styles:
  - selector: ".app-container"
    rules:
      display: "flex"
      flex-direction: "column"
      height: "100vh"
      font-family: "'Segoe UI', system-ui, sans-serif"
  
  - selector: ".app-header"
    rules:
      background: "{{primary_color}}"
      color: "white"
      padding: "1rem"
      display: "flex"
      justify-content: "space-between"
      align-items: "center"
  
  - selector: ".app-content"
    rules:
      flex: "1"
      padding: "1rem"
      overflow-y: "auto"
  
  - selector: ".control-btn"
    rules:
      background: "rgba(255,255,255,0.2)"
      border: "none"
      color: "white"
      padding: "0.5rem 1rem"
      margin-left: "0.5rem"
      border-radius: "4px"
      cursor: "pointer"]]>
</foreignObject>

<foreignObject id="file_1" data-filename="scripts/generate-app.py" 
              data-type="source" data-language="python" 
              data-section="Step 4: Generate HTML from Manifest" style="display: none;">
    <![CDATA[#!/usr/bin/env python3
import yaml
import json
from pathlib import Path

def load_manifest(path):
    with open(path, 'r') as f:
        return yaml.safe_load(f)

def generate_html(manifest):
    """Generate HTML from WhyML manifest structure"""
    
    def render_element(element):
        if isinstance(element, str):
            return element
        
        tag = element.get('tag', 'div')
        attrs = element.get('attributes', {})
        content = element.get('content', '')
        children = element.get('children', [])
        
        # Build attributes string
        attr_str = ''
        for key, value in attrs.items():
            attr_str += f' {key}="{value}"'
        
        # Build element
        if children:
            child_html = ''.join(render_element(child) for child in children)
            return f'<{tag}{attr_str}>{child_html}</{tag}>'
        else:
            return f'<{tag}{attr_str}>{content}</{tag}>'
    
    structure = manifest.get('structure', [])
    body_html = ''.join(render_element(elem) for elem in structure)
    
    variables = manifest.get('variables', {})
    title = variables.get('site_name', 'WhyML App')
    
    html = f'''<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{title}</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    {body_html}
    <script src="main.js"></script>
</body>
</html>'''
    
    return html

def generate_css(manifest):
    """Generate CSS from manifest styles"""
    styles = manifest.get('styles', [])
    variables = manifest.get('variables', {})
    
    css = '/* Generated by WhyML */\n\n'
    
    # Add CSS reset
    css += '''* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', system-ui, sans-serif;
    background: #ffffff;
}

'''
    
    # Add manifest styles
    for style in styles:
        selector = style.get('selector', '')
        rules = style.get('rules', {})
        
        css += f'{selector} {{\n'
        for prop, value in rules.items():
            # Replace variables
            for var_name, var_value in variables.items():
                value = str(value).replace(f'{{{{{var_name}}}}}', str(var_value))
            css += f'    {prop}: {value};\n'
        css += '}\n\n'
    
    return css

def main():
    manifest = load_manifest('src/manifest.yaml')
    
    # Generate HTML
    html = generate_html(manifest)
    with open('src/index.html', 'w') as f:
        f.write(html)
    
    # Generate CSS
    css = generate_css(manifest)
    with open('src/style.css', 'w') as f:
        f.write(css)
    
    print("Generated HTML and CSS from manifest")

if __name__ == '__main__':
    main()]]>
</foreignObject>

<foreignObject id="file_2" data-filename="src-tauri/tauri.conf.json" 
              data-type="config" data-language="json" 
              data-section="Step 5: Configure Tauri Application" style="display: none;">
    <![CDATA[{
  "$schema": "../node_modules/@tauri-apps/cli/schema.json",
  "build": {
    "beforeBuildCommand": "npm run build",
    "beforeDevCommand": "npm run dev",
    "devPath": "../src",
    "distDir": "../src"
  },
  "package": {
    "productName": "Scraped Website App",
    "version": "1.0.0"
  },
  "tauri": {
    "allowlist": {
      "all": false,
      "shell": {
        "all": false,
        "open": true
      },
      "window": {
        "all": false,
        "close": true,
        "hide": true,
        "maximize": true,
        "minimize": true,
        "setResizable": true,
        "setTitle": true,
        "show": true,
        "unmaximize": true,
        "unminimize": true
      },
      "fs": {
        "all": false,
        "readFile": true,
        "writeFile": true,
        "scope": ["$APPDATA/*", "$RESOURCE/*"]
      }
    },
    "bundle": {
      "active": true,
      "category": "DeveloperTool",
      "copyright": "Generated by WhyML",
      "deb": {
        "depends": []
      },
      "externalBin": [],
      "icon": [
        "icons/32x32.png",
        "icons/128x128.png",
        "icons/128x128@2x.png",
        "icons/icon.icns",
        "icons/icon.ico"
      ],
      "identifier": "com.whyml.scraped-app",
      "longDescription": "Desktop application created from scraped webpage using WhyML and Tauri",
      "macOS": {
        "entitlements": null,
        "exceptionDomain": "",
        "frameworks": [],
        "providerShortName": null,
        "signingIdentity": null
      },
      "resources": [],
      "shortDescription": "WhyML Scraped Website App",
      "targets": "all",
      "windows": {
        "certificateThumbprint": null,
        "digestAlgorithm": "sha256",
        "timestampUrl": ""
      }
    },
    "security": {
      "csp": null
    },
    "updater": {
      "active": false
    },
    "windows": [
      {
        "fullscreen": false,
        "height": 800,
        "resizable": true,
        "title": "Scraped Website App",
        "width": 1200,
        "center": true
      }
    ]
  }
}]]>
</foreignObject>

<foreignObject id="file_3" data-filename="src/main.js" 
              data-type="source" data-language="javascript" 
              data-section="Step 6: Implement App Functionality" style="display: none;">
    <![CDATA[const { invoke } = window.__TAURI__.tauri;
const { appWindow } = window.__TAURI__.window;

class ScrapedWebsiteApp {
    constructor() {
        this.initializeApp();
        this.bindEvents();
        this.loadScrapedContent();
    }

    async initializeApp() {
        console.log('Initializing Scraped Website App...');
        
        // Set window title dynamically
        await appWindow.setTitle('Scraped Website App - WhyML Generated');
        
        // Load app settings
        this.loadSettings();
    }

    bindEvents() {
        // Refresh button
        const refreshBtn = document.getElementById('refresh-btn');
        if (refreshBtn) {
            refreshBtn.addEventListener('click', () => {
                this.refreshContent();
            });
        }

        // Settings button
        const settingsBtn = document.getElementById('settings-btn');
        if (settingsBtn) {
            settingsBtn.addEventListener('click', () => {
                this.showSettings();
            });
        }

        // Window controls
        this.setupWindowControls();
    }

    async loadScrapedContent() {
        const contentArea = document.getElementById('scraped-content');
        if (!contentArea) return;

        try {
            // In a real app, you'd load the scraped content from the manifest
            // For this demo, we'll create some sample content
            const sampleContent = this.generateSampleContent();
            contentArea.innerHTML = sampleContent;
            
            console.log('Scraped content loaded successfully');
        } catch (error) {
            console.error('Failed to load scraped content:', error);
            contentArea.innerHTML = '<p>Failed to load content. Please try refreshing.</p>';
        }
    }

    generateSampleContent() {
        return `
            <div class="content-section">
                <h2>Welcome to Your Desktop App</h2>
                <p>This application was generated from a scraped webpage using WhyML and converted to a desktop app using Tauri.</p>
                
                <div class="feature-grid">
                    <div class="feature-card">
                        <h3>📄 Content Preservation</h3>
                        <p>Original webpage structure and content preserved in YAML format</p>
                    </div>
                    
                    <div class="feature-card">
                        <h3>🖥️ Native Desktop</h3>
                        <p>Cross-platform desktop application using Tauri and Rust</p>
                    </div>
                    
                    <div class="feature-card">
                        <h3>⚡ High Performance</h3>
                        <p>Fast, lightweight, and resource-efficient application</p>
                    </div>
                </div>
                
                <div class="scraped-info">
                    <h3>Original Site Information</h3>
                    <ul>
                        <li><strong>Source:</strong> Scraped from example-blog.com</li>
                        <li><strong>Generated:</strong> ${new Date().toLocaleDateString()}</li>
                        <li><strong>Technology:</strong> WhyML + Tauri + Rust</li>
                    </ul>
                </div>
            </div>
        `;
    }

    async refreshContent() {
        console.log('Refreshing content...');
        const contentArea = document.getElementById('scraped-content');
        
        if (contentArea) {
            contentArea.innerHTML = '<p>Refreshing content...</p>';
            
            // Simulate refresh delay
            setTimeout(() => {
                this.loadScrapedContent();
            }, 1000);
        }
    }

    showSettings() {
        const modal = document.createElement('div');
        modal.className = 'settings-modal';
        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <h3>App Settings</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="setting-group">
                        <label for="theme-select">Theme:</label>
                        <select id="theme-select">
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label for="font-size">Font Size:</label>
                        <input type="range" id="font-size" min="12" max="20" value="14">
                        <span id="font-size-value">14px</span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="save-settings">Save</button>
                    <button class="cancel-settings">Cancel</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // Bind modal events
        modal.querySelector('.close-modal').addEventListener('click', () => {
            document.body.removeChild(modal);
        });
        
        modal.querySelector('.cancel-settings').addEventListener('click', () => {
            document.body.removeChild(modal);
        });
        
        modal.querySelector('.save-settings').addEventListener('click', () => {
            this.saveSettings();
            document.body.removeChild(modal);
        });
        
        // Font size slider
        const fontSlider = modal.querySelector('#font-size');
        const fontValue = modal.querySelector('#font-size-value');
        fontSlider.addEventListener('input', (e) => {
            fontValue.textContent = e.target.value + 'px';
        });
    }

    setupWindowControls() {
        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'r':
                        e.preventDefault();
                        this.refreshContent();
                        break;
                    case ',':
                        e.preventDefault();
                        this.showSettings();
                        break;
                }
            }
        });
    }

    loadSettings() {
        // In a real app, you'd load settings from Tauri's filesystem API
        const settings = {
            theme: 'light',
            fontSize: '14px'
        };
        
        document.documentElement.style.setProperty('--font-size', settings.fontSize);
        document.documentElement.className = settings.theme;
    }

    saveSettings() {
        console.log('Settings saved!');
        // In a real app, you'd save settings using Tauri's filesystem API
    }
}

// Initialize app when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    new ScrapedWebsiteApp();
});]]>
</foreignObject>

<foreignObject id="file_4" data-filename="src/style.css" 
              data-type="web" data-language="css" 
              data-section="Step 7: Enhanced Styling" style="display: none;">
    <![CDATA[/* Generated by WhyML */

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary-color: #2563eb;
    --background-color: #ffffff;
    --text-color: #1f2937;
    --border-color: #e5e7eb;
    --font-size: 14px;
}

body {
    font-family: 'Segoe UI', system-ui, sans-serif;
    background: var(--background-color);
    color: var(--text-color);
    font-size: var(--font-size);
}

.app-container {
    display: flex;
    flex-direction: column;
    height: 100vh;
    font-family: 'Segoe UI', system-ui, sans-serif;
}

.app-header {
    background: var(--primary-color);
    color: white;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    -webkit-app-region: drag;
}

.app-title {
    font-size: 1.2rem;
    font-weight: 600;
}

.app-controls {
    -webkit-app-region: no-drag;
}

.control-btn {
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 0.5rem 1rem;
    margin-left: 0.5rem;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.control-btn:hover {
    background: rgba(255,255,255,0.3);
}

.app-content {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
}

.content-section h2 {
    color: var(--primary-color);
    margin-bottom: 1rem;
    font-size: 1.8rem;
}

.content-section p {
    margin-bottom: 1.5rem;
    line-height: 1.6;
}

.feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin: 2rem 0;
}

.feature-card {
    background: #f8fafc;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 1.5rem;
    transition: transform 0.2s, box-shadow 0.2s;
}

.feature-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.feature-card h3 {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
}

.scraped-info {
    background: #fef3c7;
    border: 1px solid #f59e0b;
    border-radius: 8px;
    padding: 1.5rem;
    margin-top: 2rem;
}

.scraped-info h3 {
    color: #d97706;
    margin-bottom: 1rem;
}

.scraped-info ul {
    list-style: none;
    padding: 0;
}

.scraped-info li {
    margin-bottom: 0.5rem;
    padding-left: 1rem;
    position: relative;
}

.scraped-info li::before {
    content: "→";
    position: absolute;
    left: 0;
    color: #d97706;
}

.app-footer {
    background: #f8fafc;
    border-top: 1px solid var(--border-color);
    padding: 0.75rem 1rem;
    text-align: center;
    font-size: 0.875rem;
    color: #6b7280;
}

/* Settings Modal */
.settings-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background: white;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
    overflow: hidden;
}

.modal-header {
    background: var(--primary-color);
    color: white;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.close-modal {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-body {
    padding: 1.5rem;
}

.setting-group {
    margin-bottom: 1.5rem;
}

.setting-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.setting-group select,
.setting-group input {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: 4px;
}

.modal-footer {
    padding: 1rem;
    background: #f8fafc;
    text-align: right;
}

.modal-footer button {
    margin-left: 0.5rem;
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.save-settings {
    background: var(--primary-color);
    color: white;
}

.cancel-settings {
    background: #6b7280;
    color: white;
}

/* Dark theme */
.dark {
    --background-color: #1f2937;
    --text-color: #f9fafb;
    --border-color: #374151;
}

.dark .feature-card {
    background: #374151;
}

.dark .modal-content {
    background: #1f2937;
    color: #f9fafb;
}

.dark .modal-footer {
    background: #374151;
}]]>
</foreignObject>

<foreignObject id="file_5" data-filename="package.json" 
              data-type="config" data-language="json" 
              data-section="Step 8: Build and Test" style="display: none;">
    <![CDATA[{
  "name": "scraped-website-app",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "echo 'Development server for Tauri'",
    "build": "echo 'Build process for Tauri'",
    "tauri": "tauri",
    "tauri:dev": "tauri dev",
    "tauri:build": "tauri build"
  },
  "dependencies": {
    "@tauri-apps/api": "^1.5.0"
  },
  "devDependencies": {
    "@tauri-apps/cli": "^1.5.0"
  }
}]]>
</foreignObject>

<foreignObject id="file_6" data-filename="scripts/webpage-to-tauri.sh" 
              data-type="script" data-language="bash" 
              data-section="Step 9: Integration with WhyML Workflow" style="display: none;">
    <![CDATA[#!/bin/bash

if [ "$#" -ne 2 ]; then
    echo "Usage: $0 <website-url> <app-name>"
    exit 1
fi

WEBSITE_URL=$1
APP_NAME=$2

echo "🌐 Scraping website: $WEBSITE_URL"
whyml scrape "$WEBSITE_URL" \
  --section metadata \
  --section analysis \
  --section structure \
  --section styles \
  --output "scraped/${APP_NAME}.yaml" \
  --verbose

echo "📱 Generating Tauri application..."
python3 scripts/generate-app.py "$APP_NAME"

echo "🔧 Building desktop application..."
npm run tauri:build

echo "✅ Desktop application created successfully!"
echo "📦 Find your app in: src-tauri/target/release/bundle/"]]>
</foreignObject>


<!-- Build Configuration -->
<script type="application/json" data-filename="pasvg-build.json">
    <![CDATA[{
  "project": "Tutorial 3: Tauri Desktop Application from Scraped Webpage",
  "targets": [
    "Desktop"
  ],
  "files": [
    {
      "filename": "src/manifest.yaml",
      "type": "manifest"
    },
    {
      "filename": "scripts/generate-app.py",
      "type": "source"
    },
    {
      "filename": "src-tauri/tauri.conf.json",
      "type": "config"
    },
    {
      "filename": "src/main.js",
      "type": "source"
    },
    {
      "filename": "src/style.css",
      "type": "web"
    },
    {
      "filename": "package.json",
      "type": "config"
    },
    {
      "filename": "scripts/webpage-to-tauri.sh",
      "type": "script"
    }
  ]
}]]>
</script>

<!-- Build Instructions -->
<g transform="translate(20, 400)">
    <text x="0" y="0" class="pasvg-title" font-size="16">Build Instructions</text>
    <text x="0" y="25" class="pasvg-code">1. Extract: python pasvg_extractor.py tutorial-3--tauri-desktop-application-from-scraped-webpage.pasvg.svg</text>
    <text x="0" y="40" class="pasvg-code">2. Build: cd extracted &amp;&amp; ./build.sh</text>
    <text x="0" y="60" class="pasvg-section">Targets: Desktop</text>
</g>

</svg>