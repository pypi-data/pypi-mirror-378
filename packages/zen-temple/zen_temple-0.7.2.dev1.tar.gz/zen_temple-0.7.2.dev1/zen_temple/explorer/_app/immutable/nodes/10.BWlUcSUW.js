import"../chunks/DsnmJJEf.js";import{o as at,s as st}from"../chunks/CxYln1hn.js";import{p as ot,s as n,b as d,u as Y,g as e,l as g,d as oe,j as r,t as nt,e as R,h as f,f as E,a as m,i as lt,c as be,n as it,m as ne,r as le,v as ut}from"../chunks/Drxlg-Xn.js";import{i as p}from"../chunks/BbB4DTre.js";import{u as dt,a as Be,b as ie,e as ct,i as _t}from"../chunks/iLwl9KAB.js";import{s as Ie}from"../chunks/CpZHtke-.js";import{F as ft,f as xe,b as ye,S as vt,c as gt,t as mt,h as ht,i as Me,r as pt}from"../chunks/C6Y5c09E.js";import{A as Q}from"../chunks/se_iUg_v.js";import{R as bt}from"../chunks/C92D-6Mo.js";import{T as Ue}from"../chunks/BNZwnsPw.js";import{B as xt}from"../chunks/CINfEwQf.js";import{g as yt}from"../chunks/CqS7hfz2.js";var wt=R('<label class="col-6 col-md-2">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),Ct=R('<div class="row mb-2"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-2"><!></div> <!></div>'),Ot=R("<h3>Technologies (for Capex/Opex)</h3> <!> <!> <!> <!> <!>",1),St=R("<!> <!> <!>",1),jt=R("<!> <!> <!>",1),Pt=R("<!> <!>",1),Tt=R('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),$t=R('<div class="text-center">No data with this selection.</div>'),kt=R('<div class="text-center">Please select at least one year.</div>'),Lt=R('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Costs</h1> <!> <div class="mt-4"><!></div>',1);function qt(Ne,Ve){ot(Ve,!0);const u="Techology / Carrier",Se=" (Capex)",je=" (Opex)",Ye="Capex",qe="Opex",ze="Carrier",Ge="Shed Demand";let Pe=n(d([])),Te=n(d([])),W=n(d([]));const $e=["Location",u];let ue=n(null),X=n(null),y=n(null),O=n(null),Z=n(null),de=n(d({})),ee=n(d([])),l=n(null),q=n(d([])),F=n(d([])),B=n(d([])),z=n(d([])),G=n(d([])),H=n(d([])),ce=n("Location"),_e=n(d([])),fe=n(d([])),ve=n(d([])),ge=n(d([])),me=n(d([])),te=n(!1),re=n(!1),S=d({capex:{title:"Capex",show:!0,subdivision:!1,show_subdivision:!0,label:Ye},opex:{title:"Opex",show:!0,subdivision:!1,show_subdivision:!0,label:qe},carrier:{title:"Carrier",show:!0,subdivision:!1,show_subdivision:!0,label:ze},shed_demand:{title:"Shed Demand",show:!0,subdivision:!1,show_subdivision:!0,label:Ge},carbon_emission:{title:"Carbon Emissions",show:!0,subdivision:!1,show_subdivision:!1}}),He=g(()=>{if(!e(l))return"";let t=e(l).solution_name.split(".");return[t[t.length-1],e(l).scenario_name,"costs"].join("_")}),ke=g(()=>e(P).length>0?e(de)[e(P)[0]]||"":e(j).length>0?e(de)[e(j)[0]]||"":e(T).length>0&&e(de)[e(T)[0]]||""),Je=g(()=>({responsive:!0,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:`Costs [${e(ke)}]`}}},interaction:{intersect:!1,mode:"nearest",axis:"x"},plugins:{tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue} ${e(ke)}`}}}})),Ke=g(()=>e(q).map(t=>t.toString())),we=g(()=>!e(y)||!e(O)?new Set:new Set([...e(y).data.map(t=>t[u])||[],...e(O).data.map(t=>t[u])||[]])),j=g(()=>!e(l)||!e(y)||!e(O)?[]:e(l).detail.system.set_transport_technologies.filter(t=>e(we).has(t))),P=g(()=>!e(l)||!e(y)||!e(O)?[]:xe(e(l).detail.system.set_conversion_technologies.filter(t=>e(we).has(t)))),T=g(()=>!e(l)||!e(y)||!e(O)?[]:xe(e(l).detail.system.set_storage_technologies.filter(t=>e(we).has(t)))),I=g(()=>!e(l)||!e(X)?.data?[]:xe(e(X).data.map(t=>t[u]))),M=g(()=>!e(l)||!e(Z)?.data?[]:xe(e(Z).data.map(t=>t[u]))),Ce=g(()=>e(l)?Object.keys(e(l).detail.edges).concat(e(l).detail.system.set_nodes):[]);Y(()=>{e(j),oe(()=>{e(_e).length&&e(y)&&e(O)?(e(j).length>0&&r(z,e(_e).map(t=>e(j)[t]).filter(t=>t!==void 0),!0),r(_e,[],!0)):e(j).length>0&&r(z,e(j),!0)})}),Y(()=>{e(P),oe(()=>{e(fe).length&&e(y)&&e(O)?(e(P).length>0&&r(H,e(fe).map(t=>e(P)[t]).filter(t=>t!==void 0),!0),r(fe,[],!0)):e(P).length>0&&r(H,e(P),!0)})}),Y(()=>{e(T),oe(()=>{e(ve).length&&e(y)&&e(O)?(e(T).length>0&&r(G,e(ve).map(t=>e(T)[t]).filter(t=>t!==void 0),!0),r(ve,[],!0)):e(T).length>0&&r(G,e(T),!0)})}),Y(()=>{e(I),oe(()=>{e(ge).length&&e(X)?(e(I).length>0&&r(F,e(ge).map(t=>e(I)[t]).filter(t=>t!==void 0),!0),r(ge,[],!0)):e(I).length>0&&r(F,e(I),!0)})}),Y(()=>{e(M),oe(()=>{e(me)&&e(Z)?(e(M).length>0&&r(B,e(me).map(t=>e(M)[t]).filter(t=>t!==void 0),!0),r(me,[],!0)):e(M).length>0&&r(B,e(M),!0)})}),Y(()=>{r(ee,e(Ce),!0)}),Y(()=>{r(q,e(W),!0)}),at(()=>{Object.entries(S).forEach(([t,a])=>{a.show=Be(t,a.show),a.subdivision=Be(t+"_sub",a.subdivision)}),r(_e,ie("tran"),!0),r(fe,ie("conv"),!0),r(ve,ie("stor"),!0),r(ge,ie("cost"),!0),r(me,ie("demand"),!0)}),Y(()=>{e(z),e(H),e(G),e(F),e(B),Object.values(S).forEach(t=>{t.show,t.subdivision}),nt().then(()=>{let t={tran:e(z).map(a=>e(j).indexOf(a)).join("~"),conv:e(H).map(a=>e(P).indexOf(a)).join("~"),stor:e(G).map(a=>e(T).indexOf(a)).join("~"),cost:e(F).map(a=>e(I).indexOf(a)).join("~"),demand:e(B).map(a=>e(M).indexOf(a)).join("~")};Object.entries(S).forEach(([a,h])=>{t[a]=h.show?"1":"0",t[a+"_sub"]=h.subdivision?"1":"0"}),dt(t)})});function Qe(){e(l)&&We()}function he(t,a){return!t||!t.data||(t.data=t.data.map(h=>a.reduce((D,[b,$])=>{if(!(b in h))return D;const{[b]:w,...k}=D;return{...k,[$]:w}},h))),t}async function We(){if(!e(l))return;r(re,!0);let t=await ht(e(l).solution_name,["cost_capex_yearly","cost_opex_yearly","cost_carbon_emissions_total","cost_carrier","cost_shed_demand"].map(a=>yt(a,e(l)?.version)),e(l).scenario_name);r(y,he(t.cost_capex_yearly||null,[["technology",u]]),!0),r(O,he(t.cost_opex_yearly||null,[["technology",u]]),!0),r(ue,t.cost_carbon_emissions_total||null,!0),r(X,he(t.cost_carrier||null,[["node","location"],["carrier",u]]),!0),r(Z,he(t.cost_shed_demand||null,[["node","location"],["carrier",u]]),!0),t.unit?.data&&r(de,Object.fromEntries(t.unit.data.map(a=>[a.technology,a[0]||a.units])),!0),r(re,!1)}let Oe=g(()=>{let t=[...e(H).concat(e(G)).concat(e(z)).flatMap(s=>[s+Se,s+je]),...e(F),...e(B)],a=e(W).filter(s=>!e(q).includes(s));const h=[{key:"capex",data:(e(y)?.data||[]).map(s=>({...s,[u]:s[u]+Se}))},{key:"opex",data:(e(O)?.data||[]).map(s=>({...s,[u]:s[u]+je}))},{key:"carrier",data:(e(X)?.data||[]).filter(s=>e(F).includes(s[u]))},{key:"shed_demand",data:(e(Z)?.data||[]).filter(s=>e(B).includes(s[u]))||null}];let D=h.flatMap(({key:s,data:o})=>!S[s].show||!o?[]:S[s].subdivision?o:Me(o,{location:e(ee)},{[u]:t},a,!1).map(C=>({...C.data,location:C.label,[u]:S[s].label})));h.forEach(({key:s})=>{S[s].label&&t.push(S[s].label)});let b,$;e(ce)==u?(b={location:e(Ce)},$={[u]:t}):(b={[u]:t},$={location:e(ee)}),pt();let w=Me(D,b,$,[],!1),k=[];return e(ue)?.data&&e(ue).data.length>0&&S.carbon_emission.show&&(k=[{data:Object.entries(e(ue).data[0]).filter(([o])=>!a.includes(Number(o))).map(([o,C])=>C),label:"Total Carbon Costs",type:"bar"}]),[...w,...k]});var Le=Lt(),Ae=f(E(Le),2);ft(Ae,{children:(t,a)=>{var h=Pt(),D=E(h);ye(D,{title:"Solution Selection",children:(w,k)=>{{let s=g(()=>e(re)||e(te));vt(w,{solution_selected:Qe,get disabled(){return e(s)},get carriers(){return e(Pe)},set carriers(o){r(Pe,o,!0)},get nodes(){return e(Te)},set nodes(o){r(Te,o,!0)},get years(){return e(W)},set years(o){r(W,o,!0)},get selected_solution(){return e(l)},set selected_solution(o){r(l,o,!0)},get loading(){return e(te)},set loading(o){r(te,o,!0)}})}}});var b=f(D,2);{var $=w=>{var k=jt(),s=E(k);ye(s,{title:"Cost Selection",children:(J,pe)=>{var L=be(),v=E(L);ct(v,17,()=>Object.values(S),_t,(U,x,N)=>{var V=Ct(),c=ne(V);Ie(c,"for","variables"+N);var A=ne(c,!0);le(c);var K=f(c,2),ae=ne(K);Ue(ae,{formId:"variables"+N,get value(){return e(x).show},set value(_){e(x).show=_}}),le(K);var se=f(K,2);{var i=_=>{var Re=wt(),De=E(Re);Ie(De,"for","subdivision"+N);var Fe=f(De,2),tt=ne(Fe);Ue(tt,{formId:"subdivision"+N,get value(){return e(x).subdivision},set value(rt){e(x).subdivision=rt}}),le(Fe),m(_,Re)};p(se,_=>{e(x).show&&e(x).show_subdivision&&_(i)})}le(V),ut(()=>st(A,e(x).title)),m(U,V)}),m(J,L)}});var o=f(s,2);ye(o,{title:"Technology Selection",children:(J,pe)=>{var L=Ot(),v=f(E(L),2);{var U=i=>{Q(i,{label:"Transport",get elements(){return e(j)},get value(){return e(z)},set value(_){r(z,_,!0)}})};p(v,i=>{e(j).length>0&&i(U)})}var x=f(v,2);{var N=i=>{Q(i,{label:"Storage",get elements(){return e(T)},get value(){return e(G)},set value(_){r(G,_,!0)}})};p(x,i=>{e(T).length>0&&i(N)})}var V=f(x,2);{var c=i=>{Q(i,{label:"Conversion",get elements(){return e(P)},get value(){return e(H)},set value(_){r(H,_,!0)}})};p(V,i=>{e(P).length>0&&i(c)})}var A=f(V,2);{var K=i=>{Q(i,{label:"Cost of Carrier",get elements(){return e(I)},get value(){return e(F)},set value(_){r(F,_,!0)}})};p(A,i=>{e(I).length>0&&i(K)})}var ae=f(A,2);{var se=i=>{Q(i,{label:"Shed Demand",get elements(){return e(M)},get value(){return e(B)},set value(_){r(B,_,!0)}})};p(ae,i=>{e(M).length>0&&i(se)})}m(J,L)}});var C=f(o,2);ye(C,{title:"Data Selection",children:(J,pe)=>{var L=St(),v=E(L);gt(v,{label:"Aggregation",content:(A,K=it)=>{{let ae=g(()=>mt($e));bt(A,{get formId(){return K()},get options(){return e(ae)},get value(){return e(ce)},set value(se){r(ce,se,!0)}})}}});var U=f(v,2);{var x=c=>{Q(c,{label:"Locations",get elements(){return e(Ce)},get value(){return e(ee)},set value(A){r(ee,A,!0)}})};p(U,c=>{e(ce)==$e[1]&&c(x)})}var N=f(U,2);{var V=c=>{Q(c,{label:"Years",get elements(){return e(W)},get value(){return e(q)},set value(A){r(q,A,!0)}})};p(N,c=>{e(q)&&c(V)})}m(J,L)}}),m(w,k)};p(b,w=>{!e(re)&&!e(te)&&e(y)&&e(l)!=null&&w($)})}m(t,h)}});var Ee=f(Ae,2),Xe=ne(Ee);{var Ze=t=>{var a=Tt();m(t,a)},et=t=>{var a=be(),h=E(a);{var D=b=>{var $=be(),w=E($);{var k=o=>{var C=$t();m(o,C)},s=o=>{var C=be(),J=E(C);{var pe=v=>{var U=kt();m(v,U)},L=v=>{xt(v,{type:"line",get options(){return e(Je)},get datasets(){return e(Oe)},get labels(){return e(Ke)},get plot_name(){return e(He)}})};p(J,v=>{e(q).length==0?v(pe):v(L,!1)},!0)}m(o,C)};p(w,o=>{e(Oe).length==0||e(Oe)[0].data.length==0?o(k):o(s,!1)})}m(b,$)};p(h,b=>{e(l)!=null&&b(D)},!0)}m(t,a)};p(Xe,t=>{e(te)||e(re)?t(Ze):t(et,!1)})}le(Ee),m(Ne,Le),lt()}export{qt as component};
