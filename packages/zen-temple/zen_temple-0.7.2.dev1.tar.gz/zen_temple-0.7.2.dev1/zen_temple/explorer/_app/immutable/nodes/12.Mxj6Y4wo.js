import"../chunks/DsnmJJEf.js";import{s as ye,o as Ze}from"../chunks/CxYln1hn.js";import{p as Re,c as ae,f as O,a as v,i as Be,e as N,m as F,r as R,h as w,g as e,l as s,v as Me,s as f,b as E,u as ie,d as be,j as o,t as et,n as Ie}from"../chunks/Drxlg-Xn.js";import{i as z}from"../chunks/BbB4DTre.js";import{u as tt,g as rt,a as Le,b as Ae,e as ot,i as at}from"../chunks/iLwl9KAB.js";import{s as Ee}from"../chunks/CpZHtke-.js";import{B as xe,C as nt}from"../chunks/CINfEwQf.js";import{F as st,f as lt,b as de,S as it,c as Fe,r as dt,j as ut,h as ct,t as _t,i as ft}from"../chunks/C6Y5c09E.js";import{A as fe}from"../chunks/se_iUg_v.js";import{D as vt}from"../chunks/6KI89v4Y.js";import{T as we}from"../chunks/BNZwnsPw.js";var gt=N('<div class="text-center text-muted">Click on a bar to see a production and consumption breakdown.</div>'),mt=N('<div class="row"><div class="col-lg-6"><h3 class="text-center h4"> </h3> <!></div> <div class="col-lg-6"><h3 class="text-center h4"> </h3> <!></div></div>');function ht(ve,k){Re(k,!0);let B=s(()=>{if(k.year==null)return[];const l=k.labels.findIndex(a=>a===k.year);return k.datasets.map(a=>({data:a.data.find((x,C)=>C===l),color:a.backgroundColor,label:a.label}))});function V(l){return{animation:{duration:0},responsive:!0,plugins:{tooltip:{callbacks:{label:a=>{const x=Number(a.raw||0),C=a.dataset.data.map(i=>Number(i||0)).reduce((i,ee)=>i+ee,0),p=(x*100/C).toFixed(2);return`${a.dataset.label}: ${a.formattedValue}${k.tooltipSuffix} (${p}%)`}}},legend:{position:"top"}}}}function Y(l,a){if(k.year==null)return[];const x=e(B).filter(i=>i.data&&l(Number(i.data))),C=x.map(i=>i.data),p=x.map(i=>i.color);return[{label:a,data:C,backgroundColor:p}]}function ne(l){return k.year==null?[]:e(B).filter(a=>a.data&&l(Number(a.data))).map(a=>a.label||"")}let $=s(()=>Y(l=>l>1e-6,"Production")),c=s(()=>ne(l=>l>1e-6)),_=s(()=>V()),M=s(()=>Y(l=>l<-1e-6,"Consumption")),T=s(()=>ne(l=>l<-1e-6)),ue=s(()=>V());var U=ae(),q=O(U);{var G=l=>{var a=gt();v(l,a)},Q=l=>{var a=mt(),x=F(a),C=F(x),p=F(C);R(C);var i=w(C,2);xe(i,{type:"pie",get datasets(){return e($)},get labels(){return e(c)},get options(){return e(_)},downloadable:!1}),R(x);var ee=w(x,2),te=F(ee),ce=F(te);R(te);var _e=w(te,2);xe(_e,{type:"pie",get datasets(){return e(M)},get labels(){return e(T)},get options(){return e(ue)},downloadable:!1}),R(ee),R(a),Me(()=>{ye(p,`Breakdown of Production for ${k.year??""}`),ye(ce,`Breakdown of Consumption for ${k.year??""}`)}),v(l,a)};z(q,l=>{k.year==null?l(G):l(Q,!1)})}v(ve,U),Be()}var pt=N('<label class="col-6 col-md-2 fw-medium fs-5">Subdivision</label> <div class="col-4 col-md-2"><!></div>',1),bt=N('<div class="row align-items-baseline"><label class="col-6 col-md-3 fw-medium fs-4"> </label> <div class="col-4 col-md-3"><!></div> <!></div>'),wt=N("<!> <!>",1),yt=N("<!> <!> <!>",1),xt=N("<!> <!> <!> <!>",1),Ct=N("<!> <!>",1),St=N('<div class="text-center"><div class="spinner-border center" role="status"><span class="visually-hidden">Loading...</span></div></div>'),Pt=N("<div></div>"),kt=N('<div class="text-center">No carriers with this selection.</div>'),Nt=N('<div class="text-center">No data with this selection.</div>'),jt=N('<h1 class="mt-2 mb-4">The Transition Pathway &ndash; Production</h1> <!> <h2 class="visually-hidden">Plots</h2> <div class="plot mt-4"><!></div> <div class="my-4"><!></div>',1);function Ut(ve,k){Re(k,!0);let B=f(null),V=f(E([])),Y=f(E([])),ne=f(E([])),$=E([{id:"conversion",short_id:"conv",title:"Conversion",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_conversion_output",positive_label:"Conversion output",negative:"flow_conversion_input",negative_label:"Conversion input"},{id:"storage",short_id:"stor",title:"Storage",show:!0,subdivision:!1,show_subdivision:!0,filter_by_technologies:!0,positive:"flow_storage_discharge",positive_label:"Storage discharge",positive_suffix:" (discharge)",negative:"flow_storage_charge",negative_label:"Storage charge",negative_suffix:" (charge)"},{id:"import_export",short_id:"imp_exp",title:"Import/Export",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"flow_import",positive_label:"Import",negative:"flow_export",negative_label:"Export"},{id:"demand_shed_demand",short_id:"dem_shed",title:"Demand/Shed Demand",show:!0,subdivision:!1,show_subdivision:!1,filter_by_technologies:!1,positive:"shed_demand",positive_label:"Shed Demand",negative:"demand",negative_label:"Demand"}]),c=f(null),_=f(null),M=f(E([])),T=f(E([])),ue=s(()=>[...e(M),...e(T)]),U=f(!1),q=f(E([])),G=f(E([])),Q=f(null),l=f(!0),a=f(!0),x=f(E([])),C=f(E([])),p=f(!1),i=f(!1),ee=s(()=>{if(!e(c)?.solution_name||!e(_))return"";let t=e(c).solution_name.split(".");return[t[t?.length-1],e(c).scenario_name,e(_)].join("_")}),te=f(E([])),ce=s(()=>{let t=null;return!t&&e(_)&&(t=e(te).find(r=>r.carrier==e(_))),t&&(t[0]||t.units)||""}),_e=s(()=>e(G).map(t=>t.toString())),Ce=s(()=>e(U)?"":` ${e(ce)}`),Te=s(()=>({datasets:{bar:{borderColor:"rgb(255, 0, 0)",borderWidth:t=>e(Q)&&t.chart.data.labels[t.dataIndex]==e(Q)?5:0,borderRadius:2,borderSkipped:"middle"}},animation:{duration:0},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,title:{display:!0,text:"Year"}},y:{stacked:!0,title:{display:!0,text:"Production"+(e(U)?"":` [${e(ce)}]`)},max:e(U)?1:void 0,suggestedMin:e(U)?-1:void 0}},plugins:{tooltip:{callbacks:{label:t=>`${t.dataset.label}: ${t.formattedValue}${e(Ce)}`,labelColor:t=>({borderColor:t.dataset.backgroundColor,backgroundColor:t.dataset.backgroundColor,borderWidth:0})},filter:t=>Math.abs(t.parsed.y)>1e-6,borderWidth:0},legend:{labels:{generateLabels:t=>{const r=t.data.datasets;return r.length?r.map((d,u)=>({text:d.label||"",fillStyle:d.backgroundColor,strokeStyle:d.borderColor,lineWidth:0,hidden:!t.isDatasetVisible(u),datasetIndex:u,fontColor:nt.defaults.color})):[]}}}},interaction:{intersect:!1,mode:"nearest",axis:"x"}})),X=s(()=>e(c)?e(c).detail.system.set_carriers.slice().sort():[]),H=s(()=>e(c)?lt(Object.entries(e(c).detail.carriers_input).concat(Object.entries(e(c).detail.carriers_output)).filter(t=>e(_)&&t[1].includes(e(_))).map(t=>t[0])):[]),J=s(()=>e(c)?e(c).detail.system.set_storage_technologies.filter(t=>e(c)?.detail.reference_carrier[t]==e(_)):[]);ie(()=>{e(X),be(()=>{(e(X).length>=1&&!e(_)||!e(X).includes(e(_)))&&o(_,e(X)[0],!0)})}),ie(()=>{e(H),be(()=>{e(x).length>0?(e(H).length>0&&o(M,e(x).map(t=>e(H)[t]).filter(t=>t!==void 0),!0),o(x,[],!0)):(e(H).length>0||e(M).some(t=>!e(H).includes(t)))&&o(M,e(H),!0)})}),ie(()=>{e(J),be(()=>{e(C).length>0?(e(J).length>0&&o(T,e(C).map(t=>e(J)[t]).filter(t=>t!==void 0),!0),o(C,[],!0)):(e(J).length>0||e(T).some(t=>!e(J).includes(t)))&&o(T,e(J),!0)})}),ie(()=>{o(q,e(Y),!0)}),Ze(()=>{o(_,rt("car")||null,!0),$.forEach(t=>{t.show=Le(t.short_id,t.show),t.subdivision=Le(t.short_id+"_sub",t.subdivision)}),o(x,Ae("conv_tech"),!0),o(l,!0),o(C,Ae("stor_tech"),!0),o(a,!0)}),ie(()=>{e(_),$.forEach(t=>{t.show,t.subdivision}),e(M),e(T),et().then(()=>{let t={car:e(_),conv_tech:e(M).map(r=>e(H).indexOf(r)).join("~"),stor_tech:e(T).map(r=>e(J).indexOf(r)).join("~")};$.forEach(r=>{t[r.short_id]=r.show?"1":"0",t[r.short_id+"_sub"]=r.subdivision?"1":"0"}),tt(t)})});function Ue(){o(G,e(V),!0),o(q,e(Y),!0)}async function We(){Ue(),await Ve()}function ze(t){t&&o(Q,e(Q)!==t?t:null,!0)}async function Ve(){if(e(c)===null)return;o(i,!0),o(B,null);const t=await ct(e(c).solution_name,["flow_conversion_output","flow_conversion_input","flow_storage_discharge","flow_storage_charge","flow_import","flow_export","shed_demand","demand"],e(c).scenario_name,"demand");o(B,$.flatMap(r=>[t[r.positive]||null,t[r.negative]||null]),!0),t.unit?.data&&o(te,t.unit.data,!0),o(i,!1)}function Ye(t,r,d){return r.subdivision?t:Object.entries(t.reduce((u,S)=>{const g=S.node,h=S.technology;if(d&&!d.includes(h))return u;let D=Object.fromEntries(Object.entries(S).filter(([y])=>!isNaN(Number(y))).map(([y,n])=>[y,Number(n)]));return u[g]=u[g]||{technology:r.title,data:{}},u[g].data=Object.fromEntries(Object.entries(D).map(([y,n])=>[y,(n||0)+(u[g].data[y]||0)])),u},{})).map(([u,S])=>({...S.data,technology:S.technology,node:u}))}function Se(t,r,d,u,S,g){if(t===null)return[];let h={technology:[...e(ue),r.title]},D={node:e(q)};const y=Ye(t.data.filter(P=>P.carrier===void 0||P.carrier==e(_)),r,r.filter_by_technologies?e(ue):void 0);let n=ft(y,h,D,d,!1,void 0,S||"").map(P=>({...P,borderColor:"rgb(0, 0, 0)"}));return g!==void 0&&(n=n.map(g)),!r.subdivision&&n.length>0&&(n[0].label=u),n}let ge=s(()=>{if(e(q).length==0||e(G).length==0||!e(B)||e(B).length==0)return[];let t=e(V).filter(d=>!e(G).includes(d));dt();let r=$.flatMap((d,u)=>{if(!d.show||!e(B))return[];let S=Se(e(B)[2*u],d,t,d.positive_label,d.positive_suffix,void 0),g=Se(e(B)[2*u+1],d,t,d.negative_label,d.negative_suffix,h=>({...h,data:Object.values(h.data).map(D=>-Number(D))}));return[...S,...g]});return e(U)?ut(r):r});var Pe=jt(),ke=w(O(Pe),2);st(ke,{children:(t,r)=>{var d=Ct(),u=O(d);de(u,{title:"Solution Selection",children:(h,D)=>{{let y=s(()=>e(i)||e(p));it(h,{solution_selected:We,get disabled(){return e(y)},get selected_solution(){return e(c)},set selected_solution(n){o(c,n,!0)},get years(){return e(V)},set years(n){o(V,n,!0)},get nodes(){return e(Y)},set nodes(n){o(Y,n,!0)},get edges(){return e(ne)},set edges(n){o(ne,n,!0)},get loading(){return e(p)},set loading(n){o(p,n,!0)}})}}});var S=w(u,2);{var g=h=>{var D=xt(),y=O(D);de(y,{title:"Carrier Selection",children:(I,oe)=>{var b=ae(),L=O(b);{var K=m=>{Fe(m,{label:"Carrier",content:(W,j=Ie)=>{{let se=s(()=>_t(e(X))),Z=s(()=>e(p)||e(i));vt(W,{get formId(){return j()},get options(){return e(se)},get disabled(){return e(Z)},get value(){return e(_)},set value(pe){o(_,pe,!0)}})}}})};z(L,m=>{e(X).length>0&&m(K)})}v(I,b)}});var n=w(y,2);de(n,{title:"Production Component Selection",children:(I,oe)=>{var b=ae(),L=O(b);ot(L,17,()=>$,at,(K,m,A)=>{var W=bt(),j=F(W);Ee(j,"for","variables"+A);var se=F(j,!0);R(j);var Z=w(j,2),pe=F(Z);we(pe,{formId:"variables"+A,get value(){return e(m).show},set value(le){e(m).show=le}}),R(Z);var Je=w(Z,2);{var Ke=le=>{var je=pt(),Oe=O(je);Ee(Oe,"for","subdivision"+A);var De=w(Oe,2),Qe=F(De);we(Qe,{formId:"subdivision"+A,get value(){return e(m).subdivision},set value(Xe){e(m).subdivision=Xe}}),R(De),v(le,je)};z(Je,le=>{e(m).show&&e(m).show_subdivision&&le(Ke)})}R(W),Me(()=>ye(se,e(m).title)),v(K,W)}),v(I,b)}});var P=w(n,2);de(P,{title:"Technology Selection",children:(I,oe)=>{var b=wt(),L=O(b);{let m=s(()=>e(p)||e(i));fe(L,{label:"Conversion",get elements(){return e(H)},get disabled(){return e(m)},get value(){return e(M)},set value(A){o(M,A,!0)}})}var K=w(L,2);{let m=s(()=>e(p)||e(i));fe(K,{label:"Storage",get elements(){return e(J)},get disabled(){return e(m)},get value(){return e(T)},set value(A){o(T,A,!0)}})}v(I,b)}});var re=w(P,2);{var he=I=>{de(I,{title:"Data Selection",children:(oe,b)=>{var L=yt(),K=O(L);Fe(K,{label:"Normalization",content:(j,se=Ie)=>{we(j,{get formId(){return se()},get value(){return e(U)},set value(Z){o(U,Z,!0)}})}});var m=w(K,2);{let W=s(()=>e(p)||e(i));fe(m,{label:"Nodes",get elements(){return e(Y)},get disabled(){return e(W)},get value(){return e(q)},set value(j){o(q,j,!0)}})}var A=w(m,2);{let W=s(()=>e(p)||e(i));fe(A,{label:"Years",get elements(){return e(V)},get disabled(){return e(W)},get value(){return e(G)},set value(j){o(G,j,!0)}})}v(oe,L)}})};z(re,I=>{!e(i)&&e(_)!=null&&I(he)})}v(h,D)};z(S,h=>{!e(p)&&e(c)&&h(g)})}v(t,d)}});var me=w(ke,4),$e=F(me);{var qe=t=>{var r=St();v(t,r)},Ge=t=>{var r=ae(),d=O(r);{var u=g=>{var h=Pt();v(g,h)},S=g=>{var h=ae(),D=O(h);{var y=P=>{var re=kt();v(P,re)},n=P=>{var re=ae(),he=O(re);{var I=b=>{var L=Nt();v(b,L)},oe=b=>{xe(b,{type:"bar",get options(){return e(Te)},get labels(){return e(_e)},get datasets(){return e(ge)},get plot_name(){return e(ee)},onclick:ze})};z(he,b=>{e(ge).length==0?b(I):b(oe,!1)},!0)}v(P,re)};z(D,P=>{e(X).length==0?P(y):P(n,!1)},!0)}v(g,h)};z(d,g=>{e(c)==null?g(u):g(S,!1)},!0)}v(t,r)};z($e,t=>{e(p)||e(i)?t(qe):t(Ge,!1)})}R(me);var Ne=w(me,2),He=F(Ne);ht(He,{get datasets(){return e(ge)},get labels(){return e(_e)},get year(){return e(Q)},get tooltipSuffix(){return e(Ce)}}),R(Ne),v(ve,Pe),Be()}export{Ut as component};
