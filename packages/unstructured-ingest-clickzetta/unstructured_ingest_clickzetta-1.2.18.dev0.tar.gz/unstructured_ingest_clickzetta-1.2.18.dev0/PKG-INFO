Metadata-Version: 2.4
Name: unstructured-ingest-clickzetta
Version: 1.2.18.dev0
Summary: ClickZetta connector for Unstructured data pipeline - Enhanced ETL with SQL and Volume support
Author-email: ClickZetta Community <yunqiqiliang@gmail.com>
License-Expression: Apache-2.0
Keywords: clickzetta,data-pipeline,document-processing,etl,rag,unstructured
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Intended Audience :: Education
Classifier: Intended Audience :: Science/Research
Classifier: License :: OSI Approved :: Apache Software License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Database
Classifier: Topic :: Scientific/Engineering :: Artificial Intelligence
Classifier: Topic :: Scientific/Engineering :: Information Analysis
Classifier: Topic :: System :: Archiving
Requires-Python: <3.13,>=3.10
Requires-Dist: certifi>=2025.7.14
Requires-Dist: click
Requires-Dist: opentelemetry-sdk
Requires-Dist: pydantic>=2.7
Requires-Dist: python-dateutil
Requires-Dist: tqdm
Provides-Extra: airtable
Requires-Dist: pandas; extra == 'airtable'
Requires-Dist: pyairtable; extra == 'airtable'
Provides-Extra: astradb
Requires-Dist: astrapy>2.0.0; extra == 'astradb'
Provides-Extra: azure
Requires-Dist: adlfs; extra == 'azure'
Requires-Dist: fsspec; extra == 'azure'
Provides-Extra: azure-ai-search
Requires-Dist: azure-search-documents; extra == 'azure-ai-search'
Provides-Extra: bedrock
Requires-Dist: aioboto3; extra == 'bedrock'
Requires-Dist: boto3; extra == 'bedrock'
Provides-Extra: biomed
Requires-Dist: bs4; extra == 'biomed'
Requires-Dist: requests; extra == 'biomed'
Provides-Extra: box
Requires-Dist: boxfs; extra == 'box'
Requires-Dist: fsspec; extra == 'box'
Provides-Extra: chroma
Requires-Dist: chromadb; extra == 'chroma'
Provides-Extra: clarifai
Requires-Dist: clarifai; extra == 'clarifai'
Provides-Extra: clickzetta
Requires-Dist: clickzetta-connector-python; extra == 'clickzetta'
Requires-Dist: clickzetta-zettapark-python; extra == 'clickzetta'
Provides-Extra: confluence
Requires-Dist: atlassian-python-api; extra == 'confluence'
Requires-Dist: requests; extra == 'confluence'
Provides-Extra: couchbase
Requires-Dist: couchbase; extra == 'couchbase'
Provides-Extra: dashscope
Requires-Dist: dashscope; extra == 'dashscope'
Provides-Extra: databricks-delta-tables
Requires-Dist: databricks-sql-connector; extra == 'databricks-delta-tables'
Requires-Dist: pandas; extra == 'databricks-delta-tables'
Provides-Extra: databricks-volumes
Requires-Dist: databricks-sdk; extra == 'databricks-volumes'
Provides-Extra: delta-table
Requires-Dist: boto3; extra == 'delta-table'
Requires-Dist: deltalake; extra == 'delta-table'
Requires-Dist: pandas; extra == 'delta-table'
Requires-Dist: pyarrow; extra == 'delta-table'
Requires-Dist: tenacity; extra == 'delta-table'
Provides-Extra: discord
Requires-Dist: discord-py; extra == 'discord'
Provides-Extra: doc
Requires-Dist: unstructured[doc]; extra == 'doc'
Provides-Extra: docx
Requires-Dist: unstructured[docx]; extra == 'docx'
Provides-Extra: dropbox
Requires-Dist: dropboxdrivefs; extra == 'dropbox'
Requires-Dist: fsspec; extra == 'dropbox'
Provides-Extra: duckdb
Requires-Dist: duckdb; extra == 'duckdb'
Requires-Dist: pandas; extra == 'duckdb'
Provides-Extra: elasticsearch
Requires-Dist: elasticsearch[async]<9.0.0; extra == 'elasticsearch'
Provides-Extra: epub
Requires-Dist: unstructured[epub]; extra == 'epub'
Provides-Extra: gcs
Requires-Dist: bs4; extra == 'gcs'
Requires-Dist: fsspec; extra == 'gcs'
Requires-Dist: gcsfs; extra == 'gcs'
Provides-Extra: github
Requires-Dist: pygithub>1.58.0; extra == 'github'
Requires-Dist: requests; extra == 'github'
Provides-Extra: gitlab
Requires-Dist: python-gitlab; extra == 'gitlab'
Provides-Extra: google-drive
Requires-Dist: google-api-python-client; extra == 'google-drive'
Requires-Dist: tenacity; extra == 'google-drive'
Provides-Extra: hubspot
Requires-Dist: hubspot-api-client; extra == 'hubspot'
Requires-Dist: urllib3; extra == 'hubspot'
Provides-Extra: huggingface
Requires-Dist: sentence-transformers; extra == 'huggingface'
Provides-Extra: ibm-watsonx-s3
Requires-Dist: httpx; extra == 'ibm-watsonx-s3'
Requires-Dist: pandas; extra == 'ibm-watsonx-s3'
Requires-Dist: pyarrow; extra == 'ibm-watsonx-s3'
Requires-Dist: pyiceberg; extra == 'ibm-watsonx-s3'
Requires-Dist: tenacity; extra == 'ibm-watsonx-s3'
Provides-Extra: image
Requires-Dist: unstructured[image]; extra == 'image'
Provides-Extra: jira
Requires-Dist: atlassian-python-api; extra == 'jira'
Provides-Extra: kafka
Requires-Dist: confluent-kafka; extra == 'kafka'
Provides-Extra: kdbai
Requires-Dist: kdbai-client>=1.4.0; extra == 'kdbai'
Requires-Dist: pandas; extra == 'kdbai'
Provides-Extra: lancedb
Requires-Dist: lancedb; extra == 'lancedb'
Provides-Extra: md
Requires-Dist: unstructured[md]; extra == 'md'
Provides-Extra: milvus
Requires-Dist: pymilvus; extra == 'milvus'
Provides-Extra: mixedbreadai
Requires-Dist: mixedbread; extra == 'mixedbreadai'
Provides-Extra: mongodb
Requires-Dist: pymongo; extra == 'mongodb'
Provides-Extra: msg
Requires-Dist: unstructured[msg]; extra == 'msg'
Provides-Extra: neo4j
Requires-Dist: cymple; extra == 'neo4j'
Requires-Dist: neo4j-rust-ext; extra == 'neo4j'
Requires-Dist: networkx; extra == 'neo4j'
Provides-Extra: notion
Requires-Dist: backoff; extra == 'notion'
Requires-Dist: htmlbuilder; extra == 'notion'
Requires-Dist: httpx; extra == 'notion'
Requires-Dist: notion-client; extra == 'notion'
Provides-Extra: octoai
Requires-Dist: openai; extra == 'octoai'
Requires-Dist: tiktoken; extra == 'octoai'
Provides-Extra: odt
Requires-Dist: unstructured[odt]; extra == 'odt'
Provides-Extra: onedrive
Requires-Dist: msal; extra == 'onedrive'
Requires-Dist: office365-rest-python-client; extra == 'onedrive'
Requires-Dist: requests; extra == 'onedrive'
Provides-Extra: openai
Requires-Dist: openai; extra == 'openai'
Requires-Dist: tiktoken; extra == 'openai'
Provides-Extra: opensearch
Requires-Dist: opensearch-py; extra == 'opensearch'
Provides-Extra: org
Requires-Dist: unstructured[org]; extra == 'org'
Provides-Extra: outlook
Requires-Dist: msal; extra == 'outlook'
Requires-Dist: office365-rest-python-client; extra == 'outlook'
Provides-Extra: pdf
Requires-Dist: unstructured[pdf]; extra == 'pdf'
Provides-Extra: pinecone
Requires-Dist: pinecone; extra == 'pinecone'
Provides-Extra: postgres
Requires-Dist: pandas; extra == 'postgres'
Requires-Dist: psycopg2-binary; extra == 'postgres'
Provides-Extra: ppt
Requires-Dist: unstructured[ppt]; extra == 'ppt'
Provides-Extra: pptx
Requires-Dist: unstructured[pptx]; extra == 'pptx'
Provides-Extra: qdrant
Requires-Dist: qdrant-client; extra == 'qdrant'
Provides-Extra: reddit
Requires-Dist: praw; extra == 'reddit'
Provides-Extra: redis
Requires-Dist: redis<=5.3.0; extra == 'redis'
Provides-Extra: remote
Requires-Dist: unstructured-client>=0.30.0; extra == 'remote'
Provides-Extra: rst
Requires-Dist: unstructured[rst]; extra == 'rst'
Provides-Extra: rtf
Requires-Dist: unstructured[rtf]; extra == 'rtf'
Provides-Extra: s3
Requires-Dist: fsspec; extra == 's3'
Requires-Dist: s3fs; extra == 's3'
Provides-Extra: salesforce
Requires-Dist: simple-salesforce; extra == 'salesforce'
Provides-Extra: sftp
Requires-Dist: fsspec; extra == 'sftp'
Requires-Dist: paramiko; extra == 'sftp'
Provides-Extra: sharepoint
Requires-Dist: msal; extra == 'sharepoint'
Requires-Dist: office365-rest-python-client; extra == 'sharepoint'
Requires-Dist: requests; extra == 'sharepoint'
Provides-Extra: singlestore
Requires-Dist: pandas; extra == 'singlestore'
Requires-Dist: singlestoredb; extra == 'singlestore'
Provides-Extra: slack
Requires-Dist: slack-sdk[optional]; extra == 'slack'
Provides-Extra: snowflake
Requires-Dist: pandas; extra == 'snowflake'
Requires-Dist: psycopg2-binary; extra == 'snowflake'
Requires-Dist: snowflake-connector-python; extra == 'snowflake'
Provides-Extra: togetherai
Requires-Dist: together; extra == 'togetherai'
Provides-Extra: tsv
Requires-Dist: unstructured[tsv]; extra == 'tsv'
Provides-Extra: vastdb
Requires-Dist: ibis; extra == 'vastdb'
Requires-Dist: pandas; extra == 'vastdb'
Requires-Dist: pyarrow; extra == 'vastdb'
Requires-Dist: vastdb; extra == 'vastdb'
Provides-Extra: vectara
Requires-Dist: aiofiles; extra == 'vectara'
Requires-Dist: httpx; extra == 'vectara'
Requires-Dist: requests; extra == 'vectara'
Provides-Extra: vertexai
Requires-Dist: vertexai; extra == 'vertexai'
Provides-Extra: voyageai
Requires-Dist: voyageai; extra == 'voyageai'
Provides-Extra: weaviate
Requires-Dist: weaviate-client; extra == 'weaviate'
Provides-Extra: wikipedia
Requires-Dist: wikipedia; extra == 'wikipedia'
Provides-Extra: xlsx
Requires-Dist: unstructured[xlsx]; extra == 'xlsx'
Provides-Extra: zendesk
Requires-Dist: aiofiles; extra == 'zendesk'
Requires-Dist: bs4; extra == 'zendesk'
Requires-Dist: httpx; extra == 'zendesk'
Description-Content-Type: text/markdown

# unstructured-ingest-clickzetta

ClickZettaè¿æ¥å™¨ï¼Œä¸“ä¸ºUnstructuredæ•°æ®å¤„ç†ç®¡é“æ‰“é€ çš„ä¼ä¸šçº§æ•°æ®æ¹–ä»“è§£å†³æ–¹æ¡ˆã€‚

æœ¬é¡¹ç›®åŸºäº [Unstructured-IO/unstructured-ingest](https://github.com/Unstructured-IO/unstructured-ingest) æ‰©å±•å¼€å‘ï¼Œæä¾›äº†ä¸ClickZettaæ•°æ®æ¹–ä»“å¹³å°çš„æ·±åº¦é›†æˆã€‚

## âš¡ å¿«é€Ÿå¼€å§‹

**æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ - ä¸€é”®å¯åŠ¨ï¼š**

```bash
git clone https://github.com/yunqiqiliang/unstructured-ingest-clickzetta.git
cd unstructured-ingest-clickzetta
./multi_lakehouse_kb_builder/run.sh
```

ğŸ“– **è¯¦ç»†æ–‡æ¡£** â†’ [multi_lakehouse_kb_builder/README.md](./multi_lakehouse_kb_builder/README.md)

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### ç›¸å¯¹äºä¸Šæ¸¸é¡¹ç›®æ–°å¢çš„åŠŸèƒ½

#### 1. ClickZetta SQLè¿æ¥å™¨ (`clickzetta`)
- **å®Œæ•´çš„æ•°æ®æ¹–ä»“é›†æˆ**ï¼šæ”¯æŒä»ClickZettaæ•°æ®åº“è¡¨è¯»å–å’Œå†™å…¥éç»“æ„åŒ–æ•°æ®
- **æ™ºèƒ½æ‰¹é‡å¤„ç†**ï¼šè‡ªåŠ¨ä¼˜åŒ–çš„æ‰¹é‡ä¸Šä¼ ï¼Œæ”¯æŒå¤§è§„æ¨¡æ•°æ®å¤„ç†
- **å‘é‡åŒ–æ”¯æŒ**ï¼šåŸç”Ÿæ”¯æŒå‘é‡åµŒå…¥å­˜å‚¨ï¼Œå…¼å®¹å¤šç§å‘é‡ç»´åº¦ï¼ˆ512/768/1024/1536ï¼‰
- **ä¸­æ–‡ä¼˜åŒ–**ï¼šé’ˆå¯¹ä¸­æ–‡ç¯å¢ƒä¼˜åŒ–çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—æç¤º
- **è¿æ¥æ± ç®¡ç†**ï¼šæ™ºèƒ½çš„æ•°æ®åº“è¿æ¥å’Œä¼šè¯ç®¡ç†

#### 2. ClickZetta Volumeè¿æ¥å™¨ (`clickzetta_volume`)
- **äº‘åŸç”Ÿå­˜å‚¨**ï¼šæ”¯æŒClickZetta Volumeå­˜å‚¨ç³»ç»Ÿçš„æ–‡ä»¶æ“ä½œ
- **çµæ´»çš„å·ç®¡ç†**ï¼šæ”¯æŒç”¨æˆ·å·ã€è¡¨å·ç­‰å¤šç§å·ç±»å‹
- **é«˜çº§æ–‡ä»¶æ“ä½œ**ï¼šåŒ…æ‹¬ä¸Šä¼ ã€ä¸‹è½½ã€åˆ é™¤ã€æ­£åˆ™è¿‡æ»¤ç­‰
- **è·¯å¾„æ™ºèƒ½è§£æ**ï¼šè‡ªåŠ¨å¤„ç†å¤æ‚çš„æ–‡ä»¶è·¯å¾„å’Œå·åè§£æ
- **ç¯å¢ƒå˜é‡é›†æˆ**ï¼šæ”¯æŒå¤šç§ç¯å¢ƒå˜é‡å‘½åçº¦å®š

#### 3. ä¼ä¸šçº§åŠŸèƒ½å¢å¼º
- **å¢å¼ºçš„é”™è¯¯å¤„ç†**ï¼šæä¾›è¯¦ç»†çš„ä¸­æ–‡é”™è¯¯ä¿¡æ¯å’Œæ•…éšœæ’é™¤æŒ‡å—
- **æ€§èƒ½ä¼˜åŒ–**ï¼š
  - æ‰¹é‡å¤„ç†æœºåˆ¶å‡å°‘æ•°æ®åº“è¿æ¥å¼€é”€
  - æ™ºèƒ½ç¼“å†²åŒºç®¡ç†é˜²æ­¢å†…å­˜æº¢å‡º
  - ä¼˜åŒ–çš„æ•°æ®ä¼ è¾“å’Œåºåˆ—åŒ–
- **å…¼å®¹æ€§å¢å¼º**ï¼š
  - æ”¯æŒé€šä¹‰åƒé—®ç­‰ç¬¬ä¸‰æ–¹APIçš„ç‰¹æ®Šå¤„ç†
  - OpenAIå®¢æˆ·ç«¯SSLä¼˜åŒ–
  - å‘åå…¼å®¹åŸæœ‰é…ç½®æ ¼å¼

#### 4. DashScopeåµŒå…¥æ”¯æŒ (`dashscope`)
- **é˜¿é‡Œäº‘é€šä¹‰åƒé—®é›†æˆ**ï¼šå®Œæ•´æ”¯æŒDashScope TextEmbedding API
- **å¤šæ¨¡å‹æ”¯æŒ**ï¼šæ”¯æŒtext-embedding-v1/v2/v4ç­‰å¤šä¸ªç‰ˆæœ¬
- **æ™ºèƒ½é‡è¯•æœºåˆ¶**ï¼šå¸¦æŒ‡æ•°é€€é¿çš„é‡è¯•ç­–ç•¥ï¼Œå¤„ç†APIé™æµ
- **æ‰¹é‡å¤„ç†ä¼˜åŒ–**ï¼šæ”¯æŒæ‰¹é‡åµŒå…¥å’Œå•æ–‡æœ¬åµŒå…¥
- **ç»Ÿè®¡ç›‘æ§**ï¼šè¯¦ç»†çš„APIè°ƒç”¨ç»Ÿè®¡å’ŒæˆåŠŸç‡ç›‘æ§

#### 5. å¤šæ¹–ä»“çŸ¥è¯†åº“æ„å»ºç³»ç»Ÿ (`multi_lakehouse_kb_builder`) â­
- **ğŸš€ æ™ºèƒ½å¯åŠ¨è„šæœ¬**ï¼š`./multi_lakehouse_kb_builder/run.sh` ä¸€é”®å¯åŠ¨ï¼Œè‡ªåŠ¨ç¯å¢ƒæ£€æµ‹
- **ğŸ›ï¸ äº¤äº’å¼æ“ä½œç•Œé¢**ï¼šå‹å¥½çš„èœå•ç³»ç»Ÿï¼Œæ”¯æŒæ‰€æœ‰åŠŸèƒ½æ“ä½œ
- **ğŸ“¦ æ‰¹é‡éƒ¨ç½²**ï¼šæ”¯æŒä¸€é”®éƒ¨ç½²åˆ°å¤šä¸ªClickZetta Lakehouseå®ä¾‹
- **ğŸ§  æ™ºèƒ½è¡¨ç®¡ç†**ï¼šè‡ªåŠ¨åˆ›å»ºschemaã€ç®¡ç†Rawè¡¨å’ŒSilverè¡¨ç»“æ„
- **âš¡ å¹¶è¡Œ/ä¸²è¡Œæ‰§è¡Œ**ï¼šæ”¯æŒä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼Œé€‚åº”ä¸åŒæ€§èƒ½éœ€æ±‚
- **ğŸ” æ•°æ®éªŒè¯**ï¼šè‡ªåŠ¨éªŒè¯éƒ¨ç½²ç»“æœï¼Œæ£€æµ‹å‘é‡è´¨é‡é—®é¢˜
- **ğŸ¥ å¥åº·æ£€æŸ¥**ï¼šè¿æ¥çŠ¶æ€è¯Šæ–­å’ŒçŸ¥è¯†åº“å¥åº·è¯„ä¼°
- **ğŸ“š çŸ¥è¯†ç®¡ç†**ï¼šæ”¯æŒæ·»åŠ ã€åˆ é™¤ã€æœç´¢è‡ªå®šä¹‰çŸ¥è¯†æ¡ç›®

#### 6. Jupyter Notebookç¤ºä¾‹ (`examples/notebooks/`)
- **`Unstructured_data_ETL_from_local_to_Lakehouse_tongyi.ipynb`**ï¼š
  - å®Œæ•´çš„æœ¬åœ°æ–‡æ¡£åˆ°ClickZetta Lakehouseçš„ETLæµç¨‹
  - DashScope text-embedding-v4é›†æˆå’Œå‘é‡åŒ–å¤„ç†
  - Rawè¡¨å’ŒSilverè¡¨çš„åˆ›å»ºå’Œç®¡ç†
  - å€’æ’ç´¢å¼•å’Œå‘é‡ç´¢å¼•çš„è‡ªåŠ¨åˆ›å»º
  - RAGæ£€ç´¢å’Œç›¸ä¼¼åº¦æœç´¢æ¼”ç¤º
  - æ”¯æŒçŸ¥è¯†åº“å†…å®¹åŠ¨æ€æ·»åŠ å’Œç®¡ç†
- **`databricks_delta_tables.ipynb`**ï¼š
  - Databricks Delta Tablesé›†æˆç¤ºä¾‹ï¼ˆç»§æ‰¿è‡ªä¸Šæ¸¸é¡¹ç›®ï¼‰

#### 7. å¼€å‘å’Œæµ‹è¯•å·¥å…·
- **å®Œæ•´çš„æµ‹è¯•å¥—ä»¶**ï¼šåŒ…å«SQLå’ŒVolumeè¿æ¥å™¨çš„é›†æˆæµ‹è¯•
- **DockeråŒ–éƒ¨ç½²**ï¼šæ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²å’Œæµ‹è¯•ç¯å¢ƒ
- **CI/CDä¼˜åŒ–**ï¼šå®šåˆ¶çš„GitHub Actionså·¥ä½œæµ

## ğŸ“¦ å®‰è£…

### åŸºç¡€å®‰è£…
```bash
git clone https://github.com/yunqiqiliang/unstructured-ingest-clickzetta.git
cd unstructured-ingest-clickzetta
pip install -e .
```

### ClickZettaä¾èµ–
```bash
# åŸºç¡€ClickZettaè¿æ¥å™¨
pip install -r requirements/connectors/clickzetta.txt

# DashScopeåµŒå…¥æ”¯æŒ
pip install -r requirements/embed/dashscope.txt
```

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### ğŸš€ æ¨èæ–¹å¼ï¼šæ™ºèƒ½å¯åŠ¨è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰

**ä¸€é”®å¯åŠ¨å¤šæ¹–ä»“çŸ¥è¯†åº“éƒ¨ç½²ç³»ç»Ÿï¼š**

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd unstructured-ingest-clickzetta

# ä¸€é”®å¯åŠ¨äº¤äº’å¼èœå•
./multi_lakehouse_kb_builder/run.sh

# æˆ–ç›´æ¥æ‰§è¡Œå‘½ä»¤
./multi_lakehouse_kb_builder/run.sh test      # ç¯å¢ƒæµ‹è¯•
./multi_lakehouse_kb_builder/run.sh deploy    # äº¤äº’å¼éƒ¨ç½²
./multi_lakehouse_kb_builder/run.sh deploy-all # æ‰¹é‡éƒ¨ç½²
./multi_lakehouse_kb_builder/run.sh validate  # éªŒè¯ç»“æœ
./multi_lakehouse_kb_builder/run.sh check     # å¥åº·æ£€æŸ¥
./multi_lakehouse_kb_builder/run.sh manage    # çŸ¥è¯†åº“ç®¡ç†
```

**âœ¨ ç‰¹ç‚¹ï¼š**
- ğŸ¯ **æ™ºèƒ½ç¯å¢ƒæ£€æµ‹**ï¼šè‡ªåŠ¨è¯†åˆ«condaã€venvã€uvç­‰Pythonç¯å¢ƒ
- ğŸ“¦ **ä¾èµ–è‡ªåŠ¨æ£€æŸ¥**ï¼šæ£€æµ‹å¹¶æç¤ºå®‰è£…ç¼ºå¤±çš„ä¾èµ–åŒ…
- ğŸ›ï¸ **äº¤äº’å¼èœå•**ï¼šå‹å¥½çš„ç”¨æˆ·ç•Œé¢ï¼Œæ”¯æŒæ‰€æœ‰åŠŸèƒ½
- ğŸš€ **æ‰¹é‡éƒ¨ç½²**ï¼šæ”¯æŒä¸²è¡Œ/å¹¶è¡Œéƒ¨ç½²åˆ°å¤šä¸ªLakehouse
- ğŸ” **å®Œæ•´éªŒè¯**ï¼šè‡ªåŠ¨æ•°æ®éªŒè¯å’Œå¥åº·æ£€æŸ¥
- ğŸ“š **çŸ¥è¯†ç®¡ç†**ï¼šæ”¯æŒæ·»åŠ ã€æœç´¢ã€åˆ é™¤çŸ¥è¯†å†…å®¹

ğŸ“– **è¯¦ç»†ä½¿ç”¨æŒ‡å—** â†’ [multi_lakehouse_kb_builder/README.md](./multi_lakehouse_kb_builder/README.md)

---

### ğŸ“š Jupyter Notebookæ–¹å¼ï¼ˆè¯¦ç»†å­¦ä¹ ï¼‰

é€‚åˆå­¦ä¹ å’Œç†è§£å®Œæ•´ETLæµç¨‹çš„ç”¨æˆ·ï¼Œæä¾›6æ­¥è¯¦ç»†æ“ä½œï¼š

### æ­¥éª¤1ï¼šç¯å¢ƒå‡†å¤‡å’ŒéªŒè¯

```python
# 1. å®‰è£…æœ¬åœ°å¼€å‘ç‰ˆæœ¬
!pip uninstall unstructured-ingest -y -q
!pip install -e /path/to/unstructured-ingest-clickzetta/ -q

# 2. éªŒè¯DashScopeæ”¯æŒ
from unstructured_ingest.processes.embedder import EmbedderConfig
test_config = EmbedderConfig(
    embedding_provider="dashscope",
    embedding_model_name="text-embedding-v4",
    embedding_api_key="test"
)
print("âœ… DashScope æ”¯æŒå·²æˆåŠŸæ·»åŠ ")
```

### æ­¥éª¤2ï¼šé…ç½®ç¯å¢ƒå˜é‡å’Œå‚æ•°

```python
import os
import dotenv

# åŠ è½½ç¯å¢ƒå˜é‡
dotenv.load_dotenv('.env')

# DashScopeé…ç½®
api_key = os.getenv("DASHSCOPE_API_KEY")
embedding_provider = "dashscope"
embedding_model_name = "text-embedding-v4"
embeddings_dimensions = 1024

# ClickZettaè¿æ¥å‚æ•°
_username = os.getenv("cz_username")
_password = os.getenv("cz_password")
_service = os.getenv("cz_service")
_instance = os.getenv("cz_instance")
_workspace = os.getenv("cz_workspace")
_schema = os.getenv("cz_schema")
_vcluster = os.getenv("cz_vcluster")

# è¡¨åé…ç½®
index_and_table_prefix = "dashscope_v4_1024_2048_20250611_"
raw_table_name = f"{index_and_table_prefix}yunqi_raw_elements"
silver_table_name = f"{index_and_table_prefix}yunqi_elements"
```

### æ­¥éª¤3ï¼šåˆ›å»ºæ•°æ®åº“è¿æ¥å’Œè¡¨ç»“æ„

```python
from clickzetta.connector import connect

# åˆ›å»ºè¿æ¥å‡½æ•°
def get_connection(password, username, service, instance, workspace, schema, vcluster):
    return connect(
        password=password, username=username, service=service,
        instance=instance, workspace=workspace, schema=schema, vcluster=vcluster
    )

# å»ºç«‹è¿æ¥
conn = get_connection(_password, _username, _service, _instance, _workspace, _schema, _vcluster)

# æ‰§è¡ŒSQLçš„å·¥å…·å‡½æ•°
def execute_sql(conn, sql_statement: str):
    with conn.cursor() as cur:
        cur.execute(sql_statement)
        return cur.fetchall()

# åˆ›å»ºRawè¡¨å’ŒSilverè¡¨ï¼ˆåŒ…å«å‘é‡ç´¢å¼•ï¼‰
execute_sql(conn, raw_table_ddl)  # è¯¦è§notebookä¸­çš„å®Œæ•´DDL
execute_sql(conn, silver_table_ddl)  # åŒ…å«å€’æ’ç´¢å¼•å’Œå‘é‡ç´¢å¼•
```

### æ­¥éª¤4ï¼šé…ç½®å¹¶è¿è¡ŒETL Pipeline

```python
from unstructured_ingest.interfaces import ProcessorConfig
from unstructured_ingest.pipeline.pipeline import Pipeline
from unstructured_ingest.processes.chunker import ChunkerConfig
from unstructured_ingest.processes.connectors.local import (
    LocalIndexerConfig, LocalDownloaderConfig, LocalConnectionConfig
)
from unstructured_ingest.processes.embedder import EmbedderConfig
from unstructured_ingest.processes.partitioner import PartitionerConfig
from unstructured_ingest.processes.connectors.sql.clickzetta import (
    ClickzettaConnectionConfig, ClickzettaAccessConfig,
    ClickzettaUploadStagerConfig, ClickzettaUploaderConfig
)

# åˆ›å»ºPipeline
pipeline = Pipeline.from_configs(
    context=ProcessorConfig(verbose=False, tqdm=False, num_processes=2),

    # æœ¬åœ°æ–‡ä»¶è¾“å…¥
    indexer_config=LocalIndexerConfig(
        input_path=os.getenv("LOCAL_FILE_INPUT_DIR"),
        file_glob="**/*",
        recursive=True
    ),
    downloader_config=LocalDownloaderConfig(),
    source_connection_config=LocalConnectionConfig(),

    # æ–‡æ¡£è§£æé…ç½®
    partitioner_config=PartitionerConfig(
        partition_by_api=False,
        strategy="hi_res",
        additional_partition_args={
            "split_pdf_page": True,
            "split_pdf_allow_failed": True,
            "split_pdf_concurrency_level": 1
        }
    ),

    # æ–‡æ¡£åˆ†å—é…ç½®
    chunker_config=ChunkerConfig(
        chunking_strategy="by_title",
        chunk_max_characters=2048,
        chunk_overlap=512,
        chunk_combine_text_under_n_chars=200,
    ),

    # DashScopeåµŒå…¥é…ç½®
    embedder_config=EmbedderConfig(
        embedding_provider="dashscope",
        embedding_model_name="text-embedding-v4",
        embedding_api_key=api_key,
    ),

    # ClickZettaç›®æ ‡é…ç½®
    destination_connection_config=ClickzettaConnectionConfig(
        access_config=ClickzettaAccessConfig(password=_password),
        username=_username, service=_service, instance=_instance,
        workspace=_workspace, schema=_schema, vcluster=_vcluster,
    ),
    stager_config=ClickzettaUploadStagerConfig(),
    uploader_config=ClickzettaUploaderConfig(
        table_name=raw_table_name,
        documents_original_source="https://yunqi.tech/documents"
    ),
)

# è¿è¡ŒPipeline
print("ğŸš€ è¿è¡Œ Pipeline...")
pipeline.run()
```

### æ­¥éª¤5ï¼šæ•°æ®è½¬æ¢å’Œæ¸…æ´—

```python
# ä»Rawè¡¨è½¬æ¢æ•°æ®åˆ°Silverè¡¨
clean_transformation_sql = f"""
INSERT overwrite {_schema}.{silver_table_name}
SELECT
    id, record_locator, type, record_id, element_id, filetype,
    file_directory, filename, last_modified, languages, page_number, text,
    CAST(embeddings AS VECTOR({embeddings_dimensions})) AS embeddings,
    parent_id, is_continuation, orig_elements, element_type, coordinates,
    link_texts, link_urls, email_message_id, sent_from, sent_to, subject,
    url, version, date_created, date_modified, date_processed, text_as_html,
    emphasized_text_contents, emphasized_text_tags,
    "https://yunqi.tech/documents" as documents_source
FROM {_schema}.{raw_table_name};
"""

execute_sql(conn, clean_transformation_sql)
print("âœ… æ•°æ®è½¬æ¢å®Œæˆ")
```

### æ­¥éª¤6ï¼šRAGæ£€ç´¢å’ŒçŸ¥è¯†åº“ç®¡ç†

```python
import dashscope
from dashscope import TextEmbedding
import pandas as pd

# è®¾ç½®DashScope API
dashscope.api_key = api_key

def get_embedding(query):
    """ä½¿ç”¨DashScopeè·å–åµŒå…¥"""
    response = TextEmbedding.call(model="text-embedding-v4", input=query)
    if response.status_code == 200:
        return response.output['embeddings'][0]['embedding']
    else:
        raise Exception(f"DashScope API error: {response.message}")

def retrieve_documents(conn, query: str, num_results: int = 10):
    """å‘é‡ç›¸ä¼¼åº¦æœç´¢"""
    embedding = get_embedding(query)

    with conn.cursor() as cur:
        stmt = f"""
            SELECT "vector_embedding" as retrieve_method, record_locator, type,
                   filename, text, orig_elements,
                   cosine_distance(embeddings, cast({embedding} as vector({embeddings_dimensions}))) AS score
            FROM {silver_table_name}
            ORDER BY score ASC LIMIT {num_results}
        """
        cur.execute(stmt)
        results = cur.fetchall()
        columns = [desc[0] for desc in cur.description]
        return pd.DataFrame(results, columns=columns)

# ç¤ºä¾‹ï¼šæœç´¢ç›¸å…³æ–‡æ¡£
query_text = "åˆ›å»ºç´¢å¼•çš„è¯­æ³•æ˜¯ä»€ä¹ˆï¼Ÿ"
results_df = retrieve_documents(conn, query_text)
print(f"æ‰¾åˆ° {len(results_df)} ä¸ªç›¸å…³æ–‡æ¡£")

# æ·»åŠ è‡ªå®šä¹‰çŸ¥è¯†
kb_text = "ClickZettaæ˜¯äº‘å™¨ã€Singdataçš„æŠ€æœ¯å“ç‰Œ..."
embedded_kb = get_embedding(kb_text)
add_kb_sql = f"""
INSERT INTO {_schema}.{silver_table_name} (
  id, type, record_id, element_id, filetype, last_modified, languages,
  text, embeddings, date_created, date_modified, date_processed
) VALUES (
  uuid(), 'UserInput', uuid(), uuid(), 'text', CURRENT_TIMESTAMP, '["zh-cn"]',
  '{kb_text}', CAST('{embedded_kb}' AS vector(float,{embeddings_dimensions})),
  CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, CURRENT_TIMESTAMP
);
"""
execute_sql(conn, add_kb_sql)
print("âœ… çŸ¥è¯†åº“å†…å®¹æ·»åŠ å®Œæˆ")
```

### ClickZetta Volumeè¿æ¥å™¨ç¤ºä¾‹

```python
from unstructured_ingest.processes.connectors.fsspec.clickzetta_volume import (
    ClickZettaVolumeConnectionConfig,
    ClickZettaVolumeIndexer,
    ClickZettaVolumeIndexerConfig
)

# ç¯å¢ƒå˜é‡é…ç½®
export CLICKZETTA_USERNAME="your-username"
export CLICKZETTA_PASSWORD="your-password"
export CLICKZETTA_SERVICE="your-service-url"
# ... å…¶ä»–ç¯å¢ƒå˜é‡

# åˆ—ä¸¾å·ä¸­æ–‡ä»¶
connection_config = ClickZettaVolumeConnectionConfig()
index_config = ClickZettaVolumeIndexerConfig(
    volume="your-volume",
    remote_path="path/to/files/",
    regexp=".*\\.pdf$"  # åªåŒ¹é…PDFæ–‡ä»¶
)

indexer = ClickZettaVolumeIndexer(
    connection_config=connection_config,
    index_config=index_config
)
files = indexer.list_files()
```

### DashScopeåµŒå…¥å™¨ç¤ºä¾‹

```python
from unstructured_ingest.embed.dashscope import (
    DashScopeEmbeddingConfig,
    DashScopeEmbeddingEncoder
)

# é…ç½®DashScopeåµŒå…¥å™¨
config = DashScopeEmbeddingConfig(
    api_key="your-dashscope-api-key",
    model_name="text-embedding-v4",  # æ”¯æŒv1/v2/v4
    max_retries=3,
    retry_delay=1.0,
    enable_debug_logging=True
)

# åˆ›å»ºåµŒå…¥å™¨
encoder = DashScopeEmbeddingEncoder(config)

# åµŒå…¥æ–‡æ¡£
elements = [{"text": "ClickZettaæ˜¯äº‘åŸç”Ÿæ•°æ®æ¹–ä»“å¹³å°"}]
embedded_elements = encoder.embed_documents(elements)

# æŸ¥çœ‹ç»Ÿè®¡
stats = encoder.get_stats()
print(f"æˆåŠŸç‡: {stats['success_rate_percent']}%")
```

### å¤šæ¹–ä»“çŸ¥è¯†åº“æ„å»ºç¤ºä¾‹

```bash
# è¿›å…¥çŸ¥è¯†åº“æ„å»ºç›®å½•
cd multi_lakehouse_kb_builder

# å¿«é€Ÿéƒ¨ç½²åˆ°æ‰€æœ‰Lakehouse
./run_with_current_env.sh deploy

# éªŒè¯éƒ¨ç½²ç»“æœ
python validate_kb_simple.py

# ç®¡ç†çŸ¥è¯†åº“å†…å®¹
python manage_knowledge_simple.py
```

## ğŸ“Š Jupyter Notebookä½¿ç”¨ç¤ºä¾‹

### è¿è¡Œå®Œæ•´çš„ETLæµç¨‹

```bash
# å¯åŠ¨Jupyter Notebook
jupyter notebook

# æ‰“å¼€ç¤ºä¾‹notebook
# examples/notebooks/Unstructured_data_ETL_from_local_to_Lakehouse_tongyi.ipynb
```

### NotebookåŠŸèƒ½äº®ç‚¹

1. **ç¯å¢ƒå‡†å¤‡**ï¼š
   ```python
   # è‡ªåŠ¨åˆ‡æ¢åˆ°æœ¬åœ°å¼€å‘ç‰ˆæœ¬
   !pip install -e /path/to/unstructured-ingest-clickzetta/

   # éªŒè¯DashScopeæ”¯æŒ
   from unstructured_ingest.processes.embedder import EmbedderConfig
   ```

2. **DashScopeé…ç½®**ï¼š
   ```python
   # é…ç½®DashScope text-embedding-v4
   embedding_provider = "dashscope"
   embedding_model_name = "text-embedding-v4"
   embeddings_dimensions = 1024
   api_key = os.getenv("DASHSCOPE_API_KEY")
   ```

3. **è¡¨ç»“æ„åˆ›å»º**ï¼š
   ```python
   # è‡ªåŠ¨åˆ›å»ºRawè¡¨å’ŒSilverè¡¨
   # åŒ…å«å‘é‡ç´¢å¼•å’Œå€’æ’ç´¢å¼•
   INDEX embeddings_vec_index USING vector properties (
       "scalar.type" = "f32",
       "distance.function" = "cosine_distance"
   )
   ```

4. **Pipelineæ‰§è¡Œ**ï¼š
   ```python
   # ä½¿ç”¨DashScopeåµŒå…¥å™¨çš„å®Œæ•´Pipeline
   pipeline = Pipeline.from_configs(
       embedder_config=EmbedderConfig(
           embedding_provider="dashscope",
           embedding_model_name="text-embedding-v4",
           embedding_api_key=api_key,
       ),
       # ... å…¶ä»–é…ç½®
   )
   ```

5. **RAGæ£€ç´¢æ¼”ç¤º**ï¼š
   ```python
   # å‘é‡ç›¸ä¼¼åº¦æœç´¢
   query_text = "åˆ›å»ºç´¢å¼•çš„è¯­æ³•æ˜¯ä»€ä¹ˆï¼Ÿ"
   results = retrieve_documents(conn, query_text)

   # åŠ¨æ€æ·»åŠ çŸ¥è¯†åº“å†…å®¹
   kb = "ClickZettaæ˜¯äº‘å™¨ã€Singdataçš„æŠ€æœ¯å“ç‰Œ..."
   embedded_kb = get_embedding(kb)
   ```

## ğŸ“‹ ç¯å¢ƒå˜é‡é…ç½®

æ”¯æŒå¤šç§å‘½åçº¦å®šçš„ç¯å¢ƒå˜é‡ï¼š

```bash
# ClickZettaè¿æ¥é…ç½®ï¼ˆæ”¯æŒCLICKZETTA_*ã€CZ_*ã€cz_*å‰ç¼€ï¼‰
CLICKZETTA_USERNAME=your-username
CLICKZETTA_PASSWORD=your-password
CLICKZETTA_SERVICE=your-service-url
CLICKZETTA_INSTANCE=your-instance
CLICKZETTA_WORKSPACE=your-workspace
CLICKZETTA_SCHEMA=your-schema
CLICKZETTA_VCLUSTER=your-vcluster

# OpenAI APIé…ç½®ï¼ˆæ”¯æŒè‡ªå®šä¹‰base_urlï¼‰
OPENAI_API_KEY=your-api-key
OPENAI_BASE_URL=your-custom-endpoint  # å¯é€‰ï¼Œæ”¯æŒé€šä¹‰åƒé—®ç­‰

# DashScope APIé…ç½®
DASHSCOPE_API_KEY=your-dashscope-api-key  # é˜¿é‡Œäº‘é€šä¹‰åƒé—®APIå¯†é’¥
```

## ğŸ§ª æµ‹è¯•

```bash
# è¿è¡ŒClickZettaè¿æ¥å™¨æµ‹è¯•
pytest test/integration/connectors/sql/test_clickzetta.py

# è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•
pytest test/integration/

# æµ‹è¯•DashScopeåµŒå…¥åŠŸèƒ½
python -c "
from unstructured_ingest.embed.dashscope import DashScopeEmbeddingConfig, DashScopeEmbeddingEncoder
config = DashScopeEmbeddingConfig(api_key='your-key', model_name='text-embedding-v4')
encoder = DashScopeEmbeddingEncoder(config)
result = encoder.embed_query('æµ‹è¯•æ–‡æœ¬')
print(f'åµŒå…¥ç»´åº¦: {len(result)}')
"

# è¿è¡Œå¤šæ¹–ä»“çŸ¥è¯†åº“æ„å»ºæµ‹è¯•
cd multi_lakehouse_kb_builder && python test_kb_deployment.py
```

## ğŸ“š ä¸ä¸Šæ¸¸é¡¹ç›®çš„å…³ç³»

æœ¬é¡¹ç›®åŸºäºå®˜æ–¹ [Unstructured-IO/unstructured-ingest](https://github.com/Unstructured-IO/unstructured-ingest) é¡¹ç›®ï¼š

- **ä¸Šæ¸¸å…¼å®¹**ï¼šå®šæœŸåŒæ­¥ä¸Šæ¸¸æ›´æ–°ï¼Œä¿æŒä¸æœ€æ–°ç‰ˆæœ¬çš„å…¼å®¹æ€§
- **åŠŸèƒ½æ‰©å±•**ï¼šåœ¨ä¿æŒåŸæœ‰åŠŸèƒ½çš„åŸºç¡€ä¸Šï¼Œä¸“é—¨é’ˆå¯¹ClickZettaå¹³å°è¿›è¡Œæ·±åº¦é›†æˆ
- **ä¼ä¸šä¼˜åŒ–**ï¼šé’ˆå¯¹ä¼ä¸šçº§ä½¿ç”¨åœºæ™¯è¿›è¡Œæ€§èƒ½å’Œç¨³å®šæ€§ä¼˜åŒ–

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªä¸ä¸Šæ¸¸é¡¹ç›®ç›¸åŒçš„å¼€æºè®¸å¯è¯ã€‚