import{b as M,u as q,i as U,h as f,j as b,d as J,c as d,l as y,a,e as k,w as e,m as P,k as c,t as o,f as s,q as K,o as r,_ as Q,B as z,F as H}from"./index-YIGRKgNA.js";import{c as W,b as X,a as Y,_ as Z}from"./DomainTransportForm-CmFZ1Cxm.js";import{L as ee}from"./LoadingData-Cxd490P6.js";import{p as ae}from"./parameters-DpVw-Zs4.js";import{_ as te}from"./ResourcesForm-C1YGkT8i.js";import{d as j}from"./domains-CQv8gtbQ.js";import{d as N,c as w,V as I}from"./VAvatar-J563boKh.js";import{V,c as F,a as h,b as le}from"./VExpansionPanels-Dnwgt5uT.js";import{V as p,a as m}from"./VRow-CAbOSEHS.js";import{u as oe}from"./domains.store-CfpnnBGo.js";import{V as se,a as re}from"./VToolbar-Cs-fVa4M.js";import"./ChoiceField-17aCFpF6.js";import"./VForm-BwTUBf4u.js";import"./tag-DV1_zOzl.js";import"./VInput-Dpmea5z9.js";import"./VProgressCircular-CtqQON49.js";import"./forwardRefs-DPrLRqxP.js";import"./ssrBoot-CpJ-7WlH.js";import"./VTextField-C9VUP7V9.js";import"./VSwitch-CixaedmQ.js";import"./VSelectionControl-BN-zQ3C6.js";import"./transports-B9mWU1W8.js";import"./VAutocomplete-Bg2AlW_n.js";import"./VSelect-Cdh0qO5m.js";import"./VMenu-DDmBlbM8.js";import"./VCheckboxBtn-CLh3m66z.js";import"./VChip-DvxO74Mw.js";import"./filter-C_GJovn5.js";import"./VCheckbox-VicuXIJq.js";import"./VContainer-L2EoH3dT.js";/* empty css              */const ue={key:1},ne={key:0},ie={key:0},me={key:0},de={class:"mr-2"},ce={class:"mr-2"},fe={class:"mr-2"},pe={key:0},_e={class:"mr-2"},ve={class:"mt-4 d-flex justify-end"},ye={__name:"DomainEditForm",props:{domain:{type:Object,default:null}},setup($){const x=K(),{$gettext:n}=M(),R=q(),E=$,_=U(()=>R.authUser),v=f({}),D=f(0),g=f(!1),t=U(()=>E.domain),C=f(),L=f(),T=f(),A=f(),B=f(),O=U(()=>{const u={generalForm:C,limitationForm:A,dnsForm:B};return t.value.type==="relaydomain"&&(u.transportForm=T),v.value.params&&v.value.params.enable_domain_limits&&(_.value.role===b.SUPER_ADMIN||_.value.role===b.RESELLER)&&(u.resourcesForm=L),u}),S=f(!1);async function G(){S.value=!1,D.value=[];for(const[u,i]of Object.entries(O.value))if(i.value!=null){const{valid:l}=await i.value.vFormRef.validate();l||(S.value=!0,D.value.push(u))}if(!S.value){g.value=!0;try{const u=JSON.parse(JSON.stringify(t.value));u.transport===null&&delete u.transport,u.type==="relaydomain"?T.value.checkSettingTypes(u):u.transport&&delete u.transport,u.message_limit===""&&(u.message_limit=null),await j.updateDomain(t.value.pk,u),x.push({name:"DomainDetail",params:{id:t.value.pk}})}finally{g.value=!1}}}return J(()=>{ae.getGlobalApplication("limits").then(u=>{v.value.data=u.data})}),(u,i)=>g.value?(r(),d(ee,{key:0})):(r(),y("div",ue,[a(le,{modelValue:D.value,"onUpdate:modelValue":i[5]||(i[5]=l=>D.value=l),multiple:S.value},{default:e(()=>[a(V,{eager:"",value:"generalForm"},{default:e(()=>[a(F,null,{default:e(({expanded:l})=>[a(p,{"no-gutters":""},{default:e(()=>[a(m,{cols:"4"},{default:e(()=>[c(o(s(n)("General")),1)]),_:1}),a(m,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(N,{"leave-absolute":""},{default:e(()=>[l?(r(),y("span",ne)):(r(),d(p,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(m,{cols:"6"},{default:e(()=>[c(o(s(n)("Name: "))+" "+o(t.value.name),1)]),_:1}),a(m,{cols:"6"},{default:e(()=>[c(o(s(n)("Type: "))+" "+o(t.value.type),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(h,null,{default:e(()=>[a(W,{ref_key:"generalForm",ref:C,modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=l=>t.value=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(V,{eager:"",value:"dnsForm"},{default:e(()=>[a(F,null,{default:e(({expanded:l})=>[a(p,{"no-gutters":""},{default:e(()=>[a(m,{cols:"4"},{default:e(()=>[c(o(s(n)("DNS")),1)]),_:1}),a(m,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(N,{"leave-absolute":""},{default:e(()=>[l?(r(),y("span",ie)):(r(),d(p,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(m,{cols:"6"},{default:e(()=>[c(o(s(n)("DNS checks"))+" ",1),t.value.enable_dns_checks?(r(),d(w,{key:0,color:"success",icon:"mdi-check-circle-outline"})):(r(),d(w,{key:1,icon:"mdi-check-circle-outline"}))]),_:1}),a(m,{cols:"6"},{default:e(()=>[c(o(s(n)("DKIM signing"))+" ",1),t.value.enable_dkim?(r(),d(w,{key:0,color:"success",icon:"mdi-check-circle-outline"})):(r(),d(w,{key:1,icon:"mdi-close-circle-outline"}))]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(h,null,{default:e(()=>[a(X,{ref_key:"dnsForm",ref:B,modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=l=>t.value=l)},null,8,["modelValue"])]),_:1})]),_:1}),a(V,{eager:"",value:"limitationForm"},{default:e(()=>[a(F,null,{default:e(({expanded:l})=>[a(p,{"no-gutters":""},{default:e(()=>[a(m,{cols:"4"},{default:e(()=>[c(o(s(n)("Limitations")),1)]),_:1}),a(m,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(N,{"leave-absolute":""},{default:e(()=>[l?(r(),y("span",me)):(r(),d(p,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(m,{cols:"6"},{default:e(()=>[k("div",de,o(s(n)("Quota: "))+" "+o(t.value.quota),1)]),_:1}),t.value.message_limit?(r(),d(m,{key:0,cols:"6"},{default:e(()=>[k("div",ce,o(s(n)("Sending limit: "))+" "+o(t.value.message_limit),1)]),_:1})):(r(),d(m,{key:1,cols:"6"},{default:e(()=>[k("div",fe,o(s(n)("No sending limit")),1)]),_:1}))]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(h,null,{default:e(()=>[a(Y,{ref_key:"limitationForm",ref:A,modelValue:t.value,"onUpdate:modelValue":i[2]||(i[2]=l=>t.value=l)},null,8,["modelValue"])]),_:1})]),_:1}),t.value.type==="relaydomain"?(r(),d(V,{key:0,value:"transportForm",eager:""},{default:e(()=>[a(F,null,{default:e(({expanded:l})=>[a(p,{"no-gutters":""},{default:e(()=>[a(m,{cols:"4"},{default:e(()=>[c(o(s(n)("Transport")),1)]),_:1}),a(m,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(N,{"leave-absolute":""},{default:e(()=>[l?(r(),y("span",pe)):(r(),d(p,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(m,{cols:"6"},{default:e(()=>[k("div",_e,o(s(n)("Service: "))+" "+o(t.value.transport.service),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(h,null,{default:e(()=>[a(Z,{ref_key:"transportForm",ref:T,modelValue:t.value.transport,"onUpdate:modelValue":i[3]||(i[3]=l=>t.value.transport=l)},null,8,["modelValue"])]),_:1})]),_:1})):P("",!0),v.value.params&&v.value.params.enable_domain_limits&&(_.value.role===s(b).SUPER_ADMIN||_.value.role===s(b).RESELLER)?(r(),d(V,{key:1,value:"resourcesForm",eager:""},{default:e(()=>[a(F,null,{default:e(()=>[a(p,{"no-gutters":""},{default:e(()=>[a(m,{cols:"4"},{default:e(()=>[c(o(s(n)("Resources")),1)]),_:1})]),_:1})]),_:1}),a(h,null,{default:e(()=>[a(te,{ref_key:"resourcesForm",ref:L,modelValue:t.value.resources,"onUpdate:modelValue":i[4]||(i[4]=l=>t.value.resources=l)},null,8,["modelValue"])]),_:1})]),_:1})):P("",!0)]),_:1},8,["modelValue","multiple"]),k("div",ve,[a(I,{loading:g.value,onClick:i[6]||(i[6]=l=>s(x).go(-1))},{default:e(()=>[c(o(s(n)("Cancel")),1)]),_:1},8,["loading"]),a(I,{class:"ml-4",color:"primary darken-1",loading:g.value,onClick:G},{default:e(()=>[c(o(s(n)("Save")),1)]),_:1},8,["loading"])])]))}},ge={__name:"DomainEditView",setup($){const{$gettext:x}=M(),n=z(),R=oe(),E=f({});return R.getDomains(),j.getDomain(n.params.id).then(_=>{E.value=_.data}),(_,v)=>(r(),y(H,null,[a(se,{flat:""},{default:e(()=>[a(re,null,{default:e(()=>[c(o(s(x)("Edit domain")),1)]),_:1})]),_:1}),a(s(ye),{domain:E.value},null,8,["domain"])],64))}},We=Q(ge,[["__scopeId","data-v-2221e277"]]);export{We as default};
