Metadata-Version: 2.4
Name: aionvk
Version: 0.4.0
Summary: Asynchronous VK API framework for building bots
Author: Nikita
Author-email: nikitalyschev@gmail.com
Requires-Python: >=3.11,<4.0
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: 3.13
Classifier: Programming Language :: Python :: 3.14
Requires-Dist: aiohttp (>=3.12.15,<4.0.0)
Requires-Dist: httpx (>=0.27.0,<0.28.0)
Requires-Dist: loguru (>=0.7.3,<0.8.0)
Requires-Dist: magic-filter (>=1.0.12,<2.0.0)
Requires-Dist: openpyxl (>=3.1.5,<4.0.0)
Requires-Dist: pydantic (>=2.7.1,<3.0.0)
Description-Content-Type: text/markdown

# aionvk

[![PyPI - Version](https://img.shields.io/pypi/v/aionvk)](https://pypi.org/project/aionvk/)
[![Python Versions](https://img.shields.io/pypi/pyversions/aionvk.svg)](https://pypi.org/project/aionvk/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

## ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°

```bash
pip install aionvk
```

##  quickstart Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚: Ð­Ñ…Ð¾-Ð±Ð¾Ñ‚ Ð·Ð° 1 Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ

Ð­Ñ‚Ð¾Ñ‚ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Ð±Ð¾Ñ‚ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‡Ð°Ñ‚ÑŒ Ð½Ð° Ð»ÑŽÐ±Ð¾Ðµ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ, Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑ ÐµÐ³Ð¾ Ð¾Ð±Ñ€Ð°Ñ‚Ð½Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ.

```python
# echo_bot.py
import asyncio
import os

from aiohttp import web
from dotenv import load_dotenv

from aionvk import Bot, Dispatcher, F, Router
from aionvk.types import Message

load_dotenv()

# Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð½Ð° Ð²Ð°ÑˆÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² .env Ñ„Ð°Ð¹Ð»Ðµ
VK_TOKEN = os.getenv("VK_BOT_TOKEN")
VK_SECRET = os.getenv("VK_CALLBACK_SECRET")
VK_CONFIRMATION_TOKEN = os.getenv("VK_CALLBACK_CONFIRMATION_TOKEN")

# 1. Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²
router = Router()
bot = Bot(token=VK_TOKEN)
dp = Dispatcher()

# 2. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°
@router.message(F.text) # Ð¡Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½Ð° Ð»ÑŽÐ±Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ñ Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼
async def echo_handler(event: Message, bot: Bot):
    await bot.send_message(
        peer_id=event.peer_id,
        text=f"Ð’Ñ‹ Ð½Ð°Ð¿Ð¸ÑÐ°Ð»Ð¸: {event.text}"
    )

# 3. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð²ÐµÐ±-ÑÐµÑ€Ð²ÐµÑ€Ð° Ð´Ð»Ñ Callback API
async def handle_vk_callback(request: web.Request):
    data = await request.json()
    if data.get("secret") != VK_SECRET: return web.Response(status=403)
    if data.get("type") == "confirmation": return web.Response(text=VK_CONFIRMATION_TOKEN)
    
    # ÐŸÐµÑ€ÐµÐ´Ð°ÐµÐ¼ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ð¸ Ð¾Ð±ÑŠÐµÐºÑ‚ Ð±Ð¾Ñ‚Ð° Ð² Ð´Ð¸ÑÐ¿ÐµÑ‚Ñ‡ÐµÑ€
    asyncio.create_task(dp.feed_raw_event(data, bot=bot))
    return web.Response(text="ok")

async def main():
    dp.include_router(router) # Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐµÐ¼ Ð½Ð°ÑˆÐ¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸
    
    app = web.Application()
    app.router.add_post("/callback", handle_vk_callback)
    
    # ÐÐµ Ð·Ð°Ð±ÑƒÐ´ÑŒÑ‚Ðµ Ð·Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ ÑÐµÑÑÐ¸ÑŽ Ð±Ð¾Ñ‚Ð° Ð¿Ñ€Ð¸ Ð²Ñ‹Ñ…Ð¾Ð´Ðµ
    app.on_shutdown.append(lambda _: bot.close())

    await web.run_app(app, host='localhost', port=8080)

if __name__ == "__main__":
    asyncio.run(main())
```

## âœ¨ ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ

### ÐšÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñ‹ Ð¸ Callback-ÐºÐ½Ð¾Ð¿ÐºÐ¸

`aionvk` Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð»ÐµÐ³ÐºÐ¾ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ inline-ÐºÐ»Ð°Ð²Ð¸Ð°Ñ‚ÑƒÑ€Ñ‹.

```python
from aionvk import KeyboardBuilder, Button, F
from aionvk.types import Message, Callback

router = Router()

@router.message(F.text.lower() == "/start")
async def start_with_keyboard(event: Message, bot: Bot):
    kb = KeyboardBuilder(inline=True)
    kb.add(Button.callback("ÐÐ°Ð¶Ð¼Ð¸ Ð¼ÐµÐ½Ñ!", payload={"cmd": "button_pressed"}))
    
    await bot.send_message(
        peer_id=event.peer_id,
        text="Ð­Ñ‚Ð¾ ÐºÐ½Ð¾Ð¿ÐºÐ°!",
        keyboard=kb.build()
    )

@router.callback(F.payload["cmd"] == "button_pressed")
async def button_handler(event: Callback, bot: Bot):
    # Ð£Ð±Ð¸Ñ€Ð°ÐµÐ¼ "Ñ‡Ð°ÑÐ¸ÐºÐ¸" Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ
    await bot.show_snackbar(event, text="ÐšÐ½Ð¾Ð¿ÐºÐ° Ð±Ñ‹Ð»Ð° Ð½Ð°Ð¶Ð°Ñ‚Ð°!")
```

### ÐœÐ°ÑˆÐ¸Ð½Ð° Ð¡Ð¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¹ (FSM)

Ð¡Ð¾Ð·Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ðµ Ð´Ð¸Ð°Ð»Ð¾Ð³Ð¸ Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ `StatesGroup` Ð¸ `FSMContext`.

```python
from aionvk.bot.fsm import FSMContext, State, StatesGroup

class Registration(StatesGroup):
    waiting_for_name = State()
    waiting_for_age = State()

@router.message(F.text.lower() == "/reg")
async def start_registration(event: Message, state: FSMContext, bot: Bot):
    await state.set_state(Registration.waiting_for_name)
    await bot.send_message(event.peer_id, "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ Ð¸Ð¼Ñ:")

@router.message(state=Registration.waiting_for_name)
async def name_entered(event: Message, state: FSMContext, bot: Bot):
    await state.update_data(name=event.text)
    await state.set_state(Registration.waiting_for_age)
    await bot.send_message(event.peer_id, "ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚:")

@router.message(state=Registration.waiting_for_age)
async def age_entered(event: Message, state: FSMContext, bot: Bot):
    if not event.text.isdigit():
        return await bot.send_message(event.peer_id, "Ð’Ð¾Ð·Ñ€Ð°ÑÑ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ñ‡Ð¸ÑÐ»Ð¾Ð¼!")
        
    user_data = await state.get_data()
    name = user_data.get("name")
    age = event.text
    
    await bot.send_message(event.peer_id, f"Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!\nÐ˜Ð¼Ñ: {name}, Ð’Ð¾Ð·Ñ€Ð°ÑÑ‚: {age}")
    await state.clear()
```

## ðŸ—ºï¸ Ð”Ð°Ð»ÑŒÐ½ÐµÐ¹ÑˆÐ¸Ðµ Ð¿Ð»Ð°Ð½Ñ‹

*   **Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:** ÐŸÐ¾ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ ÐºÐ¾Ð´Ð° ÑŽÐ½Ð¸Ñ‚-Ñ‚ÐµÑÑ‚Ð°Ð¼Ð¸ Ð´Ð»Ñ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡ÐµÐ½Ð¸Ñ ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸.
*   **Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ API:** Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ñ‚Ð¸Ð¿Ð¾Ð² ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹, Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ„Ð¾Ñ‚Ð¾ Ð¸ Ñ‚.Ð´.
*   **Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ:** Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»Ð½Ð¾Ñ†ÐµÐ½Ð½Ð¾Ð¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð²ÑÐµÐ¼ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð°Ð¼.

## ðŸ¤ Ð£Ñ‡Ð°ÑÑ‚Ð¸Ðµ Ð² Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ

ÐŸÑ€Ð¾ÐµÐºÑ‚ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð½Ð° Ñ€Ð°Ð½Ð½ÐµÐ¹ ÑÑ‚Ð°Ð´Ð¸Ð¸. Ð›ÑŽÐ±Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ, ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ… (issues) Ð¸ pull-Ñ€ÐµÐºÐ²ÐµÑÑ‚Ñ‹ Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚ÑÑ!

## ðŸ“œ Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

ÐŸÑ€Ð¾ÐµÐºÑ‚ Ñ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð¿Ð¾Ð´ Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸ÐµÐ¹ MIT.
