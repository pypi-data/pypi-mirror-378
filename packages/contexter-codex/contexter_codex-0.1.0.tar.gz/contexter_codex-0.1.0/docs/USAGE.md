# Usage Guide

## Quick Start

1. **Initialize a repository:**
   ```bash
   contexter init
   ```

2. **Generate context pack:**
   ```bash
   contexter run
   ```

3. **Paste the prompt into Codex and approve writes**

## Commands

### `contexter init`

Initialize a repository with Contexter templates.

**Options:**
- `--force, -f`: Overwrite existing files

**Example:**
```bash
contexter init
contexter init --force  # Overwrite existing files
```

**Creates:**
- `CONTEXTER.yaml` - Configuration file
- `PLAN.md` - Progress tracking
- `.gitignore` - Ignores generated files
- `.github/workflows/contexter.yml` - CI integration

### `contexter run`

Generate context pack for the current repository.

**Options:**
- `--config, -c`: Path to CONTEXTER.yaml
- `--verbose, -v`: Verbose output

**Example:**
```bash
contexter run
contexter run --config custom.yaml --verbose
```

**Generates:**
- `contexter/.manifest.json` - Run metadata
- `contexter/.slices/` - Code slices
- `contexter/.prompt.txt` - Master prompt for Codex
- Updates `PLAN.md` with progress

### `contexter version`

Show version information.

**Example:**
```bash
contexter version
# Output: contexter-codex 0.1.0
```

### `contexter config`

Print effective configuration.

**Options:**
- `--config, -c`: Path to CONTEXTER.yaml

**Example:**
```bash
contexter config
contexter config --config custom.yaml
```

## Configuration

Edit `CONTEXTER.yaml` to customize behavior:

```yaml
policy:
  no_code_edits: true
  abstention: "Correct > Abstain >> Confidently wrong"
  secret_scrub: true

budgets:
  token_limit: 200000
  slice_fraction: 0.5

prompt:
  base: |
    You are Codex in plan mode. Build and maintain a Markdown "context pack" for this repository.
    Never edit source code; write only to contexter/pack/ and PLAN.md.

  addons:
    ast_snippets: |
      Use AST reasoning to select representative functions/classes. Include Lstartâ€“Lend anchors.

    diagrams: |
      Render small ASCII and Mermaid diagrams for dependencies and architecture.

domains:
  core:
    - "src/core/**"
  api:
    - "src/api/**"

dependency_kinds: ["import", "http", "db", "queue"]
languages: ["python", "javascript", "typescript", "cpp", "cuda", "go", "java", "rust"]
```

## Workflow

### Daily Development

1. **Make code changes**
2. **Run Contexter:**
   ```bash
   contexter run
   ```
3. **Paste prompt into Codex**
4. **Approve writes to `contexter/pack/` and `PLAN.md`**

### CI/CD Integration

Add to your GitHub Actions workflow:

```yaml
name: Contexter
on:
  push:
    branches: [ main, master ]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with: { python-version: "3.11" }
      - run: pip install contexter-codex
      - run: contexter run || true
```

## Output Files

### Generated by Contexter

- `contexter/.manifest.json` - Run metadata and file information
- `contexter/.slices/` - Deterministic code slices
- `contexter/.prompt.txt` - Master prompt for Codex
- `contexter/.runlog.jsonl` - Event log

### Generated by Codex

- `contexter/pack/CONTEXTPACK.md` - Single context pack
- `contexter/pack/INDEX.md` - Chaptered index (if domains configured)
- `contexter/pack/domain-*.md` - Domain-specific packs (if domains configured)
- `PLAN.md` - Progress and questions (updated by Codex)

## Advanced Usage

### Domain Chaptering

For large repositories, split into domains:

```yaml
domains:
  core:
    - "src/core/**"
    - "lib/**"
  api:
    - "src/api/**"
    - "routes/**"
  frontend:
    - "src/frontend/**"
    - "public/**"
```

This generates:
- `contexter/pack/INDEX.md` - Global overview
- `contexter/pack/domain-core.md` - Core domain
- `contexter/pack/domain-api.md` - API domain
- `contexter/pack/domain-frontend.md` - Frontend domain

### Custom Prompts

Extend the base prompt with addons:

```yaml
prompt:
  base: |
    You are Codex in plan mode. Build and maintain a Markdown "context pack" for this repository.
    Focus on security vulnerabilities and performance issues.

  addons:
    security: |
      Pay special attention to security patterns and potential vulnerabilities.
      Flag any suspicious code patterns.

    performance: |
      Identify performance bottlenecks and optimization opportunities.
```

## Troubleshooting

### Common Issues

1. **"CONTEXTER.yaml missing"**: Run `contexter init` first
2. **No files discovered**: Check your `.gitignore` and file patterns
3. **Token budget exceeded**: Reduce `slice_fraction` or increase `token_limit`
4. **Clipboard not working**: Copy prompt manually from `contexter/.prompt.txt`

### Debug Mode

Use verbose output to see what's happening:

```bash
contexter run --verbose
```

### Check Configuration

Verify your configuration:

```bash
contexter config
```

## Best Practices

1. **Run regularly**: Update context packs after significant changes
2. **Use domains**: Split large repositories into logical domains
3. **Customize prompts**: Tailor prompts to your specific needs
4. **Version control**: Commit `CONTEXTER.yaml` and `PLAN.md`, ignore generated files
5. **CI integration**: Automate context pack generation in CI/CD
