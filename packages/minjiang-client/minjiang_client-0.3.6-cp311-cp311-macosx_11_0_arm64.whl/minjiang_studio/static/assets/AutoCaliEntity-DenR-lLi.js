import{d as A,E as v,z as L,l as e,a8 as B,f as s,a2 as oe,C as O,b as le,r as _,J as ie,e as N,h as q,i as u,a7 as ue,w as o,a9 as re,aa as z,ab as Y,s as ce,t as _e,a6 as T,aR as de,ac as pe,M as H,ah as fe,aU as me,aY as j,aj as S,o as ve,b5 as ge}from"./index-CeJdvDPL.js";import{d as ye,e as he,f as be}from"./autoCali-CP59JHpU.js";import{_ as ke}from"./LogView.vue_vue_type_script_setup_true_lang-BXQ-RTEM.js";import{u as D}from"./useInterval-C97DlMEs.js";import{u as xe}from"./autoCali-CozseCQZ.js";import{a as P,b as Q}from"./Tabs-JJxe-BPz.js";import"./dayjs.min-cNpdkFss.js";import"./Add-DSasCgEP.js";import"./debounce-CCZK3QBY.js";const F=A({__name:"EntityLog",props:{logs:{}},setup(K){return(r,d)=>e(B)(r.logs)?L("",!0):(s(),v(ke,{key:0,logs:r.logs},null,8,["logs"]))}}),Ce={class:"flex ml-5"},J=120,Ee=A({__name:"EntitiesView",props:{entities:{}},setup(K){const r=xe(),d=oe(),E=O(),{t:R}=le(),p=_(),g=_(),a=_(0),b=_(),w=_(0),l=_(!1),i=_(),G=K,W=ie(()=>{const n=G.entities.length;return Array(n<J?J:n).fill(0).map((t,f)=>G.entities[f])}),X=n=>{n&&(i.value||(i.value=!0,p.value=n,g.value=[],b.value=[],a.value=0,w.value=0,l.value=!0,I.value==0?V():U()))},U=async()=>{var f,k,m,c,y;l.value=!0;const[n,t]=await ye({session_id:+E.query.session_id,entity:p.value});i.value=!1,l.value=!1,!n&&(t==null?void 0:t.status)===0&&(w.value!==((f=t.data)==null?void 0:f.last_record_id)&&((k=t.data)!=null&&k.last_record_id)&&(b.value=[...b.value||[],...(m=t.data)==null?void 0:m.logs]),(c=t.data)!=null&&c.last_record_id&&(w.value=(y=t.data)==null?void 0:y.last_record_id),j(()=>{var h,x;!M.value&&((h=r.sessionInfo)==null?void 0:h.status)===S.RUNNING&&Z(),((x=r.sessionInfo)==null?void 0:x.status)!==S.RUNNING&&(ee(),M.value&&U())}))},{start:Z,stop:ee,runing:M}=D(U,{isManual:!0,duration:3e3}),V=async()=>{var f,k,m,c,y;l.value=!0;const[n,t]=await he({session_id:+E.query.session_id,entity:p.value,last_record_id:a.value});i.value=!1,l.value=!1,!n&&(t==null?void 0:t.status)===0&&(a.value!==((f=t.data)==null?void 0:f.last_record_id)&&((k=t.data)!=null&&k.last_record_id)&&(g.value=[...g.value||[],...(m=t.data)==null?void 0:m.logs]),(c=t.data)!=null&&c.last_record_id&&(a.value=(y=t.data)==null?void 0:y.last_record_id),j(()=>{var h,x;!$.value&&((h=r.sessionInfo)==null?void 0:h.status)===S.RUNNING&&te(),((x=r.sessionInfo)==null?void 0:x.status)!==S.RUNNING&&(ae(),$.value&&V())}))},{start:te,stop:ae,runing:$}=D(V,{isManual:!0,duration:3e3}),I=_(0),se=n=>{I.value=n,p.value&&(n===0?V():U())};return(n,t)=>{const f=pe,k=re,m=ue,c=fe,y=me,h=Q,x=P;return s(),N("div",Ce,[q("div",null,[u(m,{style:{height:"calc(100vh - 310px)"}},{default:o(()=>[u(k,{cols:10,style:{width:"560px"}},{default:o(()=>[(s(!0),N(z,null,Y(e(W),(C,ne)=>(s(),v(f,{key:ne,class:de(["border min-w-14 min-h-14 flex items-center justify-center p-1",[C?"cursor-pointer":""]]),style:T({borderColor:e(d).dividerColor,backgroundColor:e(p)===C&&e(p)?"#00B42A":"inherit",color:e(p)===C?"#fff":"inherit"}),onClick:()=>X(C)},{default:o(()=>[ce(_e(C),1)]),_:2},1032,["style","class","onClick"]))),128))]),_:1})]),_:1})]),u(x,{animated:"",class:"!h-full flex-1 !w-auto ml-8",value:e(I),"onUpdate:value":t[0]||(t[0]=C=>H(I)?I.value=C:null),onUpdateValue:se},{default:o(()=>[u(h,{name:0,key:"0",tab:e(R)("groupDetail.autoCali.caliLog"),class:"!pl-0","display-directive":"show:lazy"},{default:o(()=>[u(m,{style:T({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:e(d).baseColor})},{default:o(()=>[e(i)?(s(),v(c,{key:0})):(s(),N(z,{key:1},[u(F,{logs:e(g)},null,8,["logs"]),e(l)?(s(),v(c,{key:0})):L("",!0),e(B)(e(g))?(s(),v(y,{key:1,class:"mt-32"})):L("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"]),u(h,{name:1,key:"1",tab:e(R)("groupDetail.autoCali.caliRecord"),class:"!pl-0","display-directive":"show:lazy"},{default:o(()=>[u(m,{style:T({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:e(d).baseColor})},{default:o(()=>[e(i)?(s(),v(c,{key:0})):(s(),N(z,{key:1},[u(F,{logs:e(b)},null,8,["logs"]),e(l)?(s(),v(c,{key:0})):L("",!0),e(B)(e(b))?(s(),v(y,{key:1,class:"mt-32"})):L("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"])]),_:1},8,["value"])])}}}),Be=A({__name:"AutoCaliEntity",setup(K){const r=O(),d=_(),E=_(),R=async()=>{const[g,a]=await be({device_group_name:r.query.device_group_name,space_id:+r.query.space_id});!g&&(a==null?void 0:a.status)===0&&(E.value=a.data,d.value=Object.keys(a.data)[0])},p=()=>{};return ve(()=>{R()}),(g,a)=>{const b=Q,w=P;return s(),N("div",null,[u(w,{type:"card",animated:"",size:"small",placement:"left",class:"!h-full !w-auto",value:e(d),"onUpdate:value":a[0]||(a[0]=l=>H(d)?d.value=l:null),onUpdateValue:p,"tab-class":"w-[128px]"},ge({suffix:o(()=>[a[2]||(a[2]=q("div",null,null,-1))]),default:o(()=>[(s(!0),N(z,null,Y(e(E),(l,i)=>(s(),v(b,{name:i,key:i,tab:i},{default:o(()=>[u(Ee,{"active-key":i,entities:l},null,8,["active-key","entities"])]),_:2},1032,["name","tab"]))),128))]),_:2},[e(B)(e(E))?void 0:{name:"prefix",fn:o(()=>[a[1]||(a[1]=q("div",null,null,-1))]),key:"0"}]),1032,["value"])])}}});export{Be as default};
