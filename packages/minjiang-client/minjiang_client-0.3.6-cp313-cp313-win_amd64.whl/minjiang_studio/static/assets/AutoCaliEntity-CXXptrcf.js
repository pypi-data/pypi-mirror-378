import{d as B,E as v,z as R,l as e,a8 as K,f as s,a2 as X,C as M,b as Z,r as o,J as ee,e as b,h as U,i as p,a7 as te,w as l,a9 as ae,aa as z,ab as D,s as se,t as ne,a6 as $,aR as oe,ac as le,M as G,ah as ue,aU as ie,aY as re,aj as j,o as ce,b5 as _e}from"./index-Cb59vHe7.js";import{d as de,e as pe}from"./autoCali-DhUdKHEj.js";import{_ as me}from"./LogView.vue_vue_type_script_setup_true_lang-DA01i2si.js";import{u as fe}from"./useInterval-BnwyQoHU.js";import{u as ve}from"./autoCali-BbnaIrlF.js";import{a as F,b as J}from"./Tabs-QibKeMS0.js";import"./dayjs.min-DIdtLxCY.js";import"./Add-i_ArqUp_.js";import"./debounce-Dsk_V89r.js";const ge=B({__name:"EntityLog",props:{logs:{}},setup(N){return(i,r)=>e(K)(i.logs)?R("",!0):(s(),v(me,{key:0,logs:i.logs},null,8,["logs"]))}}),ye={class:"flex ml-5"},q=120,he=B({__name:"EntitiesView",props:{entities:{}},setup(N){const i=ve(),r=X(),g=M(),{t:V}=Z(),c=o(),_=o(),t=o(0),I=o(),S=o(0),d=o(!1),u=o(),T=N,O=ee(()=>{const n=T.entities.length;return Array(n<q?q:n).fill(0).map((a,f)=>T.entities[f])}),Y=n=>{n&&(u.value||(u.value=!0,c.value=n,_.value=[],I.value=[],t.value=0,S.value=0,d.value=!0,k()))},k=async()=>{var f,C,y,h,E;d.value=!0;const[n,a]=await de({session_id:+g.query.session_id,entity:c.value,last_record_id:t.value});u.value=!1,d.value=!1,!n&&(a==null?void 0:a.status)===0&&(t.value!==((f=a.data)==null?void 0:f.last_record_id)&&((C=a.data)!=null&&C.last_record_id)&&(_.value=[..._.value||[],...(y=a.data)==null?void 0:y.logs]),(h=a.data)!=null&&h.last_record_id&&(t.value=(E=a.data)==null?void 0:E.last_record_id),re(()=>{var w,L;!A.value&&((w=i.sessionInfo)==null?void 0:w.status)===j.RUNNING&&H(),((L=i.sessionInfo)==null?void 0:L.status)!==j.RUNNING&&(P(),A.value&&k())}))},{start:H,stop:P,runing:A}=fe(k,{isManual:!0,duration:3e3}),x=o(0),Q=n=>{x.value=n,c.value&&k()};return(n,a)=>{const f=le,C=ae,y=te,h=ue,E=ie,w=J,L=F;return s(),b("div",ye,[U("div",null,[p(y,{style:{height:"calc(100vh - 310px)"}},{default:l(()=>[p(C,{cols:10,style:{width:"560px"}},{default:l(()=>[(s(!0),b(z,null,D(e(O),(m,W)=>(s(),v(f,{key:W,class:oe(["border min-w-14 min-h-14 flex items-center justify-center p-1",[m?"cursor-pointer":""]]),style:$({borderColor:e(r).dividerColor,backgroundColor:e(c)===m&&e(c)?"#00B42A":"inherit",color:e(c)===m?"#fff":"inherit"}),onClick:()=>Y(m)},{default:l(()=>[se(ne(m),1)]),_:2},1032,["style","class","onClick"]))),128))]),_:1})]),_:1})]),p(L,{animated:"",class:"!h-full flex-1 !w-auto ml-8",value:e(x),"onUpdate:value":a[0]||(a[0]=m=>G(x)?x.value=m:null),onUpdateValue:Q},{default:l(()=>[p(w,{name:0,key:"0",tab:e(V)("groupDetail.autoCali.caliLog"),class:"!pl-0","display-directive":"show:lazy"},{default:l(()=>[p(y,{style:$({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:e(r).baseColor})},{default:l(()=>[e(u)?(s(),v(h,{key:0})):(s(),b(z,{key:1},[p(ge,{logs:e(_)},null,8,["logs"]),e(d)?(s(),v(h,{key:0})):R("",!0),e(K)(e(_))?(s(),v(E,{key:1,class:"mt-32"})):R("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"])]),_:1},8,["value"])])}}}),Ie=B({__name:"AutoCaliEntity",setup(N){const i=M(),r=o(),g=o(),V=async()=>{const[_,t]=await pe({device_group_name:i.query.device_group_name,space_id:+i.query.space_id});!_&&(t==null?void 0:t.status)===0&&(g.value=t.data,r.value=Object.keys(t.data)[0])},c=()=>{};return ce(()=>{V()}),(_,t)=>{const I=J,S=F;return s(),b("div",null,[p(S,{type:"card",animated:"",size:"small",placement:"left",class:"!h-full !w-auto",value:e(r),"onUpdate:value":t[0]||(t[0]=d=>G(r)?r.value=d:null),onUpdateValue:c,"tab-class":"w-[128px]"},_e({suffix:l(()=>[t[2]||(t[2]=U("div",null,null,-1))]),default:l(()=>[(s(!0),b(z,null,D(e(g),(d,u)=>(s(),v(I,{name:u,key:u,tab:u},{default:l(()=>[p(he,{"active-key":u,entities:d},null,8,["active-key","entities"])]),_:2},1032,["name","tab"]))),128))]),_:2},[e(K)(e(g))?void 0:{name:"prefix",fn:l(()=>[t[1]||(t[1]=U("div",null,null,-1))]),key:"0"}]),1032,["value"])])}}});export{Ie as default};
