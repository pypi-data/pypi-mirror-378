import{d as F,e as T,f as p,h as l,Q as $,Y as Z,Z as H,$ as mt,a0 as pt,a1 as gt,b as ft,C as vt,c as yt,a2 as ht,a3 as wt,r as b,R as j,a4 as kt,a5 as Ct,E,w as a,i as e,W as bt,T as Et,B as St,t as c,l as s,N as It,a6 as W,s as m,a7 as Dt,a8 as Tt,a9 as zt,aa as J,ab as Lt,ac as Rt,v as Nt,z as A,ad as qt,ae as Q,af as Mt,ag as Ot,j as Bt,ah as Ut,ai as K,aj as y,V as Vt,M as $t,X as jt,ak as At,K as Ft}from"./index-Cb59vHe7.js";import{a as Pt}from"./task-ZjmdmFQC.js";import{s as xt,g as Gt,a as Ht}from"./exp-CIEzgQjT.js";import{u as Wt}from"./useInterval-BnwyQoHU.js";import{R as Jt,D as Qt,E as Kt}from"./ExpsTpl-CEKDlnwT.js";import{c as Xt}from"./index-BLiPyCyo.js";import{u as Yt}from"./groupDetail-D8vC22Cm.js";import{C as Zt}from"./ChevronBack-Bvozz8GZ.js";import{A as X}from"./Add-CL_Ajwew.js";import"./DynamicForm.vue_vue_type_script_setup_true_lang-BxzB6NGC.js";import"./json-editor-vue-BkNXGhFf.js";import"./debounce-Dsk_V89r.js";import"./InputNumber-Bsb4b-G_.js";import"./Add-i_ArqUp_.js";import"./Switch-QvRZELaX.js";import"./Tabs-QibKeMS0.js";const te={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ee=F({name:"Timer24Regular",render:function(h,g){return p(),T("svg",te,g[0]||(g[0]=[l("g",{fill:"none"},[l("path",{d:"M12 5a8.5 8.5 0 1 1 0 17a8.5 8.5 0 0 1 0-17zm0 1.5a7 7 0 1 0 0 14a7 7 0 0 0 0-14zM12 8a.75.75 0 0 1 .743.648l.007.102v4.5a.75.75 0 0 1-1.493.102l-.007-.102v-4.5A.75.75 0 0 1 12 8zm7.147-2.886l.083.06l1.158.964a.75.75 0 0 1-.877 1.212l-.082-.06l-1.159-.964a.75.75 0 0 1 .877-1.212zM14.25 2.5a.75.75 0 0 1 .102 1.493L14.25 4h-4.5a.75.75 0 0 1-.102-1.493L9.75 2.5h4.5z",fill:"currentColor"})],-1)]))}}),se={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ae=F({name:"Eye",render:function(h,g){return p(),T("svg",se,g[0]||(g[0]=[l("circle",{cx:"256",cy:"256",r:"64",fill:"currentColor"},null,-1),l("path",{d:"M490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96c-42.52 0-84.33 12.15-124.27 36.11c-40.73 24.43-77.63 60.12-109.68 106.07a31.92 31.92 0 0 0-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416c46.71 0 93.81-14.43 136.2-41.72c38.46-24.77 72.72-59.66 99.08-100.92a32.2 32.2 0 0 0-.1-34.76zM256 352a96 96 0 1 1 96-96a96.11 96.11 0 0 1-96 96z",fill:"currentColor"},null,-1)]))}}),Y=(S,h)=>{var z;if(!S.length)return;const g=document.createEvent("MouseEvents");g.initEvent("click",!0,!0);const _=S.map(v=>$(Z,{width:100,src:v}));let i=document.querySelector("#preview-image");if(!i){const v=document.createElement("div");v.id="preview-image",document.body.appendChild(v),i=v}_.length>1?H($(pt,{},[$(mt,{},_)]),i):H(_[0],i),(z=i==null?void 0:i.querySelectorAll(".n-image img")[h])==null||z.dispatchEvent(g)},ne={class:"flex items-center mb-5 text-xl gap-2"},oe={class:"inline-flex gap-2"},ie={class:"flex justify-between"},le={class:"text-lg flex items-center gap-1.5"},re={class:"break-keep font-bold"},ce={class:"flex items-center gap-1.5 opacity-75 text-xs mt-2"},ue={class:"flex gap-2"},_e={key:2,class:"bg-gray-500 w-20 h-20 rounded text-center leading-4 text-xs flex items-center justify-center text-white"},de={class:"flex gap-2 flex-col"},me={class:"flex items-center gap-1"},pe={class:"flex justify-around items-center gap-1"},ge=F({__name:"ExperimentList",setup(S){const h=Yt(),g=gt(),{t:_}=ft(),i=vt(),z=yt(),v=ht(),tt=wt(),L=b(),M=j({}),w=b(!1),et=b(),P=b(),I=j({page:1,per_page:8,total:0}),x=(n,u={})=>{const o=new URLSearchParams({device_group_name:i.query.device_group_name,task_id:i.query.task_id,task_title:i.query.task_title,space_id:i.query.space_id,exp_id:String(n.exp_id),...u});window.open(`/experiment/waveforms?${o.toString()}`,g.expOpenForm)},R=b(),st=async(n,u)=>{var f;const[o,r]=await Ht({exp_ids:n,group_name:i.query.device_group_name,create_timestamps:u,org_id:(f=h.groupInfo)==null?void 0:f.organization_id});if(!o&&(r==null?void 0:r.status)===0)return r.data},O=async n=>{var f;if(!n){if(w.value)return;w.value=!0}const u=i.query.device_group_name;if(!u)return;const[o,r]=await Pt({...((f=et.value)==null?void 0:f.searchParasm)||{},...jt(I),task_id:i.query.task_id,device_group_name:u});if(n||(w.value=!1),!o&&r&&r.status===0){const k=[],D=Xt(r.data.list.map(d=>{if(M[d.exp_id]===void 0)return k.push(d.create_timestamp),d.exp_id;d.img=M[d.exp_id]}));if(D.length>0){const d=JSON.parse(JSON.stringify(r.data.list));st(D.join(","),k.join(",")).then(N=>{N&&(At(N,(q,V)=>{d.some(C=>{if(C.exp_id===+V)return C.img=q,[y.COMPLETE,y.ERROR,y.CANCELED,y.HOST_DOWNLOADED].includes(C.status)&&(M[C.exp_id]=q),!0})}),R.value=d)})}R.value=r.data.list,I.total=r.data.total}},at=()=>{z.push({name:"taskList",query:{device_group_name:i.query.device_group_name}})},nt=async n=>{w.value=!0;const[u,o]=await xt({exp_id:n.exp_id});w.value=!1,!u&&(o==null?void 0:o.status)===0&&tt.success("实验终止成功")},ot=n=>{x(n,{dup:"1"})},it=()=>{var n;(n=P.value)==null||n.open()},lt=()=>{},{start:rt,stop:ct}=Wt(O,{initParams:!0,isManual:!0});kt(()=>{var n;return(n=h.groupInfo)==null?void 0:n.organization_id},n=>{n&&(O(),L.value=setTimeout(()=>{rt()},5e3))},{immediate:!0}),Ct(()=>{ct(),L.value!==null&&clearInterval(L.value),L.value=null});const B=b(),U=j({}),ut=async n=>{if(U[String(n.exp_id)]){Y([U[String(n.exp_id)]],0);return}B.value=n.exp_id;const[u,o]=await Gt({exp_id:n.exp_id,device_group_name:i.query.device_group_name,space_id:i.query.space_id});B.value=void 0,!u&&(o==null?void 0:o.status)===0&&(Y([o.data.big_picture_url],0),U[String(n.exp_id)]=o.data.big_picture_url)};return(n,u)=>{const o=It,r=St,f=qt,k=Mt,D=Bt,d=Ut,N=Z,q=Nt,V=Rt,C=zt,G=Dt,_t=Et,dt=bt;return p(),E(d,{show:s(w)},{default:a(()=>[e(dt,{"has-sider":""},{default:a(()=>[e(_t,{class:"min-h-[500px]"},{default:a(()=>[l("div",ne,[e(r,{onClick:at,quaternary:""},{icon:a(()=>[e(o,{size:"26"},{default:a(()=>[e(s(Zt))]),_:1})]),default:a(()=>[l("span",null,c(s(_)("groupDetail.exps.back")),1)]),_:1}),l("span",{class:"flex-1 text-center",style:W({color:s(v).primaryColor})},c(s(_)("groupDetail.exps.taskTitle",{taskId:s(i).query.task_id,taskTitle:` " ${s(i).query.task_title} " `})),5),l("div",oe,[e(r,{type:"primary",onClick:it},{default:a(()=>[e(o,null,{default:a(()=>[e(s(X))]),_:1}),m("  "+c(s(_)("groupDetail.exps.createFromTemplate")),1)]),_:1}),e(r,{type:"primary",onClick:lt},{default:a(()=>[e(o,null,{default:a(()=>[e(s(X))]),_:1}),m("  "+c(s(_)("groupDetail.exps.createManualTask")),1)]),_:1})])]),e(G,{style:W({maxHeight:s(Tt)(s(R))?"200px":"calc(100vh - 350px)"})},{default:a(()=>[e(C,{cols:"4","x-gap":"20","y-gap":"20",class:"py-1 px-1.5"},{default:a(()=>[(p(!0),T(J,null,Lt(s(R),t=>(p(),E(V,{key:t.exp_id},{default:a(()=>[e(q,{rounded:"",style:{width:"100%"},"content-class":"!mb-0 !p-2",class:"hover:scale-103 hover:transform-gpu"},{default:a(()=>[l("div",ie,[l("div",null,[l("div",le,[l("div",re,c(t.exp_id),1),t!=null&&t.status?(p(),E(f,{key:0,color:{color:s(Q)[t.status].color,textColor:"#fff"},bordered:!1,size:"small"},{default:a(()=>[m(c(s(_)(s(Q)[t.status].text)),1)]),_:2},1032,["color"])):A("",!0),e(f,{size:"small",type:"info"},{default:a(()=>[m(c(t==null?void 0:t.progress),1)]),_:2},1024),t!=null&&t.source?(p(),E(f,{key:1,size:"small",type:"info"},{default:a(()=>[m(c(s(_)("groupDetail.exps.source"))+": "+c(t==null?void 0:t.source),1)]),_:2},1024)):A("",!0)]),l("div",ce,[e(o,{component:s(ee)},null,8,["component"]),e(k,{"line-clamp":1},{default:a(()=>[m(c(t==null?void 0:t.create_time),1)]),_:2},1024),t!=null&&t.user_name?(p(),T(J,{key:0},[e(o,{component:s(Ot),class:"ml-2"},null,8,["component"]),l("div",null,c(t==null?void 0:t.user_name),1)],64)):A("",!0)])])]),e(k,{style:{"max-width":"100%"},class:"text-lg mt-2"},{default:a(()=>[m(c(t==null?void 0:t.title),1)]),_:2},1024),e(D,{class:"!my-3"}),l("div",ue,[l("div",null,[(t==null?void 0:t.img)===void 0?(p(),E(d,{key:0,show:!0,"content-class":"h-20"},{default:a(()=>u[1]||(u[1]=[l("div",{class:"w-20 h-20 rounded"},null,-1)])),_:1})):t!=null&&t.img?(p(),E(d,{key:1,show:s(B)===t.exp_id},{default:a(()=>[e(N,{class:"w-20 h-20 rounded cursor-pointer",src:t==null?void 0:t.img,"preview-disabled":!0,onClick:()=>ut(t)},null,8,["src","onClick"])]),_:2},1032,["show"])):(p(),T("div",_e,c(s(_)("groupDetail.exps.noresult")),1))]),l("div",de,[l("div",me,[e(f,{type:"warning",size:"small"},{default:a(()=>[m(c((t==null?void 0:t.template_name)==="-"?"No Template":t==null?void 0:t.template_name),1)]),_:2},1024)]),e(k,{style:{"max-width":"100%"},class:"opacity-75 text-xs","line-clamp":3},{default:a(()=>[m(c(t==null?void 0:t.description),1)]),_:2},1024)])]),e(D,{class:"!my-3"}),l("div",pe,[e(r,{disabled:![s(y).SERVICE_QUEUING,s(y).RUNNING,s(y).HOST_DOWNLOADED].includes(t.status),type:"info",size:"small",class:"flex-1 !px-0.5",onClick:K(()=>nt(t),["stop"])},{icon:a(()=>[e(s(Jt))]),default:a(()=>[m(" "+c(s(_)("groupDetail.exps.stop")),1)]),_:2},1032,["disabled","onClick"]),e(r,{type:"info",size:"small",class:"flex-1",onClick:K(()=>ot(t),["stop"]),disabled:(t==null?void 0:t.exp_mode)==="batch_circuit"},{icon:a(()=>[e(s(Qt))]),default:a(()=>[m(c(s(_)("expInfo.duplicate"))+" ",1)]),_:2},1032,["onClick","disabled"]),e(r,{type:"info",size:"small",class:"flex-1",disabled:(t==null?void 0:t.exp_mode)==="batch_circuit",onClick:()=>x(t)},{icon:a(()=>[e(s(ae))]),default:a(()=>[m(c(s(_)("groupDetail.exps.preview"))+" ",1)]),_:2},1032,["disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["style"]),e(Vt,{"page-info":s(I),"onUpdate:pageInfo":u[0]||(u[0]=t=>$t(I)?I.value=t:null),"page-sizes":[8,16,24],onUpdateList:O,class:"!pb-0"},null,8,["page-info"]),e(Kt,{ref_key:"expsTplRef",ref:P},null,512)]),_:1})]),_:1})]),_:1},8,["show"])}}}),Ne=Ft(ge,[["__scopeId","data-v-0833f3ce"]]);export{Ne as default};
