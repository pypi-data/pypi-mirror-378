import{C as O}from"./CommingSoon-CiugiW8W.js";import{d as F,e as d,f as n,h,a2 as Y,b as H,C as Q,r as v,J as W,a4 as X,a8 as U,aY as M,aj as Z,aa as z,ab as ee,z as A,a6 as P,l as e,i as f,t as y,w as R,s as I,ae as g,ad as te,j as se,N as oe,E,ah as ae,a7 as ne}from"./index-Cb59vHe7.js";import{b as le,c as re}from"./autoCali-DhUdKHEj.js";import{u as q}from"./useInterval-BnwyQoHU.js";import{_ as ie}from"./LogView.vue_vue_type_script_setup_true_lang-DA01i2si.js";import"./dayjs.min-DIdtLxCY.js";const ce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},de=F({name:"ChevronDown",render:function(B,m){return n(),d("svg",ce,m[0]||(m[0]=[h("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 184l144 144l144-144"},null,-1)]))}}),ue={class:"flex p-5"},_e={class:"pr-10"},fe=["onClick"],me={class:"flex-1 break-all"},pe={key:0,class:"flex items-center justify-between pt-2"},ve={class:"flex flex-1 items-center flex-col"},ge={key:0,class:"flex gap-2 items-center mb-5 text-lg"},Ce=F({__name:"AutoCaliProcess",setup($){const B=Y(),{t:m}=H(),L=Q(),k=v(),r=v(),i=W(()=>{var o;return(o=k.value)==null?void 0:o.find(a=>a.node_id===r.value)}),T=v(!1),c=v(),w=v(!1),p=v(0),N=async()=>{var u,_,x,l,b,s,C;T.value=!0;const o={node_id:r.value,session_id:+L.query.session_id,last_record_id:p.value},[a,t]=await le(o);w.value=!1,!a&&(t==null?void 0:t.status)===0&&(((_=(u=t.data)==null?void 0:u.logs)==null?void 0:_.find(G=>{if(typeof G.msg=="string")return G.msg.includes("COMPLETE")}))?(D(),p.value!==t.data.last_record_id&&t.data.last_record_id&&(c.value=[...c.value||[],...(x=t.data)==null?void 0:x.logs]),t.data.last_record_id&&(p.value=t.data.last_record_id),((l=i.value)==null?void 0:l.status)==="RUNNING"&&V()):(p.value!==t.data.last_record_id&&t.data.last_record_id&&(c.value=[...c.value||[],...(b=t.data)==null?void 0:b.logs]),t.data.last_record_id&&(p.value=t.data.last_record_id),!S.value&&((s=i.value)==null?void 0:s.status)==="RUNNING"&&j(),((C=i.value)==null?void 0:C.status)!=="RUNNING"&&S.value&&(D(),N()))),T.value=!1},V=async()=>{var t,u,_;const[o,a]=await re({session_id:+L.query.session_id});!o&&(a==null?void 0:a.status)===0&&(k.value=a.data,(t=a.data)!=null&&t.find(l=>l.node_id===r.value)||(r.value=(u=a.data[0])==null?void 0:u.node_id,M(()=>{N()})),(_=a.data)!=null&&_.find(l=>l.status=="RUNNING")||J())},{start:j,stop:D,runing:S}=q(N,{isManual:!0,duration:3e3}),{stop:J}=q(V,{duration:10*1e3});X(i,o=>{U(o)||M(()=>{o.status===Z.RUNNING&&!S.value&&j()})});const K=o=>{w.value||(w.value=!0,c.value=void 0,r.value=o,p.value=0,N())};return(o,a)=>{const t=te,u=se,_=oe,x=O,l=ae,b=ne;return n(),d("div",ue,[h("div",_e,[(n(!0),d(z,null,ee(e(k),(s,C)=>(n(),d("div",{key:s.node_id,class:"cursor-pointer"},[h("div",{class:"px-2 pb-2 pt-2.5 w-full max-w-96 border text-center min-w-72 flex items-center",style:P({borderTopLeftRadius:"40px",borderBottomLeftRadius:"40px",borderTopRightRadius:"100px",borderBottomRightRadius:"100px",backgroundColor:e(r)===s.node_id?"rgba(0, 180, 42, 0.15)":"inherit",borderColor:e(r)===s.node_id?"rgb(0, 180, 42)":"#999A9B",color:e(r)===s.node_id?e(B).primaryColor:"inherit"}),onClick:()=>K(s.node_id)},[h("span",me,y(s.node_name),1),f(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full !w-20 !flex !items-center !justify-center",color:{color:e(g)[s.status].color}},{default:R(()=>[I(y(e(m)(e(g)[s.status].text)),1)]),_:2},1032,["color"])],12,fe),C<e(k).length-1?(n(),d("div",pe,[h("div",ve,[f(u,{class:"!h-10 !bg-[#999A9B]",vertical:""}),f(_,{class:"-mt-2",color:"#999A9B",component:e(de)},null,8,["component"])]),f(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full invisible !w-20",color:{color:e(g)[s.status].color}},{default:R(()=>[I(y(e(m)(e(g)[s.status].text)),1)]),_:2},1032,["color"])])):A("",!0)]))),128))]),h("div",{class:"border-l pl-10 flex-1",style:P({borderColor:e(B).dividerColor})},[f(b,{style:{height:"calc(100vh - 335px)"}},{default:R(()=>{var s;return[e(U)(e(i))?A("",!0):(n(),d("div",ge,[I(y((s=e(i))==null?void 0:s.node_name)+" ",1),f(t,{size:"tiny",color:{color:e(g)[e(i).status].color}},{default:R(()=>[I(y(e(m)(e(g)[e(i).status].text)),1)]),_:1},8,["color"])])),Array.isArray(e(c))&&e(c).length===0?(n(),E(x,{key:1,class:"h-full"})):(n(),d(z,{key:2},[e(w)?(n(),E(l,{key:1,show:""})):(n(),d(z,{key:0},[f(ie,{logs:e(c)},null,8,["logs"]),e(T)?(n(),E(l,{key:0,size:"medium"})):A("",!0)],64))],64))]}),_:1})],4)])}}});export{Ce as default};
