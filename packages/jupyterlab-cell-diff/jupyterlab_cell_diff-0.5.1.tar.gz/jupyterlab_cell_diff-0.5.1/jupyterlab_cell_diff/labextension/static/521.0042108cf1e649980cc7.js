"use strict";(self.webpackChunkjupyterlab_cell_diff=self.webpackChunkjupyterlab_cell_diff||[]).push([[521],{521:(e,o,t)=>{t.r(o),t.d(o,{default:()=>g});var i=t(980),r=t(690),l=t(356),c=t(325),n=t(293),s=t(24),a=t(245),d=t(332),h=t(760),f=t(256);class u extends f.Widget{constructor(e){var o,t;super(),this._toggleButton=null,this._cell=e.cell,this._cellFooterTracker=e.cellFooterTracker,this._originalSource=e.originalSource,this._newSource=e.newSource||e.cell.sharedModel.getSource(),this._trans=e.trans,this._showActionButtons=null===(o=e.showActionButtons)||void 0===o||o,this._openDiff=null===(t=e.openDiff)||void 0===t||t}addToFooter(){if(!this._cellFooterTracker||!this._cell)return;const e=this._cell.id,o=this._cellFooterTracker.getFooter(e);o&&(o.removeWidget("jupyterlab-cell-diff"),o.removeToolbarItem("accept-diff"),o.removeToolbarItem("reject-diff"),o.removeToolbarItem("toggle-diff"),o.removeToolbarItem("compare"),o.addWidget(this),this._createButtons(o),this._cellFooterTracker.showFooter(e))}onAcceptClick(){this._cell&&(this._cell.sharedModel.setSource(this._newSource),this._closeDiffView())}onRejectClick(){this._cell&&(this._cell.sharedModel.setSource(this._originalSource),this._closeDiffView())}onToggleClick(){this.isHidden?this.show():this.hide()}_createButtons(e){if(this._toggleButton=new h.ToolbarButton({label:this._trans.__("Compare changes"),enabled:!0,className:"jp-DiffView-toggle",onClick:()=>{this.onToggleClick()}}),e.addToolbarItemOnLeft("toggle-diff",this._toggleButton),this._showActionButtons){const o=new h.ToolbarButton({icon:h.undoIcon,tooltip:this._trans.__("Reject Changes"),enabled:!0,className:"jp-DiffView-reject",onClick:()=>this.onRejectClick()}),t=new h.ToolbarButton({icon:h.checkIcon,tooltip:this._trans.__("Accept Changes"),enabled:!0,className:"jp-DiffView-accept",onClick:()=>this.onAcceptClick()});e.addToolbarItemOnRight("reject-diff",o),e.addToolbarItemOnRight("accept-diff",t)}this._openDiff?this.show():this.hide()}_closeDiffView(){if(this._cellFooterTracker&&this._cell){const e=this._cell.id,o=this._cellFooterTracker.getFooter(e);o&&(o.removeWidget("jupyterlab-cell-diff"),o.removeToolbarItem("accept-diff"),o.removeToolbarItem("reject-diff"),o.removeToolbarItem("toggle-diff"),o.removeToolbarItem("compare")),this._cellFooterTracker.hideFooter(e)}}}class _ extends u{constructor(e){super(e),this._mergeView=null,this._originalCode=e.originalSource,this._modifiedCode=e.newSource,this.addClass("jp-DiffView")}onAfterAttach(e){super.onAfterAttach(e),this._createMergeView()}onBeforeDetach(e){this._destroyMergeView(),super.onBeforeDetach(e)}_createMergeView(){this._mergeView||(this._mergeView=new n.MergeView({a:{doc:this._originalCode,extensions:[d.basicSetup,(0,c.python)(),s.EditorView.editable.of(!1),a.jupyterTheme]},b:{doc:this._modifiedCode,extensions:[d.basicSetup,(0,c.python)(),s.EditorView.editable.of(!1),a.jupyterTheme]},parent:this.node}))}_destroyMergeView(){this._mergeView&&(this._mergeView.destroy(),this._mergeView=null)}}const g=[{id:"jupyterlab-cell-diff:codemirror-plugin",description:"Expose a command to show cell diffs using CodeMirror",requires:[l.ICellFooterTracker,i.INotebookTracker],optional:[r.ITranslator],autoStart:!0,activate:async(e,o,t,i)=>{const{commands:l}=e,c=(null!=i?i:r.nullTranslator).load("jupyterlab-cell-diff");l.addCommand("jupyterlab-cell-diff:show-codemirror",{label:c.__("Show Cell Diff (CodeMirror)"),describedBy:{args:{type:"object",properties:{cellId:{type:"string",description:c.__("ID of the cell to show diff for")},originalSource:{type:"string",description:c.__("Original source code to compare against")},newSource:{type:"string",description:c.__("New source code to compare with")},showActionButtons:{type:"boolean",description:c.__("Whether to show action buttons in the diff widget")},notebookPath:{type:"string",description:c.__("Path to the notebook containing the cell")},openDiff:{type:"boolean",description:c.__("Whether to open the diff widget automatically")}},required:["originalSource","newSource"]}},execute:async(e={})=>{const{cellId:i,originalSource:r,newSource:l,showActionButtons:n=!0,notebookPath:s,openDiff:a=!0}=e;if(!r||!l)return void console.error(c.__("Missing required arguments: originalSource and newSource"));const d=function(e,o){const t=e.find((e=>e.context.path===o));return null!=t?t:e.currentWidget}(t,s);if(!d)return;const h=function(e,o){var t;const i=e.content,r=i.model;let l=null===(t=i.activeCell)||void 0===t?void 0:t.model;if(o&&r)for(let e=0;e<r.cells.length;e++){const t=r.cells.get(e);if(t.id===o){l=t;break}}return null!=l?l:null}(d,i);if(h)if(o.getFooter(h.id))try{const e={cell:h,cellFooterTracker:o,originalSource:r,newSource:l,showActionButtons:n,openDiff:a,trans:c};await async function(e){const{cell:o,cellFooterTracker:t,originalSource:i,newSource:r,trans:l,showActionButtons:c=!0,openDiff:n=!0}=e,s=new _({originalSource:i,newSource:r,cell:o,cellFooterTracker:t,showActionButtons:c,openDiff:n,trans:l});return s.addClass("jupyterlab-cell-diff"),s.addToFooter(),s}(e)}catch(e){console.error(c.__("Failed to create diff widget: %1"),e)}else console.error(c.__("Footer not found for cell %1",h.id));else console.error(c.__("Missing required arguments: cellId (or no active cell found)"))}})}}]}}]);