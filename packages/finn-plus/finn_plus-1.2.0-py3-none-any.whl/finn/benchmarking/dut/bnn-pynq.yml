# This defines the build flow for the bnn-pynq models (cnv & tfc)

# There are multiple variants (w1a1, w1a2, w2a2 for both), so the model and config files need to be set by the run configuration

# The original finn-examples were using FINN-ONNX input format (with 255 division and top-1 already applied) and default steps
# Due to layout annotation issues, we now use QONNX input format and add the pre/post processing layers as part of the flow

steps:
  - finn.builder.custom_step_library.general.add_preproc_divide_by_255 # Custom step
  - finn.builder.custom_step_library.general.add_postproc_top1 # Custom step
  - step_qonnx_to_finn
  - step_tidy_up
  - step_streamline
  - step_convert_to_hw
  - step_create_dataflow_partition
  - step_specialize_layers
  - step_target_fps_parallelization
  - step_apply_folding_config
  - step_minimize_bit_width
  - step_generate_estimate_reports
  - step_set_fifo_depths
  - step_hw_codegen
  - step_hw_ipgen
  - step_create_stitched_ip
  - step_measure_rtlsim_performance
  - step_out_of_context_synthesis
  - step_synthesize_bitfile
  - step_make_driver
  - step_deployment_package

# Workaround for auto FIFO-sizing from finn-examples
default_swg_exceptions: True
