version: "3.9"
services:
  app:
    image: your/app:latest
    ports: ["8000:8000"]
    environment:
      - METRICS_ENABLED=true
      - METRICS_PATH=/metrics

  grafana-agent:
    image: grafana/agent:latest
    command: ["/bin/grafana-agent","--config.file=/etc/agent/agent.yaml","--config.expand-env"]
    environment:
      # Grafana Cloud remote_write
      - GRAFANA_CLOUD_PROM_URL=${GRAFANA_CLOUD_PROM_URL}
      - GRAFANA_CLOUD_PROM_USERNAME=${GRAFANA_CLOUD_PROM_USERNAME}
      - GRAFANA_CLOUD_TOKEN=${GRAFANA_CLOUD_TOKEN}

      # Scrape target hints
      - APP_HOST=${APP_HOST:-app:8000}
      - APP_SCHEME=${APP_SCHEME:-http}
      - METRICS_PATH=${METRICS_PATH:-/metrics}

      # NEW: scrape interval for the agent (defaults to 5s)
      - SCRAPE_INTERVAL=${SCRAPE_INTERVAL:-5s}
    volumes:
      - ./agent.yaml:/etc/agent/agent.yaml:ro
    depends_on: [app]
