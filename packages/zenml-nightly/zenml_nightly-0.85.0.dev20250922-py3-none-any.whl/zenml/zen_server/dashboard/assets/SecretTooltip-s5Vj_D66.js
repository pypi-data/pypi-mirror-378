import{j as e,r as A}from"./@radix-CliVkFaa.js";import{S as Q}from"./eye-_QtMThMm.js";import{S as $}from"./plus-CS72uBlh.js";import{S as z}from"./trash-DEQyKF3P.js";import{q as T,c as L,b as U,h as G}from"./@tanstack-IKWdbe7C.js";import{F as j,H as g,Z as O,x as w,_ as N,G as b,z as c,aP as B,aQ as H,D as M,v as R,I as f,B as h,aT as _,aU as J,aV as W,R as Z,U as X,V as Y,W as I}from"./index-DNZysKmJ.js";import{t as ee}from"./zod-B4miPCh1.js";import{u as se,b as te,C as p}from"./index.esm-BcJnCn7I.js";import{C as ae}from"./CodeSnippet-D9BOt4ga.js";import{S as re}from"./info-CxU5aob4.js";async function ie({params:t}){const i=j(g.secrets.all+"?"+O(t)),s=await w(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&N(),!s.ok){const l=await s.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>"Failed to fetch secrets");throw new b({status:s.status,statusText:s.statusText,message:l})}return s.json()}async function le(t){const i=j(g.secrets.detail(t)),s=await w(i,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.status===404&&N(),!s.ok){const l=await s.json().then(n=>Array.isArray(n.detail)?n.detail[1]:n.detail).catch(()=>`Failed to fetch secret ${t}`);throw new b({status:s.status,statusText:s.statusText,message:l})}return s.json()}const y={all:["secrets"],secretList:t=>T({queryKey:[...y.all,t],queryFn:async()=>ie({params:t})}),secretDetail:t=>T({queryKey:[...y.all,t],queryFn:async()=>le(t)})};async function ne(t,i){const s=j(g.secrets.detail(t)),l=await w(s,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(l.status===404&&N(),!l.ok)throw new b({message:"Error updating secret",status:l.status,statusText:l.statusText});return l.json()}function oe(t){return L({mutationFn:async({id:i,body:s})=>ne(i,s),...t})}const ce=c.object({secretName:c.string().min(1,"Secret Name is required"),keysValues:c.array(c.object({key:c.string().min(1,"Key is required"),value:c.string().min(1,"Value is required"),showPassword:c.boolean().optional()}))});function Ne({secretId:t,isSecretNameEditable:i,dialogTitle:s}){return e.jsxs(B,{className:"mx-auto w-[90vw] max-w-[744px]",children:[e.jsx(H,{children:e.jsx(M,{children:s})}),e.jsx(ue,{secretId:t,isSecretNameEditable:i})]})}function ue({secretId:t,isSecretNameEditable:i}){const{data:s,isLoading:l,isError:n}=U({...y.secretDetail(t)}),{handleSubmit:V,control:u,setValue:m,watch:v,formState:{isValid:C}}=se({resolver:ee(ce),defaultValues:{secretName:"",keysValues:[{key:"",value:""}]}}),{fields:x,append:D,remove:E}=te({control:u,name:"keysValues"});A.useEffect(()=>{var a;s&&(m("secretName",s.name),m("keysValues",Object.entries(((a=s.body)==null?void 0:a.values)||{}).map(([r,o])=>({key:r,value:String(o)}))))},[s,m]);const q=()=>{D({key:"",value:"",showPassword:!1})},{toast:S}=R(),k=G(),{mutate:F}=oe({onError(a){W(a)&&S({status:"error",emphasis:"subtle",description:a.message,rounded:!0})},onSuccess(){S({status:"success",emphasis:"subtle",description:"Secret updated successfull",rounded:!0}),k.invalidateQueries({queryKey:["secrets"]}),k.invalidateQueries({queryKey:["secretDetail",t]})}}),P=a=>{const r={name:a.secretName,values:a.keysValues.reduce((o,d)=>(d.key&&d.value&&(o[d.key]=d.value),o),{})};F({id:t,body:r})},K=a=>{const r=v(`keysValues.${a}.showPassword`);m(`keysValues.${a}.showPassword`,!r)};return l?e.jsx("p",{children:"Loading..."}):n?e.jsx("p",{children:"Error fetching secret details."}):e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"edit-secret-form",className:"gap-5 p-5",onSubmit:V(P),children:e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Secret Name",e.jsx("span",{className:"ml-1 text-theme-text-error",children:"*"})]}),e.jsx(p,{name:"secretName",control:u,render:({field:a})=>e.jsx(f,{...a,className:"mb-3 w-full",required:!0,disabled:!i})})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{children:e.jsx("h1",{className:"font-inter text-lg text-left font-semibold",children:"Keys"})}),e.jsxs("div",{className:"mt-5 flex flex-row",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Key"})}),e.jsx("div",{className:"flex-grow pr-12",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Value"})})]})]}),x.map((a,r)=>e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx(p,{name:`keysValues.${r}.key`,control:u,render:({field:o})=>e.jsx(f,{...o,className:"mb-2 w-full",required:!0,placeholder:"key"})})}),e.jsx("div",{className:"relative flex-grow",children:e.jsxs("div",{className:"relative",children:[e.jsx(p,{name:`keysValues.${r}.value`,control:u,render:({field:o})=>e.jsx(f,{...o,className:"mb-2 w-full pr-10",required:!0,placeholder:"•••••••••",type:v(`keysValues.${r}.showPassword`)?"text":"password"})}),e.jsx("button",{type:"button",onClick:()=>K(r),className:"absolute inset-y-1 right-0 flex items-center pb-1 pr-3",children:e.jsx(Q,{className:"h-4 w-4 flex-shrink-0"})})]})}),e.jsxs("div",{className:"flex items-center",children:[r===x.length-1&&e.jsx(h,{intent:"primary",emphasis:"subtle",onClick:q,className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx($,{className:"flex-shrink-0 fill-primary-600"})}),r!==x.length-1&&e.jsx(h,{intent:"secondary",emphasis:"minimal",onClick:()=>E(r),className:"mb-2 h-7 w-7 items-center justify-center",children:e.jsx(z,{className:"flex-shrink-0 fill-theme-text-secondary"})})]})]},a.id))]})}),e.jsxs(_,{className:"gap-[10px]",children:[e.jsx(J,{asChild:!0,children:e.jsx(h,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(h,{intent:"primary",type:"submit",form:"edit-secret-form",disabled:!C,children:"Save Secret"})]})]})}function be({code:t}){return e.jsx(Z,{children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsx(re,{className:"h-4 w-4 shrink-0 fill-theme-text-tertiary"})}),e.jsxs(I,{className:"z-50 flex max-w-[480px] flex-col gap-2 bg-theme-surface-primary p-5 text-text-sm text-theme-text-primary",children:[e.jsx("p",{className:"text-md text-theme-text-primary",children:"To use your secret in a step, you can use the following code:"}),e.jsx(ae,{highlightCode:!0,wrap:!0,codeClasses:"break-words",code:t}),e.jsx("a",{className:"link w-fit text-primary-400",target:"_blank",href:"https://docs.zenml.io/how-to/interact-with-secrets#accessing-registered-secrets",children:"Learn More"})]})]})})}export{Ne as E,be as S,y as a,ce as s,oe as u};
