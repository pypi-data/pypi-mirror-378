import{r as d,j as e}from"./@radix-CliVkFaa.js";import{u as V,W as ie,L as ce}from"./LeftSideMenu-CG0ulXd3.js";import{$ as le,b4 as de,r as F,a1 as ue,z as y,B as b,c as L,d as N,b5 as me,T as he,b2 as S,x as H,F as O,G as Z,H as Q,b6 as xe,ai as q,aj as I,ak as W,al as Y,am as K,an as M,aS as pe,w as U,I as z,b7 as fe,u as je,v as ye,X as B,a2 as ge,Y as Ce}from"./index-DNZysKmJ.js";import{W as A,H as R,B as E,F as P}from"./Wizard-Cl03M4hQ.js";import{t as $}from"./zod-B4miPCh1.js";import{a as C,C as w,u as J,F as G}from"./index.esm-BcJnCn7I.js";import{S as X}from"./arrow-left-B51hC8ek.js";import{L as ee}from"./@react-router-CYx8DMBZ.js";import{R as ve}from"./resource-tyes-list-BeU1v3LY.js";import{b as k,c as te,h as be}from"./@tanstack-IKWdbe7C.js";import{S as Ne}from"./transform-DLpNFzK1.js";import{g as Se,a as we,D as Te,b as Ve}from"./form-DGmG_AlY.js";import{A as ke}from"./index.es-DJV4DPH8.js";import{S as Me}from"./Lock-CREkCtrv.js";import{S as _}from"./check-circle-DHmddCbA.js";import{d as _e}from"./index-C4h6InI4.js";import{S as Fe}from"./package-DWDk6YQT.js";import{C as Ae,R as Re}from"./resource-type-tooltip-BOFOAHwB.js";import{e as Ee,R as Pe,E as ze}from"./service-connectors-D638TvmQ.js";import"./Tick-B5JTYJPV.js";import"./check-kZOtsBOj.js";import"./@reactflow-CiTrzm79.js";import"./plus-CS72uBlh.js";import"./trash-DEQyKF3P.js";import"./info-CxU5aob4.js";function Be(){const{setBreadcrumbs:t}=le();d.useEffect(()=>{t([...de,{label:"New Connector",href:F.settings.connectors.create}])},[t])}function De(){return Be(),e.jsx(ue,{children:e.jsx("p",{className:"text-display-xs font-semibold",children:"Register a Service Connector"})})}const se=d.createContext(null);function Le({children:t}){const[s,r]=d.useState(""),[n,a]=d.useState(null);return e.jsx(se.Provider,{value:{connectorType:s,setConnectorType:r,createdConnector:n,setCreatedConnector:a},children:t})}function v(){const t=d.useContext(se);if(!t)throw new Error("useRegisterConnectorContext must be used within a RegisterConnectorProvider");return t}const He=y.object({connectorType:y.string().trim().min(1)});function re(){return e.jsx(b,{size:"md",intent:"secondary",asChild:!0,children:e.jsx(ee,{to:F.settings.connectors.overview,children:"Cancel"})})}function ne({isPending:t,...s}){return e.jsxs(b,{type:"submit",size:"md",intent:"primary",...s,children:[!!t&&e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-[20px] w-[20px] animate-spin rounded-rounded border-2 border-theme-text-negative border-b-theme-text-brand"}),e.jsx("span",{children:"Next"}),e.jsx(X,{width:24,height:24,className:"size-5 shrink-0 rotate-180 fill-white"})]})}function Oe(t){const{goToPreviousStep:s}=V();return e.jsxs(b,{onClick:()=>s(),type:"button",size:"md",intent:"primary",emphasis:"subtle",...t,children:[e.jsx(X,{width:24,height:24,className:"size-5 shrink-0 fill-primary-600"}),"Prev"]})}const Ze=t=>d.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.24923 9.14303C6.0632 6.17816 8.7764 4 12 4C15.2236 4 17.9368 6.17816 18.7508 9.14303C21.1861 9.70961 23 11.8925 23 14.5C23 17.5376 20.5376 20 17.5 20H6.5C3.46243 20 1 17.5376 1 14.5C1 11.8925 2.8139 9.70961 5.24923 9.14303ZM12 6C9.51785 6 7.45643 7.80968 7.0665 10.1816C6.99268 10.6306 6.62505 10.9731 6.17196 11.0151C4.39329 11.1798 3 12.6778 3 14.5C3 16.433 4.567 18 6.5 18H17.5C19.433 18 21 16.433 21 14.5C21 12.6778 19.6067 11.1798 17.828 11.0151C17.375 10.9731 17.0073 10.6306 16.9335 10.1816C16.5436 7.80968 14.4822 6 12 6Z"}));function Qe(){return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ze,{className:"size-5 shrink-0 stroke-primary-400"}),e.jsx("p",{className:"font-sebmibold text-text-lg",children:"Select a Service Connector Type"})]}),e.jsx("p",{className:"text-theme-text-secondary",children:"Select the type of service connector you want to create. This will allow you to integrate your cloud resources with ZenML for model deployment and management."})]})}function qe(){const t=k(S.serviceConnectorTypeList()),{control:s}=C();if(t.isError)return e.jsx("p",{children:"Failed to fetch Connector Type List"});if(t.isPending)return e.jsx(Ke,{});const r=t.data;return e.jsx("ul",{className:"space-y-2",children:r.map(n=>e.jsx("li",{children:e.jsx(w,{control:s,name:"connectorType",render:({field:{onChange:a,value:i}})=>e.jsxs("label",{className:L("flex w-full cursor-pointer items-center gap-5 rounded-md border p-5 transition-colors",{"border-primary-400 bg-primary-25 shadow-sm":i===n.connector_type,"border-theme-border-moderate hover:border-theme-border-bold hover:shadow-sm":i!==n.connector_type}),children:[e.jsx("input",{type:"radio",name:"connectorType",onChange:()=>a(n.connector_type),checked:i===n.connector_type,value:n.name,className:"h-3 w-3 border !border-theme-border-bold text-theme-surface-primary focus:ring-2 focus:ring-theme-surface-strong"}),e.jsxs("div",{className:"grid grid-cols-1 items-center gap-5 xl:grid-cols-3",children:[e.jsx(Ie,{connectorType:n}),e.jsx(We,{resourceTypes:n.resource_types}),e.jsx(Ye,{authMethods:n.auth_methods})]})]})})},n.name))})}function Ie({connectorType:t}){return e.jsxs("div",{className:"flex items-center gap-3",children:[t.logo_url&&e.jsx("img",{src:t.logo_url,width:32,height:32,className:"size-6 shrink-0",alt:t.name}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("div",{className:"text-text-lg font-semibold",children:t.name}),t.description&&e.jsx("span",{className:"text-text-sm text-theme-text-secondary",children:me(t.description,70)})]})]})}function We({resourceTypes:t}){return e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:"Resource Types"}),e.jsx(ve,{iconSize:16,size:"xs",resourceTypes:t})]})}function Ye({authMethods:t}){return e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:"Auth Methods"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:t.map(s=>e.jsx(he,{className:"w-fit",color:"blue",emphasis:"subtle",size:"xs",rounded:!1,children:s.name},s.auth_method))})]})}function Ke(){return e.jsx("div",{className:"w-full space-y-2",children:[...Array(4)].map((t,s)=>e.jsx(N,{className:"h-[110px] w-full"},s))})}function Ue(){const{goToNextStep:t}=V(),{setConnectorType:s,connectorType:r}=v(),n=J({resolver:$(He),defaultValues:{connectorType:r}});function a({connectorType:i}){s(i),t()}return e.jsx(A,{children:e.jsx(G,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(a),children:[e.jsx(R,{children:"Select Your Implementation"}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-5",children:[e.jsx(Qe,{}),e.jsx(qe,{})]})}),e.jsxs(P,{children:[e.jsx(re,{}),e.jsx(ne,{disabled:!n.formState.isValid})]})]})})})}async function $e({body:t}){const s=O(Q.serviceConnectors.list),r=await H(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){const n=await r.json().then(a=>Array.isArray(a.detail)?a.detail[1]:a.detail).catch(()=>"Failed to create service connector");throw new Z({status:r.status,statusText:r.statusText,message:n})}return r.json()}function Je(t){return te({...t,mutationFn:async({body:s})=>$e({body:s})})}const Ge=ke(async t=>{try{return!((await xe({name:t})).total>0)}catch(s){return console.error(s),!1}},500),Xe=y.object({description:y.string().trim(),authMethod:y.string().trim().min(1,"Auth method is required"),resourceType:y.string().trim().min(1,"Resource type is required"),isValid:y.boolean().nullable(),skipValidation:y.boolean()});function ae(t){const s=d.useRef(t),r=d.useRef(!0),n=d.useMemo(()=>y.object({name:y.string().trim().min(1,"Name is required").max(32,"Name can be at most 32 characters").regex(/^[a-zA-Z0-9-]+$/,"Name can only contain letters, numbers and dashes").refine(async a=>{if(!a)return!0;if(a!==s.current){s.current=a;const i=await Ge(a);return r.current=i,i}return r.current},{message:"Service connector with this name already exists"})}),[]);return Xe.merge(n)}function et({setConfigDefaultValues:t,setSchema:s}){return e.jsxs("section",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{width:24,height:24,className:"shrink-0 fill-primary-400"}),e.jsx("p",{className:"text-text-lg font-semibold",children:"Select an Authentication Method"})]}),e.jsx("p",{className:"text-theme-text-secondary",children:"Connect ZenML to your cloud provider for seamless integration of cloud services into your ML pipelines."})]}),e.jsx(tt,{setConfigDefaultValues:t,setSchema:s})]})}function tt({setConfigDefaultValues:t,setSchema:s}){const{control:r,resetField:n}=C(),a=ae(""),{connectorType:i}=v(),u=k(S.serviceConnectorTypeDetail(i));if(u.isError)return e.jsxs("p",{children:["Failed to fetch Connector Type ",i]});if(u.isPending)return e.jsx(N,{className:"h-7 w-full"});const f=u.data,l=f.auth_methods.filter(x=>x.auth_method!=="implicit");function c(x){const o=l.find(p=>p.auth_method===x);if(!o)return;const h=o.config_schema,m=Se(h),j=we(h);t(j),s(a.merge(m)),Object.keys(m.shape).forEach(p=>n(p))}return e.jsx(w,{control:r,name:"authMethod",render:({field:x,formState:{errors:o}})=>{var h;return e.jsxs("div",{className:"space-y-1",children:[e.jsxs(q,{onValueChange:m=>{x.onChange(m),c(m)},defaultValue:x.value,children:[e.jsx(I,{"data-error":!!o.authMethod,className:"border border-theme-border-moderate data-[error=true]:border-error-500",children:e.jsx(W,{placeholder:"Select your Authentication Method"})}),e.jsx(Y,{className:"",children:e.jsx(K,{viewportClassName:"max-h-[300px]",children:l.map(m=>e.jsx(M,{value:m.auth_method,children:e.jsxs("div",{className:"flex items-center gap-1",children:[f.logo_url&&e.jsx("img",{alt:m.name,width:24,height:24,className:"shrink-0 object-contain",src:f.logo_url}),m.name]})},m.name))})})]}),o.authMethod&&e.jsx("p",{className:"text-text-xs text-red-500",children:(h=o.authMethod.message)==null?void 0:h.toString()})]})}})}function st(){const{control:t}=C();return e.jsx(w,{name:"skipValidation",control:t,render:({field:s,fieldState:{error:r}})=>{var n;return e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx(pe,{checked:s.value,onCheckedChange:s.onChange}),e.jsx("span",{children:"Register without validation"})]}),r&&e.jsx("p",{className:"text-text-xs text-red-500",children:(n=r.message)==null?void 0:n.toString()})]})}})}function oe({name:t,authMethod:s,connectorType:r,user:n,workspace:a,resourceType:i,description:u,isValid:f,skipValidation:l,...c}){return Object.keys(c).forEach(o=>{(c[o]===""||c[o]===null||c[o]===void 0||Array.isArray(c[o])&&c[o].length===0||typeof c[o]=="object"&&!Array.isArray(c[o])&&Object.keys(c[o]).length===0)&&delete c[o]}),{name:t,auth_method:s,connector_type:r,resource_types:i==="all"?void 0:[i],description:u||void 0,configuration:c,user:n}}async function rt({payload:t}){const s=O(Q.serviceConnectors.verify),r=await H(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){const n=await r.json().then(a=>Array.isArray(a.detail)?a.detail[1]:a.detail).catch(()=>"Failed to verify connector");throw new Z({status:r.status,statusText:r.statusText,message:n})}return r.json()}function nt(t){return te({...t,mutationFn:async({payload:s})=>rt({payload:s})})}function at({mandatoryFields:t}){const s=d.useMemo(()=>[...t,"name","authMethod","resourceType"],[t]),[r,n]=d.useState(!0),[a,i]=d.useState(""),{setValue:u,clearErrors:f,watch:l,resetField:c}=C();d.useEffect(()=>{const o=l((h,{name:m})=>{m&&(m==="isValid"||m==="skipValidation"||h.isValid!==null&&c("isValid"))});return()=>o.unsubscribe()},[l,c]),d.useEffect(()=>{const h=_e(j=>{const T=s.every(p=>{const g=j[p];return g==null||g===""?!1:Array.isArray(g)?g.length>0:typeof g=="object"?Object.keys(g).length>0:!0});n(!T)},300),m=l(j=>{h(j)});return()=>{m.unsubscribe(),h.cancel()}},[l,s]);const x=nt({onMutate:()=>{i("")},onSuccess:o=>{if(o.error){u("isValid",!1),i(o.error);return}u("isValid",!0),f("skipValidation")},onError:()=>{u("isValid",!1)}});return{disabled:r,errorMsg:a,verifyConfig:x}}function ot({user:t,mandatoryFields:s}){const{connectorType:r}=v(),{control:n,getValues:a}=C(),{disabled:i,errorMsg:u,verifyConfig:f}=at({mandatoryFields:s});return e.jsx(w,{control:n,name:"isValid",render:({field:l})=>e.jsxs("div",{className:"space-y-5",children:[e.jsx(b,{disabled:i,size:"md",className:L("flex w-full items-center justify-center gap-3",{"border-success-500 bg-success-500 text-white":l.value===!0}),type:"button",intent:"primary",emphasis:"subtle",onClick:()=>{const c=oe({...a(),connectorType:r,user:t});f.mutate({payload:c})},children:e.jsx(it,{disabled:i,isValid:l.value,isPending:f.isPending})}),u&&e.jsx("p",{className:"max-h-[250px] overflow-auto rounded-md border border-theme-border-moderate bg-theme-surface-secondary p-1 text-left font-mono",children:u})]})})}function it({isValid:t,isPending:s,disabled:r}){return s?e.jsxs(e.Fragment,{children:[e.jsx("div",{role:"alert","aria-busy":"true",className:"full h-5 w-5 animate-spin rounded-rounded border-2 border-neutral-300 border-b-theme-text-brand"}),"Validating Credentials..."]}):t===null?e.jsxs(e.Fragment,{children:[e.jsx(_,{width:24,height:24,"data-disabled":r,className:"fill-primary-600 data-[disabled=true]:fill-primary-100"}),"Validate Credentials"]}):t?e.jsxs(e.Fragment,{children:[e.jsx(_,{width:24,height:24,className:"fill-white"}),"Verified successfully"]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{width:24,height:24,"data-disabled":r,className:"fill-primary-600 data-[disabled=true]:fill-primary-100"}),"Invalid Credentials"]})}function ct({user:t}){return e.jsxs("section",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Me,{width:24,height:24,className:"shrink-0 fill-primary-400"}),e.jsx("p",{className:"text-text-lg font-semibold",children:"Add your configuration"})]}),e.jsx("p",{className:"text-theme-text-secondary",children:"Your credentials are securely stored and encrypted. ZenML uses these credentials to interact with your resources."})]}),e.jsx(lt,{user:t})]})}function lt({user:t}){const{getValues:s}=C(),{connectorType:r}=v(),n=k(S.serviceConnectorTypeDetail(r));if(n.isError)return e.jsxs("p",{children:["Failed to fetch Connector Type ",r]});if(n.isPending)return e.jsx(N,{className:"h-7 w-full"});const i=n.data.auth_methods.find(o=>o.auth_method===s("authMethod"));if(!i)return null;const u=i.config_schema,f=u.properties||{},l=u.required||[],c=u.$defs,x=Object.entries(f).sort(([o],[h])=>l.includes(o)&&!l.includes(h)?-1:!l.includes(o)&&l.includes(h)?1:0);return e.jsxs("div",{className:"space-y-5",children:[x.map(([o,h])=>e.jsx(Te,{definitions:c,isOptional:Ve(o,l),name:o,schema:h},o)),e.jsx(ot,{mandatoryFields:l,user:t}),e.jsx(st,{})]})}const dt=t=>d.createElement("svg",{viewBox:"0 0 24 24",fill:"black",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.7587 2H16.2413C17.0463 1.99999 17.7106 1.99998 18.2518 2.04419C18.8139 2.09012 19.3306 2.18868 19.816 2.43597C20.5686 2.81947 21.1805 3.43139 21.564 4.18404C21.8113 4.66937 21.9099 5.18608 21.9558 5.74817C22 6.28936 22 6.95372 22 7.75868V16.2413C22 17.0463 22 17.7106 21.9558 18.2518C21.9099 18.8139 21.8113 19.3306 21.564 19.816C21.1805 20.5686 20.5686 21.1805 19.816 21.564C19.3306 21.8113 18.8139 21.9099 18.2518 21.9558C17.7106 22 17.0463 22 16.2413 22H7.75868C6.95372 22 6.28936 22 5.74817 21.9558C5.18608 21.9099 4.66937 21.8113 4.18404 21.564C3.43139 21.1805 2.81947 20.5686 2.43597 19.816C2.18868 19.3306 2.09012 18.8139 2.04419 18.2518C1.99998 17.7106 1.99999 17.0463 2 16.2413V7.7587C1.99999 6.95373 1.99998 6.28937 2.04419 5.74817C2.09012 5.18608 2.18868 4.66937 2.43597 4.18404C2.81947 3.43139 3.43139 2.81947 4.18404 2.43597C4.66937 2.18868 5.18608 2.09012 5.74817 2.04419C6.28937 1.99998 6.95373 1.99999 7.7587 2ZM5.91104 4.03755C5.47262 4.07337 5.24842 4.1383 5.09202 4.21799C4.7157 4.40973 4.40973 4.7157 4.21799 5.09202C4.1383 5.24842 4.07337 5.47262 4.03755 5.91104C4.00078 6.36113 4 6.94342 4 7.8V16.2C4 17.0566 4.00078 17.6389 4.03755 18.089C4.07337 18.5274 4.1383 18.7516 4.21799 18.908C4.40973 19.2843 4.7157 19.5903 5.09202 19.782C5.24842 19.8617 5.47262 19.9266 5.91104 19.9624C6.36113 19.9992 6.94342 20 7.8 20H16.2C17.0566 20 17.6389 19.9992 18.089 19.9624C18.5274 19.9266 18.7516 19.8617 18.908 19.782C19.2843 19.5903 19.5903 19.2843 19.782 18.908C19.8617 18.7516 19.9266 18.5274 19.9624 18.089C19.9992 17.6389 20 17.0566 20 16.2V7.8C20 6.94342 19.9992 6.36113 19.9624 5.91104C19.9266 5.47262 19.8617 5.24842 19.782 5.09202C19.5903 4.7157 19.2843 4.40973 18.908 4.21799C18.7516 4.1383 18.5274 4.07337 18.089 4.03755C17.6389 4.00078 17.0566 4 16.2 4H7.8C6.94342 4 6.36113 4.00078 5.91104 4.03755ZM7 7C7 6.44772 7.44772 6 8 6H16C16.5523 6 17 6.44772 17 7C17 7.55229 16.5523 8 16 8H13V17C13 17.5523 12.5523 18 12 18C11.4477 18 11 17.5523 11 17V8H8C7.44772 8 7 7.55229 7 7Z"}));function ut(){var r,n;const{register:t,formState:{errors:s}}=C();return e.jsxs("section",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(dt,{width:24,height:24,className:"shrink-0 fill-primary-400"}),e.jsx("p",{className:"text-text-lg font-semibold",children:"Select a name and description for your Service Connector"})]}),e.jsx("p",{className:"text-theme-text-secondary",children:"You can keep the suggested name or create your own."})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Name",e.jsx("span",{className:"text-theme-text-error","aria-label":"required",children:"*"})]}),e.jsx(z,{"data-error":!!s.name,...t("name"),className:"w-full data-[error=true]:border-error-500",inputSize:"md"}),e.jsx("p",{className:"text-text-xs text-theme-text-secondary",children:"Only letters, numbers and dashes. It should be 32 characters max. You cannot use an existing name."}),s.name&&e.jsx("p",{className:"text-text-xs text-red-500",children:(r=s.name.message)==null?void 0:r.toString()})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("label",{className:"font-inter text-sm text-left font-medium leading-5",children:"Description"}),e.jsx(z,{...t("description"),className:"w-full",inputSize:"md"}),s.description&&e.jsx("p",{className:"text-text-xs text-red-500",children:(n=s.description.message)==null?void 0:n.toString()})]})]})}function mt(){return e.jsxs("section",{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{width:24,height:24,className:"shrink-0 fill-primary-400"}),e.jsx("p",{className:"text-text-lg font-semibold",children:"Select your resource type"})]}),e.jsxs("p",{className:"text-theme-text-secondary",children:["Select resource types your connector will provide access to. Choose a specific type or enable all available resources."," ",e.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:"https://docs.zenml.io/how-to/infrastructure-deployment/auth-management/service-connectors-guide#resource-types",className:"link text-theme-text-brand",children:"Learn More"})]})]}),e.jsx(ht,{})]})}function ht(){const{control:t}=C(),{connectorType:s}=v(),r=k(S.serviceConnectorTypeDetail(s));if(r.isError)return e.jsxs("p",{children:["Failed to fetch Connector Type ",s]});if(r.isPending)return e.jsx(N,{className:"h-7 w-full"});const n=r.data;return e.jsx(w,{control:t,name:"resourceType",render:({field:a})=>e.jsxs(q,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(I,{className:"border border-theme-border-moderate",children:e.jsx(W,{placeholder:"Select your Resource Type"})}),e.jsx(Y,{className:"",children:e.jsxs(K,{viewportClassName:"max-h-[300px]",children:[n.resource_types.map(i=>e.jsx(M,{value:i.resource_type,children:e.jsxs("div",{className:"flex items-center gap-1",children:[i.logo_url&&e.jsx("img",{alt:i.name,width:24,height:24,className:"shrink-0 object-contain",src:i.logo_url}),i.name]})},i.name)),e.jsx(M,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{width:24,height:24,className:"shrink-0 fill-neutral-400 object-contain"}),"All resources types"]})})]})})]})})}function xt(){const t=je(),{connectorType:s,setCreatedConnector:r}=v(),{goToNextStep:n}=V(),a=ae(""),[i,u]=d.useState(a),{toast:f}=ye(),l=S.connectors,c=be(),x=Je({onSuccess:p=>{c.invalidateQueries({queryKey:l}),r(p),n()},onError:p=>{f({status:"error",emphasis:"subtle",icon:e.jsx(U,{width:24,height:24,className:"shrink-0 fill-error-700"}),description:p.message,rounded:!0})}}),[o,h]=d.useState({}),m=i.refine(p=>p.isValid===!0||p.skipValidation===!0,{message:"Either verify the connector or register without validation",path:["skipValidation"]}),j=J({resolver:$(m),shouldUnregister:!0,mode:"onChange",defaultValues:{name:"",description:"",authMethod:"",isValid:null,resourceType:"all",skipValidation:!1,...o}});if(t.isPending)return e.jsx(N,{className:"h-[500px] w-full"});if(t.isError)return e.jsx("p",{children:"Error fetching user"});const T=p=>{const g=oe({...p,connectorType:s,user:t.data.id});x.mutate({body:g})};return e.jsx(A,{children:e.jsxs(G,{...j,children:[e.jsx(R,{children:"Configure your Service Connector"}),e.jsxs("form",{onSubmit:j.handleSubmit(T),children:[e.jsx(E,{children:e.jsxs("div",{className:"divide-y divide-theme-border-moderate *:py-5 first:*:pt-0 last:*:pb-0",children:[e.jsx(ut,{}),e.jsx(mt,{}),e.jsx(et,{setConfigDefaultValues:h,setSchema:u}),e.jsx(ct,{user:t.data.id})]})}),e.jsxs(P,{children:[e.jsx(re,{}),e.jsx(Oe,{}),e.jsx(ne,{isPending:j.formState.isSubmitting||x.isPending,disabled:j.formState.isSubmitting||x.isPending})]})]})]})})}function pt({connectorName:t}){return e.jsxs("div",{className:"flex w-full items-center gap-3 rounded-md border border-success-300 bg-success-50 px-4 py-3 text-text-sm text-success-900",children:[e.jsx(_,{width:24,height:24,className:"shrink-0 fill-success-900"}),e.jsxs("p",{children:["You successfully registered the service connector `",t,"` and can now create new resources"]})]})}function ft(){return d.useMemo(()=>[{id:"name",header:"Service Connector",accessorKey:"name",cell:({row:t})=>{var a;const s=t.original.id,r=t.original.name,n=(a=t.original.body)==null?void 0:a.connector_type;return e.jsxs("div",{className:"group/copybutton flex items-center gap-2",children:[!!n&&typeof n!="string"&&e.jsx(Ae,{connectorType:n}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"block max-w-[200px] truncate text-text-md font-semibold",children:r}),e.jsx(B,{copyText:r})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{children:s.split("-")[0]}),e.jsx(B,{copyText:s})]})]})]})}},{id:"resource_types",header(){return e.jsx("p",{className:"whitespace-nowrap",children:"Resource Types"})},cell:({row:t})=>{const s=Ee(t.original);return e.jsx("div",{className:"flex items-center gap-0.5",children:s.map((r,n)=>e.jsx(Re,{resourceType:r},n))})}},{id:"resource-name",header(){return e.jsx("p",{className:"whitespace-nowrap",children:"Resource Name"})},cell:({row:t})=>e.jsx("div",{className:"max-w-[100px]",children:e.jsx(Pe,{connector:t.original})})},{id:"user",header:"Author",accessorFn:t=>{var s,r;return(r=(s=t.resources)==null?void 0:s.user)==null?void 0:r.name},cell:({row:t})=>{var r,n,a;const s=(r=t.original.resources)==null?void 0:r.user;return s?e.jsx(ge,{className:"max-w-[200px] truncate",avatarUrl:((n=s.body)==null?void 0:n.avatar_url)??void 0,username:s.name,isServiceAccount:!!((a=s.body)!=null&&a.is_service_account)}):null}},{id:"expires",header(){return e.jsx("p",{className:"whitespace-nowrap",children:"Expires in"})},accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.expires_at},cell:({row:t})=>{var r;const s=(r=t.original.body)==null?void 0:r.expires_at;return s?e.jsx(ze,{expires:s}):e.jsx("p",{children:"Never"})}}],[])}function jt({connector:t}){const s=ft();return e.jsx("section",{className:"flex flex-col gap-5",children:e.jsx("div",{className:"flex flex-col items-center gap-5",children:e.jsx("div",{className:"w-full",children:e.jsx(Ce,{columns:s,data:[t]})})})})}function yt(){const{createdConnector:t}=v();return t?e.jsxs(A,{children:[e.jsx(R,{children:"Your Service Connector"}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-5",children:[e.jsx(pt,{connectorName:t.name}),e.jsx(jt,{connector:t})]})}),e.jsx(P,{children:e.jsx(gt,{connectorId:t.id})})]}):e.jsx("p",{children:"No connector created"})}function gt({connectorId:t}){return e.jsx(b,{asChild:!0,type:"submit",size:"md",intent:"primary",children:e.jsx(ee,{to:F.settings.connectors.detail.configuration(t),children:"Finish"})})}function Ct(){return e.jsx(Le,{children:e.jsx(vt,{})})}function vt(){const{currentStep:t}=V();if(t===0)return e.jsx(Ue,{});if(t===1)return e.jsx(xt,{});if(t===2)return e.jsx(yt,{})}const D=["Connector Type","Configuration"];function Yt(){return e.jsxs("div",{children:[e.jsx(De,{}),e.jsx("div",{className:"layout-container flex flex-col gap-5 px-3 py-5 xl:flex-row xl:px-0",children:e.jsxs(ie,{maxSteps:D.length,initialStep:0,children:[e.jsx("div",{className:"shrink-0",children:e.jsx(ce,{entries:D})}),e.jsx("div",{className:"w-full",children:e.jsx(Ct,{})})]})})]})}export{Yt as default};
