import{r as p,j as e}from"./@radix-CliVkFaa.js";import{x as D,F as C,_ as B,G as k,H as E,aP as T,aQ as P,D as F,I as j,aT as O,aU as V,B as u,L as H,M as K,N as U,O as G,aX as X,r as S,X as v,a2 as J,z as f,u as Y,d as N,aN as W,aO as Z,v as ee,aV as se,Y as te,k as re}from"./index-DNZysKmJ.js";import{P as ae}from"./Pagination-CA90k9B9.js";import{S as ne}from"./SearchField-DHUbQmhu.js";import{E as ie,S as le,s as ce,a as oe}from"./SecretTooltip-s5Vj_D66.js";import{c as A,h as _,b as me}from"./@tanstack-IKWdbe7C.js";import{S as de}from"./Lock-CREkCtrv.js";import{D as ue}from"./DisplayDate-B-cVfXAH.js";import{c as xe}from"./code-snippets-Cro2ORGr.js";import{L as w,f as he}from"./@react-router-CYx8DMBZ.js";import{S as L}from"./trash-DEQyKF3P.js";import{D as b}from"./DialogItem-DRRsXCBo.js";import{S as pe}from"./eye-_QtMThMm.js";import{S as q}from"./plus-CS72uBlh.js";import{t as fe}from"./zod-B4miPCh1.js";import{u as je,b as ge,C as g}from"./index.esm-BcJnCn7I.js";import"./@reactflow-CiTrzm79.js";import"./chevron-right-double-CoJGs9PO.js";import"./index-C4h6InI4.js";import"./CodeSnippet-D9BOt4ga.js";import"./info-CxU5aob4.js";async function ye(t){const s=C(E.secrets.detail(t)),r=await D(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(r.status===404&&B(),!r.ok)throw new k({message:"Error deleting secret",status:r.status,statusText:r.statusText});return r.json()}function Ne(t){return A({mutationFn:async s=>ye(s),...t})}function Se({secretId:t}){const s=_(),{mutate:r}=Ne({onSuccess(){s.invalidateQueries({queryKey:["secrets"]})}}),[a,n]=p.useState("");function o(){r(t)}function m(x){n(x.target.value)}return e.jsxs(T,{children:[e.jsx(P,{children:e.jsx(F,{children:"Delete secret"})}),e.jsxs("div",{className:"gap-5 p-5",children:[e.jsx("p",{className:"text-text-md  text-theme-text-secondary",children:"Are you sure you want to delete this secret?"}),e.jsx("p",{className:"text-text-md  text-theme-text-secondary",children:"This action cannot be undone."}),e.jsx("h3",{className:"font-inter text-sm mb-1 mt-4 text-left font-medium leading-5",children:"Please type DELETE to confirm"}),e.jsx(j,{name:"key",onChange:m,className:"w-full",required:!0,value:a})]}),e.jsxs(O,{className:"gap-[10px]",children:[e.jsx(V,{asChild:!0,children:e.jsx(u,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(u,{intent:"danger",type:"submit",form:"edit-secret-form",onClick:o,disabled:a!=="DELETE",children:"Delete"})]})]})}function ve({secretId:t}){const[s,r]=p.useState(!1),[a,n]=p.useState(!1),o=p.useRef(null),m=p.useRef(null);function x(){m.current=o.current}function h(d){if(d===!1){r(!1),setTimeout(()=>{n(d)},200);return}n(d)}return e.jsxs(H,{onOpenChange:r,open:s,children:[e.jsx(K,{ref:o,children:e.jsx(U,{className:"h-4 w-4 fill-theme-text-tertiary"})}),e.jsxs(G,{hidden:a,onCloseAutoFocus:d=>{m.current&&(m.current.focus(),m.current=null,d.preventDefault())},align:"end",sideOffset:7,children:[e.jsx(b,{onSelect:x,onOpenChange:h,triggerChildren:"Edit ",icon:e.jsx(X,{}),children:e.jsx(ie,{secretId:t,isSecretNameEditable:!0,dialogTitle:"Edit secret"})}),e.jsx(b,{onSelect:x,onOpenChange:h,triggerChildren:"Delete ",icon:e.jsx(L,{}),children:e.jsx(Se,{secretId:t})})]})]})}const we=[{id:"secret",header:"Secret",accessorFn:t=>t.name,cell:({getValue:t,row:s})=>{const r=xe(s.original.name);return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"h-5 w-5 flex-shrink-0 fill-primary-400"}),e.jsxs("div",{className:"group/copybutton flex flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(w,{className:"text-text-md font-semibold text-theme-text-primary",to:S.settings.secrets.detail(s.original.id),children:s.original.name}),e.jsx(le,{code:r})]}),e.jsx(v,{copyText:t()})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{to:S.settings.secrets.detail(s.original.id),className:"flex items-center gap-1 text-text-sm text-theme-text-secondary",children:s.original.id.slice(0,8)}),e.jsx(v,{copyText:s.original.id})]})]})]})}},{id:"author",header:"Author",accessorFn:t=>{var s,r;return(r=(s=t.resources)==null?void 0:s.user)==null?void 0:r.name},cell:({row:t})=>{var r,a,n;const s=(r=t.original.resources)==null?void 0:r.user;return s?e.jsx(J,{avatarUrl:((a=s.body)==null?void 0:a.avatar_url)??void 0,username:s.name,isServiceAccount:!!((n=s.body)!=null&&n.is_service_account)}):null}},{id:"created_at",header:"Created At",accessorFn:t=>{var s;return(s=t.body)==null?void 0:s.created},cell:({getValue:t})=>e.jsx("p",{className:"text-text-sm text-theme-text-secondary",children:e.jsx(ue,{dateString:t()})})},{id:"admin_actions",header:"",accessorFn:t=>String(t.id),cell:({row:t,getValue:s})=>{var a,n,o;const r=s();return(o=(n=(a=t.original.resources)==null?void 0:a.user)==null?void 0:n.body)!=null&&o.is_admin?e.jsx(ve,{secretId:r}):e.jsx("p",{className:"text-sm text-theme-text-secondary",children:"No Actions"})}}],y=1,be=f.object({page:f.coerce.number().min(y).optional().default(y).catch(y),name:f.string().optional(),operator:f.enum(["and","or"]).optional()});function De(){const[t]=he(),{page:s,name:r,operator:a}=be.parse({page:t.get("page")||void 0,name:t.get("name")||void 0,operator:t.get("operator")||void 0});return{page:s,name:r,logical_operator:a}}async function Ce(t){const s=C(E.secrets.all),r=await D(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok){const a=await r.json().then(n=>n.detail).catch(()=>"Failed to create Secret");throw new k({status:r.status,statusText:r.statusText,message:a})}return r.json()}function ke(t){return A({mutationFn:async s=>Ce(s),...t})}function Ee(){const[t,s]=p.useState(!1),r=Y();if(r.isPending)return e.jsx(N,{className:"h-7 w-full"});if(r.isError)return e.jsx("div",{children:"Error loading user"});const a=r.data.id;return e.jsxs(W,{open:t,onOpenChange:s,children:[e.jsx(Z,{asChild:!0,children:e.jsxs(u,{size:"md",className:"shrink-0",intent:"primary",children:[e.jsx(q,{className:"h-5 w-5 shrink-0 fill-white"}),e.jsx("span",{children:"New Secret"})]})}),e.jsxs(T,{className:"mx-auto w-[90vw] max-w-[744px]",children:[e.jsx(P,{children:e.jsx(F,{children:"Register New Secret"})}),e.jsx(Te,{userId:a,setOpen:s})]})]})}function Te({userId:t,setOpen:s}){const{handleSubmit:r,control:a,watch:n,setValue:o,formState:{isValid:m},reset:x}=je({resolver:fe(ce),defaultValues:{secretName:"",keysValues:[{key:"",value:""}]}}),{fields:h,append:d,remove:I}=ge({control:a,name:"keysValues"}),{toast:M}=ee(),Q=_(),{mutate:R}=ke({onError(i){se(i)&&M({status:"error",emphasis:"subtle",description:i.message,rounded:!0})},onSuccess(){Q.invalidateQueries({queryKey:["secrets"]}),s(!1),x()}}),z=i=>{R({user:t,name:i.secretName,values:i.keysValues.reduce((l,c)=>(c.key&&c.value&&(l[c.key]=c.value),l),{})})},$=i=>{z(i)};return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"create-secret-form",className:"gap-5 p-5",onSubmit:r($),children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("label",{className:"font-inter text-sm text-left font-medium leading-5",children:["Secret Name",e.jsx("span",{className:"ml-1 text-theme-text-error",children:"*"})]}),e.jsx(g,{name:"secretName",control:a,render:({field:i})=>e.jsx(j,{...i,className:"mb-3 w-full",required:!0})})]}),e.jsxs("div",{className:"mt-10",children:[e.jsx("div",{children:e.jsx("h1",{className:"font-inter text-lg text-left font-semibold",children:"Keys"})}),e.jsxs("div",{className:"mt-5 flex flex-row",children:[e.jsx("div",{className:"flex-grow",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Key"})}),e.jsx("div",{className:"flex-grow pr-12",children:e.jsx("label",{className:"font-inter text-sm text-left font-medium",children:"Value"})})]})]}),h.map((i,l)=>e.jsxs("div",{className:"flex flex-row items-center space-x-1",children:[e.jsx("div",{className:"relative flex-grow",children:e.jsx(g,{name:`keysValues.${l}.key`,control:a,render:({field:c})=>e.jsx(j,{...c,className:"mb-2 w-full",required:!0,placeholder:"key"})})}),e.jsx("div",{className:"relative flex-grow",children:e.jsxs("div",{className:"relative",children:[e.jsx(g,{name:`keysValues.${l}.value`,control:a,render:({field:c})=>e.jsx(j,{...c,className:"mb-2 w-full pr-10",required:!0,placeholder:"•••••••••",type:n(`keysValues.${l}.showPassword`)?"text":"password"})}),e.jsx("button",{type:"button",onClick:()=>{const c=n(`keysValues.${l}.showPassword`);o(`keysValues.${l}.showPassword`,!c)},className:"absolute inset-y-1 right-0 flex items-center pb-1 pr-3",children:e.jsx(pe,{className:"h-4 w-4 flex-shrink-0"})})]})}),e.jsxs("div",{className:"flex items-center",children:[l===h.length-1&&e.jsx(u,{intent:"primary",emphasis:"subtle",onClick:()=>d({key:"",value:""}),className:"mb-2 flex h-7 w-7 items-center justify-center",children:e.jsx(q,{className:"flex-shrink-0 fill-primary-600"})}),l!==h.length-1&&e.jsx(u,{intent:"secondary",emphasis:"minimal",onClick:()=>I(l),className:"mb-2 h-7 w-7 items-center justify-center",children:e.jsx(L,{className:"flex-shrink-0 fill-theme-text-secondary"})})]})]},i.id))]})}),e.jsxs(O,{className:"gap-[10px]",children:[e.jsx(V,{asChild:!0,children:e.jsx(u,{size:"sm",intent:"secondary",children:"Cancel"})}),e.jsx(u,{intent:"primary",disabled:!m,type:"submit",form:"create-secret-form",children:"Register Secret"})]})]})}function Pe(){const t=De(),{data:s}=me({...oe.secretList({...t,sort_by:"desc:created"}),throwOnError:!0});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx(ne,{searchParams:t}),e.jsx(Ee,{})]}),e.jsxs("div",{className:"flex flex-col items-center gap-5",children:[e.jsx("div",{className:"w-full",children:s?e.jsx(te,{columns:we,data:s.items}):e.jsx(N,{className:"h-[250px] w-full"})}),s?s.total_pages>1&&e.jsx(ae,{searchParams:t,paginate:s}):e.jsx(N,{className:"h-[36px] w-[300px]"})]})]})}function We(){return e.jsxs(re,{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-text-xl font-semibold",children:"Secrets"}),e.jsxs("p",{className:"text-text-sm text-theme-text-secondary",children:["Configure and manage your pipeline secrets and configurations."," ",e.jsx("a",{target:"_blank",rel:"noreferrer noopener",href:"https://docs.zenml.io/how-to/interact-with-secrets",className:"link text-primary-400",children:"Learn More"})]})]}),e.jsx(Pe,{})]})}export{We as default};
