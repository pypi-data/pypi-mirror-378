"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[9710],{28027:(e,t,o)=>{o.d(t,{A:()=>c});var i=o(2445),a=o(96540),l=o(50290),n=o(29898);const r=l.I4.div`
  ${({theme:e})=>`\n    font-size: ${e.fontSizeSM}px;\n    position: absolute;\n    background: ${e.colorBgElevated};\n    box-shadow: 0 0 ${e.sizeUnit}px ${e.colorBorderSecondary};\n    margin: ${6*e.sizeUnit}px;\n    padding: ${3*e.sizeUnit}px ${5*e.sizeUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        display: flex;\n        color: ${e.colorText};\n        text-decoration: none;\n        padding: ${e.sizeUnit}px 0;\n\n        & span {\n          margin-right: ${e.sizeUnit}px;\n        }\n      }\n    }\n  `}
`,s=" - ",d=({format:e=null,forceCategorical:t=!1,position:o="tr",categories:a={},toggleCategory:l=()=>{},showSingleCategory:d=()=>{}})=>{const c=o=>{if(!e||t)return o;const i=parseFloat(o);return(0,n.ZV)(e,i)},g=t=>{if(!e)return t;if(t.includes(s)){const e=t.split(s);return c(e[0])+s+c(e[1])}return c(t)};if(0===Object.keys(a).length||null===o)return null;const u=Object.entries(a).map((([e,t])=>{var o;const a={color:`rgba(${null==(o=t.color)?void 0:o.join(", ")})`},n=t.enabled?"◼":"◻";return(0,i.Y)("li",{children:(0,i.FD)("a",{href:"#",role:"button",onClick:()=>l(e),onDoubleClick:()=>d(e),children:[(0,i.Y)("span",{style:a,children:n})," ",g(e)]})},e)})),h="t"===(null==o?void 0:o.charAt(0))?"top":"bottom",p="r"===(null==o?void 0:o.charAt(1))?"right":"left",m={position:"absolute",[h]:"0px",[p]:"10px"};return(0,i.Y)(r,{className:"dupa",style:m,children:(0,i.Y)("ul",{children:u})})},c=(0,a.memo)(d)},43850:(e,t,o)=>{o.d(t,{A:()=>h});var i=o(71677),a=o(48186),l=o(37604),n=o(9226),r=o(23096),s=o(33232),d=o(71704);const c=[0,0,0,255],g={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:c},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class u extends i.A{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&a.A.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const t=this.state.paths.slice(),o=e.dataChanged.map((e=>(0,d.J)({data:t,getIndex:e=>e.__source.index,dataRange:e,replace:this._getPaths(e)})));this.setState({paths:t,pathsDiff:o})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:o,positionFormat:i,_normalize:a}=this.props,n=[],r="XY"===i?2:3,{startRow:d,endRow:c}=e,{iterable:g,objectInfo:u}=(0,l.X)(t,d,c);for(const e of g){u.index++;let t=o(e,u);a&&(t=s.S8(t,r));const{holeIndices:i}=t,l=t.positions||t;if(i)for(let t=0;t<=i.length;t++){const o=l.slice(i[t-1]||0,i[t]||l.length);n.push(this.getSubLayerRow({path:o},e,u.index))}else n.push(this.getSubLayerRow({path:l},e,u.index))}return n}renderLayers(){const{data:e,_dataDiff:t,stroked:o,filled:i,extruded:a,wireframe:l,_normalize:s,_windingOrder:d,elevationScale:g,transitions:u,positionFormat:h}=this.props,{lineWidthUnits:p,lineWidthScale:m,lineWidthMinPixels:f,lineWidthMaxPixels:y,lineJointRounded:b,lineMiterLimit:v,lineDashJustified:_}=this.props,{getFillColor:C,getLineColor:x,getLineWidth:L,getLineDashArray:S,getElevation:k,getPolygon:w,updateTriggers:A,material:D}=this.props,{paths:P,pathsDiff:F}=this.state,M=this.getSubLayerClass("fill",n.A),$=this.getSubLayerClass("stroke",r.A),T=this.shouldRenderSubLayer("fill",P)&&new M({_dataDiff:t,extruded:a,elevationScale:g,filled:i,wireframe:l,_normalize:s,_windingOrder:d,getElevation:k,getFillColor:C,getLineColor:a&&l?x:c,material:D,transitions:u},this.getSubLayerProps({id:"fill",updateTriggers:A&&{getPolygon:A.getPolygon,getElevation:A.getElevation,getFillColor:A.getFillColor,lineColors:a&&l,getLineColor:A.getLineColor}}),{data:e,positionFormat:h,getPolygon:w});return[!a&&T,!a&&o&&this.shouldRenderSubLayer("stroke",P)&&new $({_dataDiff:F&&(()=>F),widthUnits:p,widthScale:m,widthMinPixels:f,widthMaxPixels:y,jointRounded:b,miterLimit:v,dashJustified:_,_pathType:"loop",transitions:u&&{getWidth:u.getLineWidth,getColor:u.getLineColor,getPath:u.getPolygon},getColor:this.getSubLayerAccessor(x),getWidth:this.getSubLayerAccessor(L),getDashArray:this.getSubLayerAccessor(S)},this.getSubLayerProps({id:"stroke",updateTriggers:A&&{getWidth:A.getLineWidth,getColor:A.getLineColor,getDashArray:A.getLineDashArray}}),{data:P,positionFormat:h,getPath:e=>e.path}),a&&T]}}u.layerName="PolygonLayer",u.defaultProps=g;const h=u},69710:(e,t,o)=>{o.r(t),o.d(t,{default:()=>_,getLayer:()=>y,getPoints:()=>b});var i=o(2445),a=o(96540),l=o(74098),n=o(43850),r=o(28027),s=o(52480),d=o(51316),c=o(83860),g=o(98456);function u(e){return"geometry"in e.polygon?e.polygon.geometry.coordinates[0]:e.polygon}var h=o(48238),p=o(35942),m=o(92123),f=o(99894);const y=function({formData:e,payload:t,setTooltip:o,filterState:a,setDataMask:r,onContextMenu:h,onSelect:p,emitCrossFilters:y}){const b=e,v=b.fill_color_picker,_=b.stroke_color_picker,C=b.deafult_breakpoint_color;let x=[...t.data.features];b.js_data_mutator&&(x=(0,g.A)(b.js_data_mutator)(x));const L=b.color_scheme_type,S=b.metric?b.metric.label||b.metric:null,k=e=>e[S];let w;switch(L){case m.wP.fixed_color:w=()=>[v.r,v.g,v.b,255*v.a];break;case m.wP.linear_palette:w=null===b.metric?()=>[v.r,v.g,v.b,255*v.a]:(0,d.L6)(b,x,k);break;case m.wP.color_breakpoints:{const e=b.color_breakpoints;w=t=>{var o;const i=(0,c.JV)(k,t,e),a=void 0!==i&&(null==(o=e[i-1])?void 0:o.color);return a?[a.r,a.g,a.b,255]:C?[C.r,C.g,C.b,255*C.a]:[f.DL.r,f.DL.g,f.DL.b,255*f.DL.a]};break}default:w=()=>[v.r,v.g,v.b,255*v.a]}const A=e=>{var t;const o=w(e)||d.LC,i=u(e),l=JSON.stringify(i).replaceAll(" ","")===(null==a||null==(t=a.value)?void 0:t[0]);return null!=a&&a.value&&!l&&(o[3]/=3),o},D=b.line_column&&b.metric&&["json","geohash","zipcode"].includes(b.line_type)?function(e){return t=>{var o,a,n,r;const d=(null==e||null==(o=e.metric)?void 0:o.label)||(null==e?void 0:e.metric);return(0,i.FD)("div",{className:"deckgl-tooltip",children:[(null==(a=t.object)?void 0:a.name)&&(0,i.Y)(s.A,{label:(0,l.t)("name")+": ",value:`${t.object.name}`}),(null==(n=t.object)?void 0:n[null==e?void 0:e.line_column])&&(0,i.Y)(s.A,{label:`${e.line_column}: `,value:`${t.object[e.line_column]}`}),(null==e?void 0:e.metric)&&(0,i.Y)(s.A,{label:`${d}: `,value:`${null==(r=t.object)?void 0:r[d]}`})]})}}(b):()=>null;return new n.A({id:`path-layer-${b.slice_id}`,data:x,filled:b.filled,stroked:b.stroked,getPolygon:u,getFillColor:A,getLineColor:_?[_.r,_.g,_.b,255*_.a]:void 0,getLineWidth:b.line_width,extruded:b.extruded,lineWidthUnits:b.line_width_unit,getElevation:e=>function(e,t){return 0===t(e)[3]?0:e.elevation}(e,A),elevationScale:b.multiplier,fp64:!0,opacity:b.opacity?b.opacity/100:1,...(0,c.T$)({formData:b,setTooltip:o,setTooltipContent:D,onSelect:p,filterState:a,onContextMenu:h,setDataMask:r,emitCrossFilters:y})})};function b(e){return e.flatMap(u)}const v=e=>{const t=(0,a.useRef)(),o=(0,a.useCallback)((()=>{let t={...e.viewport};if(e.formData.autozoom){const o=e.payload.data.features||[];t=(0,h.A)(t,{width:e.width,height:e.height,points:b(o)})}return t.zoom<0&&(t.zoom=0),t}),[e]),[l,n]=(0,a.useState)(o()),[s,c]=(0,a.useState)(e.payload.form_data);(0,a.useEffect)((()=>{const{payload:t}=e;t.form_data!==s&&(n(o()),c(t.form_data))}),[o,e,s,l]);const g=(0,a.useCallback)((e=>{const{current:o}=t;o&&o.setTooltip(e)}),[]),u=(0,a.useCallback)((()=>{const{formData:t,payload:o,onAddFilter:i,onContextMenu:a,setDataMask:l,filterState:n,emitCrossFilters:r}=e;return void 0===e.payload.data.features?[]:[y({formData:t,payload:o,onAddFilter:i,setTooltip:g,onContextMenu:a,setDataMask:l,filterState:n,emitCrossFilters:r})]}),[g,e]),{payload:f,formData:v,setControlValue:_}=e,C=v.metric?v.metric.label||v.metric:null,x=v.color_scheme_type===m.wP.color_breakpoints?(0,d.BK)(v.color_breakpoints):(0,d.y1)(v,f.data.features,(e=>e[C]));return(0,i.FD)("div",{style:{position:"relative"},children:[(0,i.Y)(p.S,{ref:t,viewport:l,layers:u(),setControlValue:_,mapStyle:v.mapbox_style,mapboxApiAccessToken:f.data.mapboxApiKey,width:e.width,height:e.height}),null!==v.metric&&(0,i.Y)(r.A,{categories:x,position:v.legend_position,format:v.legend_format})]})},_=(0,a.memo)(v)}}]);