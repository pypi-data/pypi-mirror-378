"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5936],{75613:(e,a,t)=>{t.r(a),t.d(a,{default:()=>U});var l=t(2445),n=t(1763),s=t(50290),o=t(74098),d=t(79378),i=t(96540),r=t(58561),c=t.n(r),u=t(61225),h=t(33231),b=t(24777),p=t(86784),m=t(71323),_=t(64457),Y=t(20237),f=t(95018),S=t(94551),g=t(19187),y=t(92998),w=t(89232),v=t(42566),C=t(31296),D=t(85923),A=t(8558),E=t(47305),k=t(51304),x=t(11753),N=t(14180),F=t(79605),I=t(66124),O=t(51692);const z=(0,n.a)(),H=z.get("database.delete.related"),T=z.get("databaseconnection.extraOption"),L=s.I4.div`
  .action-button {
    display: inline-block;
    height: 100%;
    color: ${({theme:e})=>e.colorIcon};
  }
`;function q({value:e}){return e?(0,l.Y)(A.F.CheckOutlined,{iconSize:"s"}):(0,l.Y)(A.F.CloseOutlined,{iconSize:"s"})}const U=(0,_.Ay)((function({addDangerToast:e,addInfoToast:a,addSuccessToast:t,user:n}){const{state:{loading:s,resourceCount:r,resourceCollection:_},hasPerm:z,fetchData:U,refreshData:B}=(0,p.RU)("database",(0,o.t)("database"),e),M=(0,u.d4)((e=>e.user)),R=(0,u.d4)((e=>{var a;return null==(a=e.common)?void 0:a.conf.SYNC_DB_PERMISSIONS_IN_ASYNC_MODE})),$=(0,C.P3)(D.vX.showDatabaseModal),[P,X]=(0,h.sq)({databaseAdded:h.sJ}),[J,Q]=(0,i.useState)($||!1),[V,j]=(0,i.useState)(null),[K,W]=(0,i.useState)(null),[G,Z]=(0,i.useState)(!1),[ee,ae]=(0,i.useState)(!1),[te,le]=(0,i.useState)(!1),[ne,se]=(0,i.useState)(!1),oe=(0,E.N6)(M),de=ne||oe,[ie,re]=(0,i.useState)(!1),{roles:ce}=M,{CSV_EXTENSIONS:ue,COLUMNAR_EXTENSIONS:he,EXCEL_EXTENSIONS:be,ALLOWED_EXTENSIONS:pe}=(0,u.d4)((e=>e.common.conf));function me({database:e=null,modalOpen:a=!1}={}){W(e),Q(a)}(0,i.useEffect)((()=>{null!=P&&P.databaseAdded&&(X({databaseAdded:void 0}),B())}),[P,X,B]);const _e=z("can_write"),Ye=z("can_write"),fe=z("can_write"),Se=z("can_export"),{canUploadCSV:ge,canUploadColumnar:ye,canUploadExcel:we}=(0,m.c8)(ce,ue,he,be,pe),ve=oe&&!ne,Ce=[{label:(0,o.t)("Upload file to database"),childs:[{label:(0,o.t)("Upload CSV"),name:"Upload CSV file",url:"#",onClick:()=>{Z(!0)},perm:ge&&de,disable:ve},{label:(0,o.t)("Upload Excel"),name:"Upload Excel file",url:"#",onClick:()=>{ae(!0)},perm:we&&de,disable:ve},{label:(0,o.t)("Upload Columnar"),name:"Upload columnar file",url:"#",onClick:()=>{le(!0)},perm:ye&&de,disable:ve}]}];(0,i.useEffect)((()=>{d.A.get({endpoint:`/api/v1/database/?q=${c().encode({filters:[{col:"allow_file_upload",opr:"upload_is_enabled",value:!0}]})}`}).then((({json:e})=>{var a;const t=(null==e||null==(a=e.result)?void 0:a.filter((e=>{var a;return null==e||null==(a=e.engine_information)?void 0:a.supports_file_upload})))||[];se((null==t?void 0:t.length)>=1)}))}),[J]);const De={activeChild:"Databases",dropDownLinks:Ce.reduce(((e,a)=>(a.childs=a.childs.filter((e=>e.perm)),a.childs.length?(e.push(a),e):e)),[]),name:(0,o.t)("Databases")};_e&&(De.buttons=[{icon:(0,l.Y)(A.F.PlusOutlined,{iconSize:"m"}),name:(0,o.t)("Database"),buttonStyle:"primary",onClick:()=>{me({modalOpen:!0})}}]);const Ae=(0,i.useMemo)((()=>[{accessor:"database_name",Header:(0,o.t)("Name"),size:"xxl",id:"database_name"},{accessor:"backend",Header:(0,o.t)("Backend"),size:"xl",disableSortBy:!0,id:"backend"},{accessor:"allow_run_async",Header:(0,l.Y)(f.m,{id:"allow-run-async-header-tooltip",title:(0,o.t)("Asynchronous query execution"),placement:"top",children:(0,l.Y)("span",{children:(0,o.t)("AQE")})}),Cell:({row:{original:{allow_run_async:e}}})=>(0,l.Y)(q,{value:e}),size:"sm",id:"allow_run_async"},{accessor:"allow_dml",Header:(0,l.Y)(f.m,{id:"allow-dml-header-tooltip",title:(0,o.t)("Allow data manipulation language"),placement:"top",children:(0,l.Y)("span",{children:(0,o.t)("DML")})}),Cell:({row:{original:{allow_dml:e}}})=>(0,l.Y)(q,{value:e}),size:"sm",id:"allow_dml"},{accessor:"allow_file_upload",Header:(0,o.t)("File upload"),Cell:({row:{original:{allow_file_upload:e}}})=>(0,l.Y)(q,{value:e}),size:"md",id:"allow_file_upload"},{accessor:"expose_in_sqllab",Header:(0,o.t)("Expose in SQL Lab"),Cell:({row:{original:{expose_in_sqllab:e}}})=>(0,l.Y)(q,{value:e}),size:"md",id:"expose_in_sqllab"},{Cell:({row:{original:{changed_by:e,changed_on_delta_humanized:a}}})=>(0,l.Y)(w.UW,{date:a,user:e}),Header:(0,o.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl",id:"changed_on_delta_humanized"},{Cell:({row:{original:n}})=>Ye||fe||Se?(0,l.FD)(L,{className:"actions",children:[fe&&(0,l.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{return e=n,d.A.get({endpoint:`/api/v1/database/${e.id}/related_objects/`}).then((({json:a={}})=>{j({...e,charts:a.charts,dashboards:a.dashboards,sqllab_tab_count:a.sqllab_tab_states.count})})).catch((0,m.JF)((e=>(0,o.t)("An error occurred while fetching database related data: %s",e))));var e},children:(0,l.Y)(f.m,{id:"delete-action-tooltip",title:(0,o.t)("Delete database"),placement:"bottom",children:(0,l.Y)(A.F.DeleteOutlined,{iconSize:"l"})})}),Se&&(0,l.Y)(f.m,{id:"export-action-tooltip",title:(0,o.t)("Export"),placement:"bottom",children:(0,l.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{var e;void 0!==(e=n).id&&((0,k.A)("database",[e.id],(()=>{re(!1)})),re(!0))},children:(0,l.Y)(A.F.UploadOutlined,{iconSize:"l"})})}),Ye&&(0,l.Y)(f.m,{id:"edit-action-tooltip",title:(0,o.t)("Edit"),placement:"bottom",children:(0,l.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>me({database:n,modalOpen:!0}),children:(0,l.Y)(A.F.EditOutlined,{iconSize:"l"})})}),Ye&&(0,l.Y)(f.m,{id:"sync-action-tooltip",title:(0,o.t)("Sync Permissions"),placement:"bottom",children:(0,l.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{return l=n,a(R?(0,o.t)("Validating connectivity for %s",l.database_name):(0,o.t)("Syncing permissions for %s",l.database_name)),void d.A.post({endpoint:`/api/v1/database/${l.id}/sync_permissions/`}).then((({response:e})=>{200===e.status?t((0,o.t)("Permissions successfully synced for %s",l.database_name)):a((0,o.t)("Syncing permissions for %s in the background",l.database_name))}),(0,m.JF)((a=>e((0,o.t)("An error occurred while syncing permissions for %s: %s",l.database_name,a)))));var l},children:(0,l.Y)(A.F.SyncOutlined,{iconSize:"l"})})})]}):null,Header:(0,o.t)("Actions"),id:"actions",hidden:!Ye&&!fe,disableSortBy:!0},{accessor:F.H.ChangedBy,hidden:!0,id:F.H.ChangedBy}]),[fe,Ye,Se]),Ee=(0,i.useMemo)((()=>[{Header:(0,o.t)("Name"),key:"search",id:"database_name",input:"search",operator:w.c0.Contains},{Header:(0,o.t)("Expose in SQL Lab"),key:"expose_in_sql_lab",id:"expose_in_sqllab",input:"select",operator:w.c0.Equals,unfilteredLabel:(0,o.t)("All"),selects:[{label:(0,o.t)("Yes"),value:!0},{label:(0,o.t)("No"),value:!1}]},{Header:(0,l.Y)(f.m,{id:"allow-run-async-filter-header-tooltip",title:(0,o.t)("Asynchronous query execution"),placement:"top",children:(0,l.Y)("span",{children:(0,o.t)("AQE")})}),key:"allow_run_async",id:"allow_run_async",input:"select",operator:w.c0.Equals,unfilteredLabel:(0,o.t)("All"),selects:[{label:(0,o.t)("Yes"),value:!0},{label:(0,o.t)("No"),value:!1}]},{Header:(0,o.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:w.c0.RelationOneMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:(0,m.u1)("database","changed_by",(0,m.JF)((e=>(0,o.t)("An error occurred while fetching dataset datasource values: %s",e))),n),paginate:!0,dropdownStyle:{minWidth:I.f8}}]),[]);return(0,l.FD)(l.FK,{children:[(0,l.Y)(Y.A,{...De}),(0,l.Y)(x.Ay,{databaseId:null==K?void 0:K.id,show:J,onHide:me,onDatabaseAdd:()=>{B()}}),(0,l.Y)(N.A,{addDangerToast:e,addSuccessToast:t,onHide:()=>{Z(!1)},show:G,allowedExtensions:ue,type:"csv"}),(0,l.Y)(N.A,{addDangerToast:e,addSuccessToast:t,onHide:()=>{ae(!1)},show:ee,allowedExtensions:be,type:"excel"}),(0,l.Y)(N.A,{addDangerToast:e,addSuccessToast:t,onHide:()=>{le(!1)},show:te,allowedExtensions:he,type:"columnar"}),V&&(0,l.Y)(S.T,{description:(0,l.FD)(l.FK,{children:[(0,l.FD)("p",{children:[(0,o.t)("The database")," ",(0,l.Y)("b",{children:V.database_name})," ",(0,o.t)("is linked to %s charts that appear on %s dashboards and users have %s SQL Lab tabs using this database open. Are you sure you want to continue? Deleting the database will break those objects.",V.charts.count,V.dashboards.count,V.sqllab_tab_count)]}),V.dashboards.count>=1&&(0,l.FD)(l.FK,{children:[(0,l.Y)("h4",{children:(0,o.t)("Affected Dashboards")}),(0,l.Y)(g.B,{split:!1,size:"small",dataSource:V.dashboards.result.slice(0,10),renderItem:e=>(0,l.Y)(g.B.Item,{compact:!0,children:(0,l.Y)(g.B.Item.Meta,{avatar:(0,l.Y)("span",{children:"•"}),title:(0,l.Y)(v.o.Link,{href:`/superset/dashboard/${e.id}`,target:"_atRiskItem",children:e.title})})},e.id),footer:V.dashboards.result.length>10&&(0,l.Y)("div",{children:(0,o.t)("... and %s others",V.dashboards.result.length-10)})})]}),V.charts.count>=1&&(0,l.FD)(l.FK,{children:[(0,l.Y)("h4",{children:(0,o.t)("Affected Charts")}),(0,l.Y)(g.B,{split:!1,size:"small",dataSource:V.charts.result.slice(0,10),renderItem:e=>(0,l.Y)(g.B.Item,{compact:!0,children:(0,l.Y)(g.B.Item.Meta,{avatar:(0,l.Y)("span",{children:"•"}),title:(0,l.Y)(v.o.Link,{href:`/explore/?slice_id=${e.id}`,target:"_atRiskItem",children:e.slice_name})})},e.id),footer:V.charts.result.length>10&&(0,l.Y)("div",{children:(0,o.t)("... and %s others",V.charts.result.length-10)})})]}),H&&(0,l.Y)(H,{database:V})]}),onConfirm:()=>{V&&function(a){const{id:l,database_name:n}=a;d.A.delete({endpoint:`/api/v1/database/${l}`}).then((()=>{B(),t((0,o.t)("Deleted: %s",n)),null!=T&&T.onDelete&&T.onDelete(a),(0,b.SO)(b.Hh.Database,null),j(null)}),(0,m.JF)((a=>e((0,o.t)("There was an issue deleting %s: %s",n,a)))))}(V)},onHide:()=>j(null),open:!0,title:(0,l.Y)(O.r,{icon:(0,l.Y)(A.F.DeleteOutlined,{}),title:(0,o.t)("Delete Database?")})}),(0,l.Y)(w.uO,{className:"database-list-view",columns:Ae,count:r,data:_,fetchData:U,filters:Ee,initialSort:[{id:"changed_on_delta_humanized",desc:!0}],loading:s,addDangerToast:e,addSuccessToast:t,refreshData:()=>{},pageSize:25}),ie&&(0,l.Y)(y.R,{})]})}))}}]);