"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[2251],{832:(t,e,o)=>{o.d(e,{c:()=>k,y:()=>v});var a=o(2404),r=o.n(a),n=o(2445),l=o(96540),i=o(67413),s=o(35942),c=o(14503),u=o(28027),d=o(50871),p=o(98456),f=o(48238),g=o(92123),m=o(51316),h=o(99894);const{getScale:b}=c;function _(t,e){const o=t.color_picker||{r:0,g:0,b:0,a:1},a=[o.r,o.g,o.b,255*o.a],r=t.color_scheme,n=b(r);let l={};return t.color_scheme_type===g.wP.color_breakpoints?l=(0,m.BK)(t.color_breakpoints):e.forEach((e=>{if(null!=e.cat_color&&!l.hasOwnProperty(e.cat_color)){let r;r=t.dimension?(0,d.hexToRGB)(n(e.cat_color,t.sliceId),255*o.a):a,l[e.cat_color]={color:r,enabled:!0}}})),l}const y=t=>{const e=(0,l.useRef)(null),o=(0,l.useCallback)((()=>{let e={...t.viewport};return t.formData.autozoom&&(e=(0,f.A)(e,{width:t.width,height:t.height,points:t.getPoints(t.payload.data.features||[])})),e.zoom<0&&(e.zoom=0),e}),[t]),[a,r]=(0,l.useState)(_(t.formData,t.payload.data.features||[])),[i,c]=(0,l.useState)(t.payload.form_data),[m,y]=(0,l.useState)(o());(0,l.useEffect)((()=>{if(t.payload.form_data!==i){const e=t.payload.data.features||[],a=_(t.formData,e);y(o()),c(t.payload.form_data),r(a)}}),[o,t,i]);const C=(0,l.useCallback)((t=>{const{current:o}=e;o&&o.setTooltip(t)}),[]),v=(0,l.useCallback)(((t,e,o)=>{const a=e.color_scheme,r=b(a);let n;switch(o){case g.wP.fixed_color:return n=e.color_picker||{r:0,g:0,b:0,a:100},t.map((t=>({...t,color:[n.r,n.g,n.b,255*n.a]})));case g.wP.categorical_palette:return t.map((t=>({...t,color:(0,d.hexToRGB)(r(t.cat_color,e.slice_id))})));case g.wP.color_breakpoints:{const o=e.deafult_breakpoint_color?[e.deafult_breakpoint_color.r,e.deafult_breakpoint_color.g,e.deafult_breakpoint_color.b,255*e.deafult_breakpoint_color.a]:[h.DL.r,h.DL.g,h.DL.b,255*h.DL.a];return t.map((t=>{var a;const r=null==(a=e.color_breakpoints)?void 0:a.find((e=>t.metric>=e.minValue&&t.metric<=e.maxValue));return{...t,color:r?[null==r?void 0:r.color.r,null==r?void 0:r.color.g,null==r?void 0:r.color.b,255*(null==r?void 0:r.color.a)]:o}}))}default:return[]}}),[]),k=(0,l.useCallback)((()=>{const{getLayer:e,getHighlightLayer:o,payload:r,formData:n,onAddFilter:l,onContextMenu:i,filterState:s,setDataMask:c,emitCrossFilters:u}=t;let d=r.data.features?[...r.data.features]:[];const f=n.color_scheme_type;d=v(d,n,f),n.js_data_mutator&&(d=(0,p.A)(n.js_data_mutator)(d)),n.dimension&&(d=d.filter((t=>{var e;return null==(e=a[t.cat_color])?void 0:e.enabled})));const g={formData:n,payload:{...r,data:{...r.data,features:d}},onAddFilter:l,setTooltip:C,datasource:t.datasource,onContextMenu:i,filterState:s,setDataMask:c,emitCrossFilters:u},m=e(g);return u&&null!=s&&s.value&&o?[m,o(g)]:[m]}),[v,a,t,C]),w=(0,l.useCallback)((t=>{const e=a[t],o={...a,[t]:{...e,enabled:!e.enabled}};Object.values(o).every((t=>!t.enabled))&&Object.values(o).forEach((t=>{t.enabled=!0})),r(o)}),[a]),x=(0,l.useCallback)((t=>{const e={...a};Object.values(e).forEach((t=>{t.enabled=!1})),e[t].enabled=!0,r(e)}),[a]);return(0,n.FD)("div",{style:{position:"relative"},children:[(0,n.Y)(s.S,{ref:e,viewport:m,layers:k(),setControlValue:t.setControlValue,mapStyle:t.formData.mapbox_style,mapboxApiAccessToken:t.mapboxApiKey,width:t.width,height:t.height}),(0,n.Y)(u.A,{forceCategorical:!0,categories:a,format:t.formData.legend_format,position:t.formData.legend_position,showSingleCategory:x,toggleCategory:w})]})},C=(0,l.memo)(y);function v(t,e,o){return(0,l.memo)((a=>{const c=(0,l.useRef)(),d=(0,i.Z)(a.formData),p=(0,i.Z)(a.filterState),g=(0,i.Z)(a.payload),[h,b]=(0,l.useState)((0,m.BK)(a.formData.color_breakpoints)||[]),[_,y]=(0,l.useState)((()=>{const{width:t,height:o,formData:r}=a;return r.autozoom?(0,f.A)(a.viewport,{width:t,height:o,points:e(a.payload.data.features)}):a.viewport})()),C=(0,l.useCallback)((t=>{const{current:e}=c;e&&(null==e||e.setTooltip(t))}),[]),v=(0,l.useCallback)((e=>{const{formData:a,payload:r,onAddFilter:n,filterState:l,setDataMask:i,onContextMenu:s,emitCrossFilters:c}=e,u={formData:a,payload:r,onAddFilter:n,setTooltip:C,setDataMask:i,onContextMenu:s,filterState:l,emitCrossFilters:c},d=t(u);return c&&null!=l&&l.value&&o?[d,o(u)]:[d]}),[C]);(0,l.useEffect)((()=>{const t=(0,m.BK)(a.formData.color_breakpoints);b(t)}),[a]);const[k,w]=(0,l.useState)(v(a));(0,l.useEffect)((()=>{const t={...d,...p,viewport:null},e={...a.formData,...a.filterState,viewport:null};r()(t,e)&&g===a.payload||w(v(a))}),[v,d,p,g,a]);const{formData:x,payload:D,setControlValue:S,height:A,width:F}=a;return(0,n.FD)("div",{style:{position:"relative"},children:[(0,n.Y)(s.S,{ref:c,mapboxApiAccessToken:D.data.mapboxApiKey,viewport:_,layers:k,mapStyle:x.mapbox_style,setControlValue:S,width:F,height:A,onViewportChange:y}),(0,n.Y)(u.A,{forceCategorical:!0,categories:h,format:a.formData.legend_format,position:a.formData.legend_position})]})}))}function k(t,e,o){return function(a){const{datasource:r,formData:l,height:i,payload:s,setControlValue:c,viewport:u,width:d,setDataMask:p,filterState:f,onContextMenu:g,emitCrossFilters:m}=a;return(0,n.Y)(C,{datasource:r,formData:l,mapboxApiKey:s.data.mapboxApiKey,setControlValue:c,viewport:u,getLayer:t,getHighlightLayer:o,payload:s,getPoints:e,width:d,height:i,setDataMask:p,onContextMenu:g,filterState:f,emitCrossFilters:m})}}},28027:(t,e,o)=>{o.d(e,{A:()=>u});var a=o(2445),r=o(96540),n=o(50290),l=o(29898);const i=n.I4.div`
  ${({theme:t})=>`\n    font-size: ${t.fontSizeSM}px;\n    position: absolute;\n    background: ${t.colorBgElevated};\n    box-shadow: 0 0 ${t.sizeUnit}px ${t.colorBorderSecondary};\n    margin: ${6*t.sizeUnit}px;\n    padding: ${3*t.sizeUnit}px ${5*t.sizeUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        display: flex;\n        color: ${t.colorText};\n        text-decoration: none;\n        padding: ${t.sizeUnit}px 0;\n\n        & span {\n          margin-right: ${t.sizeUnit}px;\n        }\n      }\n    }\n  `}
`,s=" - ",c=({format:t=null,forceCategorical:e=!1,position:o="tr",categories:r={},toggleCategory:n=()=>{},showSingleCategory:c=()=>{}})=>{const u=o=>{if(!t||e)return o;const a=parseFloat(o);return(0,l.ZV)(t,a)},d=e=>{if(!t)return e;if(e.includes(s)){const t=e.split(s);return u(t[0])+s+u(t[1])}return u(e)};if(0===Object.keys(r).length||null===o)return null;const p=Object.entries(r).map((([t,e])=>{var o;const r={color:`rgba(${null==(o=e.color)?void 0:o.join(", ")})`},l=e.enabled?"◼":"◻";return(0,a.Y)("li",{children:(0,a.FD)("a",{href:"#",role:"button",onClick:()=>n(t),onDoubleClick:()=>c(t),children:[(0,a.Y)("span",{style:r,children:l})," ",d(t)]})},t)})),f="t"===(null==o?void 0:o.charAt(0))?"top":"bottom",g="r"===(null==o?void 0:o.charAt(1))?"right":"left",m={position:"absolute",[f]:"0px",[g]:"10px"};return(0,a.Y)(i,{className:"dupa",style:m,children:(0,a.Y)("ul",{children:p})})},u=(0,r.memo)(c)},49529:(t,e,o)=>{o.r(e),o.d(e,{default:()=>b,getHighlightLayer:()=>h,getLayer:()=>g,getPoints:()=>m});var a=o(2445),r=o(93237),n=o(74098),l=o(96469),i=o(92123),s=o(83860),c=o(98456),u=o(832),d=o(52480),p=o(51316);function f(t){return(0,a.Y)("div",{className:"deckgl-tooltip",children:(0,a.Y)(d.A,{label:(0,n.t)("Centroid (Longitude and Latitude): "),value:`(${null==t?void 0:t.coordinate[0]}, ${null==t?void 0:t.coordinate[1]})`})})}const g=({formData:t,onContextMenu:e,filterState:o,setDataMask:a,setTooltip:n,payload:i,emitCrossFilters:u})=>{var d,p;const g=t,{intensity:m=1,radius_pixels:h=30,aggregation:b="SUM",js_data_mutator:_,linear_color_scheme:y}=g;let C=i.data.features;_&&(C=(0,c.A)(g.js_data_mutator)(C));const v=null==(d=(0,l.A)())||null==(d=d.get(y))?void 0:d.createLinearScale([0,6]),k=g.color_scheme_type,w=null==(p=(0,s.XC)({defaultBreakpointsColor:g.deafult_breakpoint_color,colorBreakpoints:g.color_breakpoints,fixedColor:g.color_picker,colorSchemeType:k,colorScale:v}))?void 0:p.reverse();return new r.A({id:`heatmap-layer-${g.slice_id}`,data:C,intensity:m,radiusPixels:h,colorRange:w,aggregation:b.toUpperCase(),getPosition:t=>t.position,getWeight:t=>t.weight?t.weight:1,...(0,s.T$)({formData:g,setTooltip:n,setTooltipContent:f,setDataMask:a,filterState:o,onContextMenu:e,emitCrossFilters:u})})};function m(t){return t.map((t=>t.position))}const h=({formData:t,filterState:e,payload:o})=>{const a=t,{intensity:n=1,radius_pixels:l=30,aggregation:s="SUM",js_data_mutator:u}=a;let d=o.data.features;u&&(d=(0,c.A)(a.js_data_mutator)(d));const f=d.filter((t=>(0,i.st)(t.position,null==e?void 0:e.value)));return new r.A({id:`heatmap-layer-${a.slice_id}`,data:f,intensity:n,radiusPixels:l,colorRange:[[p.Fe[0],p.Fe[1],p.Fe[2],55],p.Fe],aggregation:s.toUpperCase(),getPosition:t=>t.position,getWeight:t=>t.weight?t.weight:1})},b=(0,u.y)(g,m,h)},78579:(t,e,o)=>{o.d(e,{Pu:()=>l,QO:()=>a,Y5:()=>r,cp:()=>i});const a=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function r(t,e=!1,o=Float32Array){let a;if(Number.isFinite(t[0]))a=new o(t);else{a=new o(4*t.length);let e=0;for(let o=0;o<t.length;o++){const r=t[o];a[e++]=r[0],a[e++]=r[1],a[e++]=r[2],a[e++]=Number.isFinite(r[3])?r[3]:255}}if(e)for(let t=0;t<a.length;t++)a[t]/=255;return a}const n={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function l(t,e){t.setSampler({minFilter:n[e],magFilter:n[e]})}function i(t,e,o="linear"){const a=r(e,!1,Uint8Array);return t.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:n[o],magFilter:n[o],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:a,width:a.length/4,height:1})}}}]);