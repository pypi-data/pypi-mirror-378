"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[1085],{21085:(t,e,o)=>{o.r(e),o.d(e,{default:()=>Q});var r=o(2445),l=o(96540),a=o(55140),s=o(65765),n=o(50290),i=o(74098),c=o(40984),u=o(29898),h=o(65432),p=o(91920),d=o(95021),g=o(99106),m=o(5556),b=o.n(m);const f=function(t){const e={digitsAfterDecimal:2,scaler:1,thousandsSep:",",decimalSep:".",prefix:"",suffix:"",...t};return function(t){if(Number.isNaN(t)||!Number.isFinite(t))return"";const o=function(t,e,o){const r=String(t).split(".");let l=r[0];const a=r.length>1?o+r[1]:"",s=/(\d+)(\d{3})/;for(;s.test(l);)l=l.replace(s,`$1${e}$2`);return l+a}((e.scaler*t).toFixed(e.digitsAfterDecimal),e.thousandsSep,e.decimalSep);return`${e.prefix}${o}${e.suffix}`}},v=/(\d+)|(\D+)/g,w=/\d/,y=/^0/,S=(t,e)=>{if(null!==e&&null===t)return-1;if(null!==t&&null===e)return 1;if("number"==typeof t&&Number.isNaN(t))return-1;if("number"==typeof e&&Number.isNaN(e))return 1;const o=Number(t),r=Number(e);if(o<r)return-1;if(o>r)return 1;if("number"==typeof t&&"number"!=typeof e)return-1;if("number"==typeof e&&"number"!=typeof t)return 1;if("number"==typeof t&&"number"==typeof e)return 0;if(Number.isNaN(r)&&!Number.isNaN(o))return-1;if(Number.isNaN(o)&&!Number.isNaN(r))return 1;let l=String(t),a=String(e);if(l===a)return 0;if(!w.test(l)||!w.test(a))return l>a?1:-1;for(l=l.match(v),a=a.match(v);l.length&&a.length;){const t=l.shift(),e=a.shift();if(t!==e)return w.test(t)&&w.test(e)?t.replace(y,".0")-e.replace(y,".0"):t>e?1:-1}return l.length-a.length},C=function(t){const e={},o={};return t.forEach(((t,r)=>{e[t]=r,"string"==typeof t&&(o[t.toLowerCase()]=r)})),function(t,r){return t in e&&r in e?e[t]-e[r]:t in e?-1:r in e?1:t in o&&r in o?o[t]-o[r]:t in o?-1:r in o?1:S(t,r)}},T=function(t,e){if(t)if("function"==typeof t){const o=t(e);if("function"==typeof o)return o}else if(e in t)return t[e];return S},k=f(),O=f({digitsAfterDecimal:0}),N=f({digitsAfterDecimal:1,scaler:100,suffix:"%"}),x=t=>e=>"string"==typeof e?e:t(e),A={count:(t=O)=>()=>function(){return{count:0,push(){this.count+=1},value(){return this.count},format:t}},uniques:(t,e=O)=>function([o]){return function(){return{uniq:[],push(t){Array.from(this.uniq).includes(t[o])||this.uniq.push(t[o])},value(){return t(this.uniq)},format:x(e),numInputs:void 0!==o?0:1}}},sum:(t=k)=>function([e]){return function(){return{sum:0,push(t){Number.isNaN(Number(t[e]))?this.sum=t[e]:this.sum+=parseFloat(t[e])},value(){return this.sum},format:x(t),numInputs:void 0!==e?0:1}}},extremes:(t,e=k)=>function([o]){return function(r){return{val:null,sorter:T(void 0!==r?r.sorters:null,o),push(e){const r=e[o];if(["min","max"].includes(t)){const e=Number(r);Number.isNaN(e)?this.val=!this.val||"min"===t&&r<this.val||"max"===t&&r>this.val?r:this.val:this.val=Math[t](e,null!==this.val?this.val:e)}else("first"===t&&this.sorter(r,null!==this.val?this.val:r)<=0||"last"===t&&this.sorter(r,null!==this.val?this.val:r)>=0)&&(this.val=r)},value(){return this.val},format:t=>"number"==typeof t?e(t):t,numInputs:void 0!==o?0:1}}},quantile:(t,e=k)=>function([o]){return function(){return{vals:[],strMap:{},push(t){const e=t[o],r=Number(e);Number.isNaN(r)?this.strMap[e]=(this.strMap[e]||0)+1:this.vals.push(r)},value(){if(0===this.vals.length&&0===Object.keys(this.strMap).length)return null;if(Object.keys(this.strMap).length){const t=Object.values(this.strMap).sort(((t,e)=>t-e)),e=Math.floor(t.length/2),o=Object.keys(this.strMap);return o.length%2!=0?o[e]:(o[e-1]+o[e])/2}this.vals.sort(((t,e)=>t-e));const e=(this.vals.length-1)*t;return(this.vals[Math.floor(e)]+this.vals[Math.ceil(e)])/2},format:x(e),numInputs:void 0!==o?0:1}}},runningStat:(t="mean",e=1,o=k)=>function([r]){return function(){return{n:0,m:0,s:0,strValue:null,push(t){const e=Number(t[r]);if(Number.isNaN(e))return void(this.strValue="string"==typeof t[r]?t[r]:this.strValue);this.n+=1,1===this.n&&(this.m=e);const o=this.m+(e-this.m)/this.n;this.s+=(e-this.m)*(e-o),this.m=o},value(){if(this.strValue)return this.strValue;if("mean"===t)return 0===this.n?NaN:this.m;if(this.n<=e)return 0;switch(t){case"var":return this.s/(this.n-e);case"stdev":return Math.sqrt(this.s/(this.n-e));default:throw new Error("unknown mode for runningStat")}},format:x(o),numInputs:void 0!==r?0:1}}},sumOverSum:(t=k)=>function([e,o]){return function(){return{sumNum:0,sumDenom:0,push(t){Number.isNaN(Number(t[e]))||(this.sumNum+=parseFloat(t[e])),Number.isNaN(Number(t[o]))||(this.sumDenom+=parseFloat(t[o]))},value(){return this.sumNum/this.sumDenom},format:t,numInputs:void 0!==e&&void 0!==o?0:2}}},fractionOf:(t,e="total",o=N)=>(...r)=>function(l,a,s){return{selector:{total:[[],[]],row:[a,[]],col:[[],s]}[e],inner:t(...Array.from(r||[]))(l,a,s),push(t){this.inner.push(t)},format:x(o),value(){const t=l.getAggregator(...Array.from(this.selector||[])).inner.value();return"string"==typeof t?t:this.inner.value()/t},numInputs:t(...Array.from(r||[]))().numInputs}}},M={countUnique:t=>A.uniques((t=>t.length),t),listUnique:(t,e)=>A.uniques((e=>e.join(t)),e||(t=>t)),max:t=>A.extremes("max",t),min:t=>A.extremes("min",t),first:t=>A.extremes("first",t),last:t=>A.extremes("last",t),median:t=>A.quantile(.5,t),average:t=>A.runningStat("mean",1,t),var:(t,e)=>A.runningStat("var",t,e),stdev:(t,e)=>A.runningStat("stdev",t,e)},H={...A,...M},R={Count:(F=H).count(O),"Count Unique Values":F.countUnique(O),"List Unique Values":F.listUnique(", "),Sum:F.sum(k),"Integer Sum":F.sum(O),Average:F.average(k),Median:F.median(k),"Sample Variance":F.var(1,k),"Sample Standard Deviation":F.stdev(1,k),Minimum:F.min(k),Maximum:F.max(k),First:F.first(k),Last:F.last(k),"Sum over Sum":F.sumOverSum(k),"Sum as Fraction of Total":F.fractionOf(F.sum(),"total",N),"Sum as Fraction of Rows":F.fractionOf(F.sum(),"row",N),"Sum as Fraction of Columns":F.fractionOf(F.sum(),"col",N),"Count as Fraction of Total":F.fractionOf(F.count(),"total",N),"Count as Fraction of Rows":F.fractionOf(F.count(),"row",N),"Count as Fraction of Columns":F.fractionOf(F.count(),"col",N)};var F;const $=t=>t.join(String.fromCharCode(0));class _{constructor(t={},e={}){this.props={..._.defaultProps,...t},this.processRecord=this.processRecord.bind(this),b().checkPropTypes(_.propTypes,this.props,"prop","PivotData"),this.aggregator=this.props.aggregatorsFactory(this.props.defaultFormatter)[this.props.aggregatorName](this.props.vals),this.formattedAggregators=this.props.customFormatters&&Object.entries(this.props.customFormatters).reduce(((t,[e,o])=>(t[e]={},Object.entries(o).forEach((([o,r])=>{t[e][o]=this.props.aggregatorsFactory(r)[this.props.aggregatorName](this.props.vals)})),t)),{}),this.tree={},this.rowKeys=[],this.colKeys=[],this.rowTotals={},this.colTotals={},this.allTotal=this.aggregator(this,[],[]),this.subtotals=e,this.sorted=!1,_.forEachRecord(this.props.data,this.processRecord)}getFormattedAggregator(t,e){if(!this.formattedAggregators)return this.aggregator;const[o,r]=Object.entries(t).find((([t,e])=>this.formattedAggregators[t]&&this.formattedAggregators[t][e]))||[];return!o||!r||e&&!e.includes(r)?this.aggregator:this.formattedAggregators[o][r]||this.aggregator}arrSort(t,e,o=!1){const r=t.map((t=>T(this.props.sorters,t)));return function(t,l){const a=Math.min(t.length,l.length);for(let e=0;e<a;e+=1){const a=r[e],s=o?a(l[e],t[e]):a(t[e],l[e]);if(0!==s)return s}return e?t.length-l.length:l.length-t.length}}sortKeys(){if(!this.sorted){this.sorted=!0;const t=(t,e)=>this.getAggregator(t,e).value();switch(this.props.rowOrder){case"key_z_to_a":this.rowKeys.sort(this.arrSort(this.props.rows,this.subtotals.rowPartialOnTop,!0));break;case"value_a_to_z":this.rowKeys.sort(((e,o)=>S(t(e,[]),t(o,[]))));break;case"value_z_to_a":this.rowKeys.sort(((e,o)=>-S(t(e,[]),t(o,[]))));break;default:this.rowKeys.sort(this.arrSort(this.props.rows,this.subtotals.rowPartialOnTop))}switch(this.props.colOrder){case"key_z_to_a":this.colKeys.sort(this.arrSort(this.props.cols,this.subtotals.colPartialOnTop,!0));break;case"value_a_to_z":this.colKeys.sort(((e,o)=>S(t([],e),t([],o))));break;case"value_z_to_a":this.colKeys.sort(((e,o)=>-S(t([],e),t([],o))));break;default:this.colKeys.sort(this.arrSort(this.props.cols,this.subtotals.colPartialOnTop))}}}getColKeys(){return this.sortKeys(),this.colKeys}getRowKeys(){return this.sortKeys(),this.rowKeys}processRecord(t){const e=[],o=[];this.props.cols.forEach((o=>{e.push(o in t?t[o]:"null")})),this.props.rows.forEach((e=>{o.push(e in t?t[e]:"null")})),this.allTotal.push(t);const r=this.subtotals.rowEnabled?1:Math.max(1,o.length),l=this.subtotals.colEnabled?1:Math.max(1,e.length);let a,s;for(let e=r;e<=o.length;e+=1){a=e<o.length;const r=o.slice(0,e),l=$(r);this.rowTotals[l]||(this.rowKeys.push(r),this.rowTotals[l]=this.getFormattedAggregator(t,o)(this,r,[])),this.rowTotals[l].push(t),this.rowTotals[l].isSubtotal=a}for(let o=l;o<=e.length;o+=1){s=o<e.length;const r=e.slice(0,o),l=$(r);this.colTotals[l]||(this.colKeys.push(r),this.colTotals[l]=this.getFormattedAggregator(t,e)(this,[],r)),this.colTotals[l].push(t),this.colTotals[l].isSubtotal=s}for(let n=r;n<=o.length;n+=1){a=n<o.length;const r=o.slice(0,n),i=$(r);this.tree[i]||(this.tree[i]={});for(let o=l;o<=e.length;o+=1){s=o<e.length;const l=e.slice(0,o),n=$(l);this.tree[i][n]||(this.tree[i][n]=this.getFormattedAggregator(t)(this,r,l)),this.tree[i][n].push(t),this.tree[i][n].isRowSubtotal=a,this.tree[i][n].isColSubtotal=s,this.tree[i][n].isSubtotal=a||s}}}getAggregator(t,e){let o;const r=$(t),l=$(e);return o=0===t.length&&0===e.length?this.allTotal:0===t.length?this.colTotals[l]:0===e.length?this.rowTotals[r]:this.tree[r][l],o||{value:()=>null,format:()=>""}}}_.forEachRecord=function(t,e){if(Array.isArray(t))return t.map((t=>e(t)));throw new Error((0,i.t)("Unknown input format"))},_.defaultProps={aggregators:R,cols:[],rows:[],vals:[],aggregatorName:"Count",sorters:{},rowOrder:"key_a_to_z",colOrder:"key_a_to_z"},_.propTypes={data:b().oneOfType([b().array,b().object,b().func]).isRequired,aggregatorName:b().string,cols:b().arrayOf(b().string),rows:b().arrayOf(b().string),vals:b().arrayOf(b().string),valueFilter:b().objectOf(b().objectOf(b().bool)),sorters:b().oneOfType([b().func,b().objectOf(b().func)]),derivedAttributes:b().objectOf(b().func),rowOrder:b().oneOf(["key_a_to_z","key_z_to_a","value_a_to_z","value_z_to_a"]),colOrder:b().oneOf(["key_a_to_z","key_z_to_a","value_a_to_z","value_z_to_a"])};var D=o(7566),K=o(17437);const E=n.I4.div`
  ${({theme:t,isDashboardEditMode:e})=>K.AH`
    table.pvtTable {
      position: ${e?"inherit":"relative"};
      width: calc(100% - ${t.sizeUnit}px);
      font-size: ${t.fontSizeSM}px;
      text-align: left;
      margin: ${t.sizeUnit}px;
      border-collapse: separate;
      font-family: ${t.fontFamily};
      line-height: 1.4;
    }

    table thead {
      background-color: ${t.colorBgBase};
      position: ${e?"inherit":"sticky"};
      top: 0;
    }

    table tbody tr {
      font-feature-settings: 'tnum' 1;
    }

    table.pvtTable thead tr th,
    table.pvtTable tbody tr th {
      border-top: 1px solid ${t.colorSplit};
      border-left: 1px solid ${t.colorSplit};
      font-size: ${t.fontSizeSM}px;
      padding: ${t.sizeUnit}px;
      font-weight: ${t.fontWeightNormal};
    }

    table.pvtTable tbody tr.pvtRowTotals {
      position: ${e?"inherit":"sticky"};
      bottom: 0;
    }

    table.pvtTable thead tr:last-of-type th,
    table.pvtTable thead tr:first-of-type th.pvtTotalLabel,
    table.pvtTable thead tr:nth-last-of-type(2) th.pvtColLabel,
    table.pvtTable thead th.pvtSubtotalLabel,
    table.pvtTable tbody tr:last-of-type th,
    table.pvtTable tbody tr:last-of-type td {
      border-bottom: 1px solid ${t.colorSplit};
    }

    table.pvtTable
      thead
      tr:last-of-type:not(:only-child)
      th.pvtAxisLabel
      ~ th.pvtColLabel,
    table.pvtTable tbody tr:first-of-type th,
    table.pvtTable tbody tr:first-of-type td {
      border-top: none;
    }

    table.pvtTable tbody tr td:last-of-type,
    table.pvtTable thead tr th:last-of-type:not(.pvtSubtotalLabel) {
      border-right: 1px solid ${t.colorSplit};
    }

    table.pvtTable
      thead
      tr:last-of-type:not(:only-child)
      th.pvtAxisLabel
      + .pvtTotalLabel {
      border-right: none;
    }

    table.pvtTable tr th.active {
      background-color: ${t.colorPrimaryBg};
    }

    table.pvtTable .pvtTotalLabel {
      text-align: right;
      font-weight: ${t.fontWeightStrong};
    }

    table.pvtTable .pvtSubtotalLabel {
      font-weight: ${t.fontWeightStrong};
    }

    table.pvtTable tbody tr td {
      color: ${t.colorPrimaryText};
      padding: ${t.sizeUnit}px;
      background-color: ${t.colorBgBase};
      border-top: 1px solid ${t.colorSplit};
      border-left: 1px solid ${t.colorSplit};
      vertical-align: top;
      text-align: right;
    }

    table.pvtTable tbody tr th.pvtRowLabel {
      vertical-align: baseline;
    }

    .pvtTotal,
    .pvtGrandTotal {
      font-weight: ${t.fontWeightStrong};
    }

    table.pvtTable tbody tr td.pvtRowTotal {
      vertical-align: middle;
    }

    .toggle-wrapper {
      white-space: nowrap;
    }

    .toggle-wrapper > .toggle-val {
      white-space: normal;
    }

    .toggle {
      padding-right: ${t.sizeUnit}px;
      cursor: pointer;
    }

    .hoverable:hover {
      background-color: ${t.colorPrimaryBgHover};
      cursor: pointer;
    }
  `}
`,P=t=>"string"==typeof t?"metric"===t?(0,i.t)("metric"):t:"number"==typeof t?t:String(t);function j(t,e){return e&&"string"==typeof t?(0,D.nn)(t):P(t)}function L(t,e,o,l,a,s){const n=a[l]||l,i=P(n),c=s&&"string"==typeof i?(0,D.nn)(i):i;return t?(0,r.FD)("span",{className:"toggle-wrapper",children:[(0,r.Y)("span",{role:"button",tabIndex:"0",className:"toggle",onClick:o,children:e}),(0,r.Y)("span",{className:"toggle-val",children:c})]}):c}class Y extends l.Component{constructor(t){super(t),this.state={collapsedRows:{},collapsedCols:{}},this.clickHeaderHandler=this.clickHeaderHandler.bind(this),this.clickHandler=this.clickHandler.bind(this)}getBasePivotSettings(){const{props:t}=this,e=t.cols,o=t.rows,r={rowTotals:!0,colTotals:!0,...t.tableOptions},l=r.rowTotals||0===e.length,a=r.colTotals||0===o.length,s=t.namesMapping||{},n={arrowCollapsed:"▲",arrowExpanded:"▼",...t.subtotalOptions},i={displayOnTop:!1,enabled:r.colSubTotals,hideOnExpand:!1,...n.colSubtotalDisplay},c={displayOnTop:!1,enabled:r.rowSubTotals,hideOnExpand:!1,...n.rowSubtotalDisplay},u=new _(t,{rowEnabled:c.enabled,colEnabled:i.enabled,rowPartialOnTop:c.displayOnTop,colPartialOnTop:i.displayOnTop}),h=u.getRowKeys(),p=u.getColKeys(),d={},g={},m={};let b=null;return r.clickCallback&&(h.forEach((t=>{const e=$(t);e in d||(d[e]={}),p.forEach((o=>{d[e][$(o)]=this.clickHandler(u,t,o)}))})),l&&h.forEach((t=>{g[$(t)]=this.clickHandler(u,t,[])})),a&&p.forEach((t=>{m[$(t)]=this.clickHandler(u,[],t)})),l&&a&&(b=this.clickHandler(u,[],[]))),{pivotData:u,colAttrs:e,rowAttrs:o,colKeys:p,rowKeys:h,rowTotals:l,colTotals:a,arrowCollapsed:n.arrowCollapsed,arrowExpanded:n.arrowExpanded,colSubtotalDisplay:i,rowSubtotalDisplay:c,cellCallbacks:d,rowTotalCallbacks:g,colTotalCallbacks:m,grandTotalCallback:b,namesMapping:s,allowRenderHtml:t.allowRenderHtml}}clickHandler(t,e,o){const r=this.props.cols,l=this.props.rows,a=t.getAggregator(e,o).value(),s={},n=Math.min(r.length,o.length);for(let t=0;t<n;t+=1){const e=r[t];null!==o[t]&&(s[e]=o[t])}const i=Math.min(l.length,e.length);for(let t=0;t<i;t+=1){const o=l[t];null!==e[t]&&(s[o]=e[t])}return e=>this.props.tableOptions.clickCallback(e,a,s,t)}clickHeaderHandler(t,e,o,r,l,a=!1,s=!1){const n={};for(let t=0;t<=r;t+=1){const r=o[t];n[r]=e[t]}return o=>l(o,e[r],n,t,a,s)}collapseAttr(t,e,o){return r=>{r.stopPropagation();const l=e+1,a=o.filter((t=>t.length===l)).map($),s={};a.forEach((t=>{s[t]=!0})),t?this.setState((t=>({collapsedRows:{...t.collapsedRows,...s}}))):this.setState((t=>({collapsedCols:{...t.collapsedCols,...s}})))}}expandAttr(t,e,o){return r=>{r.stopPropagation();const l={};o.forEach((t=>{for(let o=0;o<=e;o+=1)l[$(t.slice(0,o+1))]=!1})),t?this.setState((t=>({collapsedRows:{...t.collapsedRows,...l}}))):this.setState((t=>({collapsedCols:{...t.collapsedCols,...l}})))}}toggleRowKey(t){return e=>{e.stopPropagation(),this.setState((e=>({collapsedRows:{...e.collapsedRows,[t]:!e.collapsedRows[t]}})))}}toggleColKey(t){return e=>{e.stopPropagation(),this.setState((e=>({collapsedCols:{...e.collapsedCols,[t]:!e.collapsedCols[t]}})))}}calcAttrSpans(t,e){const o=[],r=Array(e).map((()=>0));let l=Array(e).map((()=>null));for(let e=0;e<t.length;e+=1){const a=t[e],s=[];let n=0;const i=Math.min(l.length,a.length);for(;n<i&&l[n]===a[n];)s.push(-1),o[r[n]][n]+=1,n+=1;for(;n<a.length;)r[n]=e,s.push(1),n+=1;o.push(s),l=a}return o}renderColHeaderRow(t,e,o){const{rowAttrs:l,colAttrs:a,colKeys:s,visibleColKeys:n,colAttrSpans:c,rowTotals:u,arrowExpanded:h,arrowCollapsed:p,colSubtotalDisplay:d,maxColVisible:g,pivotData:m,namesMapping:b,allowRenderHtml:f}=o,{highlightHeaderCellsOnHover:v,omittedHighlightHeaderGroups:w=[],highlightedHeaderCells:y,dateFormatters:S}=this.props.tableOptions,C=0===e&&0!==l.length?(0,r.Y)("th",{colSpan:l.length,rowSpan:a.length,"aria-hidden":"true"},"padding"):null,T=d.enabled&&e!==a.length-1;let k=null,O=null;T&&(k=e+1<g?this.collapseAttr(!1,e,s):this.expandAttr(!1,e,s),O=e+1<g?h:p);const N=(0,r.Y)("th",{className:"pvtAxisLabel",children:L(T,O,k,t,b,f)},"label"),x=[],A=0!==l.length?1:0;let M=0;for(;M<n.length;){let o;const l=n[M],s=e<l.length?c[M][e]:1;let u="pvtColLabel";if(e<l.length){w.includes(a[e])||(v&&(u+=" hoverable"),o=o=>this.props.onContextMenu(o,l,void 0,{[t]:l[e]})),y&&Array.isArray(y[a[e]])&&y[a[e]].includes(l[e])&&(u+=" active");const n=1+(e===a.length-1?A:0),i=$(l.slice(0,e+1)),c=T?this.toggleColKey(i):null,d=S&&S[t]&&"function"==typeof S[t]?S[t](l[e]):l[e];x.push((0,r.Y)("th",{className:u,colSpan:s,rowSpan:n,role:"columnheader button",onClick:this.clickHeaderHandler(m,l,this.props.cols,e,this.props.tableOptions.clickColumnHeaderCallback),onContextMenu:o,children:L(T,this.state.collapsedCols[i]?p:h,c,d,b,f)},`colKey-${i}`))}else if(e===l.length){const t=a.length-l.length+A;x.push((0,r.Y)("th",{className:`${u} pvtSubtotalLabel`,colSpan:s,rowSpan:t,role:"columnheader button",onClick:this.clickHeaderHandler(m,l,this.props.cols,e,this.props.tableOptions.clickColumnHeaderCallback,!0),children:(0,i.t)("Subtotal")},`colKeyBuffer-${$(l)}`))}M+=s}const H=0===e&&u?(0,r.Y)("th",{className:"pvtTotalLabel",rowSpan:a.length+Math.min(l.length,1),role:"columnheader button",onClick:this.clickHeaderHandler(m,[],this.props.cols,e,this.props.tableOptions.clickColumnHeaderCallback,!1,!0),children:(0,i.t)("Total (%(aggregatorName)s)",{aggregatorName:(0,i.t)(this.props.aggregatorName)})},"total"):null,R=[C,N,...x,H];return(0,r.Y)("tr",{children:R},`colAttr-${e}`)}renderRowHeaderRow(t){const{rowAttrs:e,colAttrs:o,rowKeys:l,arrowCollapsed:a,arrowExpanded:s,rowSubtotalDisplay:n,maxRowVisible:c,pivotData:u,namesMapping:h,allowRenderHtml:p}=t;return(0,r.FD)("tr",{children:[e.map(((t,o)=>{const i=n.enabled&&o!==e.length-1;let u=null,d=null;return i&&(u=o+1<c?this.collapseAttr(!0,o,l):this.expandAttr(!0,o,l),d=o+1<c?s:a),(0,r.Y)("th",{className:"pvtAxisLabel",children:L(i,d,u,t,h,p)},`rowAttr-${o}`)})),(0,r.Y)("th",{className:"pvtTotalLabel",role:"columnheader button",onClick:this.clickHeaderHandler(u,[],this.props.rows,0,this.props.tableOptions.clickRowHeaderCallback,!1,!0),children:0===o.length?(0,i.t)("Total (%(aggregatorName)s)",{aggregatorName:(0,i.t)(this.props.aggregatorName)}):null},"padding")]},"rowHdr")}renderTableRow(t,e,o){const{rowAttrs:l,colAttrs:a,rowAttrSpans:s,visibleColKeys:n,pivotData:c,rowTotals:u,rowSubtotalDisplay:h,arrowExpanded:p,arrowCollapsed:d,cellCallbacks:g,rowTotalCallbacks:m,namesMapping:b,allowRenderHtml:f}=o,{highlightHeaderCellsOnHover:v,omittedHighlightHeaderGroups:w=[],highlightedHeaderCells:y,cellColorFormatters:S,dateFormatters:C}=this.props.tableOptions,T=$(t),k=0!==a.length?1:0,O=t.map(((o,a)=>{let n,i="pvtRowLabel";w.includes(l[a])||(v&&(i+=" hoverable"),n=e=>this.props.onContextMenu(e,void 0,t,{[l[a]]:o})),y&&Array.isArray(y[l[a]])&&y[l[a]].includes(o)&&(i+=" active");const u=s[e][a];if(u>0){const e=$(t.slice(0,a+1)),s=1+(a===l.length-1?k:0),g=h.enabled&&a!==l.length-1,m=g?this.toggleRowKey(e):null,v=C&&C[l[a]]?C[l[a]](o):o;return(0,r.Y)("th",{className:i,rowSpan:u,colSpan:s,role:"columnheader button",onClick:this.clickHeaderHandler(c,t,this.props.rows,a,this.props.tableOptions.clickRowHeaderCallback),onContextMenu:n,children:L(g,this.state.collapsedRows[e]?d:p,m,v,b,f)},`rowKeyLabel-${a}`)}return null})),N=t.length<l.length?(0,r.Y)("th",{className:"pvtRowLabel pvtSubtotalLabel",colSpan:l.length-t.length+k,rowSpan:1,role:"columnheader button",onClick:this.clickHeaderHandler(c,t,this.props.rows,t.length,this.props.tableOptions.clickRowHeaderCallback,!0),children:(0,i.t)("Subtotal")},"rowKeyBuffer"):null,x=g[T]||{},A=n.map((e=>{const o=$(e),l=c.getAggregator(t,e),a=l.value(),s=[...t,...e];let n;S&&Object.values(S).forEach((t=>{Array.isArray(t)&&s.forEach((e=>{n||t.filter((t=>t.column===e)).forEach((t=>{const e=t.getColorFromValue(a);e&&(n=e)}))}))}));const i=l.isSubtotal?{fontWeight:"bold"}:{backgroundColor:n};return(0,r.Y)("td",{role:"gridcell",className:"pvtVal",onClick:x[o],onContextMenu:o=>this.props.onContextMenu(o,e,t),style:i,children:j(l.format(a),f)},`pvtVal-${o}`)}));let M=null;if(u){const e=c.getAggregator(t,[]),o=e.value();M=(0,r.Y)("td",{role:"gridcell",className:"pvtTotal",onClick:m[T],onContextMenu:e=>this.props.onContextMenu(e,void 0,t),children:j(e.format(o),f)},"total")}const H=[...O,N,...A,M];return(0,r.Y)("tr",{children:H},`keyRow-${T}`)}renderTotalsRow(t){const{rowAttrs:e,colAttrs:o,visibleColKeys:l,rowTotals:a,pivotData:s,colTotalCallbacks:n,grandTotalCallback:c}=t,u=(0,r.Y)("th",{className:"pvtTotalLabel pvtRowTotalLabel",colSpan:e.length+Math.min(o.length,1),role:"columnheader button",onClick:this.clickHeaderHandler(s,[],this.props.rows,0,this.props.tableOptions.clickRowHeaderCallback,!1,!0),children:(0,i.t)("Total (%(aggregatorName)s)",{aggregatorName:(0,i.t)(this.props.aggregatorName)})},"label"),h=l.map((t=>{const e=$(t),o=s.getAggregator([],t),l=o.value();return(0,r.Y)("td",{role:"gridcell",className:"pvtTotal pvtRowTotal",onClick:n[e],onContextMenu:e=>this.props.onContextMenu(e,t,void 0),style:{padding:"5px"},children:j(o.format(l),this.props.allowRenderHtml)},`total-${e}`)}));let p=null;if(a){const t=s.getAggregator([],[]),e=t.value();p=(0,r.Y)("td",{role:"gridcell",className:"pvtGrandTotal pvtRowTotal",onClick:c,onContextMenu:t=>this.props.onContextMenu(t,void 0,void 0),children:j(t.format(e),this.props.allowRenderHtml)},"total")}const d=[u,...h,p];return(0,r.Y)("tr",{className:"pvtRowTotals",children:d},"total")}visibleKeys(t,e,o,r){return t.filter((t=>!t.some(((o,r)=>e[$(t.slice(0,r))]))&&(t.length===o||$(t)in e||!r.hideOnExpand)))}isDashboardEditMode(){return document.contains(document.querySelector(".dashboard--editing"))}render(){this.cachedProps!==this.props&&(this.cachedProps=this.props,this.cachedBasePivotSettings=this.getBasePivotSettings());const{colAttrs:t,rowAttrs:e,rowKeys:o,colKeys:l,colTotals:a,rowSubtotalDisplay:s,colSubtotalDisplay:n,allowRenderHtml:i}=this.cachedBasePivotSettings,c=this.visibleKeys(o,this.state.collapsedRows,e.length,s),u=this.visibleKeys(l,this.state.collapsedCols,t.length,n),h={visibleRowKeys:c,maxRowVisible:Math.max(...c.map((t=>t.length))),visibleColKeys:u,maxColVisible:Math.max(...u.map((t=>t.length))),rowAttrSpans:this.calcAttrSpans(c,e.length),colAttrSpans:this.calcAttrSpans(u,t.length),allowRenderHtml:i,...this.cachedBasePivotSettings};return(0,r.Y)(E,{isDashboardEditMode:this.isDashboardEditMode(),children:(0,r.FD)("table",{className:"pvtTable",role:"grid",children:[(0,r.FD)("thead",{children:[t.map(((t,e)=>this.renderColHeaderRow(t,e,h))),0!==e.length&&this.renderRowHeaderRow(h)]}),(0,r.FD)("tbody",{children:[c.map(((t,e)=>this.renderTableRow(t,e,h))),a&&this.renderTotalsRow(h)]})]})})}}Y.propTypes={..._.propTypes,tableOptions:b().object,onContextMenu:b().func},Y.defaultProps={..._.defaultProps,tableOptions:{}};class z extends l.PureComponent{render(){return(0,r.Y)(Y,{...this.props})}}z.propTypes=Y.propTypes,z.defaultProps=Y.defaultProps;const q=z;var V=o(64311);const I=n.I4.div`
  ${({height:t,width:e,margin:o})=>`\n      margin: ${o}px;\n      height: ${t-2*o}px;\n      width: ${"string"==typeof e?parseInt(e,10):e-2*o}px;\n `}
`,U=n.I4.div`
  height: 100%;
  max-width: inherit;
  overflow: auto;
`,B=(0,i.t)("Metric"),G=["value"],W=(0,n.I4)(a.A)`
  stroke: ${({theme:t})=>t.colorBorderSecondary};
  stroke-width: 16px;
`,X=(0,n.I4)(s.A)`
  stroke: ${({theme:t})=>t.colorBorderSecondary};
  stroke-width: 16px;
`,J=t=>({Count:H.count(t),"Count Unique Values":H.countUnique(t),"List Unique Values":H.listUnique(", ",t),Sum:H.sum(t),Average:H.average(t),Median:H.median(t),"Sample Variance":H.var(1,t),"Sample Standard Deviation":H.stdev(1,t),Minimum:H.min(t),Maximum:H.max(t),First:H.first(t),Last:H.last(t),"Sum as Fraction of Total":H.fractionOf(H.sum(),"total",t),"Sum as Fraction of Rows":H.fractionOf(H.sum(),"row",t),"Sum as Fraction of Columns":H.fractionOf(H.sum(),"col",t),"Count as Fraction of Total":H.fractionOf(H.count(),"total",t),"Count as Fraction of Rows":H.fractionOf(H.count(),"row",t),"Count as Fraction of Columns":H.fractionOf(H.count(),"col",t)});function Q(t){const{data:e,height:o,width:a,groupbyRows:s,groupbyColumns:i,metrics:m,colOrder:b,rowOrder:f,aggregateFunction:v,transposePivot:w,combineMetric:y,rowSubtotalPosition:S,colSubtotalPosition:T,colTotals:k,colSubTotals:O,rowTotals:N,rowSubTotals:x,valueFormat:A,currencyFormat:M,emitCrossFilters:H,setDataMask:R,selectedFilters:F,verboseMap:$,columnFormats:_,currencyFormats:D,metricsLayout:K,metricColorFormatters:E,dateFormatters:P,onContextMenu:j,timeGrainSqla:L,allowRenderHtml:Y}=t,z=(0,n.DP)(),Q=(0,l.useMemo)((()=>null!=M&&M.symbol?new c.A({currency:M,d3Format:A}):(0,u.gV)(A)),[A,M]),Z=(0,l.useMemo)((()=>Array.from(new Set([...Object.keys(_||{}),...Object.keys(D||{})])).map((t=>[t,_[t]||A,D[t]||M]))),[_,M,D,A]),tt=Z.length>0,et=(0,l.useMemo)((()=>tt?{[B]:Object.fromEntries(Z.map((([t,e,o])=>[t,o?new c.A({currency:o,d3Format:e}):(0,u.gV)(e)])))}:void 0),[Z,tt]),ot=(0,l.useMemo)((()=>m.map((t=>"string"==typeof t?t:t.label))),[m]),rt=(0,l.useMemo)((()=>e.reduce(((t,e)=>[...t,...ot.map((t=>({...e,[B]:t,value:e[t]}))).filter((t=>null!==t.value))]),[])),[e,ot]),lt=(0,l.useMemo)((()=>s.map(h.A)),[s]),at=(0,l.useMemo)((()=>i.map(h.A)),[i]),st=(0,l.useMemo)((()=>({[B]:C(ot)})),[ot]),[nt,it]=(0,l.useMemo)((()=>{let[t,e]=w?[at,lt]:[lt,at];return K===V.P.ROWS?t=y?[...t,B]:[B,...t]:e=y?[...e,B]:[B,...e],[t,e]}),[y,at,lt,K,w]),ct=(0,l.useCallback)((t=>{const e=Object.keys(t),o=[...s,...i];R({extraFormData:{filters:0===e.length?void 0:e.map((e=>{var r;const l=null==t?void 0:t[e],a=null!=(r=o.find((t=>(0,p.eh)(t)?t===e:!!(0,p.q0)(t)&&t.label===e)))?r:"";return null==l?{col:a,op:"IS NULL"}:{col:a,op:"IN",val:l}}))},filterState:{value:t&&Object.keys(t).length?Object.values(t):null,selectedFilters:t&&Object.keys(t).length?t:null}})}),[i,s,R]),ut=(0,l.useCallback)((t=>{const e=(t,e)=>{var o;return!!F&&(null==(o=F[t])?void 0:o.includes(e))};if(!t)return;const[o,r]=Object.entries(t)[0];let l={...F};l=e(o,r)?{}:{[o]:[r]};const a=Object.keys(l),n=[...s,...i];return{dataMask:{extraFormData:{filters:0===a.length?void 0:a.map((t=>{var e,o;const r=null==(e=l)?void 0:e[t],a=null!=(o=n.find((e=>(0,p.eh)(e)?e===t:!!(0,p.q0)(e)&&e.label===t)))?o:"";return null==r?{col:a,op:"IS NULL"}:{col:a,op:"IN",val:r}}))},filterState:{value:l&&Object.keys(l).length?Object.values(l):null,selectedFilters:l&&Object.keys(l).length?l:null}},isCurrentValueSelected:e(o,r)}}),[i,s,F]),ht=(0,l.useCallback)(((t,e,o,r,l,a)=>{if(l||a||!H)return;if((0,d.j)())return;const s={...o};delete s[B];const n=Object.entries(s);if(0===n.length)return;const[i,c]=n[n.length-1];let u={...F||{}};u=F&&((t,e)=>{var o;return!!F&&(null==(o=F[t])?void 0:o.includes(e))})(i,c)?{}:{[i]:[c]},Array.isArray(u[i])&&0===u[i].length&&delete u[i],ct(u)}),[H,F,ct]),pt=(0,l.useMemo)((()=>({clickRowHeaderCallback:ht,clickColumnHeaderCallback:ht,colTotals:k,colSubTotals:O,rowTotals:N,rowSubTotals:x,highlightHeaderCellsOnHover:H||(0,g.G7)(g.TO.DrillBy)||(0,g.G7)(g.TO.DrillToDetail),highlightedHeaderCells:F,omittedHighlightHeaderGroups:[B],cellColorFormatters:{[B]:E},dateFormatters:P})),[k,O,P,H,E,N,x,F,ht]),dt=(0,l.useMemo)((()=>({colSubtotalDisplay:{displayOnTop:T},rowSubtotalDisplay:{displayOnTop:S},arrowCollapsed:(0,r.Y)(W,{}),arrowExpanded:(0,r.Y)(X,{})})),[T,S]),gt=(0,l.useCallback)(((t,e,o,r)=>{if(j){t.preventDefault(),t.stopPropagation();const l=[];e&&e.length>1&&e.forEach(((t,e)=>{const o=it[e],r=P[o],a=(null==r?void 0:r(t))||String(t);e>0&&l.push({col:o,op:"==",val:t,formattedVal:a,grain:r?L:void 0})})),o&&o.forEach(((t,e)=>{const o=nt[e],r=P[o],a=(null==r?void 0:r(t))||String(t);l.push({col:o,op:"==",val:t,formattedVal:a,grain:r?L:void 0})})),j(t.clientX,t.clientY,{drillToDetail:l,crossFilter:ut(r),drillBy:r&&{filters:[{col:Object.keys(r)[0],op:"==",val:Object.values(r)[0]}],groupbyFieldName:o?"groupbyRows":"groupbyColumns"}})}}),[it,P,ut,j,nt,L]);return(0,r.Y)(I,{height:o,width:a,margin:4*z.sizeUnit,children:(0,r.Y)(U,{children:(0,r.Y)(q,{data:rt,rows:nt,cols:it,aggregatorsFactory:J,defaultFormatter:Q,customFormatters:et,aggregatorName:v,vals:G,colOrder:b,rowOrder:f,sorters:st,tableOptions:pt,subtotalOptions:dt,namesMapping:$,onContextMenu:gt,allowRenderHtml:Y})})})}},95021:(t,e,o)=>{o.d(e,{j:()=>r});const r=()=>{var t;return null==(t=window.getSelection())?void 0:t.toString()}}}]);