"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3405],{832:(t,e,o)=>{o.d(e,{c:()=>v,y:()=>C});var a=o(2404),r=o.n(a),l=o(2445),n=o(96540),i=o(67413),s=o(35942),c=o(14503),d=o(28027),u=o(50871),p=o(98456),h=o(48238),f=o(92123),m=o(51316),g=o(99894);const{getScale:b}=c;function _(t,e){const o=t.color_picker||{r:0,g:0,b:0,a:1},a=[o.r,o.g,o.b,255*o.a],r=t.color_scheme,l=b(r);let n={};return t.color_scheme_type===f.wP.color_breakpoints?n=(0,m.BK)(t.color_breakpoints):e.forEach((e=>{if(null!=e.cat_color&&!n.hasOwnProperty(e.cat_color)){let r;r=t.dimension?(0,u.hexToRGB)(l(e.cat_color,t.sliceId),255*o.a):a,n[e.cat_color]={color:r,enabled:!0}}})),n}const y=t=>{const e=(0,n.useRef)(null),o=(0,n.useCallback)((()=>{let e={...t.viewport};return t.formData.autozoom&&(e=(0,h.A)(e,{width:t.width,height:t.height,points:t.getPoints(t.payload.data.features||[])})),e.zoom<0&&(e.zoom=0),e}),[t]),[a,r]=(0,n.useState)(_(t.formData,t.payload.data.features||[])),[i,c]=(0,n.useState)(t.payload.form_data),[m,y]=(0,n.useState)(o());(0,n.useEffect)((()=>{if(t.payload.form_data!==i){const e=t.payload.data.features||[],a=_(t.formData,e);y(o()),c(t.payload.form_data),r(a)}}),[o,t,i]);const w=(0,n.useCallback)((t=>{const{current:o}=e;o&&o.setTooltip(t)}),[]),C=(0,n.useCallback)(((t,e,o)=>{const a=e.color_scheme,r=b(a);let l;switch(o){case f.wP.fixed_color:return l=e.color_picker||{r:0,g:0,b:0,a:100},t.map((t=>({...t,color:[l.r,l.g,l.b,255*l.a]})));case f.wP.categorical_palette:return t.map((t=>({...t,color:(0,u.hexToRGB)(r(t.cat_color,e.slice_id))})));case f.wP.color_breakpoints:{const o=e.deafult_breakpoint_color?[e.deafult_breakpoint_color.r,e.deafult_breakpoint_color.g,e.deafult_breakpoint_color.b,255*e.deafult_breakpoint_color.a]:[g.DL.r,g.DL.g,g.DL.b,255*g.DL.a];return t.map((t=>{var a;const r=null==(a=e.color_breakpoints)?void 0:a.find((e=>t.metric>=e.minValue&&t.metric<=e.maxValue));return{...t,color:r?[null==r?void 0:r.color.r,null==r?void 0:r.color.g,null==r?void 0:r.color.b,255*(null==r?void 0:r.color.a)]:o}}))}default:return[]}}),[]),v=(0,n.useCallback)((()=>{const{getLayer:e,getHighlightLayer:o,payload:r,formData:l,onAddFilter:n,onContextMenu:i,filterState:s,setDataMask:c,emitCrossFilters:d}=t;let u=r.data.features?[...r.data.features]:[];const h=l.color_scheme_type;u=C(u,l,h),l.js_data_mutator&&(u=(0,p.A)(l.js_data_mutator)(u)),l.dimension&&(u=u.filter((t=>{var e;return null==(e=a[t.cat_color])?void 0:e.enabled})));const f={formData:l,payload:{...r,data:{...r.data,features:u}},onAddFilter:n,setTooltip:w,datasource:t.datasource,onContextMenu:i,filterState:s,setDataMask:c,emitCrossFilters:d},m=e(f);return d&&null!=s&&s.value&&o?[m,o(f)]:[m]}),[C,a,t,w]),k=(0,n.useCallback)((t=>{const e=a[t],o={...a,[t]:{...e,enabled:!e.enabled}};Object.values(o).every((t=>!t.enabled))&&Object.values(o).forEach((t=>{t.enabled=!0})),r(o)}),[a]),D=(0,n.useCallback)((t=>{const e={...a};Object.values(e).forEach((t=>{t.enabled=!1})),e[t].enabled=!0,r(e)}),[a]);return(0,l.FD)("div",{style:{position:"relative"},children:[(0,l.Y)(s.S,{ref:e,viewport:m,layers:v(),setControlValue:t.setControlValue,mapStyle:t.formData.mapbox_style,mapboxApiAccessToken:t.mapboxApiKey,width:t.width,height:t.height}),(0,l.Y)(d.A,{forceCategorical:!0,categories:a,format:t.formData.legend_format,position:t.formData.legend_position,showSingleCategory:D,toggleCategory:k})]})},w=(0,n.memo)(y);function C(t,e,o){return(0,n.memo)((a=>{const c=(0,n.useRef)(),u=(0,i.Z)(a.formData),p=(0,i.Z)(a.filterState),f=(0,i.Z)(a.payload),[g,b]=(0,n.useState)((0,m.BK)(a.formData.color_breakpoints)||[]),[_,y]=(0,n.useState)((()=>{const{width:t,height:o,formData:r}=a;return r.autozoom?(0,h.A)(a.viewport,{width:t,height:o,points:e(a.payload.data.features)}):a.viewport})()),w=(0,n.useCallback)((t=>{const{current:e}=c;e&&(null==e||e.setTooltip(t))}),[]),C=(0,n.useCallback)((e=>{const{formData:a,payload:r,onAddFilter:l,filterState:n,setDataMask:i,onContextMenu:s,emitCrossFilters:c}=e,d={formData:a,payload:r,onAddFilter:l,setTooltip:w,setDataMask:i,onContextMenu:s,filterState:n,emitCrossFilters:c},u=t(d);return c&&null!=n&&n.value&&o?[u,o(d)]:[u]}),[w]);(0,n.useEffect)((()=>{const t=(0,m.BK)(a.formData.color_breakpoints);b(t)}),[a]);const[v,k]=(0,n.useState)(C(a));(0,n.useEffect)((()=>{const t={...u,...p,viewport:null},e={...a.formData,...a.filterState,viewport:null};r()(t,e)&&f===a.payload||k(C(a))}),[C,u,p,f,a]);const{formData:D,payload:x,setControlValue:S,height:A,width:F}=a;return(0,l.FD)("div",{style:{position:"relative"},children:[(0,l.Y)(s.S,{ref:c,mapboxApiAccessToken:x.data.mapboxApiKey,viewport:_,layers:v,mapStyle:D.mapbox_style,setControlValue:S,width:F,height:A,onViewportChange:y}),(0,l.Y)(d.A,{forceCategorical:!0,categories:g,format:a.formData.legend_format,position:a.formData.legend_position})]})}))}function v(t,e,o){return function(a){const{datasource:r,formData:n,height:i,payload:s,setControlValue:c,viewport:d,width:u,setDataMask:p,filterState:h,onContextMenu:f,emitCrossFilters:m}=a;return(0,l.Y)(w,{datasource:r,formData:n,mapboxApiKey:s.data.mapboxApiKey,setControlValue:c,viewport:d,getLayer:t,getHighlightLayer:o,payload:s,getPoints:e,width:u,height:i,setDataMask:p,onContextMenu:f,filterState:h,emitCrossFilters:m})}}},28027:(t,e,o)=>{o.d(e,{A:()=>d});var a=o(2445),r=o(96540),l=o(50290),n=o(29898);const i=l.I4.div`
  ${({theme:t})=>`\n    font-size: ${t.fontSizeSM}px;\n    position: absolute;\n    background: ${t.colorBgElevated};\n    box-shadow: 0 0 ${t.sizeUnit}px ${t.colorBorderSecondary};\n    margin: ${6*t.sizeUnit}px;\n    padding: ${3*t.sizeUnit}px ${5*t.sizeUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        display: flex;\n        color: ${t.colorText};\n        text-decoration: none;\n        padding: ${t.sizeUnit}px 0;\n\n        & span {\n          margin-right: ${t.sizeUnit}px;\n        }\n      }\n    }\n  `}
`,s=" - ",c=({format:t=null,forceCategorical:e=!1,position:o="tr",categories:r={},toggleCategory:l=()=>{},showSingleCategory:c=()=>{}})=>{const d=o=>{if(!t||e)return o;const a=parseFloat(o);return(0,n.ZV)(t,a)},u=e=>{if(!t)return e;if(e.includes(s)){const t=e.split(s);return d(t[0])+s+d(t[1])}return d(e)};if(0===Object.keys(r).length||null===o)return null;const p=Object.entries(r).map((([t,e])=>{var o;const r={color:`rgba(${null==(o=e.color)?void 0:o.join(", ")})`},n=e.enabled?"◼":"◻";return(0,a.Y)("li",{children:(0,a.FD)("a",{href:"#",role:"button",onClick:()=>l(t),onDoubleClick:()=>c(t),children:[(0,a.Y)("span",{style:r,children:n})," ",u(t)]})},t)})),h="t"===(null==o?void 0:o.charAt(0))?"top":"bottom",f="r"===(null==o?void 0:o.charAt(1))?"right":"left",m={position:"absolute",[h]:"0px",[f]:"10px"};return(0,a.Y)(i,{className:"dupa",style:m,children:(0,a.Y)("ul",{children:p})})},d=(0,r.memo)(c)},93405:(t,e,o)=>{o.r(e),o.d(e,{default:()=>f,getHighlightLayer:()=>h,getLayer:()=>u,getPoints:()=>p});var a=o(2445),r=o(23096),l=o(83860),n=o(98456),i=o(832),s=o(52480),c=o(51316);function d(t){var e;return(null==(e=t.object)?void 0:e.extraProps)&&(0,a.Y)("div",{className:"deckgl-tooltip",children:Object.keys(t.object.extraProps).map(((e,o)=>(0,a.Y)(s.A,{label:`${e}: `,value:`${t.object.extraProps[e]}`},`prop-${o}`)))})}const u=function({formData:t,payload:e,onContextMenu:o,filterState:a,setDataMask:i,setTooltip:s,emitCrossFilters:c}){const u=t,p=u.color_picker,h=[p.r,p.g,p.b,255*p.a];let f=e.data.features.map((t=>({...t,path:t.path,width:u.line_width,color:h})));return u.js_data_mutator&&(f=(0,n.A)(u.js_data_mutator)(f)),new r.A({id:`path-layer-${u.slice_id}`,getColor:t=>t.color,getPath:t=>t.path,getWidth:t=>t.width,data:f,rounded:!0,widthScale:1,widthUnits:u.line_width_unit,...(0,l.T$)({formData:u,setTooltip:s,setTooltipContent:d,setDataMask:i,filterState:a,onContextMenu:o,emitCrossFilters:c}),opacity:null!=a&&a.value?.3:1})};function p(t){let e=[];return t.forEach((t=>{e=e.concat(t.path)})),e}const h=function({formData:t,payload:e,filterState:o}){const a=t,l=c.Fe;let i=e.data.features.map((t=>({...t,path:t.path,width:a.line_width,color:l})));a.js_data_mutator&&(i=(0,n.A)(a.js_data_mutator)(i));const s=i.filter((t=>JSON.stringify(t.path).replaceAll(" ","")===(null==o?void 0:o.value[0])));return new r.A({id:`path-highlight-layer-${a.slice_id}`,getColor:()=>c.Fe,getPath:t=>t.path,getWidth:t=>t.width,data:s,rounded:!0,widthScale:1,widthUnits:a.line_width_unit})},f=(0,i.y)(u,p,h)}}]);