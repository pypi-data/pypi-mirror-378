"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[1440],{87070:(t,e,n)=>{n.r(e),n.d(e,{default:()=>M});var a=n(2445),o=n(96540),l=n(61574),i=n(71519),d=n(50290),r=n(17437),s=n(74098),c=n(79378),u=n(59744),h=n(74353),m=n.n(h),_=n(58561),p=n.n(_),g=n(94551),f=n(38961),y=n(89232),Y=n(20237),b=n(64457),v=n(86784),D=n(71323),S=n(59674),A=n(52167),w=n(97163),k=n(17355),x=n(64535),C=n(45207),T=n(51692);const H=d.I4.div`
  margin: ${({theme:t})=>2*t.sizeUnit}px auto
    ${({theme:t})=>4*t.sizeUnit}px auto;
`,F=(0,d.I4)(A.iN)`
  /* Border is already applied by AceEditor itself */
`,$=d.I4.div`
  margin-bottom: ${({theme:t})=>5*t.sizeUnit}px;

  .control-label {
    margin-bottom: ${({theme:t})=>2*t.sizeUnit}px;
  }

  .required {
    margin-left: ${({theme:t})=>t.sizeUnit/2}px;
    color: ${({theme:t})=>t.colorError};
  }

  input[type='text'] {
    width: 65%;
  }
`,N=(0,b.Ay)((({addDangerToast:t,addSuccessToast:e,annotationLayerId:n,annotation:l=null,onAnnotationAdd:i,onHide:d,show:r})=>{var c,u;const[h,m]=(0,o.useState)(!0),[_,p]=(0,o.useState)(null),g=null!==l,f=(0,C.p)(null==_?void 0:_.json_metadata,{errorPrefix:"Invalid JSON metadata"}),{state:{loading:y,resource:Y},fetchResource:b,createResource:D,updateResource:A}=(0,v.fn)(`annotation_layer/${n}/annotation`,(0,s.t)("annotation"),t),N=()=>{p({short_descr:"",start_dttm:"",end_dttm:"",json_metadata:"",long_descr:""})},E=()=>{g?p(Y):N(),d()},z=t=>{const{target:e}=t,n={..._,end_dttm:_?_.end_dttm:"",short_descr:_?_.short_descr:"",start_dttm:_?_.start_dttm:""};n[e.name]=e.value,p(n)};return(0,o.useEffect)((()=>{if(g&&(null==_||!_.id||l&&l.id!==_.id||r)){if(null!==(null==l?void 0:l.id)&&!y){const t=l.id||0;b(t)}}else g||_&&!_.id&&!r||N()}),[l]),(0,o.useEffect)((()=>{Y&&p(Y)}),[Y]),(0,o.useEffect)((()=>{var t,e,n;null!=_&&null!=(t=_.short_descr)&&t.length&&null!=_&&null!=(e=_.start_dttm)&&e.length&&null!=_&&null!=(n=_.end_dttm)&&n.length?m(!1):m(!0)}),[_?_.short_descr:"",_?_.start_dttm:"",_?_.end_dttm:""]),(0,a.FD)(w.aF,{disablePrimaryButton:h,onHandledPrimaryAction:()=>{if(g){if(null!=_&&_.id){const t=_.id;delete _.id,delete _.created_by,delete _.changed_by,delete _.changed_on_delta_humanized,delete _.layer,A(t,_).then((t=>{t&&(i&&i(),E(),e((0,s.t)("The annotation has been updated")))}))}}else _&&D(_).then((t=>{t&&(i&&i(),E(),e((0,s.t)("The annotation has been saved")))}))},onHide:E,primaryButtonName:g?(0,s.t)("Save"):(0,s.t)("Add"),show:r,width:"55%",name:g?(0,s.t)("Edit annotation"):(0,s.t)("Add annotation"),title:(0,a.Y)(T.r,{isEditMode:g,title:g?(0,s.t)("Edit annotation"):(0,s.t)("Add annotation")}),children:[(0,a.Y)(H,{children:(0,a.Y)("h4",{children:(0,s.t)("Basic information")})}),(0,a.FD)($,{children:[(0,a.FD)("div",{className:"control-label",children:[(0,s.t)("Name"),(0,a.Y)("span",{className:"required",children:"*"})]}),(0,a.Y)(k.A,{name:"short_descr",onChange:z,type:"text",value:null==_?void 0:_.short_descr})]}),(0,a.FD)($,{children:[(0,a.FD)("div",{className:"control-label",children:[(0,s.t)("date"),(0,a.Y)("span",{className:"required",children:"*"})]}),(0,a.Y)(x.c,{placeholder:[(0,s.t)("Start date"),(0,s.t)("End date")],format:"YYYY-MM-DD HH:mm",onCalendarChange:(t,e)=>{var n;if(null==t||!t[0]||null==t||!t[1]){var a;const t={..._,start_dttm:"",end_dttm:"",short_descr:null!=(a=null==_?void 0:_.short_descr)?a:""};return void p(t)}const o={..._,start_dttm:t[0].format("YYYY-MM-DD HH:mm"),end_dttm:t[1].format("YYYY-MM-DD HH:mm"),short_descr:null!=(n=null==_?void 0:_.short_descr)?n:""};p(o)},showTime:{format:"hh:mm a"},use12Hours:!0,value:null!=_&&null!=(c=_.start_dttm)&&c.length||null!=_&&null!=(u=_.end_dttm)&&u.length?[(0,S.XV)(_.start_dttm),(0,S.XV)(_.end_dttm)]:null})]}),(0,a.Y)(H,{children:(0,a.Y)("h4",{children:(0,s.t)("Additional information")})}),(0,a.FD)($,{children:[(0,a.Y)("div",{className:"control-label",children:(0,s.t)("description")}),(0,a.Y)(k.A.TextArea,{name:"long_descr",value:_?_.long_descr:"",placeholder:(0,s.t)("Description (this can be seen in the list)"),onChange:z})]}),(0,a.FD)($,{children:[(0,a.Y)("div",{className:"control-label",children:(0,s.t)("JSON metadata")}),(0,a.Y)(F,{onChange:t=>{const e={..._,end_dttm:_?_.end_dttm:"",json_metadata:t,short_descr:_?_.short_descr:"",start_dttm:_?_.start_dttm:""};p(e)},value:null!=_&&_.json_metadata?_.json_metadata:"",width:"100%",height:"120px",annotations:f})]})]})}));var E=n(8558),z=n(42566);const B=d.I4.div`
  ${({theme:t})=>r.AH`
    display: flex;
    flex-direction: row;

    a,
    Link {
      margin-left: ${4*t.sizeUnit}px;
      font-size: ${t.fontSizeSM}px;
      font-weight: ${t.fontWeightNormal};
      text-decoration: underline;
    }
  `}
`,M=(0,b.Ay)((function({addDangerToast:t,addSuccessToast:e}){const{annotationLayerId:n}=(0,l.g)(),{state:{loading:d,resourceCount:r,resourceCollection:h,bulkSelectEnabled:_},fetchData:b,refreshData:S,toggleBulkSelect:A}=(0,v.RU)(`annotation_layer/${n}/annotation`,(0,s.t)("annotation"),t,!1),[w,k]=(0,o.useState)(!1),[x,C]=(0,o.useState)(""),[T,H]=(0,o.useState)(null),[F,$]=(0,o.useState)(null),M=t=>{H(t),k(!0)},I=(0,o.useCallback)((async function(){try{const t=await c.A.get({endpoint:`/api/v1/annotation_layer/${n}`});C(t.json.result.name)}catch(e){await(0,u.h4)(e).then((({error:e})=>{t(e.error||e.statusText||e)}))}}),[n]);(0,o.useEffect)((()=>{I()}),[I]);const j=[{id:"short_descr",desc:!0}],O=(0,o.useMemo)((()=>[{accessor:"short_descr",Header:(0,s.t)("Name"),size:"xxl",id:"short_descr"},{accessor:"long_descr",Header:(0,s.t)("Description"),id:"long_descr"},{Cell:({row:{original:{start_dttm:t}}})=>m()(new Date(t)).format("ll"),Header:(0,s.t)("Start"),accessor:"start_dttm",id:"start_dttm"},{Cell:({row:{original:{end_dttm:t}}})=>m()(new Date(t)).format("ll"),Header:(0,s.t)("End"),accessor:"end_dttm",id:"end_dttm"},{Cell:({row:{original:t}})=>{const e=[{label:"edit-action",tooltip:(0,s.t)("Edit annotation"),placement:"bottom",icon:"EditOutlined",onClick:()=>M(t)},{label:"delete-action",tooltip:(0,s.t)("Delete annotation"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>$(t)}];return(0,a.Y)(y.kv,{actions:e})},Header:(0,s.t)("Actions"),id:"actions",disableSortBy:!0}]),[!0,!0]),U=[];U.push({name:(0,s.t)("Bulk select"),onClick:A,buttonStyle:"secondary"}),U.push({icon:(0,a.Y)(E.F.PlusOutlined,{iconSize:"m"}),name:(0,s.t)("Annotation"),buttonStyle:"primary",onClick:()=>{M(null)}});let L=!0;try{(0,l.W6)()}catch(t){L=!1}const P={title:(0,s.t)("No annotation yet"),image:"filter-results.svg",buttonAction:()=>{M(null)},buttonText:(0,a.FD)(a.FK,{children:[(0,a.Y)(E.F.PlusOutlined,{iconSize:"m"}),(0,s.t)("Annotation")]})};return(0,a.FD)(a.FK,{children:[(0,a.Y)(Y.A,{name:(0,a.FD)(B,{children:[(0,a.Y)("span",{children:(0,s.t)("Annotation Layer %s",x)}),(0,a.Y)("span",{children:L?(0,a.Y)(i.N_,{to:"/annotationlayer/list/",children:(0,s.t)("Back to all")}):(0,a.Y)(z.o.Link,{href:"/annotationlayer/list/",children:(0,s.t)("Back to all")})})]}),buttons:U}),(0,a.Y)(N,{addDangerToast:t,addSuccessToast:e,annotation:T,show:w,onAnnotationAdd:()=>S(),annotationLayerId:n,onHide:()=>k(!1)}),F&&(0,a.Y)(g.T,{description:(0,s.t)("Are you sure you want to delete %s?",null==F?void 0:F.short_descr),onConfirm:()=>{F&&(({id:a,short_descr:o})=>{c.A.delete({endpoint:`/api/v1/annotation_layer/${n}/annotation/${a}`}).then((()=>{S(),$(null),e((0,s.t)("Deleted: %s",o))}),(0,D.JF)((e=>t((0,s.t)("There was an issue deleting %s: %s",o,e)))))})(F)},onHide:()=>$(null),open:!0,title:(0,s.t)("Delete Annotation?")}),(0,a.Y)(f.h,{title:(0,s.t)("Please confirm"),description:(0,s.t)("Are you sure you want to delete the selected annotations?"),onConfirm:a=>{c.A.delete({endpoint:`/api/v1/annotation_layer/${n}/annotation/?q=${p().encode(a.map((({id:t})=>t)))}`}).then((({json:t={}})=>{S(),e(t.message)}),(0,D.JF)((e=>t((0,s.t)("There was an issue deleting the selected annotations: %s",e)))))},children:n=>{const o=[{key:"delete",name:(0,s.t)("Delete"),onSelect:n,type:"danger"}];return(0,a.Y)(y.uO,{className:"annotations-list-view",bulkActions:o,bulkSelectEnabled:_,columns:O,count:r,data:h,disableBulkSelect:A,emptyState:P,fetchData:b,addDangerToast:t,addSuccessToast:e,refreshData:S,initialSort:j,loading:d,pageSize:25})}})]})}))}}]);