"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3495],{3495:(e,t,n)=>{n.r(t),n.d(t,{default:()=>$});var r=n(62193),i=n.n(r),a=n(2445),o=n(96540),l=n(50290),s=n(20033),c=n(48929),u=n(90924),d=n(17437),m=n(74098),f=n(95018),g=n(35622),h=n(66854),p=n(38221),v=n.n(p);const D=e=>{const t=(0,o.useRef)(null),n=(0,o.useRef)(null),[r,i]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{let r;const a=t.current,o=n.current;if(a&&o){const t=Array.from(a.children);r=new ResizeObserver(v()((()=>{t.reduce(((e,t)=>{var n,r;return e+(null!=(n=null==(r=t.firstElementChild)?void 0:r.scrollWidth)?n:0)}),0)+e*Math.max(t.length-1,0)>o.clientWidth?i(!0):i(!1)}),500)),r.observe(document.body),t.forEach((e=>{r.observe(e)}))}return()=>{var e;return null==(e=r)?void 0:e.disconnect()}}),[e]),{isOverflowing:r,symbolContainerRef:t,wrapperRef:n}},w=l.I4.div`
  ${({theme:e,metricNameFontSize:t})=>`\n    font-family: ${e.fontFamily};\n    font-weight: ${e.fontWeightNormal};\n    font-size: ${t||2*e.fontSizeSM}px;\n    text-align: center;\n    margin-bottom: ${3*e.sizeUnit}px;\n  `}
`,y=l.I4.div`
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  width: 100%;
  height: 100%;
  overflow: auto;
  padding: 12px;
`,b=l.I4.div`
  ${({theme:e,subheaderFontSize:t})=>`\n    font-weight: ${e.fontWeightLight};\n    display: flex;\n    justify-content: center;\n    font-size: ${String(t)||20}px;\n    flex: 1 1 0px;\n  `}
`,T=l.I4.span`
  ${({theme:e,backgroundColor:t,textColor:n})=>`\n    background-color: ${t};\n    color: ${n};\n    padding: ${e.sizeUnit}px ${2*e.sizeUnit}px;\n    border-radius: ${e.borderRadius}px;\n    margin-right: ${e.sizeUnit}px;\n  `}
`;function $(e){const{height:t,width:n,bigNumber:r,prevNumber:p,valueDifference:v,percentDifferenceFormattedString:$,metricName:x,metricNameFontSize:C,headerFontSize:M,subheaderFontSize:S,comparisonColorEnabled:F,comparisonColorScheme:U,percentDifferenceNumber:N,currentTimeRangeFilter:R,startDateOffset:k,shift:z,subtitle:A,subtitleFontSize:H,dashboardTimeRange:E,showMetricName:I}=e,[Y,G]=(0,o.useState)("");(0,o.useEffect)((()=>{if(R&&(z||k)){if(!i()(z)||k){const e=(0,s.x9)(null!=E?E:R.comparator,R.subject);Promise.resolve(e).then((e=>{var t;const n=null==e||null==(t=e.value)?void 0:t.match(g.Io),[r,i]=null!=n?n:[],a=(0,c.TX)({timeRangeFilter:{...R,comparator:`${r} : ${i}`},shifts:(0,u.A)(z),startDate:k||""});(0,s.x9)(null!=E?E:R.comparator,R.subject,(0,u.A)(a)).then((e=>{const t=(0,u.A)(e.value).flat()[0].split("vs\n");G(t.length>1?t[1].trim():t[0])}))}))}}else G("")}),[R,z,k,E]);const O=(0,l.DP)(),V=5*O.sizeUnit,j=d.AH`
    font-family: ${O.fontFamily};
    display: flex;
    justify-content: center;
    align-items: center;
    height: ${t}px;
    width: ${n}px;
    overflow: auto;
  `,K=d.AH`
    font-size: ${String(M)||60}px;
    font-weight: ${O.fontWeightNormal};
    text-align: center;
    margin-bottom: ${4*O.sizeUnit}px;
  `,W=l.I4.div`
    ${({theme:e})=>`\n    font-family: ${e.fontFamily};\n    font-weight: ${e.fontWeightNormal};\n    text-align: center;\n    margin-top: -10px;\n    margin-bottom: ${4*e.sizeUnit}px;\n  `}
  `,L=d.AH`
    color: ${F&&0!==N?N>0?U===h.m.Green?O.colorSuccess:O.colorError:U===h.m.Red?O.colorSuccess:O.colorError:O.colorTextTertiary};
    margin-left: ${O.sizeUnit}px;
  `,P=O.colorBgContainer,q=O.colorTextTertiary,{backgroundColor:_,textColor:B}=(0,o.useMemo)((()=>{let e=P,t=q;if(F&&0!==N){const n=N>0&&U===h.m.Green||N<0&&U===h.m.Red;e=n?O.colorSuccessBg:O.colorErrorBg,t=n?O.colorSuccessText:O.colorErrorText}return{backgroundColor:e,textColor:t}}),[O,U,F,N]),X=(0,o.useMemo)((()=>[{defaultSymbol:"#",value:p,tooltipText:(0,m.t)("Data for %s",Y||"previous range"),columnKey:"Previous value"},{defaultSymbol:"△",value:v,tooltipText:(0,m.t)("Value difference between the time periods"),columnKey:"Delta"},{defaultSymbol:"%",value:$,tooltipText:(0,m.t)("Percentage difference between the time periods"),columnKey:"Percent change"}].map((t=>{var n;const r=null==(n=e.columnConfig)?void 0:n[t.columnKey];return{...t,symbol:!1===(null==r?void 0:r.displayTypeIcon)?"":t.defaultSymbol,label:(null==r?void 0:r.customColumnName)||t.columnKey}}))),[Y,p,v,$,e.columnConfig]).filter((t=>{var n;return!1!==(null==(n=e.columnConfig)||null==(n=n[t.columnKey])?void 0:n.visible)})),{isOverflowing:Q,symbolContainerRef:Z,wrapperRef:J}=D(V);return(0,a.Y)("div",{css:j,ref:J,children:(0,a.FD)(y,{css:Q&&d.AH`
            width: fit-content;
            margin: auto;
            align-items: flex-start;
            overflow: auto;
          `,children:[I&&x&&(0,a.Y)(w,{metricNameFontSize:C,children:x}),(0,a.FD)("div",{css:K,children:[r,0!==N&&(0,a.Y)("span",{css:L,children:N>0?"↑":"↓"})]}),A&&(0,a.Y)(W,{style:{fontSize:H*t*.4+"px"},children:A}),X.length>0&&(0,a.Y)("div",{css:[d.AH`
                display: flex;
                justify-content: space-around;
                gap: ${V}px;
                min-width: 0;
                flex-shrink: 1;
              `,Q?d.AH`
                    flex-direction: column;
                    align-items: flex-start;
                    width: fit-content;
                  `:d.AH`
                    align-items: center;
                    width: 100%;
                  `],ref:Z,children:X.map(((t,n)=>{var r;return(0,a.Y)(b,{subheaderFontSize:S,children:(0,a.FD)(f.m,{id:"tooltip",placement:"top",title:t.tooltipText,children:[t.symbol&&(0,a.Y)(T,{backgroundColor:n>0?_:P,textColor:n>0?B:q,children:t.symbol}),t.value," ",(null==(r=e.columnConfig)||null==(r=r[t.columnKey])?void 0:r.customColumnName)||""]})},`comparison-symbol-${t.columnKey}`)}))})]})})}},20033:(e,t,n)=>{n.d(t,{wv:()=>u,x9:()=>g});var r=n(62193),i=n.n(r),a=n(58561),o=n.n(a),l=n(90924),s=n(79378),c=n(59744);const u=" : ",d=(e,t)=>`${e}${u}${t}`,m=(e,t)=>e.replace("T00:00:00","")||(t?"-∞":"∞"),f=(e,t="col")=>{const n=e.split(u);return 1===n.length?e:`${m(n[0],!0)} ≤ ${t} < ${m(n[1])}`},g=async(e,t="col",n)=>{let r,a;if(i()(n))r=o().encode_uri(e),a=`/api/v1/time_range/?q=${r}`;else{const t=(0,l.A)(n).map((t=>({timeRange:e,shift:t})));r=o().encode_uri([{timeRange:e},...t]),a=`/api/v1/time_range/?q=${r}`}try{var g;const e=await s.A.get({endpoint:a});if(i()(n)){var h,p;const n=d((null==e||null==(h=e.json)||null==(h=h.result[0])?void 0:h.since)||"",(null==e||null==(p=e.json)||null==(p=p.result[0])?void 0:p.until)||"");return{value:f(n,t)}}const r=null==e||null==(g=e.json)?void 0:g.result.map((e=>d(e.since,e.until)));return{value:r.slice(1).map((e=>((e,t,n="col")=>{const r=e.split(u),i=t.split(u);return`${n}: ${m(r[0],!0)} to ${m(r[1])} vs\n  ${m(i[0],!0)} to ${m(i[1])}`})(r[0],e,t)))}}catch(e){const t=await(0,c.h4)(e);return{error:t.message||t.error||e.statusText}}}},39242:(e,t,n)=>{n.d(t,{t:()=>g});var r=n(20033);const i=String.raw`\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.\d+)?(?:(?:[+-]\d\d:\d\d)|Z)?`,a=String.raw`(?:TODAY|NOW)`,o=String.raw`[+-]?[1-9][0-9]*`,l=String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`,s=RegExp(String.raw`^DATEADD\(DATETIME\("(${i}|${a})"\),\s(${o}),\s(${l})\)$`,"i"),c=RegExp(String.raw`^${i}$|^${a}$`,"i"),u=["now","today"],d=new Date;d.setHours(0,0,0,0);const m=new Date;m.setHours(0,0,0,0);const f={sinceDatetime:d.setDate(d.getDate()-7).toString(),sinceMode:"relative",sinceGrain:"day",sinceGrainValue:-7,untilDatetime:m.toString(),untilMode:"specific",untilGrain:"day",untilGrainValue:7,anchorMode:"now",anchorValue:"now"},g=e=>{const t=e.split(r.wv);if(2===t.length){const[e,n]=t;if(c.test(e)&&c.test(n)){const t=u.includes(e)?e:"specific",r=u.includes(n)?n:"specific";return{customRange:{...f,sinceDatetime:e,untilDatetime:n,sinceMode:t,untilMode:r},matchedFlag:!0}}const r=e.match(s);if(r&&c.test(n)&&e.includes(n)){const[e,t,i]=r.slice(1),a=u.includes(n)?n:"specific";return{customRange:{...f,sinceGrain:i,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilDatetime:e,sinceMode:"relative",untilMode:a},matchedFlag:!0}}const i=n.match(s);if(c.test(e)&&i&&n.includes(e)){const[t,n,r]=[...i.slice(1)],a=u.includes(e)?e:"specific";return{customRange:{...f,untilGrain:r,untilGrainValue:parseInt(n,10),sinceDatetime:t,untilDatetime:t,untilMode:"relative",sinceMode:a},matchedFlag:!0}}if(r&&i){const[e,t,n]=[...r.slice(1)],[a,o,l]=[...i.slice(1)];if(e===a)return{customRange:{...f,sinceGrain:n,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilGrain:l,untilGrainValue:parseInt(o,10),untilDatetime:a,anchorValue:e,sinceMode:"relative",untilMode:"relative",anchorMode:"now"===e?"now":"specific"},matchedFlag:!0}}}return{customRange:f,matchedFlag:!1}}},48929:(e,t,n)=>{n.d(t,{M9:()=>c,TX:()=>u,cy:()=>s});var r=n(62193),i=n.n(r),a=n(90924),o=n(39242);const l=864e5,s=(e,t=!1,n=!1)=>{const r=new Date;if("now"===e||"No filter"===e||""===e)return r;if("today"===e)return r.setHours(0,0,0,0),r;if(n?r.setHours(-r.getTimezoneOffset()/60,0,0,0):r.setHours(0,0,0,0),t&&null!=e&&e.includes("Last"))return r;switch(e){case"Last day":return r.setUTCDate(r.getUTCDate()-1),r;case"Last week":return r.setUTCDate(r.getUTCDate()-7),r;case"Last month":return r.setUTCMonth(r.getUTCMonth()-1),r;case"Last quarter":return r.setUTCMonth(r.getUTCMonth()-3),r;case"Last year":return r.setUTCFullYear(r.getUTCFullYear()-1),r;case"previous calendar week":return t?r.setDate(r.getDate()-r.getDay()+1):r.setDate(r.getDate()-r.getDay()-6),r;case"previous calendar month":return t?r.setDate(1):(r.setDate(1),r.setMonth(r.getMonth()-1)),r;case"previous calendar year":return t?r.setFullYear(r.getFullYear(),0,1):r.setFullYear(r.getFullYear()-1,0,1),r}if(null!=e&&e.includes("ago")){const t=e.split(" "),n=parseInt(t[0],10);switch(t[1]){case"day":case"days":r.setUTCDate(r.getUTCDate()-n);break;case"week":case"weeks":r.setUTCDate(r.getUTCDate()-7*n);break;case"month":case"months":r.setUTCMonth(r.getUTCMonth()-n);break;case"year":case"years":r.setUTCFullYear(r.getUTCFullYear()-n)}return r}const a=null==e?void 0:e.split("-");let o=null;return o=a&&!i()(a)?1===a.length?new Date(Date.UTC(parseInt(a[0],10),0)):2===a.length?new Date(Date.UTC(parseInt(a[0],10),parseInt(a[1],10)-1)):3===a.length?new Date(parseInt(a[0],10),parseInt(a[1],10)-1,parseInt(a[2],10)):new Date(e):new Date(e),o&&!Number.isNaN(o.getTime())?(n?o.setHours(-o.getTimezoneOffset()/60,0,0,0):o.setHours(0,0,0,0),o):null},c=(e,t,n)=>{let r;if(r="now"===e||"today"===e?new Date:new Date(e),!Number.isNaN(r.getTime())){switch(t){case"second":r.setSeconds(r.getSeconds()+n);break;case"minute":r.setMinutes(r.getMinutes()+n);break;case"hour":r.setHours(r.getHours()+n);break;case"day":r.setDate(r.getDate()+n);break;case"week":r.setDate(r.getDate()+7*n);break;case"month":r.setMonth(r.getMonth()+n);break;case"quarter":r.setMonth(r.getMonth()+3*n);break;case"year":r.setFullYear(r.getFullYear()+n)}return r}return null},u=({timeRangeFilter:e,shifts:t,startDate:n,includeFutureOffsets:r=!0})=>{var i,u,d,m;const{customRange:f,matchedFlag:g}=(0,o.t)(null!=(i=null==e?void 0:e.comparator)?i:"");let h=null,p=null;if(g){var v,D;const{sinceDatetime:e,sinceMode:t,sinceGrain:n,sinceGrainValue:r,untilDatetime:i,untilMode:a,untilGrain:o,untilGrainValue:l}={...f};h="relative"!==t?"specific"===t?new Date(e):s(e,!1,!0):c(e,n,r),null==(v=h)||v.setHours(0,0,0,0),p="relative"!==a?"specific"===a?new Date(i):s(i,!1,!0):c(i,o,l),null==(D=p)||D.setHours(0,0,0,0)}const w=null==t?void 0:t.includes("custom"),y=null==t?void 0:t.includes("inherit");let b;var T;w&&(b=g?new Date(new Date(n).setUTCHours(new Date(n).getTimezoneOffset()/60,0,0,0)).getTime():null==(T=s(n))?void 0:T.getTime());const[$,x]=(null!=(u=null==e?void 0:e.comparator)?u:"").split(" : ").map((e=>e.trim())),C=(null==(d=null!=h?h:s($,!1,!1))?void 0:d.getTime())||0,M=(null==(m=null!=p?p:s(x||$,!0,!1))?void 0:m.getTime())||0,S=b&&C&&Math.round((C-b)/l),F=y&&M&&C&&Math.round((M-C)/l),U=(0,a.A)(t).map((e=>{if("custom"===e&&void 0!==S&&!Number.isNaN(S)){if(r&&S<0)return-1*S+" days after";if(S>=0&&C)return`${S} days ago`}if("inherit"===e&&F&&!Number.isNaN(F)){if(r&&F<0)return-1*F+" days after";if(F>0)return`${F} days ago`}return e})).filter((e=>"custom"!==e&&"inherit"!==e));return(0,a.A)(U)}}}]);