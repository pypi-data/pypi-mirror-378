"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8334],{13078:(e,s,t)=>{t.r(s),t.d(s,{default:()=>O});var a=t(2445),i=t(96540),n=t(74098),o=t(79378),r=t(86784),l=t(51692),d=t(64457),u=t(30613),c=t(8558);const m=async e=>o.A.post({endpoint:"/api/v1/security/roles/",jsonPayload:{name:e}}),p=async(e,s)=>o.A.post({endpoint:`/api/v1/security/roles/${e}/permissions`,jsonPayload:{permission_view_menu_ids:s}}),y=async(e,s)=>o.A.put({endpoint:`/api/v1/security/roles/${e}/users`,jsonPayload:{user_ids:s}}),h=async(e,s)=>o.A.put({endpoint:`/api/v1/security/roles/${e}/groups`,jsonPayload:{group_ids:s}}),g=async(e,s)=>o.A.put({endpoint:`/api/v1/security/roles/${e}`,jsonPayload:{name:s}});var v=t(82384),f=t(17355),b=t(2801),S=t(49965),w=t(40220);const D=()=>(0,a.Y)(v.e,{name:"roleName",label:(0,n.t)("Role Name"),rules:[{required:!0,message:(0,n.t)("Role name is required")}],children:(0,a.Y)(f.A,{name:"roleName"})}),Y=({permissions:e})=>(0,a.Y)(v.e,{name:"rolePermissions",label:(0,n.t)("Permissions"),children:(0,a.Y)(b.A,{mode:"multiple",name:"rolePermissions",options:e.map((e=>({label:e.label,value:e.id}))),getPopupContainer:e=>e.closest(".ant-modal-content")})}),T=({addDangerToast:e,loading:s})=>(0,a.Y)(v.e,{name:"roleUsers",label:(0,n.t)("Users"),children:(0,a.Y)(S.A,{name:"roleUsers",mode:"multiple",placeholder:(0,n.t)("Select users"),options:(s,t,a)=>(0,w.cm)(s,t,a,e),loading:s})}),A=({groups:e})=>(0,a.Y)(v.e,{name:"roleGroups",label:(0,n.t)("Groups"),children:(0,a.Y)(b.A,{mode:"multiple",name:"roleGroups",options:e.map((e=>({label:e.name,value:e.id})))})}),_=function({show:e,onHide:s,onSave:t,permissions:i}){const{addDangerToast:o,addSuccessToast:r}=(0,d.Yf)();return(0,a.Y)(u.k,{show:e,onHide:s,name:"Add Role",title:(0,a.Y)(l.r,{title:(0,n.t)("Add Role"),icon:(0,a.Y)(c.F.PlusOutlined,{})}),onSave:t,formSubmitHandler:async e=>{try{var s;const{json:t}=await m(e.roleName);(null==(s=e.rolePermissions)?void 0:s.length)>0&&await p(t.id,e.rolePermissions),r((0,n.t)("The role has been created successfully."))}catch(e){throw o((0,n.t)("There was an error creating the role. Please, try again.")),e}},requiredFields:["roleName"],initialValues:{},children:(0,a.FD)(a.FK,{children:[(0,a.Y)(D,{}),(0,a.Y)(Y,{permissions:i})]})})};var k=t(21325),C=t(50659),P=t(35340);const H={edit:{key:"edit",name:(0,n.t)("Edit Role")},users:{key:"users",name:(0,n.t)("Users")}},F=[{accessor:"first_name",Header:(0,n.t)("First Name"),id:"first_name"},{accessor:"last_name",Header:(0,n.t)("Last Name"),id:"last_name"},{accessor:"username",Header:(0,n.t)("User Name"),id:"username"},{accessor:"email",Header:(0,n.t)("Email"),id:"email"},{accessor:"active",Header:(0,n.t)("Is Active?"),Cell:({value:e})=>e?(0,n.t)("Yes"):(0,n.t)("No"),id:"active"}],E=function({show:e,onHide:s,role:t,onSave:o,permissions:r,groups:m}){const{id:v,name:f,permission_ids:b,user_ids:S,group_ids:w}=t,[_,E]=(0,i.useState)(H.edit.key),{addDangerToast:R,addSuccessToast:N}=(0,d.Yf)(),[j,$]=(0,i.useState)([]),[U,I]=(0,i.useState)(!0),L=(0,i.useRef)(null);(0,i.useEffect)((()=>{if(!S.length)return $([]),void I(!1);const e=[{col:"id",opr:"in",value:S}];(0,P.I)({endpoint:"/api/v1/security/users/",pageSize:100,setData:$,filters:e,setLoadingState:e=>I(e),loadingKey:"roleUsers",addDangerToast:R,errorMessage:(0,n.t)("There was an error loading users."),mapResult:e=>({id:e.id,username:e.username,first_name:e.first_name,last_name:e.last_name,email:e.email})})}),[S]),(0,i.useEffect)((()=>{if(!U&&L.current&&j.length>=0){const e=j.map((e=>({value:e.id,label:e.username})));L.current.setFieldsValue({roleUsers:e})}}),[U,j]);const M={roleName:f,rolePermissions:b,roleUsers:(null==j?void 0:j.map((e=>({value:e.id,label:e.username}))))||[],roleGroups:w};return(0,a.Y)(u.k,{show:e,onHide:s,name:"Edit Role",title:(0,a.Y)(l.r,{title:(0,n.t)("Edit Role"),icon:(0,a.Y)(c.F.EditOutlined,{})}),onSave:o,formSubmitHandler:async e=>{try{var s;const t=(null==(s=e.roleUsers)?void 0:s.map((e=>e.value)))||[];await Promise.all([g(v,e.roleName),p(v,e.rolePermissions),y(v,t),h(v,e.roleGroups)]),N((0,n.t)("The role has been updated successfully."))}catch(e){throw R((0,n.t)("There was an error updating the role. Please, try again.")),e}},initialValues:M,bodyStyle:{height:"400px"},requiredFields:["roleName"],children:e=>(L.current=e,(0,a.FD)(k.Ay,{activeKey:_,onChange:e=>E(e),children:[(0,a.Y)(k.Ay.TabPane,{tab:H.edit.name,forceRender:!0,children:(0,a.FD)(a.FK,{children:[(0,a.Y)(D,{}),(0,a.Y)(Y,{permissions:r}),(0,a.Y)(T,{addDangerToast:R,loading:U}),(0,a.Y)(A,{groups:m})]})},H.edit.key),(0,a.Y)(k.Ay.TabPane,{tab:H.users.name,children:(0,a.Y)(C.Q,{columns:F,data:j,emptyWrapperType:C.V.Small})},H.users.key)]}))})},R=function({role:e,show:s,onHide:t,onSave:i}){const{name:o,permission_ids:r}=e,{addDangerToast:y,addSuccessToast:h}=(0,d.Yf)();return(0,a.Y)(u.k,{show:s,onHide:t,name:(0,n.t)("Duplicate role %(name)s",{name:o}),title:(0,a.Y)(l.r,{title:(0,n.t)("Duplicate role %(name)s",{name:o}),icon:(0,a.Y)(c.F.EditOutlined,{})}),onSave:i,formSubmitHandler:async e=>{try{const{json:s}=await m(e.roleName);r.length>0&&await p(s.id,r),h((0,n.t)("The role has been duplicated successfully."))}catch(e){throw y((0,n.t)("There was an error duplicating the role. Please, try again.")),e}},requiredFields:["roleName"],initialValues:{},children:(0,a.Y)(D,{})})};var N,j=t(20237),$=t(94551),U=t(38961),I=t(89232),L=t(47305),M=t(66124);!function(e){e.ADD="add",e.EDIT="edit",e.DUPLICATE="duplicate"}(N||(N={}));const O=(0,d.Ay)((function({addDangerToast:e,addSuccessToast:s,user:t}){const{state:{loading:l,resourceCount:d,resourceCollection:u,bulkSelectEnabled:m},fetchData:p,refreshData:y,toggleBulkSelect:h}=(0,r.RU)("security/roles/search",(0,n.t)("Role"),e,!1),[g,v]=(0,i.useState)({edit:!1,add:!1,duplicate:!1}),f=e=>v((s=>({...s,[e]:!0}))),b=e=>v((s=>({...s,[e]:!1}))),[S,D]=(0,i.useState)(null),[Y,T]=(0,i.useState)(null),[A,k]=(0,i.useState)([]),[C,H]=(0,i.useState)([]),[F,O]=(0,i.useState)({permissions:!0,groups:!0}),K=(0,i.useMemo)((()=>(0,L.N6)(t)),[t]),z=(0,i.useCallback)((()=>{(0,P.I)({endpoint:"/api/v1/security/permissions-resources/",setData:k,setLoadingState:O,loadingKey:"permissions",addDangerToast:e,errorMessage:"Error while fetching permissions",mapResult:({permission:e,view_menu:s,id:t})=>({label:`${e.name.replace(/_/g," ")} ${s.name.replace(/_/g," ")}`,value:`${e.name}__${s.name}`,id:t})})}),[e]),V=(0,i.useCallback)((()=>{(0,P.I)({endpoint:"/api/v1/security/groups/",setData:H,setLoadingState:O,loadingKey:"groups",addDangerToast:e,errorMessage:(0,n.t)("Error while fetching groups")})}),[e]);(0,i.useEffect)((()=>{z()}),[z]),(0,i.useEffect)((()=>{V()}),[V]);const q=[{id:"name",desc:!0}],G=(0,i.useMemo)((()=>[{accessor:"name",id:"name",Header:(0,n.t)("Name"),size:"xxl",Cell:({row:{original:{name:e}}})=>(0,a.Y)("span",{children:e})},{accessor:"user_ids",id:"user_ids",Header:(0,n.t)("Users"),hidden:!0,Cell:({row:{original:e}})=>e.user_ids.join(", ")},{accessor:"group_ids",id:"group_ids",Header:(0,n.t)("Groups"),hidden:!0,Cell:({row:{original:e}})=>e.groups_ids.join(", ")},{accessor:"permission_ids",id:"permission_ids",Header:(0,n.t)("Permissions"),hidden:!0,Cell:({row:{original:e}})=>e.permission_ids.join(", ")},{Cell:({row:{original:e}})=>{const s=K?[{label:"role-list-edit-action",tooltip:(0,n.t)("Edit role"),placement:"bottom",icon:"EditOutlined",onClick:()=>{D(e),f(N.EDIT)}},{label:"role-list-duplicate-action",tooltip:(0,n.t)("Duplicate role"),placement:"bottom",icon:"CopyOutlined",onClick:()=>{D(e),f(N.DUPLICATE)}},{label:"role-list-delete-action",tooltip:(0,n.t)("Delete role"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>T(e)}]:[];return(0,a.Y)(I.kv,{actions:s})},Header:(0,n.t)("Actions"),id:"actions",disableSortBy:!0,hidden:!K,size:"xl"}]),[K]),x=[];K&&x.push({name:(0,n.t)("Bulk select"),onClick:h,buttonStyle:"secondary"},{icon:(0,a.Y)(c.F.PlusOutlined,{iconSize:"m"}),name:(0,n.t)("Role"),buttonStyle:"primary",onClick:()=>{f(N.ADD)},loading:F.permissions});const W=(0,i.useMemo)((()=>[{Header:(0,n.t)("Name"),key:"name",id:"name",input:"search",operator:I.c0.Contains},{Header:(0,n.t)("Users"),key:"user_ids",id:"user_ids",input:"select",operator:I.c0.RelationOneMany,unfilteredLabel:(0,n.t)("All"),fetchSelects:async(s,t,a)=>(0,w.cm)(s,t,a,e),dropdownStyle:{minWidth:M.f8}},{Header:(0,n.t)("Permissions"),key:"permission_ids",id:"permission_ids",input:"select",operator:I.c0.RelationOneMany,unfilteredLabel:(0,n.t)("All"),selects:null==A?void 0:A.map((e=>({label:e.label,value:e.id}))),loading:F.permissions,dropdownStyle:{minWidth:M.f8}},{Header:(0,n.t)("Groups"),key:"group_ids",id:"group_ids",input:"select",operator:I.c0.RelationOneMany,unfilteredLabel:(0,n.t)("All"),selects:null==C?void 0:C.map((e=>({label:e.name,value:e.id}))),loading:F.groups,dropdownStyle:{minWidth:M.f8}}]),[A,C,F.groups,F.permissions]),B={title:(0,n.t)("No roles yet"),image:"filter-results.svg",...K&&{buttonAction:()=>{f(N.ADD)},buttonText:(0,a.FD)(a.FK,{children:[(0,a.Y)(c.F.PlusOutlined,{iconSize:"m"}),(0,n.t)("Role")]})}};return(0,a.FD)(a.FK,{children:[(0,a.Y)(j.A,{name:(0,n.t)("List Roles"),buttons:x}),(0,a.Y)(_,{onHide:()=>b(N.ADD),show:g.add,onSave:()=>{y(),b(N.ADD)},permissions:A}),g.edit&&S&&(0,a.Y)(E,{role:S,show:g.edit,onHide:()=>b(N.EDIT),onSave:()=>{y(),b(N.EDIT)},permissions:A,groups:C}),g.duplicate&&S&&(0,a.Y)(R,{role:S,show:g.duplicate,onHide:()=>b(N.DUPLICATE),onSave:()=>{y(),b(N.DUPLICATE)}}),Y&&(0,a.Y)($.T,{description:(0,n.t)("This action will permanently delete the role."),onConfirm:()=>{Y&&(async({id:t,name:a})=>{try{await o.A.delete({endpoint:`/api/v1/security/roles/${t}`}),y(),T(null),s((0,n.t)("Deleted role: %s",a))}catch(s){e((0,n.t)("There was an issue deleting %s",a))}})(Y)},onHide:()=>T(null),open:!0,title:(0,n.t)("Delete Role?")}),(0,a.Y)(U.h,{title:(0,n.t)("Please confirm"),description:(0,n.t)("Are you sure you want to delete the selected roles?"),onConfirm:async t=>{const a=[];await Promise.all(t.map((async s=>{try{await o.A.delete({endpoint:`api/v1/security/roles/${s.id}`}),a.push(s.name)}catch(t){e((0,n.t)("Error deleting %s",s.name))}}))),a.length>0&&s((0,n.t)("Deleted roles: %s",a.join(", "))),y()},children:t=>{const i=K?[{key:"delete",name:(0,n.t)("Delete"),onSelect:t,type:"danger"}]:[];return(0,a.Y)(I.uO,{className:"role-list-view",columns:G,count:d,data:u,fetchData:p,filters:W,initialSort:q,loading:l,pageSize:25,bulkActions:i,bulkSelectEnabled:m,disableBulkSelect:h,addDangerToast:e,addSuccessToast:s,emptyState:B,refreshData:y})}})]})}))},30613:(e,s,t)=>{t.d(s,{k:()=>d});var a=t(2445),i=t(96540),n=t(74098),o=t(88217),r=t(65729),l=t(97163);function d({show:e,onHide:s,title:t,onSave:d,children:u,initialValues:c={},formSubmitHandler:m,bodyStyle:p={},requiredFields:y=[],name:h}){const[g]=r.l.useForm(),[v,f]=(0,i.useState)(!1),b=(0,i.useCallback)((()=>{g.resetFields(),f(!1)}),[g]),[S,w]=(0,i.useState)(!0),D=(0,i.useCallback)((()=>{b(),s()}),[s,b]),Y=(0,i.useCallback)((()=>{b(),d()}),[d,b]),T=(0,i.useCallback)((async e=>{try{f(!0),await m(e),Y()}catch(e){console.error(e)}finally{f(!1)}}),[m,Y]),A=()=>{const e=g.getFieldsError().some((({errors:e})=>e.length)),s=g.getFieldsValue(),t=y.some((e=>!s[e]));w(e||t)};return(0,a.Y)(l.aF,{name:h,show:e,title:t,onHide:D,bodyStyle:p,footer:(0,a.FD)(a.FK,{children:[(0,a.Y)(o.$,{buttonStyle:"secondary",onClick:D,children:(0,n.t)("Cancel")}),(0,a.Y)(o.$,{buttonStyle:"primary",htmlType:"submit",onClick:()=>g.submit(),disabled:v||S,children:v?(0,n.t)("Saving..."):(0,n.t)("Save")})]}),children:(0,a.Y)(r.l,{form:g,layout:"vertical",onFinish:T,initialValues:c,onValuesChange:A,onFieldsChange:A,children:"function"==typeof u?u(g):u})})}},35340:(e,s,t)=>{t.d(s,{I:()=>r});var a=t(79378),i=t(74098),n=t(58561),o=t.n(n);const r=async({endpoint:e,pageSize:s=100,setData:t,filters:n,setLoadingState:r,loadingKey:l,addDangerToast:d,errorMessage:u="Error while fetching data",mapResult:c=e=>e})=>{try{const i=async t=>{const i={page_size:s,page:t};n&&(i.filters=n);const r=o().encode(i),l=await a.A.get({endpoint:`${e}?q=${r}`});return{count:l.json.count,results:l.json.result.map(c)}},r=await i(0),l=r.count,d=r.results;if(s>=l)return void t(d);const u=Math.ceil(l/s),m=Array.from({length:u-1},((e,s)=>i(s+1))),p=await Promise.all(m);t([...d,...p.flatMap((e=>e.results))])}catch(e){d((0,i.t)(u))}finally{r((e=>"boolean"!=typeof e&&{...e,[l]:!1}))}}},40220:(e,s,t)=>{t.d(s,{Ni:()=>d,cm:()=>u,vW:()=>l,wj:()=>r});var a=t(79378),i=t(74098),n=t(58561),o=t.n(n);const r=async e=>{await a.A.post({endpoint:"/api/v1/security/groups/",jsonPayload:{...e,users:e.users.map((e=>e.value))}})},l=async(e,s)=>{await a.A.put({endpoint:`/api/v1/security/groups/${e}`,jsonPayload:{...s,users:s.users.map((e=>e.value))}})},d=async e=>a.A.delete({endpoint:`/api/v1/security/groups/${e}`}),u=async(e,s,t,n)=>{const r=o().encode({filter:e,page:s,page_size:t,order_column:"username",order_direction:"asc"});try{var l,d,u;const e=await a.A.get({endpoint:`/api/v1/security/users/?q=${r}`});return{data:((null==(l=e.json)?void 0:l.result)||[]).map((e=>({value:e.id,label:e.username}))),totalCount:null!=(d=null==(u=e.json)?void 0:u.count)?d:0}}catch(e){return n((0,i.t)("There was an error while fetching users")),{data:[],totalCount:0}}}}}]);