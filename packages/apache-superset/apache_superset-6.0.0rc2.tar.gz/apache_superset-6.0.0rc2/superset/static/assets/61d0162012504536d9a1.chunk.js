(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3017],{45854:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>U});var l=a(50014),r=a.n(l),i=a(2445),n=a(50290),o=a(74098),s=a(18749),d=a(79378),c=a(99106),u=a(96540),h=a(58561),p=a.n(h),m=a(61225),b=a(71323),y=a(86784),g=a(51304),f=a(40105),v=a(54569),_=a(5250),S=a(95018),w=a(38961),T=a(92998),C=a(89232),k=a(20237),Y=a(61574),A=a(71519),F=a(24777),x=a(64457),z=a(67314),D=a(8558),H=a(92026),I=a(47068),M=a(57771),E=a(2618),O=a(90886),P=a(79605),B=a(66124);const L=n.I4.div`
  align-items: center;
  display: flex;
  gap: ${({theme:e})=>e.sizeUnit}px;

  a {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 1.2;
  }

  svg {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,N=(0,o.t)('The passwords for the databases below are needed in order to import them together with the charts. Please note that the "Secure Extra" and "Certificate" sections of the database configuration are not present in export files, and should be added manually after the import if they are needed.'),R=(0,o.t)("You are importing one or more charts that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?"),W=(0,s.A)(),$=async(e="",t,a)=>{var l;const i=e?{filters:[{col:"table_name",opr:"sw",value:e}]}:{},n=p().encode({columns:["datasource_name","datasource_id"],keys:["none"],order_column:"table_name",order_direction:"asc",page:t,page_size:a,...i}),{json:o={}}=await d.A.get({endpoint:`/api/v1/dataset/?q=${n}`}),s=null==o||null==(l=o.result)?void 0:l.map((({table_name:e,id:t})=>({label:e,value:t})));return{data:r()(s,"value"),totalCount:null==o?void 0:o.count}},K=n.I4.div`
  color: ${({theme:e})=>e.colorIcon};
`,U=(0,x.Ay)((function(e){const{addDangerToast:t,addSuccessToast:a,user:{userId:l}}=e,n=(0,Y.W6)(),{state:{loading:s,resourceCount:h,resourceCollection:x,bulkSelectEnabled:U},setResourceCollection:q,hasPerm:G,fetchData:j,toggleBulkSelect:V,refreshData:J}=(0,y.RU)("chart",(0,o.t)("chart"),t),X=(0,u.useMemo)((()=>x.map((e=>e.id))),[x]),{roles:Q}=(0,m.d4)((e=>e.user)),Z=(0,O.L)("can_read","Tag",Q),[ee,te]=(0,y.oG)("chart",X,t),{sliceCurrentlyEditing:ae,handleChartUpdated:le,openChartEditModal:re,closeChartEditModal:ie}=(0,y.bR)(q,x),[ne,oe]=(0,u.useState)(!1),[se,de]=(0,u.useState)([]),[ce,ue]=(0,u.useState)(!1),[he,pe]=(0,u.useState)([]),[me,be]=(0,u.useState)([]),[ye,ge]=(0,u.useState)([]),fe=(0,F.SX)(null==l?void 0:l.toString(),null),ve=G("can_write"),_e=G("can_write"),Se=G("can_write"),we=G("can_export"),Te=[{id:"changed_on_delta_humanized",desc:!0}],Ce=e=>{const t=e.map((({id:e})=>e));(0,g.A)("chart",t,(()=>{ue(!1)})),ue(!0)},ke=async(e="",a,l)=>{var i,n;const s=e?{filters:[{col:"dashboard_title",opr:C.c0.StartsWith,value:e}]}:{},c=p().encode({select_columns:["dashboard_title","id"],keys:["none"],order_column:"dashboard_title",order_direction:"asc",page:a,page_size:l,...s}),u=await d.A.get({endpoint:`/api/v1/dashboard/?q=${c}`}).catch((()=>t((0,o.t)("An error occurred while fetching dashboards")))),h=null==u||null==(i=u.json)||null==(i=i.result)?void 0:i.map((({dashboard_title:e,id:t})=>({label:e,value:t})));return{data:r()(h,"value"),totalCount:null==u||null==(n=u.json)?void 0:n.count}},Ye=(0,u.useMemo)((()=>[{Cell:({row:{original:{id:e}}})=>l&&(0,i.Y)(f.$,{itemId:e,saveFaveStar:ee,isStarred:te[e]}),Header:"",id:"id",disableSortBy:!0,size:"xs",hidden:!l},{Cell:({row:{original:{url:e,slice_name:t,certified_by:a,certification_details:l,description:r}}})=>(0,i.FD)(L,{children:[(0,i.FD)(A.N_,{to:e,children:[a&&(0,i.FD)(i.FK,{children:[(0,i.Y)(v.T,{certifiedBy:a,details:l})," "]}),t]}),r&&(0,i.Y)(_.I,{tooltip:r})]}),Header:(0,o.t)("Name"),accessor:"slice_name",id:"slice_name"},{Cell:({row:{original:{viz_type:e}}})=>{var t;return(null==(t=W.get(e))?void 0:t.name)||e},Header:(0,o.t)("Type"),accessor:"viz_type",id:"viz_type"},{Cell:({row:{original:{datasource_name_text:e,datasource_url:t}}})=>{const a=e?e.includes(".")?e.split(".").slice(1).join("."):e:"";return(0,i.Y)(S.m,{title:e,placement:"top",children:(0,i.Y)(C.Kt,{to:t,children:a})})},Header:(0,o.t)("Dataset"),accessor:"datasource_id",disableSortBy:!0,size:"xl",id:"datasource_id"},{Cell:({row:{original:{dashboards:e}}})=>(0,i.Y)(C.oq,{dashboards:e}),Header:(0,o.t)("On dashboards"),accessor:"dashboards",disableSortBy:!0,size:"xl",id:"dashboards"},{Cell:({row:{original:{tags:e=[]}}})=>(0,i.Y)(C.Sk,{tags:e.filter((e=>!e.type||e.type===I.U.Custom||"TagTypes.custom"===e.type)),maxTags:3}),Header:(0,o.t)("Tags"),accessor:"tags",disableSortBy:!0,hidden:!(0,c.G7)(c.TO.TaggingSystem),id:"tags"},{Cell:({row:{original:{owners:e=[]}}})=>(0,i.Y)(C.WM,{users:e}),Header:(0,o.t)("Owners"),accessor:"owners",disableSortBy:!0,size:"xl",id:"owners"},{Cell:({row:{original:{changed_on_delta_humanized:e,changed_by:t}}})=>(0,i.Y)(C.UW,{date:e,user:t}),Header:(0,o.t)("Last modified"),accessor:"last_saved_at",size:"xl",id:"last_saved_at"},{Cell:({row:{original:e}})=>_e||Se||we?(0,i.FD)(K,{className:"actions",children:[Se&&(0,i.Y)(w.h,{title:(0,o.t)("Please confirm"),description:(0,i.FD)(i.FK,{children:[(0,o.t)("Are you sure you want to delete")," ",(0,i.Y)("b",{children:e.slice_name}),"?"]}),onConfirm:()=>(0,b.GP)(e,a,t,J),children:e=>(0,i.Y)(S.m,{id:"delete-action-tooltip",title:(0,o.t)("Delete"),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:e,children:(0,i.Y)(D.F.DeleteOutlined,{iconSize:"l"})})})}),we&&(0,i.Y)(S.m,{id:"export-action-tooltip",title:(0,o.t)("Export"),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>Ce([e]),children:(0,i.Y)(D.F.UploadOutlined,{iconSize:"l"})})}),_e&&(0,i.Y)(S.m,{id:"edit-action-tooltip",title:(0,o.t)("Edit"),placement:"bottom",children:(0,i.Y)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>re(e),children:(0,i.Y)(D.F.EditOutlined,{iconSize:"l"})})})]}):null,Header:(0,o.t)("Actions"),id:"actions",size:"lg",disableSortBy:!0,hidden:!_e&&!Se},{accessor:P.H.ChangedBy,hidden:!0,id:P.H.ChangedBy}]),[l,_e,Se,we,ee,te,J,a,t]),Ae=(0,u.useMemo)((()=>({Header:(0,o.t)("Favorite"),key:"favorite",id:"id",urlDisplay:"favorite",input:"select",operator:C.c0.ChartIsFav,unfilteredLabel:(0,o.t)("Any"),selects:[{label:(0,o.t)("Yes"),value:!0},{label:(0,o.t)("No"),value:!1}]})),[]),Fe=(0,u.useMemo)((()=>[{Header:(0,o.t)("Name"),key:"search",id:"slice_name",input:"search",operator:C.c0.ChartAllText},{Header:(0,o.t)("Type"),key:"viz_type",id:"viz_type",input:"select",operator:C.c0.Equals,unfilteredLabel:(0,o.t)("All"),selects:W.keys().filter((e=>{var t;return(0,H.px)((null==(t=W.get(e))?void 0:t.behaviors)||[])})).map((e=>{var t;return{label:(null==(t=W.get(e))?void 0:t.name)||e,value:e}})).sort(((e,t)=>e.label&&t.label?e.label>t.label?1:e.label<t.label?-1:0:0))},{Header:(0,o.t)("Dataset"),key:"dataset",id:"datasource_id",input:"select",operator:C.c0.Equals,unfilteredLabel:(0,o.t)("All"),fetchSelects:$,paginate:!0,dropdownStyle:{minWidth:B.f8}},...(0,c.G7)(c.TO.TaggingSystem)&&Z?[{Header:(0,o.t)("Tag"),key:"tags",id:"tags",input:"select",operator:C.c0.ChartTagById,unfilteredLabel:(0,o.t)("All"),fetchSelects:M.m}]:[],{Header:(0,o.t)("Owner"),key:"owner",id:"owners",input:"select",operator:C.c0.RelationManyMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:(0,b.u1)("chart","owners",(0,b.JF)((e=>t((0,o.t)("An error occurred while fetching chart owners values: %s",e)))),e.user),paginate:!0,dropdownStyle:{minWidth:B.f8}},{Header:(0,o.t)("Dashboard"),key:"dashboards",id:"dashboards",input:"select",operator:C.c0.RelationManyMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:ke,paginate:!0,dropdownStyle:{minWidth:B.f8}},...l?[Ae]:[],{Header:(0,o.t)("Certified"),key:"certified",id:"id",urlDisplay:"certified",input:"select",operator:C.c0.ChartIsCertified,unfilteredLabel:(0,o.t)("Any"),selects:[{label:(0,o.t)("Yes"),value:!0},{label:(0,o.t)("No"),value:!1}]},{Header:(0,o.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:C.c0.RelationOneMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:(0,b.u1)("chart","changed_by",(0,b.JF)((e=>(0,o.t)("An error occurred while fetching dataset datasource values: %s",e))),e.user),paginate:!0,dropdownStyle:{minWidth:B.f8}}]),[t,Ae,e.user]),xe=[{desc:!1,id:"slice_name",label:(0,o.t)("Alphabetical"),value:"alphabetical"},{desc:!0,id:"changed_on_delta_humanized",label:(0,o.t)("Recently modified"),value:"recently_modified"},{desc:!1,id:"changed_on_delta_humanized",label:(0,o.t)("Least recently modified"),value:"least_recently_modified"}],ze=(0,u.useCallback)((e=>(0,i.Y)(E.A,{chart:e,showThumbnails:fe?fe.thumbnails:(0,c.G7)(c.TO.Thumbnails),hasPerm:G,openChartEditModal:re,bulkSelectEnabled:U,addDangerToast:t,addSuccessToast:a,refreshData:J,userId:l,loading:s,favoriteStatus:te[e.id],saveFavoriteStatus:ee,handleBulkChartExport:Ce})),[t,a,U,te,G,s]),De=[];return ve&&De.push({name:(0,i.Y)(S.m,{id:"import-tooltip",title:(0,o.t)("Import charts"),placement:"bottomRight",children:(0,i.Y)(D.F.DownloadOutlined,{iconSize:"l"})}),buttonStyle:"link",onClick:()=>{oe(!0)}}),(Se||we)&&De.push({name:(0,o.t)("Bulk select"),buttonStyle:"secondary",onClick:V}),ve&&De.push({icon:(0,i.Y)(D.F.PlusOutlined,{iconSize:"m"}),name:(0,o.t)("Chart"),buttonStyle:"primary",onClick:()=>{n.push("/chart/add")}}),(0,i.FD)(i.FK,{children:[(0,i.Y)(k.A,{name:(0,o.t)("Charts"),buttons:De}),ae&&(0,i.Y)(z.A,{onHide:ie,onSave:le,show:!0,slice:ae}),(0,i.Y)(w.h,{title:(0,o.t)("Please confirm"),description:(0,o.t)("Are you sure you want to delete the selected charts?"),onConfirm:function(e){d.A.delete({endpoint:`/api/v1/chart/?q=${p().encode(e.map((({id:e})=>e)))}`}).then((({json:e={}})=>{J(),a(e.message)}),(0,b.JF)((e=>t((0,o.t)("There was an issue deleting the selected charts: %s",e)))))},children:e=>{const l=(0,c.G7)(c.TO.TaggingSystem),r=[];return Se&&r.push({key:"delete",name:(0,o.t)("Delete"),type:"danger",onSelect:e}),we&&r.push({key:"export",name:(0,o.t)("Export"),type:"primary",onSelect:Ce}),(0,i.Y)(C.uO,{bulkActions:r,bulkSelectEnabled:U,cardSortSelectOptions:xe,className:"chart-list-view",columns:Ye,count:h,data:x,disableBulkSelect:V,refreshData:J,fetchData:j,filters:Fe,initialSort:Te,loading:s,pageSize:25,renderCard:ze,enableBulkTag:l,bulkTagResourceName:"chart",addSuccessToast:a,addDangerToast:t,showThumbnails:fe?fe.thumbnails:(0,c.G7)(c.TO.Thumbnails),defaultViewMode:(0,c.G7)(c.TO.ListviewsDefaultCardView)?"card":"table"})}}),(0,i.Y)(C.zb,{resourceName:"chart",resourceLabel:(0,o.t)("chart"),passwordsNeededMessage:N,confirmOverwriteMessage:R,addDangerToast:t,addSuccessToast:a,onModelImport:()=>{oe(!1),J(),a((0,o.t)("Chart imported"))},show:ne,onHide:()=>{oe(!1)},passwordFields:se,setPasswordFields:de,sshTunnelPasswordFields:he,setSSHTunnelPasswordFields:pe,sshTunnelPrivateKeyFields:me,setSSHTunnelPrivateKeyFields:be,sshTunnelPrivateKeyPasswordFields:ye,setSSHTunnelPrivateKeyPasswordFields:ge}),ce&&(0,i.Y)(T.R,{})]})}))},50014:(e,t,a)=>{var l=a(15389),r=a(55765);e.exports=function(e,t){return e&&e.length?r(e,l(t,2)):[]}},92026:(e,t,a)=>{"use strict";a.d(t,{Kg:()=>b,J8:()=>p,Pz:()=>y,tg:()=>u,pY:()=>h,px:()=>m});var l=a(31463),r=a(81115),i=a(74098),n=a(46772);const o=e=>null!=e&&"function"==typeof e[Symbol.iterator];var s=a(29624),d=a(32064);const c=()=>{var e;const t=(0,d.Ay)();return(null==t||null==(e=t.common)||null==(e=e.conf)?void 0:e.NATIVE_FILTER_DEFAULT_ROW_LIMIT)||1e3},u=({datasetId:e,dependencies:t={},groupby:a,defaultDataMask:l,controlValues:r,filterType:i,sortMetric:o,adhoc_filters:s,time_range:d,granularity_sqla:u,type:h,dashboardId:p,id:m})=>{var b;const y={};return e&&(y.datasource=`${e}__table`),a&&(y.groupby=[a]),o&&(y.sortMetric=o),{...r,...y,adhoc_filters:null!=s?s:[],extra_filters:[],extra_form_data:t,granularity_sqla:u,metrics:["count"],row_limit:c(),showSearch:!0,defaultValue:null==l||null==(b=l.filterState)?void 0:b.value,time_range:d,url_params:(0,n.A)("regular"),inView:!0,viz_type:i,type:h,dashboardId:p,native_filter_id:m}};function h(e={},t={}){const a={};return l.t1.forEach((l=>{const r=e[l],i=t[l],n=[...o(r)?r:[],...o(i)?i:[]];n.length&&(a[l]=n)})),l.zk.forEach((l=>{const r=e[l];void 0!==r&&(a[l]=r);const i=t[l];void 0!==i&&(a[l]=i)})),a}function p(e,t){let a={};return t.forEach((t=>{var l,r;a=h(a,null!=(l=null==(r=e[t])?void 0:r.extraFormData)?l:{})})),a}function m(e){return!e.includes(r.nS.NativeFilter)||e.includes(r.nS.InteractiveChart)}const b=(e,t)=>new Set(t.map((t=>{var a;return null==(a=e.find((e=>{var a;return(null==e||null==(a=e.meta)?void 0:a.chartId)===t})))||null==(a=a.parents)?void 0:a.filter((e=>e.startsWith(`${s.B8}-`)))})).filter((e=>void 0!==e)).flat()),y=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,i.t)("Unknown value")}}]);