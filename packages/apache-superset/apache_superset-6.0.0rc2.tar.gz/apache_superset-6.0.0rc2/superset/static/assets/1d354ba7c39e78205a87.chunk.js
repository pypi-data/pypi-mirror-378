"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5306],{43234:(e,t,n)=>{n.r(t),n.d(t,{default:()=>R});var a=n(2445),s=n(96540),o=n(50290),l=n(74098),i=n(79378),r=n(97163),d=n(95018),m=n(56914),c=n(94551),h=n(28392),u=n(94185),p=n(38961),y=n(92998),g=n(58561),f=n.n(g),_=n(86784),b=n(71323),v=n(64457),S=n(31780),w=n(20237),k=n(51304),T=n(32064),A=n(89232),Y=n(17437),C=n(8558),D=n(88217),F=n(65729),O=n(17355),z=n(52167),x=n(45207),M=n(42566);const N=o.I4.div`
  ${({theme:e})=>Y.AH`
    .ace_editor {
      border-radius: ${e.borderRadius}px;
    }
  `}
`,$=o.I4.div`
  ${({theme:e})=>Y.AH`
    --ant-form-item-margin-bottom: ${6*e.sizeUnit}px;

    .system-theme-notice {
      font-size: ${e.fontSizeSM}px;
      font-style: italic;
      margin-bottom: ${4*e.sizeUnit}px;
      display: block;
    }

    .alert-info {
      margin-bottom: ${4*e.sizeUnit}px;
    }

    .apply-button-container {
      margin-top: ${2*e.sizeUnit}px;
      text-align: right;
    }
  `}
`,j=(0,v.Ay)((({addDangerToast:e,addSuccessToast:t,onThemeAdd:n,onThemeApply:i,onHide:m,show:c,theme:h=null,canDevelop:p=!1})=>{const y=(0,o.DP)(),{setTemporaryTheme:g}=(0,S.w)(),[f,b]=(0,s.useState)(!0),[v,w]=(0,s.useState)(null),[k,T]=(0,s.useState)(!0),A=null!==h,j=!0===(null==v?void 0:v.is_system),H=j,E=p,I=(0,x.p)(null==v?void 0:v.json_data,{enabled:!H,errorPrefix:"Invalid JSON syntax"}),{state:{loading:R,resource:J},fetchResource:U,createResource:B,updateResource:P}=(0,_.fn)("theme",(0,l.t)("theme"),e),L=()=>{m(),w(null)},q=()=>{if(A){if(null!=v&&v.id){const e=v.id;delete v.id,delete v.created_by,delete v.changed_by,delete v.changed_on_delta_humanized,P(e,v).then((e=>{e&&(n&&n(),L())}))}}else v&&B(v).then((e=>{e&&(n&&n(),L())}))},K=e=>{if(!e)return!1;try{return JSON.parse(e),!0}catch(e){return!1}};return(0,s.useEffect)((()=>{A&&(null==v||!v.id||h&&(null==h?void 0:h.id)!==v.id||k&&c)?null!=h&&h.id&&!R&&U(h.id):!A&&(!v||v.id||k&&c)&&w({theme_name:"",json_data:JSON.stringify({},null,2)})}),[h,c]),(0,s.useEffect)((()=>{J&&w(J)}),[J]),(0,s.useEffect)((()=>{var e;H?b(!0):null!=v&&v.theme_name.length&&null!=v&&null!=(e=v.json_data)&&e.length&&K(v.json_data)?b(!1):b(!0)}),[v?v.theme_name:"",v?v.json_data:"",H]),k&&c&&T(!1),(0,a.Y)(r.aF,{disablePrimaryButton:H||f,onHandledPrimaryAction:H?void 0:q,onHide:L,primaryButtonName:A?(0,l.t)("Save"):(0,l.t)("Add"),show:c,width:"55%",footer:[(0,a.Y)(D.$,{onClick:L,buttonStyle:"secondary",children:H?(0,l.t)("Close"):(0,l.t)("Cancel")},"cancel"),...H?[]:[(0,a.Y)(D.$,{onClick:q,disabled:f,buttonStyle:"primary",children:A?(0,l.t)("Save"):(0,l.t)("Add")},"save")]],title:(0,a.FD)(M.o.Title,{level:4,children:[A?(0,a.Y)(C.F.EditOutlined,{iconSize:"l",css:Y.AH`
                margin: auto ${2*y.sizeUnit}px auto 0;
              `}):(0,a.Y)(C.F.PlusOutlined,{iconSize:"l",css:Y.AH`
                margin: auto ${2*y.sizeUnit}px auto 0;
              `}),A?H?(0,l.t)("View theme properties"):(0,l.t)("Edit theme properties"):(0,l.t)("Add theme")]}),children:(0,a.Y)($,{children:(0,a.FD)(F.l,{layout:"vertical",children:[j&&(0,a.Y)(M.o.Text,{type:"secondary",className:"system-theme-notice",children:(0,l.t)("System Theme - Read Only")}),(0,a.Y)(F.l.Item,{label:(0,l.t)("Name"),required:!H,children:(0,a.Y)(O.A,{name:"theme_name",onChange:e=>{const{target:t}=e,n={...v,theme_name:v?v.theme_name:"",json_data:v?v.json_data:""};n[t.name]=t.value,w(n)},value:null==v?void 0:v.theme_name,readOnly:H,placeholder:(0,l.t)("Enter theme name")})}),(0,a.FD)(F.l.Item,{label:(0,l.t)("JSON Configuration"),required:!H,children:[(0,a.Y)(u.F,{type:"info",showIcon:!0,closable:!1,className:"alert-info",message:(0,a.FD)("span",{children:[(0,l.t)("Design with")," ",(0,a.Y)("a",{href:"https://ant.design/theme-editor",target:"_blank",rel:"noopener noreferrer",children:(0,l.t)("Ant Design Theme Editor")}),(0,l.t)(", then paste the JSON below. See our")," ",(0,a.Y)("a",{href:"https://superset.apache.org/docs/configuration/theming/",target:"_blank",rel:"noopener noreferrer",children:(0,l.t)("documentation")}),(0,l.t)(" for details.")]})}),(0,a.Y)(N,{children:(0,a.Y)(z.iN,{showLoadingForImport:!0,name:"json_data",value:(null==v?void 0:v.json_data)||"",onChange:e=>{const t={...v,theme_name:v?v.theme_name:"",json_data:e};w(t)},tabSize:2,width:"100%",height:"300px",wrapEnabled:!0,readOnly:H,showGutter:!0,showPrintMargin:!1,annotations:I})}),E&&(0,a.Y)("div",{className:"apply-button-container",children:(0,a.Y)(d.m,{title:(0,l.t)("Set local theme for testing (preview only)"),placement:"top",children:(0,a.Y)(D.$,{icon:(0,a.Y)(C.F.ThunderboltOutlined,{}),onClick:()=>{if(null!=v&&v.json_data&&K(v.json_data))try{const e=JSON.parse(v.json_data);g(e),i&&i(),t&&t((0,l.t)("Local theme set for preview"))}catch(t){e((0,l.t)("Failed to apply theme: Invalid JSON"))}},disabled:!(null!=v&&v.json_data&&K(v.json_data)),buttonStyle:"secondary",children:(0,l.t)("Apply")})})})]})]})})})}));var H=n(79605);const E=o.I4.div`
  align-items: center;
  display: flex;
  gap: ${({theme:e})=>e.sizeUnit}px;

  .ant-tag {
    margin-left: ${({theme:e})=>2*e.sizeUnit}px;
  }
`,I=(0,l.t)("You are importing one or more themes that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?"),R=(0,v.Ay)((function({addDangerToast:e,addSuccessToast:t,user:n}){var o;const{state:{loading:g,resourceCount:v,resourceCollection:Y,bulkSelectEnabled:D},hasPerm:F,fetchData:O,refreshData:z,toggleBulkSelect:x}=(0,_.RU)("theme",(0,l.t)("Themes"),e),{setTemporaryTheme:M,getCurrentCrudThemeId:N}=(0,S.w)(),[$,R]=(0,s.useState)(!1),[J,U]=(0,s.useState)(null),[B,P]=(0,s.useState)(!1),[L,q]=(0,s.useState)(!1),[K,V]=(0,s.useState)(null),W=F("can_write"),G=F("can_write"),Q=F("can_write"),X=F("can_export"),Z=F("can_write"),ee=F("can_write"),te=(0,T.Ay)(),ne=(null==te||null==(o=te.common)?void 0:o.theme)||{},ae=G&&(null==ne?void 0:ne.enableUiThemeAdministration),[se,oe]=(0,s.useState)(null),le=e=>{const t=e.map((({id:e})=>e)).filter((e=>void 0!==e));(0,k.A)("theme",t,(()=>{P(!1)})),P(!0)},ie=n=>{r.aF.confirm({title:n.title,content:n.content,onOk:()=>{n.onConfirm().then((()=>{z(),t(n.successMessage)})).catch((t=>{e((0,l.t)(n.errorMessage,t.message))}))}})},re=[{id:"theme_name",desc:!0}],de=(0,s.useMemo)((()=>[{Cell:({row:{original:e}})=>{var t;const n=N(),s=n&&(null==(t=e.id)?void 0:t.toString())===n||K&&e.id===K;return(0,a.FD)(E,{children:[e.theme_name,s&&(0,a.Y)(d.m,{title:(0,l.t)("This theme is set locally for your session"),children:(0,a.Y)(m.A,{color:"success",children:(0,l.t)("Local")})}),e.is_system&&(0,a.Y)(d.m,{title:(0,l.t)("Defined through system configuration."),children:(0,a.Y)(m.A,{color:"processing",children:(0,l.t)("System")})}),e.is_system_default&&(0,a.Y)(d.m,{title:(0,l.t)("This is the system default theme"),children:(0,a.FD)(m.A,{color:"warning",children:[(0,a.Y)(C.F.SunOutlined,{})," ",(0,l.t)("Default")]})}),e.is_system_dark&&(0,a.Y)(d.m,{title:(0,l.t)("This is the system dark theme"),children:(0,a.FD)(m.A,{color:"default",children:[(0,a.Y)(C.F.MoonOutlined,{})," ",(0,l.t)("Dark")]})})]})},Header:(0,l.t)("Name"),accessor:"theme_name",id:"theme_name"},{Cell:({row:{original:{changed_on_delta_humanized:e,changed_by:t}}})=>(0,a.Y)(A.UW,{date:e,user:t}),Header:(0,l.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl",disableSortBy:!0,id:"changed_on_delta_humanized"},{Cell:({row:{original:n}})=>{const s=[ee?{label:"apply-action",tooltip:(0,l.t)("Set local theme. Will be applied to your session until unset."),placement:"bottom",icon:"ThunderboltOutlined",onClick:()=>function(n){if(n.json_data)try{const e=JSON.parse(n.json_data);M(e),V(n.id||null),t((0,l.t)('Local theme set to "%s"',n.theme_name))}catch(t){e((0,l.t)("Failed to set local theme: Invalid JSON configuration"))}}(n)}:null,G?{label:"edit-action",tooltip:n.is_system?(0,l.t)("View theme"):(0,l.t)("Edit theme"),placement:"bottom",icon:n.is_system?"EyeOutlined":"EditOutlined",onClick:()=>(U(n),void R(!0))}:null,X?{label:"export-action",tooltip:(0,l.t)("Export theme"),placement:"bottom",icon:"UploadOutlined",onClick:()=>le([n])}:null,ae&&!n.is_system_default?{label:"set-default-action",tooltip:(0,l.t)("Set as system default theme"),placement:"bottom",icon:"SunOutlined",onClick:()=>{return e=n,void ie({title:(0,l.t)("Set System Default Theme"),content:(0,l.t)('Are you sure you want to set "%s" as the system default theme? This will apply to all users who haven\'t set a personal preference.',e.theme_name),onConfirm:()=>{return t=e.id,i.A.put({endpoint:`/api/v1/theme/${t}/set_system_default`});var t},successMessage:(0,l.t)('"%s" is now the system default theme',e.theme_name),errorMessage:"Failed to set system default theme: %s"});var e}}:null,ae&&n.is_system_default?{label:"unset-default-action",tooltip:(0,l.t)("Remove as system default theme"),placement:"bottom",icon:"StopOutlined",onClick:()=>{ie({title:(0,l.t)("Remove System Default Theme"),content:(0,l.t)("Are you sure you want to remove the system default theme? The application will fall back to the configuration file default."),onConfirm:()=>i.A.delete({endpoint:"/api/v1/theme/unset_system_default"}),successMessage:(0,l.t)("System default theme removed"),errorMessage:"Failed to remove system default theme: %s"})}}:null,ae&&!n.is_system_dark?{label:"set-dark-action",tooltip:(0,l.t)("Set as system dark theme"),placement:"bottom",icon:"MoonOutlined",onClick:()=>{return e=n,void ie({title:(0,l.t)("Set System Dark Theme"),content:(0,l.t)('Are you sure you want to set "%s" as the system dark theme? This will apply to all users who haven\'t set a personal preference.',e.theme_name),onConfirm:()=>{return t=e.id,i.A.put({endpoint:`/api/v1/theme/${t}/set_system_dark`});var t},successMessage:(0,l.t)('"%s" is now the system dark theme',e.theme_name),errorMessage:"Failed to set system dark theme: %s"});var e}}:null,ae&&n.is_system_dark?{label:"unset-dark-action",tooltip:(0,l.t)("Remove as system dark theme"),placement:"bottom",icon:"StopOutlined",onClick:()=>{ie({title:(0,l.t)("Remove System Dark Theme"),content:(0,l.t)("Are you sure you want to remove the system dark theme? The application will fall back to the configuration file dark theme."),onConfirm:()=>i.A.delete({endpoint:"/api/v1/theme/unset_system_dark"}),successMessage:(0,l.t)("System dark theme removed"),errorMessage:"Failed to remove system dark theme: %s"})}}:null,Q&&!n.is_system?{label:"delete-action",tooltip:(0,l.t)("Delete theme"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>{n.is_system_default||n.is_system_dark?e((0,l.t)("Cannot delete theme that is set as system default or dark theme")):oe(n)}}:null].filter((e=>!!e));return(0,a.Y)(A.kv,{actions:s})},Header:(0,l.t)("Actions"),id:"actions",disableSortBy:!0,hidden:!(G||Q||ee||X),size:"xl"},{accessor:H.H.ChangedBy,hidden:!0,id:H.H.ChangedBy}]),[Q,W,ee,X,ae,K]),me={name:(0,l.t)("Themes")},ce=[];Z&&ce.push({name:(0,a.Y)(d.m,{id:"import-tooltip",title:(0,l.t)("Import themes"),placement:"bottomRight",children:(0,a.Y)(C.F.DownloadOutlined,{iconSize:"l"})}),buttonStyle:"link",onClick:()=>{q(!0)}}),(Q||X)&&ce.push({name:(0,l.t)("Bulk select"),onClick:x,buttonStyle:"secondary"}),W&&ce.push({name:(0,a.Y)(a.FK,{children:(0,l.t)("Theme")}),buttonStyle:"primary",icon:(0,a.Y)(C.F.PlusOutlined,{iconSize:"m"}),onClick:()=>{U(null),R(!0)}}),me.buttons=ce;const he=(0,s.useMemo)((()=>[{Header:(0,l.t)("Name"),key:"search",id:"theme_name",input:"search",operator:A.c0.Contains},{Header:(0,l.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:A.c0.RelationOneMany,unfilteredLabel:(0,l.t)("All"),fetchSelects:(0,b.u1)("theme","changed_by",(0,b.JF)((e=>(0,l.t)("An error occurred while fetching theme datasource values: %s",e))),n),paginate:!0}]),[]);return(0,a.FD)(a.FK,{children:[(0,a.Y)(w.A,{...me}),(0,a.Y)(j,{addDangerToast:e,theme:J,onThemeAdd:()=>z(),onThemeApply:function(){V(null)},onHide:()=>R(!1),show:$,canDevelop:G}),(0,a.Y)(A.zb,{resourceName:"theme",resourceLabel:(0,l.t)("theme"),passwordsNeededMessage:"",confirmOverwriteMessage:I,addDangerToast:e,addSuccessToast:t,onModelImport:()=>{q(!1),z(),t((0,l.t)("Theme imported"))},show:L,onHide:()=>{q(!1)}}),se&&(0,a.Y)(c.T,{description:(0,a.FD)(h.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,a.Y)("div",{children:(0,l.t)("This action will permanently delete the theme.")}),(0,a.Y)(u.F,{type:"warning",showIcon:!0,closable:!1,message:(0,l.t)("Any dashboards using this theme will be automatically dissociated from it.")})]}),onConfirm:()=>{se&&(({id:n,theme_name:a})=>{i.A.delete({endpoint:`/api/v1/theme/${n}`}).then((()=>{z(),oe(null),t((0,l.t)("Deleted: %s",a))}),(0,b.JF)((t=>e((0,l.t)("There was an issue deleting %s: %s",a,t)))))})(se)},onHide:()=>oe(null),open:!0,title:(0,l.t)("Delete Theme?")}),(0,a.Y)(p.h,{title:(0,l.t)("Please confirm"),description:(0,a.FD)(h.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,a.Y)("div",{children:(0,l.t)("Are you sure you want to delete the selected themes?")}),(0,a.Y)(u.F,{type:"warning",showIcon:!0,closable:!1,message:(0,l.t)("Any dashboards using these themes will be automatically dissociated from them.")})]}),onConfirm:n=>{const a=n.filter((e=>!e.is_system&&!e.is_system_default&&!e.is_system_dark));0!==a.length?(a.length!==n.length&&e((0,l.t)("Skipped %d system themes that cannot be deleted",n.length-a.length)),i.A.delete({endpoint:`/api/v1/theme/?q=${f().encode(a.map((({id:e})=>e)))}`}).then((({json:e={}})=>{z(),t(e.message)}),(0,b.JF)((t=>e((0,l.t)("There was an issue deleting the selected themes: %s",t)))))):e((0,l.t)("Cannot delete system themes"))},children:n=>{const s=[];return Q&&s.push({key:"delete",name:(0,l.t)("Delete"),onSelect:n,type:"danger"}),X&&s.push({key:"export",name:(0,l.t)("Export"),type:"primary",onSelect:le}),(0,a.Y)(A.uO,{className:"themes-list-view",columns:de,count:v,data:Y,fetchData:O,filters:he,initialSort:re,loading:g,pageSize:25,bulkActions:s,bulkSelectEnabled:D,disableBulkSelect:x,addDangerToast:e,addSuccessToast:t,refreshData:z})}}),B&&(0,a.Y)(y.R,{})]})}))}}]);