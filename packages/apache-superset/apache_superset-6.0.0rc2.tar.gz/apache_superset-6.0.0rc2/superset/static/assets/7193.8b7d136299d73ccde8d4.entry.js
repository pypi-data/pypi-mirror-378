"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[7193],{1155:(e,t,o)=>{o.d(t,{j:()=>r});var a=o(65432);const r=(e,t)=>{const{bins:o,column:r,cumulative:n,groupby:i=[],normalize:l}=e,s=Number.isNaN(Number(o))?5:Number(o);return{operation:"histogram",options:{column:(0,a.A)(r),groupby:i.map(a.A),bins:s,cumulative:n,normalize:l}}}},8198:(e,t,o)=>{o.d(t,{w:()=>a});const a="__"},9753:(e,t,o)=>{o.d(t,{F:()=>i});var a=o(90924),r=o(34142),n=o(8198);const i=(e,t)=>{const o=(0,a.A)(t.metrics),i=(0,a.A)(e.time_compare),l=o.map(r.A),s=new Map;return l.forEach((e=>{i.forEach((t=>{s.set([e,t].join(n.w),e)}))})),s}},9797:(e,t,o)=>{o.d(t,{N:()=>u});var a=o(62193),r=o.n(a),n=o(89297),i=o(90924),l=o(34142),s=o(74842),c=o(34161);const u=e=>{const t=[(0,n.yj)(e),...(0,i.A)(e.metrics).map(l.A),...(0,c.d)(e).map(l.A)].filter(Boolean);if((0,s.A)(null==e?void 0:e.x_axis_sort)&&(0,s.A)(null==e?void 0:e.x_axis_sort_asc)&&t.includes(e.x_axis_sort)&&r()(e.groupby))return e.x_axis_sort===(0,n.yj)(e)?{operation:"sort",options:{is_sort_index:!0,ascending:e.x_axis_sort_asc}}:{operation:"sort",options:{by:e.x_axis_sort,ascending:e.x_axis_sort_asc}}}},17942:(e,t,o)=>{o.d(t,{A:()=>r});var a=o(74098);function r(e){return!(!e||!Number.isNaN(Number(e)))&&(0,a.t)("is expected to be a number")}},21279:(e,t,o)=>{o.d(t,{R:()=>n});var a=o(90924),r=o(1086);function n(e,t,o){return(0,r.TI)(t)?(0,a.A)(t.columns).some((t=>void 0!==t.type_generic&&o.includes(t.type_generic)&&e===t.column_name)):!!(0,r.kj)(t)&&(0,a.A)(t.columns).filter((e=>void 0!==e.type_generic&&o.includes(e.type_generic))).map((e=>e.column_name)).some((t=>e===t))}},28175:(e,t,o)=>{o.d(t,{T:()=>a});const a=(e,t,o)=>({operation:"rank",options:o})},30256:(e,t,o)=>{function a(e,t){const o=parseInt(String(e),10),a=void 0===t?NaN:t;return Number.isNaN(o)?a:o}o.d(t,{A:()=>a})},32557:(e,t,o)=>{o.d(t,{L:()=>s});var a=o(90924),r=o(34142),n=o(89297),i=o(65432),l=o(34161);const s=(e,t)=>{const o=[...(0,a.A)(t.metrics),...(0,l.d)(e)].map(r.A),s=(0,n.yj)(e),c=t.series_columns||t.columns;if(s&&o.length)return{operation:"pivot",options:{index:[s],columns:(0,a.A)(c).map(i.A),aggregates:Object.fromEntries(o.map((e=>[e,{operator:"mean"}]))),drop_missing_columns:!(null!=e&&e.show_empty_columns)}}}},32769:(e,t,o)=>{o.d(t,{EG:()=>s,LI:()=>i,Lj:()=>c,UL:()=>l});var a=o(41811),r=o(73308),n=o(1086);const i=(e,t=0)=>Number(`${Math.round(Number(`${e}e+${t}`))}e-${t}`),l=(e,t,o,a=.05,r=1)=>o===t?r:Math.min(r,i(Math.abs((r-a)/(o-t)*(e-t))+a,2)),s=({operator:e,targetValue:t,targetValueLeft:o,targetValueRight:a,colorScheme:i},s,c)=>{let u,d=.05;if(void 0===e||void 0===i)return()=>{};if(n.ro.includes(e)&&(void 0===o||void 0===a))return()=>{};if(e!==n.fH.None&&!n.ro.includes(e)&&void 0===t)return()=>{};switch(e){case n.fH.None:d=0,u=(e,t)=>{const o=Math.min(...t),a=Math.max(...t);return e>=o&&e<=a&&{cutoffValue:o,extremeValue:a}};break;case n.fH.GreaterThan:u=(e,o)=>e>t&&{cutoffValue:t,extremeValue:Math.max(...o)};break;case n.fH.LessThan:u=(e,o)=>e<t&&{cutoffValue:t,extremeValue:Math.min(...o)};break;case n.fH.GreaterOrEqual:u=(e,o)=>e>=t&&{cutoffValue:t,extremeValue:Math.max(...o)};break;case n.fH.LessOrEqual:u=(e,o)=>e<=t&&{cutoffValue:t,extremeValue:Math.min(...o)};break;case n.fH.Equal:u=e=>e===t&&{cutoffValue:t,extremeValue:t};break;case n.fH.NotEqual:u=(e,o)=>{if(e===t)return!1;const a=Math.max(...o),r=Math.min(...o);return{cutoffValue:t,extremeValue:Math.abs(t-r)>Math.abs(a-t)?r:a}};break;case n.fH.Between:u=e=>e>o&&e<a&&{cutoffValue:o,extremeValue:a};break;case n.fH.BetweenOrEqual:u=e=>e>=o&&e<=a&&{cutoffValue:o,extremeValue:a};break;case n.fH.BetweenOrLeftEqual:u=e=>e>=o&&e<a&&{cutoffValue:o,extremeValue:a};break;case n.fH.BetweenOrRightEqual:u=e=>e>o&&e<=a&&{cutoffValue:o,extremeValue:a};break;default:u=()=>!1}return e=>{const t=u(e,s);if(!1===t)return;const{cutoffValue:o,extremeValue:a}=t;return void 0===c||c?(0,r.o3)(i,l(e,o,a,d,1)):i}},c=(0,a.A)(((e,t,o)=>{var a;return null!=(a=null==e?void 0:e.reduce(((e,a)=>(void 0!==(null==a?void 0:a.column)&&((null==a?void 0:a.operator)===n.fH.None||void 0!==(null==a?void 0:a.operator)&&(n.ro.includes(null==a?void 0:a.operator)?void 0!==(null==a?void 0:a.targetValueLeft)&&void 0!==(null==a?void 0:a.targetValueRight):void 0!==(null==a?void 0:a.targetValue)))&&e.push({column:null==a?void 0:a.column,getColorFromValue:s(a,t.map((e=>e[a.column])),o)}),e)),[]))?a:[]}))},34161:(e,t,o)=>{o.d(t,{d:()=>n});var a=o(90924),r=o(34142);function n(e){const{groupby:t,timeseries_limit_metric:o,x_axis_sort:n,metrics:i}=e,l=[],s=(0,a.A)(o)[0];return(t||[]).length||!s||(0,r.A)(s)!==n||null!=i&&i.some((e=>(0,r.A)(e)===n))||l.push(s),l}},34443:(e,t,o)=>{o.d(t,{p:()=>r});var a=o(89297);const r=(e,t)=>{const o=(0,a.yj)(e);if(e.forecastEnabled&&o)return{operation:"prophet",options:{time_grain:e.time_grain_sqla,periods:parseInt(e.forecastPeriods,10),confidence_interval:parseFloat(e.forecastInterval),yearly_seasonality:e.forecastSeasonalityYearly,weekly_seasonality:e.forecastSeasonalityWeekly,daily_seasonality:e.forecastSeasonalityDaily,index:o}}}},37523:(e,t,o)=>{o.d(t,{Z:()=>u});var a=o(90924),r=o(89297),n=o(99578),i=o(34142),l=o(51979),s=o(9753),c=o(8198);const u=(e,t)=>{const o=(0,a.A)(t.metrics),u=(0,a.A)(t.series_columns||t.columns),d=(0,a.A)(e.time_compare),{truncate_metric:m}=e,p=(0,r.yj)(e),f=(0,l.f)(e,t);if(o.length>0&&p&&(f||(u.length>0||d.length>1)&&void 0!==m&&m)){const r=[];if(f){const i=(0,s.F)(e,t),l=(0,a.A)(e.time_compare);[...i.entries()].forEach((([t,a])=>{const i=l.find((e=>t.includes(e)));r.push([e.comparison_type===n.g1.Values?t:[e.comparison_type,a,t].join(c.w),o.length>1?`${a}, ${i}`:i])}))}if([n.g1.Difference,n.g1.Percentage,n.g1.Ratio].includes(e.comparison_type)||1!==o.length||0!==r.length||r.push([(0,i.A)(o[0]),null]),0===r.length)return;return{operation:"rename",options:{columns:Object.fromEntries(r),level:0,inplace:!0}}}}},47599:(e,t,o)=>{o.d(t,{j:()=>l});var a=o(90924),r=o(65432),n=o(34142);const i=/(\d+)\/(\d+) percentiles/,l=(e,t)=>{const{groupby:o,whiskerOptions:l}=e;if(l){let e,s;const c=i.exec(l);if("Tukey"!==l&&l)if("Min/max (no outliers)"===l)e="min/max";else{if(!c)throw new Error(`Unsupported whisker type: ${l}`);e="percentile",s=[parseInt(c[1],10),parseInt(c[2],10)]}else e="tukey";return{operation:"boxplot",options:{whisker_type:e,percentiles:s,groupby:(0,a.A)(o).map(r.A),metrics:(0,a.A)(t.metrics).map(n.A)}}}}},51157:(e,t,o)=>{o.d(t,{v:()=>s});var a=o(89297),r=o(90924),n=o(65432),i=o(9753),l=o(51979);const s=(e,t)=>{const o=(0,i.F)(e,t),s=(0,a.yj)(e),c=t.series_columns||t.columns;if((0,l.f)(e,t)&&s){const t=Object.fromEntries([...o.values(),...o.keys()].map((e=>[e,{operator:"mean"}])));return{operation:"pivot",options:{index:[s],columns:(0,r.A)(c).map(n.A),drop_missing_columns:!(null!=e&&e.show_empty_columns),aggregates:t}}}}},51979:(e,t,o)=>{o.d(t,{f:()=>n});var a=o(99578),r=o(9753);const n=(e,t)=>{const o=e.comparison_type,n=(0,r.F)(e,t);return Object.values(a.g1).includes(o)&&n.size>0}},54834:(e,t,o)=>{o.d(t,{M:()=>a});const a=(e,t)=>{const o="zerofill"===e.resample_method,a=o?"asfreq":e.resample_method,r=e.resample_rule;if(a&&r)return{operation:"resample",options:{method:a,rule:r,fill_value:o?0:null}}}},60919:(e,t,o)=>{o.d(t,{P:()=>a});const a=(e,t)=>({operation:"flatten"})},64076:(e,t,o)=>{o.d(t,{q:()=>s});var a=o(90924),r=o(99578),n=o(30256),i=o(51979),l=o(9753);const s=(e,t)=>{let o;if((0,i.f)(e,t)){const a=(0,l.F)(e,t);o=[...Array.from(a.values()),...Array.from(a.keys())]}else o=(0,a.A)(t.metrics).map((e=>"string"==typeof e?e:e.label));const s=Object.fromEntries(o.map((e=>[e,e])));return e.rolling_type===r.AA.Cumsum?{operation:"cum",options:{operator:"sum",columns:s}}:[r.AA.Sum,r.AA.Mean,r.AA.Std].includes(e.rolling_type)?{operation:"rolling",options:{rolling_type:e.rolling_type,window:(0,n.A)(e.rolling_periods,1),min_periods:(0,n.A)(e.min_periods,0),columns:s}}:void 0}},66925:(e,t,o)=>{o.d(t,{$5:()=>n,TX:()=>a,z1:()=>r});const a=(e,t)=>t.find((t=>e.name.includes(`${t},`)||e.name.includes(`__${t}`))),r=(e,t)=>"string"==typeof e.name&&!!a(e,t),n=(e,t)=>{let o=e;return t.forEach((e=>{o=o.replace(`${e},`,""),o=o.replace(`__${e}`,"")})),o.trim()}},69121:(e,t,o)=>{o.d(t,{t:()=>i});var a=o(99578),r=o(9753),n=o(51979);const i=(e,t)=>{const o=e.comparison_type,i=(0,r.F)(e,t);if((0,n.f)(e,t)&&o!==a.g1.Values)return{operation:"compare",options:{source_columns:Array.from(i.values()),compare_columns:Array.from(i.keys()),compare_type:o,drop_original_columns:!0}}}},72562:(e,t,o)=>{o.d(t,{D:()=>n});var a=o(90924),r=o(34142);const n=(e,t)=>{const{aggregation:o="LAST_VALUE"}=e;if("LAST_VALUE"===o||"raw"===o)return;const n=(0,a.A)(t.metrics);if(0===n.length)return;const i={};return n.forEach((e=>{const t=(0,r.A)(e);i[t]={operator:o,column:t}})),{operation:"aggregate",options:{groupby:[],aggregates:i}}}},77193:(e,t,o)=>{o.r(t),o.d(t,{COLUMN_NAME_ALIASES:()=>M.Uz,ColumnOption:()=>ue.K,ColumnTypeLabel:()=>de.P,Comparator:()=>be.fH,ControlHeader:()=>_e.V,ControlSubSectionHeader:()=>d.y,D3_FORMAT_DOCS:()=>I.YH,D3_FORMAT_OPTIONS:()=>I.Bb,D3_NUMBER_FORMAT_DESCRIPTION_PERCENTAGE_TEXT:()=>I.Q_,D3_NUMBER_FORMAT_DESCRIPTION_VALUES_TEXT:()=>I.s1,D3_TIME_FORMAT_DOCS:()=>I.gb,D3_TIME_FORMAT_OPTIONS:()=>I.lR,DATASET_TIME_COLUMN_OPTION:()=>M.CE,DEFAULT_DATE_PATTERN:()=>M.Io,DEFAULT_MAX_ROW:()=>M.sH,DEFAULT_MAX_ROW_TABLE_SERVER:()=>M.Vt,DEFAULT_NUMBER_FORMAT:()=>I.KY,DEFAULT_SORT_SERIES_DATA:()=>M.Kd,DEFAULT_TIME_FORMAT:()=>I.EN,DEFAULT_XAXIS_SORT_SERIES_DATA:()=>M.ov,Dropdown:()=>me.ms,INVALID_DATE:()=>M.FE,Menu:()=>pe.W1,MetricOption:()=>fe.S,MultipleValueComparators:()=>be.ro,QUERY_TIME_COLUMN_OPTION:()=>M.aO,QueryModeLabel:()=>M.cA,SORT_SERIES_CHOICES:()=>M.Ow,SortSeriesType:()=>be.Mb,TIME_COMPARISON_SEPARATOR:()=>ce.w,TIME_FILTER_LABELS:()=>M.Fp,TestDataset:()=>Ce,aggregationChoices:()=>x.j_,aggregationControl:()=>x.WN,aggregationOperator:()=>W.D,boxplotOperator:()=>te.j,checkColumnType:()=>F.R,columnChoices:()=>P.A,columnsByType:()=>P.t,contributionModeControl:()=>x.pC,contributionOperator:()=>J.X,datePickerInAdhocFilterMixin:()=>he.Ck,defineSavedMetrics:()=>H._,displayTimeRelatedControls:()=>m.z,dndAdhocFilterControl:()=>ve.zz,dndAdhocMetricControl:()=>ve.jc,dndAdhocMetricControl2:()=>ve.xX,dndAdhocMetricsControl:()=>ve.em,dndColumnsControl:()=>ve.XL,dndEntityControl:()=>ve.ht,dndGranularitySqlaControl:()=>ve.H7,dndGroupByControl:()=>ve.Eg,dndSecondaryMetricControl:()=>ve.I2,dndSeriesControl:()=>ve.HF,dndSizeControl:()=>ve.X5,dndSortByControl:()=>ve.fj,dndTooltipColumnsControl:()=>ve.Y9,dndTooltipMetricsControl:()=>ve.gG,dndXAxisControl:()=>ve.z,dndXControl:()=>ve.A7,dndYControl:()=>ve.R2,expandControlConfig:()=>N.s,expandControlType:()=>N.$,extractExtraMetrics:()=>le.d,flattenOperator:()=>oe.P,formatSelectOptions:()=>p.u,formatSelectOptionsForRange:()=>p.i,getColorControlsProps:()=>U.c,getColorFormatters:()=>D.Lj,getColorFunction:()=>D.EG,getMetricOffsetsMap:()=>re.F,getOpacity:()=>D.UL,getOriginalSeries:()=>se.$5,getStandardizedControls:()=>j.a,getTemporalColumns:()=>q.W,getTimeOffset:()=>se.TX,hasTimeOffset:()=>se.z1,histogramOperator:()=>G.j,isColumnMeta:()=>be.wS,isControlPanelSectionConfig:()=>be.lW,isCustomControlItem:()=>be.M5,isDataset:()=>be.TI,isDerivedSeries:()=>ie.$,isPercentMetric:()=>B.Cn,isQueryResponse:()=>be.kj,isRegularMetric:()=>B.je,isSavedExpression:()=>be.oU,isStandardizedFormData:()=>be.Wk,isTemporalColumn:()=>q.D,isTimeComparison:()=>ne.f,mainMetric:()=>V,pivotOperator:()=>Q.L,prophetOperator:()=>ee.p,rankOperator:()=>ae.T,renameOperator:()=>Z.Z,resampleOperator:()=>K.M,rollingWindowOperator:()=>z.q,round:()=>D.LI,sections:()=>xe,sharedControlComponents:()=>ye.A,sharedControls:()=>ge.A,shouldSkipMetricColumn:()=>B.Du,sortOperator:()=>$.N,temporalColumnMixin:()=>he.eX,timeCompareOperator:()=>Y.t,timeComparePivotOperator:()=>X.v,xAxisForceCategoricalControl:()=>x.K6,xAxisMixin:()=>he.BT,xAxisSortAscControl:()=>x.MR,xAxisSortControl:()=>x.$G});var a={};o.r(a),o.d(a,{FORECAST_DEFAULT_DATA:()=>v,TITLE_MARGIN_OPTIONS:()=>A,TITLE_POSITION_OPTIONS:()=>T,advancedAnalyticsControls:()=>f,annotationLayers:()=>_,annotations:()=>s,annotationsAndLayersControls:()=>g,colorScheme:()=>l,datasourceAndVizType:()=>i,echartsTimeSeriesQuery:()=>w,echartsTimeSeriesQueryWithXAxisSort:()=>E,forecastIntervalControls:()=>b,legacyTimeseriesTime:()=>n,timeComparisonControls:()=>L,titleControls:()=>C});var r=o(74098);const n={label:(0,r.t)("Time"),expanded:!0,description:(0,r.t)("Time related form attributes"),controlSetRows:[["granularity"],["granularity_sqla"],["time_grain_sqla"],["time_range"]]},i={label:(0,r.t)("Datasource & Chart Type"),expanded:!0,controlSetRows:[["datasource"],["viz_type"],[{name:"slice_id",config:{type:"HiddenControl",label:(0,r.t)("Chart ID"),hidden:!0,description:(0,r.t)("The id of the active chart")}},{name:"cache_timeout",config:{type:"HiddenControl",label:(0,r.t)("Cache Timeout (seconds)"),hidden:!0,description:(0,r.t)("The number of seconds before expiring the cache")}},{name:"url_params",config:{type:"HiddenControl",label:(0,r.t)("URL Parameters"),hidden:!0,description:(0,r.t)("Extra url parameters for use in Jinja templated queries")}},{name:"custom_params",config:{type:"HiddenControl",label:(0,r.t)("Extra Parameters"),hidden:!0,description:(0,r.t)("Extra parameters that any plugins can choose to set for use in Jinja templated queries")}}]]},l={label:(0,r.t)("Color Scheme"),controlSetRows:[["color_scheme"]]},s={label:(0,r.t)("Annotations and Layers"),tabOverride:"data",expanded:!0,controlSetRows:[[{name:"annotation_layers",config:{type:"AnnotationLayerControl",label:"",default:[],description:(0,r.t)("Annotation Layers"),renderTrigger:!0}}]]};var c=o(2445),u=o(99578),d=o(8387),m=o(90881),p=o(20259);const f={label:(0,r.t)("Advanced analytics"),tabOverride:"data",description:(0,r.t)("This section contains options that allow for advanced analytical post processing of query results"),visibility:m.z,controlSetRows:[[(0,c.Y)(d.y,{children:(0,r.t)("Rolling window")})],[{name:"rolling_type",config:{type:"SelectControl",label:(0,r.t)("Rolling function"),default:null,choices:[[null,(0,r.t)("None")]].concat((0,p.u)(Object.values(u.AA))),description:(0,r.t)("Defines a rolling window function to apply, works along with the [Periods] text box")}}],[{name:"rolling_periods",config:{type:"TextControl",label:(0,r.t)("Periods"),isInt:!0,description:(0,r.t)("Defines the size of the rolling window function, relative to the time granularity selected"),visibility:({controls:e},{name:t})=>{var o,a;const r=t.endsWith("_b")?"rolling_type_b":"rolling_type";return Boolean(null==(o=e[r])?void 0:o.value)&&(null==(a=e[r])?void 0:a.value)!==u.AA.Cumsum}}}],[{name:"min_periods",config:{type:"TextControl",label:(0,r.t)("Min periods"),isInt:!0,description:(0,r.t)('The minimum number of rolling periods required to show a value. For instance if you do a cumulative sum on 7 days you may want your "Min Period" to be 7, so that all data points shown are the total of 7 periods. This will hide the "ramp up" taking place over the first 7 periods'),visibility:({controls:e},{name:t})=>{var o,a;const r=t.endsWith("_b")?"rolling_type_b":"rolling_type";return Boolean(null==(o=e[r])?void 0:o.value)&&(null==(a=e[r])?void 0:a.value)!==u.AA.Cumsum}}}],[(0,c.Y)(d.y,{children:(0,r.t)("Time comparison")})],[{name:"time_compare",config:{type:"SelectControl",multi:!0,freeForm:!0,label:(0,r.t)("Time shift"),choices:[["1 day ago",(0,r.t)("1 day ago")],["1 week ago",(0,r.t)("1 week ago")],["28 days ago",(0,r.t)("28 days ago")],["30 days ago",(0,r.t)("30 days ago")],["52 weeks ago",(0,r.t)("52 weeks ago")],["1 year ago",(0,r.t)("1 year ago")],["104 weeks ago",(0,r.t)("104 weeks ago")],["2 years ago",(0,r.t)("2 years ago")],["156 weeks ago",(0,r.t)("156 weeks ago")],["3 years ago",(0,r.t)("3 years ago")]],description:(0,r.t)("Overlay one or more timeseries from a relative time period. Expects relative time deltas in natural language (example:  24 hours, 7 days, 52 weeks, 365 days). Free text is supported.")}}],[{name:"comparison_type",config:{type:"SelectControl",label:(0,r.t)("Calculation type"),default:"values",choices:[[u.g1.Values,(0,r.t)("Actual values")],[u.g1.Difference,(0,r.t)("Difference")],[u.g1.Percentage,(0,r.t)("Percentage change")],[u.g1.Ratio,(0,r.t)("Ratio")]],description:(0,r.t)("How to display time shifts: as individual lines; as the difference between the main time series and each time shift; as the percentage change; or as the ratio between series and time shifts.")}}],[(0,c.Y)(d.y,{children:(0,r.t)("Resample")})],[{name:"resample_rule",config:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Rule"),default:null,choices:[["1T",(0,r.t)("1 minutely frequency")],["1H",(0,r.t)("1 hourly frequency")],["1D",(0,r.t)("1 calendar day frequency")],["7D",(0,r.t)("7 calendar day frequency")],["1MS",(0,r.t)("1 month start frequency")],["1M",(0,r.t)("1 month end frequency")],["1AS",(0,r.t)("1 year start frequency")],["1A",(0,r.t)("1 year end frequency")]],description:(0,r.t)("Pandas resample rule")}}],[{name:"resample_method",config:{type:"SelectControl",label:(0,r.t)("Fill method"),default:null,choices:[["asfreq",(0,r.t)("Null imputation")],["zerofill",(0,r.t)("Zero imputation")],["linear",(0,r.t)("Linear interpolation")],["ffill",(0,r.t)("Forward values")],["bfill",(0,r.t)("Backward values")],["median",(0,r.t)("Median values")],["mean",(0,r.t)("Mean values")],["sum",(0,r.t)("Sum values")]],description:(0,r.t)("Pandas resample method")}}]]},_=[],g={label:(0,r.t)("Annotations and Layers"),expanded:!1,tabOverride:"data",controlSetRows:[[{name:"annotation_layers",config:{type:"AnnotationLayerControl",label:"",default:_,description:(0,r.t)("Annotation Layers"),renderTrigger:!1}}]]};var y=o(14125),h=o(17942);const v={forecastEnabled:!1,forecastInterval:.8,forecastPeriods:10,forecastSeasonalityDaily:null,forecastSeasonalityWeekly:null,forecastSeasonalityYearly:null},b={label:(0,r.t)("Predictive Analytics"),expanded:!1,visibility:m.z,controlSetRows:[[{name:"forecastEnabled",config:{type:"CheckboxControl",label:(0,r.t)("Enable forecast"),renderTrigger:!1,default:v.forecastEnabled,description:(0,r.t)("Enable forecasting")}}],[{name:"forecastPeriods",config:{type:"TextControl",label:(0,r.t)("Forecast periods"),validators:[y.A],default:v.forecastPeriods,description:(0,r.t)("How many periods into the future do we want to predict")}}],[{name:"forecastInterval",config:{type:"TextControl",label:(0,r.t)("Confidence interval"),validators:[h.A],default:v.forecastInterval,description:(0,r.t)("Width of the confidence interval. Should be between 0 and 1")}}],[{name:"forecastSeasonalityYearly",config:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Yearly seasonality"),choices:[[null,(0,r.t)("default")],[!0,(0,r.t)("Yes")],[!1,(0,r.t)("No")]],default:v.forecastSeasonalityYearly,description:(0,r.t)("Should yearly seasonality be applied. An integer value will specify Fourier order of seasonality.")}}],[{name:"forecastSeasonalityWeekly",config:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Weekly seasonality"),choices:[[null,(0,r.t)("default")],[!0,(0,r.t)("Yes")],[!1,(0,r.t)("No")]],default:v.forecastSeasonalityWeekly,description:(0,r.t)("Should weekly seasonality be applied. An integer value will specify Fourier order of seasonality.")}}],[{name:"forecastSeasonalityDaily",config:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Daily seasonality"),choices:[[null,(0,r.t)("default")],[!0,(0,r.t)("Yes")],[!1,(0,r.t)("No")]],default:v.forecastSeasonalityDaily,description:(0,r.t)("Should daily seasonality be applied. An integer value will specify Fourier order of seasonality.")}}]]},A=[15,30,50,75,100,125,150,200],T=[["Left",(0,r.t)("Left")],["Top",(0,r.t)("Top")]],C={label:(0,r.t)("Chart Title"),tabOverride:"customize",expanded:!0,controlSetRows:[[(0,c.Y)(d.y,{children:(0,r.t)("X Axis")})],[{name:"x_axis_title",config:{type:"TextControl",label:(0,r.t)("X Axis Title"),renderTrigger:!0,default:""}}],[{name:"x_axis_title_margin",config:{type:"SelectControl",freeForm:!0,clearable:!0,label:(0,r.t)("X Axis Title Margin"),renderTrigger:!0,default:A[0],choices:(0,p.u)(A)}}],[(0,c.Y)(d.y,{children:(0,r.t)("Y Axis")})],[{name:"y_axis_title",config:{type:"TextControl",label:(0,r.t)("Y Axis Title"),renderTrigger:!0,default:""}}],[{name:"y_axis_title_margin",config:{type:"SelectControl",freeForm:!0,clearable:!0,label:(0,r.t)("Y Axis Title Margin"),renderTrigger:!0,default:A[1],choices:(0,p.u)(A)}}],[{name:"y_axis_title_position",config:{type:"SelectControl",freeForm:!0,clearable:!1,label:(0,r.t)("Y Axis Title Position"),renderTrigger:!0,default:T[0][0],choices:T}}]]};var x=o(95790);const S=[["metrics"],["groupby"],[x.pC],["adhoc_filters"],["limit","group_others_when_limit_reached"],["timeseries_limit_metric"],["order_desc"],["row_limit"],["truncate_metric"],["show_empty_columns"]],w={label:(0,r.t)("Query"),expanded:!0,controlSetRows:[["x_axis"],["time_grain_sqla"],...S]},E={label:(0,r.t)("Query"),expanded:!0,controlSetRows:[["x_axis"],["time_grain_sqla"],[x.K6],[x.$G],[x.MR],...S]};var M=o(35622);const O=[["1 day ago",(0,r.t)("1 day ago")],["1 week ago",(0,r.t)("1 week ago")],["28 days ago",(0,r.t)("28 days ago")],["30 days ago",(0,r.t)("30 days ago")],["1 month ago",(0,r.t)("1 month ago")],["52 weeks ago",(0,r.t)("52 weeks ago")],["1 year ago",(0,r.t)("1 year ago")],["104 weeks ago",(0,r.t)("104 weeks ago")],["2 years ago",(0,r.t)("2 years ago")],["156 weeks ago",(0,r.t)("156 weeks ago")],["3 years ago",(0,r.t)("3 years ago")],["custom",(0,r.t)("Custom date")],["inherit",(0,r.t)("Inherit range from time filter")]],R=new Set(["1 day ago","1 week ago","1 month ago","1 year ago","custom","inherit"]),k=O.filter((e=>R.has(e[0]))),L=({multi:e=!0,showCalculationType:t=!0,showFullChoices:o=!0})=>({label:(0,r.t)("Time Comparison"),tabOverride:"data",description:(0,r.t)("Compare results with other time periods."),controlSetRows:[[{name:"time_compare",config:{type:"SelectControl",multi:e,freeForm:!0,placeholder:(0,r.t)("Select or type a custom value..."),label:(0,r.t)("Time shift"),choices:o?O:k,description:(0,r.t)('Overlay results from a relative time period. Expects relative time deltas in natural language (example:  24 hours, 7 days, 52 weeks, 365 days). Free text is supported. Use "Inherit range from time filters" to shift the comparison time range by the same length as your time range and use "Custom" to set a custom comparison range.')}}],[{name:"start_date_offset",config:{type:"TimeOffsetControl",label:(0,r.t)("Shift start date"),visibility:({controls:e})=>"custom"===(null==e?void 0:e.time_compare.value),mapStateToProps:(e,t)=>{const{form_data:o}=e,{time_compare:a}=o,n={...t};return"custom"!==a||""!==t.value&&t.value!==M.FE?n.externalValidationErrors=[]:n.externalValidationErrors=[(0,r.t)("A date is required when using custom date shift")],n}}}],[{name:"comparison_type",config:{type:"SelectControl",label:(0,r.t)("Calculation type"),default:"values",choices:[[u.g1.Values,(0,r.t)("Actual values")],[u.g1.Difference,(0,r.t)("Difference")],[u.g1.Percentage,(0,r.t)("Percentage change")],[u.g1.Ratio,(0,r.t)("Ratio")]],description:(0,r.t)("How to display time shifts: as individual lines; as the difference between the main time series and each time shift; as the percentage change; or as the ratio between series and time shifts."),hidden:()=>Boolean(t)}}],[{name:"comparison_range_label",config:{type:"ComparisonRangeLabel",multi:e,visibility:({controls:e})=>Boolean(null==e?void 0:e.time_compare.value)}}]]});var F=o(21279),I=o(71403),N=o(78166),D=o(32769);function V(e){let t;return e&&e.length>0&&(e.forEach((e=>{"count"===e.metric_name&&(t="count")})),t||(t=e[0].metric_name)),t}var P=o(99203),H=o(87422),j=o(76892),q=o(81500),U=o(1020),B=o(84189),z=o(64076),Y=o(69121),X=o(51157),$=o(9797),W=o(72562),G=o(1155),Q=o(32557),K=o(54834),Z=o(37523),J=o(99539),ee=o(34443),te=o(47599),oe=o(60919),ae=o(28175),re=o(9753),ne=o(51979),ie=o(79895),le=o(34161),se=o(66925),ce=o(8198),ue=o(65471),de=o(29113),me=o(28827),pe=o(85600),fe=o(72973),_e=o(7308),ge=o(58233),ye=o(85767),he=o(91466),ve=o(33842),be=o(1086),Ae=o(7683),Te=o(41479);const Ce={column_formats:{},columns:[{advanced_data_type:void 0,certification_details:null,certified_by:null,column_name:"num",description:null,expression:"",filterable:!0,groupby:!0,id:332,is_certified:!1,is_dttm:!1,python_date_format:null,type:"BIGINT",type_generic:Ae.s.Numeric,verbose_name:null,warning_markdown:null},{advanced_data_type:void 0,certification_details:null,certified_by:null,column_name:"gender",description:null,expression:"",filterable:!0,groupby:!0,id:330,is_certified:!1,is_dttm:!1,python_date_format:null,type:"VARCHAR(16)",type_generic:Ae.s.String,verbose_name:"",warning_markdown:null},{advanced_data_type:void 0,certification_details:null,certified_by:null,column_name:"state",description:null,expression:"",filterable:!0,groupby:!0,id:333,is_certified:!1,is_dttm:!1,python_date_format:null,type:"VARCHAR(10)",type_generic:Ae.s.String,verbose_name:null,warning_markdown:null},{advanced_data_type:void 0,certification_details:null,certified_by:null,column_name:"ds",description:null,expression:"",filterable:!0,groupby:!0,id:329,is_certified:!1,is_dttm:!0,python_date_format:null,type:"TIMESTAMP WITHOUT TIME ZONE",type_generic:Ae.s.Temporal,verbose_name:null,warning_markdown:null},{advanced_data_type:void 0,certification_details:null,certified_by:null,column_name:"name",description:null,expression:"",filterable:!0,groupby:!0,id:331,is_certified:!1,is_dttm:!1,python_date_format:null,type:"VARCHAR(255)",type_generic:Ae.s.String,verbose_name:null,warning_markdown:null}],datasource_name:"birth_names",description:null,granularity_sqla:"ds",id:2,main_dttm_col:"ds",metrics:[{uuid:"123",certification_details:null,certified_by:null,d3format:null,currency:null,description:null,expression:"COUNT(*)",id:7,is_certified:!1,metric_name:"count",verbose_name:"COUNT(*)",warning_markdown:"",warning_text:null}],name:"public.birth_names",order_by_choices:[],owners:[{first_name:"admin",id:1,last_name:"user",username:"admin"}],type:Te.cT.Dataset,uid:"2__table",verbose_map:{}},xe=a},79895:(e,t,o)=>{o.d(t,{$:()=>i});var a=o(99578),r=o(90924),n=o(66925);const i=(e,t)=>{if(t.comparison_type!==a.g1.Values)return!1;const o=(0,r.A)(null==t?void 0:t.time_compare);return(0,n.z1)(e,o)}},84189:(e,t,o)=>{o.d(t,{Cn:()=>i,Du:()=>r,je:()=>n});var a=o(34142);function r({colname:e,colnames:t,formData:o}){var r,n;if(!e)return!1;const i=null==(r=o.percent_metrics)?void 0:r.some((t=>(0,a.A)(t)===e)),l=null==(n=o.metrics)?void 0:n.some((t=>(0,a.A)(t)===e));return t.includes(`%${e}`)&&i&&!l}function n(e,t){var o;return!(null==(o=t.metrics)||!o.some((t=>(0,a.A)(t)===e)))}function i(e,t){var o;return!(null==(o=t.percent_metrics)||!o.some((t=>`%${(0,a.A)(t)}`===e)))}},95790:(e,t,o)=>{o.d(t,{j_:()=>f,WN:()=>y,pC:()=>_,K6:()=>b,MR:()=>v,$G:()=>h});var a=o(74098),r=o(88808),n=o(90924),i=o(34142),l=o(65432),s=o(7683),c=o(1086),u=o(81500),d=o(35622),m=o(21279),p=o(91920);const f={raw:{label:"Overall value",compute:e=>e.length?e[0]:null},LAST_VALUE:{label:"Last Value",compute:e=>e.length?e[0]:null},sum:{label:"Total (Sum)",compute:e=>e.length?e.reduce(((e,t)=>e+t),0):null},mean:{label:"Average (Mean)",compute:e=>e.length?e.reduce(((e,t)=>e+t),0)/e.length:null},min:{label:"Minimum",compute:e=>e.length?Math.min(...e):null},max:{label:"Maximum",compute:e=>e.length?Math.max(...e):null},median:{label:"Median",compute:e=>{if(!e.length)return null;const t=[...e].sort(((e,t)=>e-t)),o=Math.floor(t.length/2);return t.length%2==0?(t[o-1]+t[o])/2:t[o]}}},_={name:"contributionMode",config:{type:"SelectControl",label:(0,a.t)("Contribution Mode"),default:null,choices:[[null,(0,a.t)("None")],[r.PA.Row,(0,a.t)("Row")],[r.PA.Column,(0,a.t)("Series")]],description:(0,a.t)("Calculate contribution per series or row")}},g=({controls:e})=>function(e){var t,o,a,r,n;const i=(0,m.R)((0,l.A)(null==e||null==(t=e.x_axis)?void 0:t.value),null==e||null==(o=e.datasource)?void 0:o.datasource,[s.s.Numeric])&&!(null==e||null==(a=e.xAxisForceCategorical)||!a.value),c=null==e||null==(r=e.x_axis)?void 0:r.value,u=!(0,p.eh)(c);return i||u||(0,m.R)((0,l.A)(c),null==e||null==(n=e.datasource)?void 0:n.datasource,[s.s.String,s.s.Boolean])}(e),y={name:"aggregation",config:{type:"SelectControl",label:(0,a.t)("Aggregation Method"),default:"LAST_VALUE",clearable:!1,renderTrigger:!1,choices:Object.entries(f).map((([e,{label:t}])=>[e,(0,a.t)(t)])),description:(0,a.t)('Method to compute the displayed value. "Overall value" calculates a single metric across the entire filtered time period, ideal for non-additive metrics like ratios, averages, or distinct counts. Other methods operate over the time series data points.'),provideFormDataToProps:!0,mapStateToProps:({form_data:e})=>({value:e.aggregation||"LAST_VALUE"})}},h={name:"x_axis_sort",config:{type:"XAxisSortControl",label:e=>{var t;return"horizontal"===(null==(t=e.form_data)?void 0:t.orientation)?(0,a.t)("Y-Axis Sort By"):(0,a.t)("X-Axis Sort By")},description:(0,a.t)("Decides which column or measure to sort the base axis by."),shouldMapStateToProps:()=>!0,mapStateToProps:(e,t)=>{var o,a,r,s,m,p,f,_;const{controls:g,datasource:y}=e,h=(0,c.TI)(y)?y:void 0,v=[null==g||null==(o=g.x_axis)?void 0:o.value].filter(Boolean),b=0===(0,n.A)(null==g||null==(a=g.groupby)?void 0:a.value).length,A=!!(0,n.A)(null==g||null==(r=g.groupby)?void 0:r.value).length||(0,n.A)(null==g||null==(s=g.metrics)?void 0:s.value).length>1,T=[...(0,n.A)(null==g||null==(m=g.metrics)?void 0:m.value),null==g||null==(p=g.timeseries_limit_metric)?void 0:p.value].filter(Boolean),C=[...new Set(T.map(i.A))],x=[...b?[...v.map((e=>{var t;const o=(0,l.A)(e);return{value:o,label:(null==h||null==(t=h.verbose_map)?void 0:t[o])||o}})),...C.map((e=>{var t;return{value:e,label:(null==h||null==(t=h.verbose_map)?void 0:t[e])||e}}))]:[],...A?d.Ow.map((e=>({value:e[0],label:e[1]}))):[]];return{shouldReset:!("string"==typeof t.value&&x.map((e=>e.value)).includes(t.value)&&!(0,u.D)((0,l.A)(null==g||null==(f=g.x_axis)?void 0:f.value),null==g||null==(_=g.datasource)?void 0:_.datasource)),options:x}},visibility:g}},v={name:"x_axis_sort_asc",config:{type:"CheckboxControl",label:e=>{var t;return"horizontal"===(null==(t=e.form_data)?void 0:t.orientation)?(0,a.t)("Y-Axis Sort Ascending"):(0,a.t)("X-Axis Sort Ascending")},default:d.ov.sort_series_ascending,description:(0,a.t)("Whether to sort ascending or descending on the base Axis."),visibility:({controls:e})=>{var t;return void 0!==(null==e||null==(t=e.x_axis_sort)?void 0:t.value)&&g({controls:e})}}},b={name:"xAxisForceCategorical",config:{type:"CheckboxControl",label:()=>(0,a.t)("Force categorical"),default:!1,description:(0,a.t)("Treat values as categorical."),initialValue:(e,t)=>{var o;return void 0!==(null==t||null==(o=t.form_data)?void 0:o.x_axis_sort)||e.value},renderTrigger:!0,visibility:({controls:e})=>{var t,o;return(0,m.R)((0,l.A)(null==e||null==(t=e.x_axis)?void 0:t.value),null==e||null==(o=e.datasource)?void 0:o.datasource,[s.s.Numeric])},shouldMapStateToProps:()=>!0}}},99203:(e,t,o)=>{o.d(t,{A:()=>n,t:()=>r});var a=o(1086);function r(e,t){return(0,a.TI)(e)||(0,a.kj)(e)?e.columns.filter((e=>void 0===t||e.type_generic===t)).sort(((e,t)=>{const o="verbose_name"in e&&e.verbose_name||e.column_name,a="verbose_name"in t&&t.verbose_name||t.column_name;return o.toLowerCase()>a.toLowerCase()?1:-1})):[]}function n(e,t){return r(e,t).map((e=>[e.column_name,"verbose_name"in e&&e.verbose_name||e.column_name]))}},99539:(e,t,o)=>{o.d(t,{X:()=>a});const a=(e,t,o)=>{if(e.contributionMode)return{operation:"contribution",options:{orientation:e.contributionMode,time_shifts:o}}}}}]);