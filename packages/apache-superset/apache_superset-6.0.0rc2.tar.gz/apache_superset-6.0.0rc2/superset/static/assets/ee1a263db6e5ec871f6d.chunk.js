"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5867],{30613:(e,t,a)=>{a.d(t,{k:()=>d});var n=a(2445),l=a(96540),o=a(74098),s=a(88217),r=a(65729),i=a(97163);function d({show:e,onHide:t,title:a,onSave:d,children:u,initialValues:c={},formSubmitHandler:p,bodyStyle:m={},requiredFields:h=[],name:g}){const[y]=r.l.useForm(),[b,f]=(0,l.useState)(!1),S=(0,l.useCallback)((()=>{y.resetFields(),f(!1)}),[y]),[w,v]=(0,l.useState)(!0),D=(0,l.useCallback)((()=>{S(),t()}),[t,S]),C=(0,l.useCallback)((()=>{S(),d()}),[d,S]),Y=(0,l.useCallback)((async e=>{try{f(!0),await p(e),C()}catch(e){console.error(e)}finally{f(!1)}}),[p,C]),k=()=>{const e=y.getFieldsError().some((({errors:e})=>e.length)),t=y.getFieldsValue(),a=h.some((e=>!t[e]));v(e||a)};return(0,n.Y)(i.aF,{name:g,show:e,title:a,onHide:D,bodyStyle:m,footer:(0,n.FD)(n.FK,{children:[(0,n.Y)(s.$,{buttonStyle:"secondary",onClick:D,children:(0,o.t)("Cancel")}),(0,n.Y)(s.$,{buttonStyle:"primary",htmlType:"submit",onClick:()=>y.submit(),disabled:b||w,children:b?(0,o.t)("Saving..."):(0,o.t)("Save")})]}),children:(0,n.Y)(r.l,{form:y,layout:"vertical",onFinish:Y,initialValues:c,onValuesChange:k,onFieldsChange:k,children:"function"==typeof u?u(y):u})})}},35340:(e,t,a)=>{a.d(t,{I:()=>r});var n=a(79378),l=a(74098),o=a(58561),s=a.n(o);const r=async({endpoint:e,pageSize:t=100,setData:a,filters:o,setLoadingState:r,loadingKey:i,addDangerToast:d,errorMessage:u="Error while fetching data",mapResult:c=e=>e})=>{try{const l=async a=>{const l={page_size:t,page:a};o&&(l.filters=o);const r=s().encode(l),i=await n.A.get({endpoint:`${e}?q=${r}`});return{count:i.json.count,results:i.json.result.map(c)}},r=await l(0),i=r.count,d=r.results;if(t>=i)return void a(d);const u=Math.ceil(i/t),p=Array.from({length:u-1},((e,t)=>l(t+1))),m=await Promise.all(p);a([...d,...m.flatMap((e=>e.results))])}catch(e){d((0,l.t)(u))}finally{r((e=>"boolean"!=typeof e&&{...e,[i]:!1}))}}},40220:(e,t,a)=>{a.d(t,{Ni:()=>d,cm:()=>u,vW:()=>i,wj:()=>r});var n=a(79378),l=a(74098),o=a(58561),s=a.n(o);const r=async e=>{await n.A.post({endpoint:"/api/v1/security/groups/",jsonPayload:{...e,users:e.users.map((e=>e.value))}})},i=async(e,t)=>{await n.A.put({endpoint:`/api/v1/security/groups/${e}`,jsonPayload:{...t,users:t.users.map((e=>e.value))}})},d=async e=>n.A.delete({endpoint:`/api/v1/security/groups/${e}`}),u=async(e,t,a,o)=>{const r=s().encode({filter:e,page:t,page_size:a,order_column:"username",order_direction:"asc"});try{var i,d,u;const e=await n.A.get({endpoint:`/api/v1/security/users/?q=${r}`});return{data:((null==(i=e.json)?void 0:i.result)||[]).map((e=>({value:e.id,label:e.username}))),totalCount:null!=(d=null==(u=e.json)?void 0:u.count)?d:0}}catch(e){return o((0,l.t)("There was an error while fetching users")),{data:[],totalCount:0}}}},41893:(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var n=a(2445),l=a(96540),o=a(74098),s=a(86784),r=a(20237),i=a(47263),d=a(9485),u=a(89232),c=a(47305),p=a(64457),m=a(51692),h=a(85923),g=a(30613),y=a(82384),b=a(17355),f=a(2801),S=a(49965),w=a(40220);function v({show:e,onHide:t,onSave:a,roles:l,isEditMode:s=!1,group:r}){var i,d;const{addDangerToast:u,addSuccessToast:c}=(0,p.Yf)(),v={...r,roles:(null==r||null==(i=r.roles)?void 0:i.map((e=>e.id)))||[],users:(null==r||null==(d=r.users)?void 0:d.map((e=>({value:e.id,label:e.username}))))||[]};return(0,n.FD)(g.k,{show:e,onHide:t,name:s?"Edit Group":"Add Group",title:(0,n.Y)(m.r,{isEditMode:s,title:s?(0,o.t)("Edit Group"):(0,o.t)("Add Group")}),onSave:a,formSubmitHandler:async e=>{const t=async(e,t)=>{let a=t===h.En.CREATE?(0,o.t)("There was an error creating the group. Please, try again."):(0,o.t)("There was an error updating the group. Please, try again.");if(422===e.status){const t=await e.json(),n=(null==t?void 0:t.message)||"";n.includes("duplicate key value")&&n.includes("ab_group_name_key")&&(a=(0,o.t)("This name is already taken. Please choose another one."))}throw u(a),e};if(s){if(!r)throw new Error("Group is required in edit mode");try{await(0,w.vW)(r.id,e),c((0,o.t)("The group has been updated successfully."))}catch(e){await t(e,h.En.UPDATE)}}else try{await(0,w.wj)(e),c((0,o.t)("The group has been created successfully."))}catch(e){await t(e,h.En.CREATE)}},requiredFields:["name"],initialValues:v,children:[(0,n.Y)(y.e,{name:"name",label:(0,o.t)("Name"),rules:[{required:!0,message:(0,o.t)("Name is required")}],children:(0,n.Y)(b.A,{name:"name",placeholder:(0,o.t)("Enter the group's name")})}),(0,n.Y)(y.e,{name:"label",label:(0,o.t)("Label"),children:(0,n.Y)(b.A,{name:"label",placeholder:(0,o.t)("Enter the group's label")})}),(0,n.Y)(y.e,{name:"description",label:(0,o.t)("Description"),children:(0,n.Y)(b.A,{name:"description",placeholder:(0,o.t)("Enter the group's description")})}),(0,n.Y)(y.e,{name:"roles",label:(0,o.t)("Roles"),children:(0,n.Y)(f.A,{name:"roles",mode:"multiple",placeholder:(0,o.t)("Select roles"),options:l.map((e=>({value:e.id,label:e.name}))),getPopupContainer:e=>e.closest(".ant-modal-content")})}),(0,n.Y)(y.e,{name:"users",label:(0,o.t)("Users"),children:(0,n.Y)(S.A,{name:"users",mode:"multiple",placeholder:(0,o.t)("Select users"),options:(e,t,a)=>(0,w.cm)(e,t,a,u)})})]})}const D=e=>(0,n.Y)(v,{...e,isEditMode:!1}),C=e=>(0,n.Y)(v,{...e,isEditMode:!0});var Y,k=a(35340),E=a(95018),A=a(8558),T=a(94551),H=a(38961),F=a(66124);!function(e){e.ADD="add",e.EDIT="edit"}(Y||(Y={}));const M=function({user:e}){const{addDangerToast:t,addSuccessToast:a}=(0,p.Yf)(),{state:{loading:m,resourceCount:h,resourceCollection:g,bulkSelectEnabled:y},fetchData:b,refreshData:f,toggleBulkSelect:S}=(0,s.RU)("security/groups",(0,o.t)("Group"),t),[v,M]=(0,l.useState)({edit:!1,add:!1}),j=e=>M((t=>({...t,[e]:!0}))),P=e=>M((t=>({...t,[e]:!1}))),[N,G]=(0,l.useState)(null),[R,z]=(0,l.useState)(null),[L,q]=(0,l.useState)({roles:!0}),[I,$]=(0,l.useState)([]),_=(0,l.useMemo)((()=>(0,c.N6)(e)),[e]),B=(0,l.useCallback)((()=>{(0,k.I)({endpoint:"/api/v1/security/roles/",setData:$,setLoadingState:q,loadingKey:"roles",addDangerToast:t,errorMessage:(0,o.t)("Error while fetching roles")})}),[t]);(0,l.useEffect)((()=>{B()}),[B]);const O=[{id:"name",desc:!0}],U=(0,l.useMemo)((()=>[{accessor:"name",id:"name",Header:(0,o.t)("Name"),size:"xxl",Cell:({row:{original:{name:e}}})=>(0,n.Y)("span",{children:e})},{accessor:"label",id:"label",Header:(0,o.t)("Label"),Cell:({row:{original:{label:e}}})=>(0,n.Y)("span",{children:e})},{accessor:"description",id:"description",Header:(0,o.t)("Description"),Cell:({row:{original:{description:e}}})=>(0,n.Y)("span",{children:e}),hidden:!0},{accessor:"roles",id:"roles",Header:(0,o.t)("Roles"),Cell:({row:{original:{roles:e}}})=>(0,n.Y)(E.m,{title:(null==e?void 0:e.map((e=>e.name)).join(", "))||(0,o.t)("No roles"),children:(0,n.Y)("span",{children:null==e?void 0:e.map((e=>e.name)).join(", ")})}),disableSortBy:!0},{accessor:"users",id:"users",Header:(0,o.t)("Users"),Cell:({row:{original:{users:e}}})=>(0,n.Y)("span",{children:null==e?void 0:e.map((e=>e.username)).join(", ")}),disableSortBy:!0,hidden:!0},{Cell:({row:{original:e}})=>{const t=_?[{label:"group-list-edit-action",tooltip:(0,o.t)("Edit group"),placement:"bottom",icon:"EditOutlined",onClick:()=>{G(e),j(Y.EDIT)}},{label:"group-list-delete-action",tooltip:(0,o.t)("Delete group"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>z(e)}]:[];return(0,n.Y)(i.D,{actions:t})},Header:(0,o.t)("Actions"),id:"actions",disableSortBy:!0,hidden:!_,size:"xl"}]),[_]),V=[];_&&V.push({name:(0,o.t)("Bulk select"),onClick:S,buttonStyle:"secondary"},{name:(0,o.t)("Group"),icon:(0,n.Y)(A.F.PlusOutlined,{iconSize:"m"}),buttonStyle:"primary",onClick:()=>{j(Y.ADD)},loading:L.roles});const x=(0,l.useMemo)((()=>[{Header:(0,o.t)("Name"),key:"name",id:"name",input:"search",operator:u.c0.Contains},{Header:(0,o.t)("Label"),key:"label",id:"label",input:"search",operator:u.c0.Contains},{Header:(0,o.t)("Description"),key:"description",id:"description",input:"search",operator:u.c0.Contains},{Header:(0,o.t)("Roles"),key:"roles",id:"roles",input:"select",operator:u.c0.RelationManyMany,unfilteredLabel:(0,o.t)("All"),selects:null==I?void 0:I.map((e=>({label:e.name,value:e.id}))),loading:L.roles,dropdownStyle:{minWidth:F.f8}},{Header:(0,o.t)("Users"),key:"users",id:"users",input:"select",operator:u.c0.RelationManyMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:async(e,a,n)=>(0,w.cm)(e,a,n,t),dropdownStyle:{minWidth:F.f8}}]),[L.roles,I]),K={title:(0,o.t)("No groups yet"),image:"filter-results.svg",..._&&{buttonAction:()=>{j(Y.ADD)},buttonIcon:(0,n.Y)(A.F.PlusOutlined,{iconSize:"m"}),buttonText:(0,o.t)("Group")}};return(0,n.FD)(n.FK,{children:[(0,n.Y)(r.A,{name:(0,o.t)("List Groups"),buttons:V}),(0,n.Y)(D,{onHide:()=>P(Y.ADD),show:v.add,onSave:()=>{f(),P(Y.ADD)},roles:I}),v.edit&&N&&(0,n.Y)(C,{group:N,show:v.edit,onHide:()=>P(Y.EDIT),onSave:()=>{f(),P(Y.EDIT)},roles:I}),R&&(0,n.Y)(T.T,{description:(0,o.t)("This action will permanently delete the group."),onConfirm:()=>{R&&(async({id:e,name:n})=>{try{await(0,w.Ni)(e),f(),z(null),a((0,o.t)("Deleted group: %s",n))}catch(e){t((0,o.t)("There was an issue deleting %s",n))}})(R)},onHide:()=>z(null),open:!0,title:(0,o.t)("Delete Group?")}),(0,n.Y)(H.h,{title:(0,o.t)("Please confirm"),description:(0,o.t)("Are you sure you want to delete the selected groups?"),onConfirm:e=>{const n=[];Promise.all(e.map((e=>(0,w.Ni)(e.id).then((()=>{n.push(e.name)})).catch((a=>{t((0,o.t)("Error deleting %s",e.name))}))))).then((()=>{n.length>0&&a((0,o.t)("Deleted groups: %s",n.join(", ")))})).finally((()=>{f()}))},children:e=>{const l=_?[{key:"delete",name:(0,o.t)("Delete"),onSelect:e,type:"danger"}]:[];return(0,n.Y)(d.uO,{className:"group-list-view",columns:U,count:h,data:g,fetchData:b,filters:x,initialSort:O,loading:m,pageSize:25,bulkActions:l,bulkSelectEnabled:y,disableBulkSelect:S,addDangerToast:t,addSuccessToast:a,emptyState:K,refreshData:f})}})]})}}}]);