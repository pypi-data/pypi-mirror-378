"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[9599],{832:(t,e,o)=>{o.d(e,{c:()=>k,y:()=>C});var a=o(2404),r=o.n(a),l=o(2445),i=o(96540),n=o(67413),s=o(35942),u=o(14503),c=o(28027),d=o(50871),p=o(98456),m=o(48238),f=o(92123),h=o(51316),g=o(99894);const{getScale:b}=u;function _(t,e){const o=t.color_picker||{r:0,g:0,b:0,a:1},a=[o.r,o.g,o.b,255*o.a],r=t.color_scheme,l=b(r);let i={};return t.color_scheme_type===f.wP.color_breakpoints?i=(0,h.BK)(t.color_breakpoints):e.forEach((e=>{if(null!=e.cat_color&&!i.hasOwnProperty(e.cat_color)){let r;r=t.dimension?(0,d.hexToRGB)(l(e.cat_color,t.sliceId),255*o.a):a,i[e.cat_color]={color:r,enabled:!0}}})),i}const v=t=>{const e=(0,i.useRef)(null),o=(0,i.useCallback)((()=>{let e={...t.viewport};return t.formData.autozoom&&(e=(0,m.A)(e,{width:t.width,height:t.height,points:t.getPoints(t.payload.data.features||[])})),e.zoom<0&&(e.zoom=0),e}),[t]),[a,r]=(0,i.useState)(_(t.formData,t.payload.data.features||[])),[n,u]=(0,i.useState)(t.payload.form_data),[h,v]=(0,i.useState)(o());(0,i.useEffect)((()=>{if(t.payload.form_data!==n){const e=t.payload.data.features||[],a=_(t.formData,e);v(o()),u(t.payload.form_data),r(a)}}),[o,t,n]);const y=(0,i.useCallback)((t=>{const{current:o}=e;o&&o.setTooltip(t)}),[]),C=(0,i.useCallback)(((t,e,o)=>{const a=e.color_scheme,r=b(a);let l;switch(o){case f.wP.fixed_color:return l=e.color_picker||{r:0,g:0,b:0,a:100},t.map((t=>({...t,color:[l.r,l.g,l.b,255*l.a]})));case f.wP.categorical_palette:return t.map((t=>({...t,color:(0,d.hexToRGB)(r(t.cat_color,e.slice_id))})));case f.wP.color_breakpoints:{const o=e.deafult_breakpoint_color?[e.deafult_breakpoint_color.r,e.deafult_breakpoint_color.g,e.deafult_breakpoint_color.b,255*e.deafult_breakpoint_color.a]:[g.DL.r,g.DL.g,g.DL.b,255*g.DL.a];return t.map((t=>{var a;const r=null==(a=e.color_breakpoints)?void 0:a.find((e=>t.metric>=e.minValue&&t.metric<=e.maxValue));return{...t,color:r?[null==r?void 0:r.color.r,null==r?void 0:r.color.g,null==r?void 0:r.color.b,255*(null==r?void 0:r.color.a)]:o}}))}default:return[]}}),[]),k=(0,i.useCallback)((()=>{const{getLayer:e,getHighlightLayer:o,payload:r,formData:l,onAddFilter:i,onContextMenu:n,filterState:s,setDataMask:u,emitCrossFilters:c}=t;let d=r.data.features?[...r.data.features]:[];const m=l.color_scheme_type;d=C(d,l,m),l.js_data_mutator&&(d=(0,p.A)(l.js_data_mutator)(d)),l.dimension&&(d=d.filter((t=>{var e;return null==(e=a[t.cat_color])?void 0:e.enabled})));const f={formData:l,payload:{...r,data:{...r.data,features:d}},onAddFilter:i,setTooltip:y,datasource:t.datasource,onContextMenu:n,filterState:s,setDataMask:u,emitCrossFilters:c},h=e(f);return c&&null!=s&&s.value&&o?[h,o(f)]:[h]}),[C,a,t,y]),x=(0,i.useCallback)((t=>{const e=a[t],o={...a,[t]:{...e,enabled:!e.enabled}};Object.values(o).every((t=>!t.enabled))&&Object.values(o).forEach((t=>{t.enabled=!0})),r(o)}),[a]),D=(0,i.useCallback)((t=>{const e={...a};Object.values(e).forEach((t=>{t.enabled=!1})),e[t].enabled=!0,r(e)}),[a]);return(0,l.FD)("div",{style:{position:"relative"},children:[(0,l.Y)(s.S,{ref:e,viewport:h,layers:k(),setControlValue:t.setControlValue,mapStyle:t.formData.mapbox_style,mapboxApiAccessToken:t.mapboxApiKey,width:t.width,height:t.height}),(0,l.Y)(c.A,{forceCategorical:!0,categories:a,format:t.formData.legend_format,position:t.formData.legend_position,showSingleCategory:D,toggleCategory:x})]})},y=(0,i.memo)(v);function C(t,e,o){return(0,i.memo)((a=>{const u=(0,i.useRef)(),d=(0,n.Z)(a.formData),p=(0,n.Z)(a.filterState),f=(0,n.Z)(a.payload),[g,b]=(0,i.useState)((0,h.BK)(a.formData.color_breakpoints)||[]),[_,v]=(0,i.useState)((()=>{const{width:t,height:o,formData:r}=a;return r.autozoom?(0,m.A)(a.viewport,{width:t,height:o,points:e(a.payload.data.features)}):a.viewport})()),y=(0,i.useCallback)((t=>{const{current:e}=u;e&&(null==e||e.setTooltip(t))}),[]),C=(0,i.useCallback)((e=>{const{formData:a,payload:r,onAddFilter:l,filterState:i,setDataMask:n,onContextMenu:s,emitCrossFilters:u}=e,c={formData:a,payload:r,onAddFilter:l,setTooltip:y,setDataMask:n,onContextMenu:s,filterState:i,emitCrossFilters:u},d=t(c);return u&&null!=i&&i.value&&o?[d,o(c)]:[d]}),[y]);(0,i.useEffect)((()=>{const t=(0,h.BK)(a.formData.color_breakpoints);b(t)}),[a]);const[k,x]=(0,i.useState)(C(a));(0,i.useEffect)((()=>{const t={...d,...p,viewport:null},e={...a.formData,...a.filterState,viewport:null};r()(t,e)&&f===a.payload||x(C(a))}),[C,d,p,f,a]);const{formData:D,payload:w,setControlValue:M,height:S,width:A}=a;return(0,l.FD)("div",{style:{position:"relative"},children:[(0,l.Y)(s.S,{ref:u,mapboxApiAccessToken:w.data.mapboxApiKey,viewport:_,layers:k,mapStyle:D.mapbox_style,setControlValue:M,width:A,height:S,onViewportChange:v}),(0,l.Y)(c.A,{forceCategorical:!0,categories:g,format:a.formData.legend_format,position:a.formData.legend_position})]})}))}function k(t,e,o){return function(a){const{datasource:r,formData:i,height:n,payload:s,setControlValue:u,viewport:c,width:d,setDataMask:p,filterState:m,onContextMenu:f,emitCrossFilters:h}=a;return(0,l.Y)(y,{datasource:r,formData:i,mapboxApiKey:s.data.mapboxApiKey,setControlValue:u,viewport:c,getLayer:t,getHighlightLayer:o,payload:s,getPoints:e,width:d,height:n,setDataMask:p,onContextMenu:f,filterState:m,emitCrossFilters:h})}}},28027:(t,e,o)=>{o.d(e,{A:()=>c});var a=o(2445),r=o(96540),l=o(50290),i=o(29898);const n=l.I4.div`
  ${({theme:t})=>`\n    font-size: ${t.fontSizeSM}px;\n    position: absolute;\n    background: ${t.colorBgElevated};\n    box-shadow: 0 0 ${t.sizeUnit}px ${t.colorBorderSecondary};\n    margin: ${6*t.sizeUnit}px;\n    padding: ${3*t.sizeUnit}px ${5*t.sizeUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        display: flex;\n        color: ${t.colorText};\n        text-decoration: none;\n        padding: ${t.sizeUnit}px 0;\n\n        & span {\n          margin-right: ${t.sizeUnit}px;\n        }\n      }\n    }\n  `}
`,s=" - ",u=({format:t=null,forceCategorical:e=!1,position:o="tr",categories:r={},toggleCategory:l=()=>{},showSingleCategory:u=()=>{}})=>{const c=o=>{if(!t||e)return o;const a=parseFloat(o);return(0,i.ZV)(t,a)},d=e=>{if(!t)return e;if(e.includes(s)){const t=e.split(s);return c(t[0])+s+c(t[1])}return c(e)};if(0===Object.keys(r).length||null===o)return null;const p=Object.entries(r).map((([t,e])=>{var o;const r={color:`rgba(${null==(o=e.color)?void 0:o.join(", ")})`},i=e.enabled?"◼":"◻";return(0,a.Y)("li",{children:(0,a.FD)("a",{href:"#",role:"button",onClick:()=>l(t),onDoubleClick:()=>u(t),children:[(0,a.Y)("span",{style:r,children:i})," ",d(t)]})},t)})),m="t"===(null==o?void 0:o.charAt(0))?"top":"bottom",f="r"===(null==o?void 0:o.charAt(1))?"right":"left",h={position:"absolute",[m]:"0px",[f]:"10px"};return(0,a.Y)(n,{className:"dupa",style:h,children:(0,a.Y)("ul",{children:p})})},c=(0,r.memo)(u)},99599:(t,e,o)=>{o.r(e),o.d(e,{default:()=>_,getHighlightLayer:()=>b,getLayer:()=>g,getPoints:()=>f});var a=o(2445),r=o(49924),l=o(34142),i=o(74098),n=o(92123),s=o(83860),u=o(832),c=o(52480);const d=1609.34;function p(t,e){return"square_m"===t?Math.sqrt(e/Math.PI):"radius_m"===t?e:"radius_km"===t?1e3*e:"radius_miles"===t?e*d:"square_km"===t?1e3*Math.sqrt(e/Math.PI):"square_miles"===t?Math.sqrt(e/Math.PI)*d:null}var m=o(51316);function f(t){return t.map((t=>t.position))}function h(t,e){return o=>{var r,n,s,u,d,p,m;const f=(null==e?void 0:e[t.point_radius_fixed.value])||(0,l.A)(null==(r=t.point_radius_fixed)?void 0:r.value);return(0,a.FD)("div",{className:"deckgl-tooltip",children:[(0,a.Y)(c.A,{label:(0,i.t)("Longitude and Latitude")+": ",value:`${null==(n=o.object)||null==(n=n.position)?void 0:n[0]}, ${null==(s=o.object)||null==(s=s.position)?void 0:s[1]}`}),(null==(u=o.object)?void 0:u.cat_color)&&(0,a.Y)(c.A,{label:(0,i.t)("Category")+": ",value:`${null==(d=o.object)?void 0:d.cat_color}`}),(null==(p=o.object)?void 0:p.metric)&&(0,a.Y)(c.A,{label:`${f}: `,value:`${null==(m=o.object)?void 0:m.metric}`})]})}}const g=function({formData:t,payload:e,setTooltip:o,setDataMask:a,filterState:l,onContextMenu:i,datasource:n,emitCrossFilters:u}){const c=t,d=e.data.features.map((t=>{let e=p(c.point_unit,t.radius)||10;if(c.multiplier&&(e*=c.multiplier),t.color)return{...t,radius:e};const o=c.color_picker||{r:0,g:0,b:0,a:1},a=[o.r,o.g,o.b,255*o.a];return{...t,radius:e,color:a}}));return new r.A({id:`scatter-layer-${c.slice_id}`,data:d,fp64:!0,getFillColor:t=>t.color,getRadius:t=>t.radius,radiusMinPixels:Number(c.min_radius)||void 0,radiusMaxPixels:Number(c.max_radius)||void 0,stroked:!1,...(0,s.T$)({formData:c,setTooltip:o,setTooltipContent:h(c,null==n?void 0:n.verboseMap),setDataMask:a,filterState:l,onContextMenu:i,emitCrossFilters:u}),opacity:null!=l&&l.value?.3:1})},b=function({formData:t,payload:e,filterState:o}){const a=t,l=e.data.features.map((t=>{let e=p(a.point_unit,t.radius)||10;return a.multiplier&&(e*=a.multiplier),{...t,radius:e}})).filter((t=>(0,n.st)(t.position,null==o?void 0:o.value)));return new r.A({id:`scatter-highlight-layer-${a.slice_id}`,data:l,fp64:!0,getFillColor:()=>m.Fe,getRadius:t=>t.radius,radiusMinPixels:Number(a.min_radius)||void 0,radiusMaxPixels:Number(a.max_radius)||void 0,stroked:!1})},_=(0,u.c)(g,f,b)}}]);