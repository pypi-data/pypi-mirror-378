(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[210,5474],{42634:()=>{},46217:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>x,getLayer:()=>k,getPoints:()=>S});var a=o(2445),i=o(96540),r=o(15022),l=o(25879),n=o.n(l),s=o(35942),c=o(50871),d=o(98456),u=o(83860),p=o(52480),g=o(48238),f=o(51316);const h={fillColor:"fillColor",color:"fillColor",fill:"fillColor","fill-color":"fillColor",strokeColor:"strokeColor","stroke-color":"strokeColor","stroke-width":"strokeWidth"},m=(e,t)=>{const o={};return Object.keys(e).forEach((t=>{t in h?o[h[t]]=e[t]:o[t]=e[t]})),"string"==typeof e.fillColor&&(o.fillColor=(0,c.hexToRGB)(e.fillColor)),"string"==typeof e.strokeColor&&(o.strokeColor=(0,c.hexToRGB)(e.strokeColor)),{...o,...t}};let _=[];const v=(e,t,o)=>{if(null!=e&&e.features&&e.features.forEach((a=>{v(a,t,e.extraProps||o)})),null!=e&&e.geometry){const a={...e,properties:m(e.properties,t)};a.extraProps||(a.extraProps=o),_.push(a)}};function y(e){var t;return(null==(t=e.object)?void 0:t.extraProps)&&(0,a.Y)("div",{className:"deckgl-tooltip",children:Object.keys(e.object.extraProps).map(((t,o)=>{var i;return(0,a.Y)(p.A,{label:`${t}: `,value:`${null==(i=e.object.extraProps)?void 0:i[t]}`},`prop-${o}`)}))})}const C=e=>{var t;return null==e||null==(t=e.properties)?void 0:t.strokeColor},k=function({formData:e,onContextMenu:t,filterState:o,setDataMask:a,payload:i,setTooltip:l,emitCrossFilters:n}){const s=e,c=s.fill_color_picker,p=s.stroke_color_picker,g=[c.r,c.g,c.b,255*c.a],h=[p.r,p.g,p.b,255*p.a],m={};g[3]>0&&(m.fillColor=g),h[3]>0&&(m.strokeColor=h),_=[],v(i.data,m);let k=_;return s.js_data_mutator&&(k=(0,d.A)(s.js_data_mutator)(_)),new r.A({id:`geojson-layer-${s.slice_id}`,data:k,extruded:s.extruded,filled:s.filled,stroked:s.stroked,getFillColor:e=>((e,t)=>{var o;if(t){var a;if(JSON.stringify(e.geometry.coordinates)===JSON.stringify(null==t?void 0:t[0]))return f.Fe;const o=null==e||null==(a=e.properties)?void 0:a.fillColor;return o[3]=125,o}return null==e||null==(o=e.properties)?void 0:o.fillColor})(e,null==o?void 0:o.value),getLineColor:C,getLineWidth:s.line_width||1,pointRadiusScale:s.point_radius_scale,lineWidthUnits:s.line_width_unit,...(0,u.T$)({formData:s,setTooltip:l,setTooltipContent:y,setDataMask:a,filterState:o,onContextMenu:t,emitCrossFilters:n})})};function S(e){return e.reduce(((e,t)=>{const o=n()(t);return o?[...e,[o[0],o[1]],[o[2],o[3]]]:e}),[])}const b=e=>{var t;const o=(0,i.useRef)(),r=(0,i.useCallback)((e=>{const{current:t}=o;t&&t.setTooltip(e)}),[]),{formData:l,payload:n,setControlValue:c,onAddFilter:d,height:u,width:p}=e,f=(0,i.useMemo)((()=>l.autozoom&&(S(n.data.features)||[]).length?(0,g.A)(e.viewport,{width:p,height:u,points:S(n.data.features)||[]}):e.viewport),[l.autozoom,u,null==n||null==(t=n.data)?void 0:t.features,e.viewport,p]),h=k({onContextMenu:e.onContextMenu,filterState:e.filterState,setDataMask:e.setDataMask,setTooltip:r,onAddFilter:d,payload:n,formData:l,emitCrossFilters:e.emitCrossFilters});return(0,a.Y)(s.S,{ref:o,mapboxApiAccessToken:n.data.mapboxApiKey,viewport:f,layers:[h],mapStyle:l.mapbox_style,setControlValue:c,height:u,width:p})},x=(0,i.memo)(b)},49529:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>_,getHighlightLayer:()=>m,getLayer:()=>f,getPoints:()=>h});var a=o(2445),i=o(93237),r=o(74098),l=o(96469),n=o(92123),s=o(83860),c=o(98456),d=o(832),u=o(52480),p=o(51316);function g(e){return(0,a.Y)("div",{className:"deckgl-tooltip",children:(0,a.Y)(u.A,{label:(0,r.t)("Centroid (Longitude and Latitude): "),value:`(${null==e?void 0:e.coordinate[0]}, ${null==e?void 0:e.coordinate[1]})`})})}const f=({formData:e,onContextMenu:t,filterState:o,setDataMask:a,setTooltip:r,payload:n,emitCrossFilters:d})=>{var u,p;const f=e,{intensity:h=1,radius_pixels:m=30,aggregation:_="SUM",js_data_mutator:v,linear_color_scheme:y}=f;let C=n.data.features;v&&(C=(0,c.A)(f.js_data_mutator)(C));const k=null==(u=(0,l.A)())||null==(u=u.get(y))?void 0:u.createLinearScale([0,6]),S=f.color_scheme_type,b=null==(p=(0,s.XC)({defaultBreakpointsColor:f.deafult_breakpoint_color,colorBreakpoints:f.color_breakpoints,fixedColor:f.color_picker,colorSchemeType:S,colorScale:k}))?void 0:p.reverse();return new i.A({id:`heatmap-layer-${f.slice_id}`,data:C,intensity:h,radiusPixels:m,colorRange:b,aggregation:_.toUpperCase(),getPosition:e=>e.position,getWeight:e=>e.weight?e.weight:1,...(0,s.T$)({formData:f,setTooltip:r,setTooltipContent:g,setDataMask:a,filterState:o,onContextMenu:t,emitCrossFilters:d})})};function h(e){return e.map((e=>e.position))}const m=({formData:e,filterState:t,payload:o})=>{const a=e,{intensity:r=1,radius_pixels:l=30,aggregation:s="SUM",js_data_mutator:d}=a;let u=o.data.features;d&&(u=(0,c.A)(a.js_data_mutator)(u));const g=u.filter((e=>(0,n.st)(e.position,null==t?void 0:t.value)));return new i.A({id:`heatmap-layer-${a.slice_id}`,data:g,intensity:r,radiusPixels:l,colorRange:[[p.Fe[0],p.Fe[1],p.Fe[2],55],p.Fe],aggregation:s.toUpperCase(),getPosition:e=>e.position,getWeight:e=>e.weight?e.weight:1})},_=(0,d.y)(f,h,m)},58505:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>D});var a=o(2404),i=o.n(a),r=o(2445),l=o(96540),n=o(90924),s=o(74842),c=o(79378),d=o(67413),u=o(35942),p=o(84193),g=o.n(p);function f(e,t,o=!0,a={}){if(!e.datasource)return;const i=new(g())("/"),r=function(e="base"){let t="/explore/";return["json","csv","query","results","samples"].includes(e)&&(t="/superset/explore_json/"),t}(t),l=i.search(!0);Object.keys(a).forEach((e=>{l[e]=a[e]})),l.form_data=function(e){const t=new Set;return JSON.stringify(e,((e,o)=>{if("object"==typeof o&&null!==o){if(t.has(o))try{return JSON.parse(JSON.stringify(o))}catch(e){return}t.add(o)}return o}))}(e),"standalone"===t&&(l.standalone="true");const n=i.directory(r).search(l).toString();return!o&&n.length>8e3?f({datasource:e.datasource,viz_type:e.viz_type},t,!1,{URL_IS_TOO_LONG_TO_SHARE:null}):n}var h=o(73087),m=o(85926),_=o(93405),v=o(76185),y=o(99599),C=o(46217),k=o(83374),S=o(69710),b=o(49529),x=o(83177);const w={deck_grid:h.getLayer,deck_screengrid:m.getLayer,deck_path:_.getLayer,deck_hex:v.getLayer,deck_scatter:y.getLayer,deck_geojson:C.getLayer,deck_arc:k.getLayer,deck_polygon:S.getLayer,deck_heatmap:b.getLayer,deck_contour:x.getLayer};var A=o(48238);const P=e=>{const t=(0,l.useRef)(),o=(0,l.useCallback)((()=>{let t={...e.viewport};const o=[...(0,S.getPoints)(e.payload.data.features.deck_polygon||[]),...(0,_.getPoints)(e.payload.data.features.deck_path||[]),...(0,h.getPoints)(e.payload.data.features.deck_grid||[]),...(0,y.getPoints)(e.payload.data.features.deck_scatter||[]),...(0,x.getPoints)(e.payload.data.features.deck_contour||[]),...(0,b.getPoints)(e.payload.data.features.deck_heatmap||[]),...(0,v.getPoints)(e.payload.data.features.deck_hex||[]),...(0,k.getPoints)(e.payload.data.features.deck_arc||[]),...(0,C.getPoints)(e.payload.data.features.deck_geojson||[]),...(0,m.getPoints)(e.payload.data.features.deck_screengrid||[])];return e.formData&&(t=(0,A.A)(t,{width:e.width,height:e.height,points:o})),t.zoom<0&&(t.zoom=0),t}),[e]),[a,p]=(0,l.useState)(o()),[g,P]=(0,l.useState)({}),D=(0,l.useCallback)((e=>{const{current:o}=t;o&&o.setTooltip(e)}),[]),M=(0,l.useCallback)(((e,t,o)=>o?o.indexOf(e):t),[]),T=(0,l.useCallback)(((e,t,o)=>{var a;const i=t.layer_filter_scope,r=[...e.form_data.extra_filters||[],...t.extra_filters||[]],l=[...(null==(a=e.form_data)?void 0:a.adhoc_filters)||[]];if(i){const e=t.filter_data_mapping||{};let a=!1;if(Object.entries(i).forEach((([t,i])=>{if((0,n.A)(i).includes(o)){a=!0;const o=e[t]||[];r.push(...o)}})),a){const e=t.adhoc_filters||[];l.push(...e)}}else{var s;const e=(null==(s=t.extra_form_data)?void 0:s.filters)||[];r.push(...e);const o=t.adhoc_filters||[];l.push(...o)}return{extraFilters:r,adhocFilters:l}}),[]),j=(0,l.useCallback)(((t,o)=>w[t.form_data.viz_type]({formData:t.form_data,payload:o,setTooltip:D,datasource:e.datasource,onSelect:e.onSelect})),[e.onSelect,e.datasource,D]),L=(0,l.useCallback)(((e,t,o)=>{const a=M(e.slice_id,o,t.deck_slices);let i=[],r=[];if((window.location.href||"").includes("explore"))r=(t.adhoc_filters||[]).map((e=>{if(!(0,s.A)(null==e?void 0:e.layerFilterScope))return e;if(Array.isArray(e.layerFilterScope)&&e.layerFilterScope.length>0){if(e.layerFilterScope.includes(-1))return e;if(e.layerFilterScope.includes(a))return e}})).filter((e=>(0,s.A)(e)));else{const{extraFilters:o,adhocFilters:l}=T(e,t,a);i=o,r=l}const l={...e,form_data:{...e.form_data,extra_filters:i,adhoc_filters:r}},n=f(l.form_data,"json");n&&c.A.get({endpoint:n}).then((({json:e})=>{const t=j(l,e);P((e=>({...e,[l.slice_id]:t})))})).catch((e=>{console.error(`Error loading layer for slice ${l.slice_id}:`,e)}))}),[M,T,j]),F=(0,l.useCallback)(((e,t,a)=>{p(o()),P({}),t.data.slices.forEach(((t,o)=>{L(t,e,o)}))}),[o,L]),$=(0,d.Z)(e.formData.deck_slices);(0,l.useEffect)((()=>{const{formData:t,payload:o}=e;!i()($,t.deck_slices)&&F(t,o)}),[F,$,e]);const{payload:z,formData:N,setControlValue:R,height:O,width:W}=e,V=Object.values(g);return(0,r.Y)(u.S,{ref:t,mapboxApiAccessToken:z.data.mapboxApiKey,viewport:a,layers:V,mapStyle:N.mapbox_style,setControlValue:R,onViewportChange:p,height:O,width:W})},D=(0,l.memo)(P)},69710:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>C,getLayer:()=>_,getPoints:()=>v});var a=o(2445),i=o(96540),r=o(74098),l=o(43850),n=o(28027),s=o(52480),c=o(51316),d=o(83860),u=o(98456);function p(e){return"geometry"in e.polygon?e.polygon.geometry.coordinates[0]:e.polygon}var g=o(48238),f=o(35942),h=o(92123),m=o(99894);const _=function({formData:e,payload:t,setTooltip:o,filterState:i,setDataMask:n,onContextMenu:g,onSelect:f,emitCrossFilters:_}){const v=e,y=v.fill_color_picker,C=v.stroke_color_picker,k=v.deafult_breakpoint_color;let S=[...t.data.features];v.js_data_mutator&&(S=(0,u.A)(v.js_data_mutator)(S));const b=v.color_scheme_type,x=v.metric?v.metric.label||v.metric:null,w=e=>e[x];let A;switch(b){case h.wP.fixed_color:A=()=>[y.r,y.g,y.b,255*y.a];break;case h.wP.linear_palette:A=null===v.metric?()=>[y.r,y.g,y.b,255*y.a]:(0,c.L6)(v,S,w);break;case h.wP.color_breakpoints:{const e=v.color_breakpoints;A=t=>{var o;const a=(0,d.JV)(w,t,e),i=void 0!==a&&(null==(o=e[a-1])?void 0:o.color);return i?[i.r,i.g,i.b,255]:k?[k.r,k.g,k.b,255*k.a]:[m.DL.r,m.DL.g,m.DL.b,255*m.DL.a]};break}default:A=()=>[y.r,y.g,y.b,255*y.a]}const P=e=>{var t;const o=A(e)||c.LC,a=p(e),r=JSON.stringify(a).replaceAll(" ","")===(null==i||null==(t=i.value)?void 0:t[0]);return null!=i&&i.value&&!r&&(o[3]/=3),o},D=v.line_column&&v.metric&&["json","geohash","zipcode"].includes(v.line_type)?function(e){return t=>{var o,i,l,n;const c=(null==e||null==(o=e.metric)?void 0:o.label)||(null==e?void 0:e.metric);return(0,a.FD)("div",{className:"deckgl-tooltip",children:[(null==(i=t.object)?void 0:i.name)&&(0,a.Y)(s.A,{label:(0,r.t)("name")+": ",value:`${t.object.name}`}),(null==(l=t.object)?void 0:l[null==e?void 0:e.line_column])&&(0,a.Y)(s.A,{label:`${e.line_column}: `,value:`${t.object[e.line_column]}`}),(null==e?void 0:e.metric)&&(0,a.Y)(s.A,{label:`${c}: `,value:`${null==(n=t.object)?void 0:n[c]}`})]})}}(v):()=>null;return new l.A({id:`path-layer-${v.slice_id}`,data:S,filled:v.filled,stroked:v.stroked,getPolygon:p,getFillColor:P,getLineColor:C?[C.r,C.g,C.b,255*C.a]:void 0,getLineWidth:v.line_width,extruded:v.extruded,lineWidthUnits:v.line_width_unit,getElevation:e=>function(e,t){return 0===t(e)[3]?0:e.elevation}(e,P),elevationScale:v.multiplier,fp64:!0,opacity:v.opacity?v.opacity/100:1,...(0,d.T$)({formData:v,setTooltip:o,setTooltipContent:D,onSelect:f,filterState:i,onContextMenu:g,setDataMask:n,emitCrossFilters:_})})};function v(e){return e.flatMap(p)}const y=e=>{const t=(0,i.useRef)(),o=(0,i.useCallback)((()=>{let t={...e.viewport};if(e.formData.autozoom){const o=e.payload.data.features||[];t=(0,g.A)(t,{width:e.width,height:e.height,points:v(o)})}return t.zoom<0&&(t.zoom=0),t}),[e]),[r,l]=(0,i.useState)(o()),[s,d]=(0,i.useState)(e.payload.form_data);(0,i.useEffect)((()=>{const{payload:t}=e;t.form_data!==s&&(l(o()),d(t.form_data))}),[o,e,s,r]);const u=(0,i.useCallback)((e=>{const{current:o}=t;o&&o.setTooltip(e)}),[]),p=(0,i.useCallback)((()=>{const{formData:t,payload:o,onAddFilter:a,onContextMenu:i,setDataMask:r,filterState:l,emitCrossFilters:n}=e;return void 0===e.payload.data.features?[]:[_({formData:t,payload:o,onAddFilter:a,setTooltip:u,onContextMenu:i,setDataMask:r,filterState:l,emitCrossFilters:n})]}),[u,e]),{payload:m,formData:y,setControlValue:C}=e,k=y.metric?y.metric.label||y.metric:null,S=y.color_scheme_type===h.wP.color_breakpoints?(0,c.BK)(y.color_breakpoints):(0,c.y1)(y,m.data.features,(e=>e[k]));return(0,a.FD)("div",{style:{position:"relative"},children:[(0,a.Y)(f.S,{ref:t,viewport:r,layers:p(),setControlValue:C,mapStyle:y.mapbox_style,mapboxApiAccessToken:m.data.mapboxApiKey,width:e.width,height:e.height}),null!==y.metric&&(0,a.Y)(n.A,{categories:S,position:y.legend_position,format:y.legend_format})]})},C=(0,i.memo)(y)},73087:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>_,getHighlightLayer:()=>m,getLayer:()=>f,getPoints:()=>h});var a=o(2445),i=o(58128),r=o(74098),l=o(14503),n=o(83860),s=o(98456),c=o(832),d=o(52480),u=o(92123),p=o(51316);function g(e){return(0,a.FD)("div",{className:"deckgl-tooltip",children:[(0,a.Y)(d.A,{label:(0,r.t)("Longitude and Latitude")+": ",value:`${e.coordinate[0]}, ${e.coordinate[1]}`}),(0,a.Y)(d.A,{label:(0,r.t)("Height")+": ",value:`${e.object.elevationValue}`})]})}const f=function({formData:e,payload:t,setTooltip:o,setDataMask:a,onContextMenu:r,filterState:c,emitCrossFilters:d}){const p=e,f=p.color_scheme,h=l.getScale(f);let m=t.data.features;p.js_data_mutator&&(m=(0,s.A)(p.js_data_mutator)(m));const _=p.color_breakpoints,v=p.color_scheme_type,y=(0,n.XC)({defaultBreakpointsColor:p.deafult_breakpoint_color,colorSchemeType:v,colorScale:h,colorBreakpoints:_,fixedColor:p.color_picker}),C=(0,n.g_)(p.js_agg_function,(e=>e.weight)),k=v===u.wP.color_breakpoints?e=>(0,n.JV)(C,e,_):C;return new i.A({id:`grid-layer-${p.slice_id}-${JSON.stringify(_)}`,data:m,cellSize:p.grid_size,extruded:p.extruded,colorDomain:v===u.wP.color_breakpoints&&y?[0,y.length]:void 0,colorRange:y,outline:!1,getElevationValue:C,getColorValue:k,...(0,n.T$)({formData:p,setDataMask:a,setTooltip:o,setTooltipContent:g,filterState:c,onContextMenu:r,emitCrossFilters:d}),opacity:null!=c&&c.value?.1:1})};function h(e){return e.map((e=>e.position))}const m=function({formData:e,payload:t,filterState:o}){var a;const r=e;let l=t.data.features;r.js_data_mutator&&(l=(0,s.A)(r.js_data_mutator)(l));const c=(0,n.g_)(r.js_agg_function,(e=>e.weight)),d=new Set(null==o||null==(a=o.value)?void 0:a.map((e=>`${e[0]},${e[1]}`)));return new i.A({id:`grid-highlight-layer-${r.slice_id}-${JSON.stringify(null==o?void 0:o.value)}`,data:l,cellSize:r.grid_size,extruded:r.extruded,colorDomain:[0,1],colorRange:[p.LC,p.Fe],colorAggregation:"MAX",outline:!1,getElevationValue:c,getColorWeight:e=>d.has(`${e.position[0]},${e.position[1]}`)?1:0,opacity:1})},_=(0,c.y)(f,h,m)},76185:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>_,getHighlightLayer:()=>m,getLayer:()=>f,getPoints:()=>h});var a=o(2445),i=o(37947),r=o(74098),l=o(14503),n=o(92123),s=o(83860),c=o(98456),d=o(832),u=o(52480),p=o(51316);function g(e){return(0,a.FD)("div",{className:"deckgl-tooltip",children:[(0,a.Y)(u.A,{label:(0,r.t)("Centroid (Longitude and Latitude): "),value:`(${e.coordinate[0]}, ${e.coordinate[1]})`}),(0,a.Y)(u.A,{label:(0,r.t)("Height")+": ",value:`${e.object.elevationValue}`})]})}const f=function({formData:e,payload:t,setTooltip:o,onContextMenu:a,filterState:r,setDataMask:d,emitCrossFilters:u}){const p=e,f=p.color_scheme,h=l.getScale(f);let m=t.data.features;p.js_data_mutator&&(m=(0,c.A)(p.js_data_mutator)(m));const _=p.color_scheme_type,v=(0,s.XC)({defaultBreakpointsColor:p.deafult_breakpoint_color,colorBreakpoints:p.color_breakpoints,fixedColor:p.color_picker,colorSchemeType:_,colorScale:h}),y=p.color_breakpoints,C=(0,s.g_)(p.js_agg_function,(e=>e.weight)),k=_===n.wP.color_breakpoints?e=>(0,s.JV)(C,e,y):C;return new i.A({id:`hex-layer-${p.slice_id}-${JSON.stringify(y)}`,data:m,radius:p.grid_size,extruded:p.extruded,colorDomain:_===n.wP.color_breakpoints&&v?[0,v.length]:void 0,colorRange:v,outline:!1,getElevationValue:C,getColorValue:k,...(0,s.T$)({formData:p,setTooltip:o,setTooltipContent:g,setDataMask:d,filterState:r,onContextMenu:a,emitCrossFilters:u}),opacity:null!=r&&r.value?.3:1})};function h(e){return e.map((e=>e.position))}const m=function({formData:e,payload:t,filterState:o}){var a;const r=e;let l=t.data.features;r.js_data_mutator&&(l=(0,c.A)(r.js_data_mutator)(l));const n=(0,s.g_)(r.js_agg_function,(e=>e.weight)),d=new Set(null==o||null==(a=o.value)?void 0:a.map((e=>`${e[0]},${e[1]}`)));return new i.A({id:`hex-highlight-layer-${r.slice_id}-${JSON.stringify(null==o?void 0:o.value)}`,data:l,radius:r.grid_size,extruded:r.extruded,colorDomain:[0,1],colorRange:[p.LC,p.Fe],colorAggregation:"MAX",outline:!1,getElevationValue:n,getColorWeight:e=>d.has(`${e.position[0]},${e.position[1]}`)?1:0,opacity:1})},_=(0,d.y)(f,h,m)},83177:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>m,getHighlightLayer:()=>h,getLayer:()=>g,getPoints:()=>f});var a=o(2445),i=o(15653),r=o(43850),l=o(74098),n=o(83860),s=o(98456),c=o(832),d=o(52480),u=o(51316);function p(e){var t;return(0,a.FD)("div",{className:"deckgl-tooltip",children:[(0,a.Y)(d.A,{label:(0,l.t)("Centroid (Longitude and Latitude): "),value:`(${null==e?void 0:e.coordinate[0]}, ${null==e?void 0:e.coordinate[1]})`}),(0,a.Y)(d.A,{label:(0,l.t)("Threshold: "),value:`${null==e||null==(t=e.object)||null==(t=t.contour)?void 0:t.threshold}`})]})}const g=function({formData:e,payload:t,filterState:o,setDataMask:a,onContextMenu:r,setTooltip:l,emitCrossFilters:c}){const d=e,{aggregation:u="SUM",js_data_mutator:g,contours:f,cellSize:h="200"}=d;let m=t.data.features;const _=null==f?void 0:f.map((e=>{const{lowerThreshold:t,upperThreshold:o,color:a,strokeWidth:i}=e;return o?{threshold:[t,o],color:[a.r,a.g,a.b]}:{threshold:t,color:[a.r,a.g,a.b],strokeWidth:i}}));return g&&(m=(0,s.A)(d.js_data_mutator)(m)),new i.A({id:`contourLayer-${d.slice_id}`,data:m,contours:_,cellSize:Number(h||"200"),aggregation:u.toUpperCase(),getPosition:e=>e.position,getWeight:e=>e.weight||0,...(0,n.T$)({formData:d,setTooltip:l,setTooltipContent:p,onContextMenu:r,setDataMask:a,filterState:o,emitCrossFilters:c})})};function f(e){return e.map((e=>e.position))}const h=function({formData:e,filterState:t,setDataMask:o,onContextMenu:a,setTooltip:i,emitCrossFilters:l}){const s=e,c=null==t?void 0:t.value[0],d=null==t?void 0:t.value[1],g=c[0],f=d[0],h=c[1],m=d[1],_=[[g,h],[f,h],[f,m],[g,m],[g,h]];return new r.A({id:`contour-highlight-layer-${s.slice_id}`,data:[{polygon:_}],getPolygon:e=>e.polygon,getFillColor:[u.Fe[0],u.Fe[1],u.Fe[2],100],getLineColor:u.Fe,getLineWidth:4,filled:!0,stroked:!0,...(0,n.T$)({formData:s,setTooltip:i,setTooltipContent:p,onContextMenu:a,setDataMask:o,filterState:t,emitCrossFilters:l})})},m=(0,c.y)(g,f,h)},85926:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>j,getLayer:()=>T,getPoints:()=>D});var a=o(2445),i=o(38706),r=o(23612),l=o(5855),n=o(53112),s=o(98413),c=o(25140),d=o(15473),u=o(82849),p=o(78579);const g={name:"screenGrid",vs:"uniform screenGridUniforms {\n  vec2 cellSizeClipspace;\n  vec2 gridSizeClipspace;\n  vec2 colorDomain;\n} screenGrid;\n",uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};class f extends d.A{getShaders(){return super.getShaders({vs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\nin vec2 positions;\nin vec2 instancePositions;\nin float instanceWeights;\nin vec3 instancePickingColors;\nuniform sampler2D colorRange;\nout vec4 vColor;\nvec4 interp(float value, vec2 domain, sampler2D range) {\nfloat r = (value - domain.x) / (domain.y - domain.x);\nreturn texture(range, vec2(r, 0.5));\n}\nvoid main(void) {\nif (isnan(instanceWeights)) {\ngl_Position = vec4(0.);\nreturn;\n}\nvec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;\npos.x = pos.x - 1.0;\npos.y = 1.0 - pos.y;\ngl_Position = vec4(pos, 0., 1.);\nvColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);\nvColor.a *= layer.opacity;\npicking_setPickingColor(instancePickingColors);\n}\n",fs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-fragment-shader\nprecision highp float;\nin vec4 vColor;\nout vec4 fragColor;\nvoid main(void) {\nfragColor = vColor;\nDECKGL_FILTER_COLOR(fragColor, geometry);\n}\n",modules:[u.A,g]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(e){super.updateState(e);const{props:t,oldProps:o,changeFlags:a}=e,i=this.state.model;if(o.colorRange!==t.colorRange){var r;null==(r=this.state.colorTexture)||r.destroy(),this.state.colorTexture=(0,p.cp)(this.context.device,t.colorRange,t.colorScaleType);const e={colorRange:this.state.colorTexture};i.shaderInputs.setProps({screenGrid:e})}else o.colorScaleType!==t.colorScaleType&&(0,p.Pu)(this.state.colorTexture,t.colorScaleType);if(o.cellMarginPixels!==t.cellMarginPixels||o.cellSizePixels!==t.cellSizePixels||a.viewportChanged){const{width:e,height:t}=this.context.viewport,{cellSizePixels:o,cellMarginPixels:a}=this.props,r=Math.max(o-a,0),l={gridSizeClipspace:[o/e*2,o/t*2],cellSizeClipspace:[r/e*2,r/t*2]};i.shaderInputs.setProps({screenGrid:l})}}finalizeState(e){var t;super.finalizeState(e),null==(t=this.state.colorTexture)||t.destroy()}draw({uniforms:e}){const t=this.props.colorDomain(),o=this.state.model,a={colorDomain:t};o.shaderInputs.setProps({screenGrid:a}),o.draw(this.context.renderPass)}_getModel(){return new s.K(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new c.V({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}}f.layerName="ScreenGridCellLayer";const h=f,m={name:"binOptions",vs:"uniform binOptionsUniforms {\n  float cellSizePixels;\n} binOptions;\n",uniformTypes:{cellSizePixels:"f32"}},_={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:p.QO,colorScaleType:"linear",getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"};class v extends n.A{getAggregatorType(){return this.props.gpuAggregation&&r.V.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(e){return"cpu"!==e&&r.V.isSupported(this.context.device)?new r.V(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[i.A,m],vs:"\n  in vec3 positions;\n  in vec3 positions64Low;\n  in float counts;\n  \n  void getBin(out ivec2 binId) {\n    vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));\n    vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;\n    vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);\n    binId = ivec2(gridCoords);\n  }\n  void getValue(out float weight) {\n    weight = counts;\n  }\n  "})}):new l.M({dimensions:2,getBin:{sources:["positions"],getValue:({positions:e},t,o)=>{const a=this.context.viewport,i=a.project(e),r=o.cellSizePixels;return i[0]<0||i[0]>=a.width||i[1]<0||i[1]>=a.height?null:[Math.floor(i[0]/r),Math.floor(i[1]/r)]}},getValue:[{sources:["counts"],getValue:({counts:e})=>e}]})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){const t=super.updateState(e),{props:o,oldProps:a,changeFlags:i}=e,{cellSizePixels:l,aggregation:n}=o;if(t||i.dataChanged||i.updateTriggersChanged||i.viewportChanged||n!==a.aggregation||l!==a.cellSizePixels){const{width:e,height:t}=this.context.viewport,{aggregator:o}=this.state;o instanceof r.V&&o.setProps({binIdRange:[[0,Math.ceil(e/l)],[0,Math.ceil(t/l)]]}),o.setProps({pointCount:this.getNumInstances(),operations:[n],binOptions:{cellSizePixels:l}})}return i.viewportChanged&&this.state.aggregator.setNeedsUpdate(),t}onAttributeChange(e){const{aggregator:t}=this.state;switch(e){case"positions":t.setNeedsUpdate();break;case"counts":t.setNeedsUpdate(0)}}renderLayers(){const{aggregator:e}=this.state,t=this.getSubLayerClass("cells",h),o=e.getBins(),a=e.getResult(0);return new t(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:e.binCount,attributes:{getBin:o,getWeight:a}},dataComparator:(e,t)=>e.length===t.length,updateTriggers:{getBin:[o],getWeight:[a]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||e.getResultDomain(0),extensions:[]})}getPickingInfo(e){const t=e.info,{index:o}=t;if(o>=0){const e=this.state.aggregator.getBin(o);let a;e&&(a={col:e.id[0],row:e.id[1],value:e.value[0],count:e.count},e.pointIndices&&(a.pointIndices=e.pointIndices,a.points=Array.isArray(this.props.data)?e.pointIndices.map((e=>this.props.data[e])):[])),t.object=a}return t}}v.layerName="ScreenGridLayer",v.defaultProps=_;const y=v;var C=o(74098),k=o(14503),S=o(92123),b=o(98456),x=o(83860),w=o(52480),A=o(832),P=o(51316);function D(e){return e.map((e=>e.position))}function M(e){var t,o,i;return(0,a.FD)("div",{className:"deckgl-tooltip",children:[(0,a.Y)(w.A,{label:(0,C.t)("Longitude and Latitude")+": ",value:`${null==e||null==(t=e.coordinate)?void 0:t[0]}, ${null==e||null==(o=e.coordinate)?void 0:o[1]}`}),(0,a.Y)(w.A,{label:(0,C.t)("Weight")+": ",value:`${null==(i=e.object)?void 0:i.value}`})]})}const T=function({formData:e,setDataMask:t,filterState:o,onContextMenu:a,payload:i,setTooltip:r,emitCrossFilters:l}){const n=e,s=n.color_scheme,c=k.getScale(s);let d=i.data.features;n.js_data_mutator&&(d=(0,b.A)(n.js_data_mutator)(d));const u=n.color_scheme_type,p=(0,x.XC)({defaultBreakpointsColor:n.deafult_breakpoint_color,colorBreakpoints:n.color_breakpoints,fixedColor:n.color_picker,colorSchemeType:u,colorScale:c});return new y({id:`screengrid-layer-${n.slice_id}`,data:d,cellSizePixels:n.grid_size,colorDomain:u===S.wP.color_breakpoints&&p?[0,p.length]:void 0,colorRange:"default"===u?[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]]:p,outline:!1,...(0,x.T$)({formData:n,setDataMask:t,setTooltip:r,setTooltipContent:M,filterState:o,onContextMenu:a,emitCrossFilters:l}),getWeight:e=>e.weight||0,colorScaleType:"default"===u?"linear":"quantize",opacity:null!=o&&o.value?.3:1})},j=(0,A.y)(T,D,(function({formData:e,filterState:t,payload:o}){const a=e;let i=o.data.features;a.js_data_mutator&&(i=(0,b.A)(a.js_data_mutator)(i));const r=i.filter((e=>(0,S.st)(e.position,null==t?void 0:t.value)));return new y({id:`screengrid-highlight-layer-${e.slice_id}`,data:r,cellSizePixels:e.grid_size,colorDomain:[0,1],colorRange:[P.LC,P.Fe],outline:!1,getWeight:e=>e.weight||0,colorScaleType:"quantize"})}))},93405:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>f,getHighlightLayer:()=>g,getLayer:()=>u,getPoints:()=>p});var a=o(2445),i=o(23096),r=o(83860),l=o(98456),n=o(832),s=o(52480),c=o(51316);function d(e){var t;return(null==(t=e.object)?void 0:t.extraProps)&&(0,a.Y)("div",{className:"deckgl-tooltip",children:Object.keys(e.object.extraProps).map(((t,o)=>(0,a.Y)(s.A,{label:`${t}: `,value:`${e.object.extraProps[t]}`},`prop-${o}`)))})}const u=function({formData:e,payload:t,onContextMenu:o,filterState:a,setDataMask:n,setTooltip:s,emitCrossFilters:c}){const u=e,p=u.color_picker,g=[p.r,p.g,p.b,255*p.a];let f=t.data.features.map((e=>({...e,path:e.path,width:u.line_width,color:g})));return u.js_data_mutator&&(f=(0,l.A)(u.js_data_mutator)(f)),new i.A({id:`path-layer-${u.slice_id}`,getColor:e=>e.color,getPath:e=>e.path,getWidth:e=>e.width,data:f,rounded:!0,widthScale:1,widthUnits:u.line_width_unit,...(0,r.T$)({formData:u,setTooltip:s,setTooltipContent:d,setDataMask:n,filterState:a,onContextMenu:o,emitCrossFilters:c}),opacity:null!=a&&a.value?.3:1})};function p(e){let t=[];return e.forEach((e=>{t=t.concat(e.path)})),t}const g=function({formData:e,payload:t,filterState:o}){const a=e,r=c.Fe;let n=t.data.features.map((e=>({...e,path:e.path,width:a.line_width,color:r})));a.js_data_mutator&&(n=(0,l.A)(a.js_data_mutator)(n));const s=n.filter((e=>JSON.stringify(e.path).replaceAll(" ","")===(null==o?void 0:o.value[0])));return new i.A({id:`path-highlight-layer-${a.slice_id}`,getColor:()=>c.Fe,getPath:e=>e.path,getWidth:e=>e.width,data:s,rounded:!0,widthScale:1,widthUnits:a.line_width_unit})},f=(0,n.y)(u,p,g)},99599:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>v,getHighlightLayer:()=>_,getLayer:()=>m,getPoints:()=>f});var a=o(2445),i=o(49924),r=o(34142),l=o(74098),n=o(92123),s=o(83860),c=o(832),d=o(52480);const u=1609.34;function p(e,t){return"square_m"===e?Math.sqrt(t/Math.PI):"radius_m"===e?t:"radius_km"===e?1e3*t:"radius_miles"===e?t*u:"square_km"===e?1e3*Math.sqrt(t/Math.PI):"square_miles"===e?Math.sqrt(t/Math.PI)*u:null}var g=o(51316);function f(e){return e.map((e=>e.position))}function h(e,t){return o=>{var i,n,s,c,u,p,g;const f=(null==t?void 0:t[e.point_radius_fixed.value])||(0,r.A)(null==(i=e.point_radius_fixed)?void 0:i.value);return(0,a.FD)("div",{className:"deckgl-tooltip",children:[(0,a.Y)(d.A,{label:(0,l.t)("Longitude and Latitude")+": ",value:`${null==(n=o.object)||null==(n=n.position)?void 0:n[0]}, ${null==(s=o.object)||null==(s=s.position)?void 0:s[1]}`}),(null==(c=o.object)?void 0:c.cat_color)&&(0,a.Y)(d.A,{label:(0,l.t)("Category")+": ",value:`${null==(u=o.object)?void 0:u.cat_color}`}),(null==(p=o.object)?void 0:p.metric)&&(0,a.Y)(d.A,{label:`${f}: `,value:`${null==(g=o.object)?void 0:g.metric}`})]})}}const m=function({formData:e,payload:t,setTooltip:o,setDataMask:a,filterState:r,onContextMenu:l,datasource:n,emitCrossFilters:c}){const d=e,u=t.data.features.map((e=>{let t=p(d.point_unit,e.radius)||10;if(d.multiplier&&(t*=d.multiplier),e.color)return{...e,radius:t};const o=d.color_picker||{r:0,g:0,b:0,a:1},a=[o.r,o.g,o.b,255*o.a];return{...e,radius:t,color:a}}));return new i.A({id:`scatter-layer-${d.slice_id}`,data:u,fp64:!0,getFillColor:e=>e.color,getRadius:e=>e.radius,radiusMinPixels:Number(d.min_radius)||void 0,radiusMaxPixels:Number(d.max_radius)||void 0,stroked:!1,...(0,s.T$)({formData:d,setTooltip:o,setTooltipContent:h(d,null==n?void 0:n.verboseMap),setDataMask:a,filterState:r,onContextMenu:l,emitCrossFilters:c}),opacity:null!=r&&r.value?.3:1})},_=function({formData:e,payload:t,filterState:o}){const a=e,r=t.data.features.map((e=>{let t=p(a.point_unit,e.radius)||10;return a.multiplier&&(t*=a.multiplier),{...e,radius:t}})).filter((e=>(0,n.st)(e.position,null==o?void 0:o.value)));return new i.A({id:`scatter-highlight-layer-${a.slice_id}`,data:r,fp64:!0,getFillColor:()=>g.Fe,getRadius:e=>e.radius,radiusMinPixels:Number(a.min_radius)||void 0,radiusMaxPixels:Number(a.max_radius)||void 0,stroked:!1})},v=(0,c.c)(m,f,_)}}]);