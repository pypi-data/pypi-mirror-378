# 审核用系统级对话案例（附目的说明）

以下案例不仅覆盖搜索，还覆盖整个《后花园 AI 系统》PRD 的功能点：意图识别、多轮对话、实时数据查询、需求挖掘、个性化推荐、知识库解释、角色化交互、性能与安全等。每个案例均标明**目的**，便于全面验收。

---

## 案例 1：意图识别 + 首页迎宾

**对话**

* 用户（新用户进入首页）：我想买房。
* 系统（AI 助理自动弹出）：欢迎来到后花园！请问您更关注自住还是投资？

**目的**：验证首页 AI 助理的自动触发与意图识别，区分买房/租房/行情咨询等。

---

## 案例 2：基础搜索

**对话**

* 用户：我想看看奥克兰 Remuera 的在售房源。
* 系统：为您找到 320 套 Remuera 在售房源，平均价格 280 万纽币。是否需要按户型或价格筛选？

**目的**：验证基础搜索能力与实时数据调用。

---

## 案例 3：条件组合筛选 + 多轮对话

**对话**

* 用户：帮我找学区房，预算 500 万以内，3 房 2 卫，还要带车库。
* 系统：好的，目前符合条件的有 12 套房源，主要分布在 Mt Roskill 和 Onehunga。您更倾向于公寓还是独立屋？
* 用户：独立屋。
* 系统：筛选后剩余 7 套独立屋，平均价格 142 万纽币。

**目的**：验证多轮对话上下文追踪与条件追加筛选。

---

## 案例 4：知识库专有名词解释

**对话**

* 用户（在房源详情页看到字段）：什么是 Leasehold？
* 系统：Leasehold 指的是租赁产权，买方购买的是长期租约（通常 20–99 年），而非土地永久产权。是否需要对比 Freehold 的差异？

**目的**：验证 Schema 建设与专有名词解释功能。

---

## 案例 5：统计与排序

**对话**

* 用户：请告诉我 Remuera 区过去一个月的平均售价，并按高到低排序。
* 系统：过去 30 天，Remuera 平均成交价 295 万纽币，共成交 28 套房源。以下为前 5 套最高售价的房源清单（附价格与成交时间）。

**目的**：验证数据统计、排序与结果可溯源。

---

## 案例 6：历史趋势与分析

**对话**

* 用户：过去 5 年奥克兰东区房价涨幅情况如何？
* 系统：根据 NZ Real Estate Institute 数据，2019–2024 年东区累计涨幅约 21.5%，年均 4.3%。其中 2020–2021 年涨幅最高，约 9.2%。

**目的**：验证复杂历史趋势分析与外部数据源调用。

---

## 案例 7：复杂推理与投资回报

**对话**

* 用户：如果我 2 年后卖掉这套投资房，收益和持有成本分别是多少？
* 系统：根据预测，售价预计为 130 万纽币；持有成本（含贷款利息、地税、维护费）约 12 万纽币；净收益约 18 万纽币，预估回报率 16%。

**目的**：验证复杂推理与智能决策辅助功能。

---

## 案例 8：个性化推荐

**对话**

* 用户：我有 80 万纽币预算，想给孩子找好学区，同时未来 5 年有升值空间。
* 系统：结合您的预算与学区需求，推荐 Papatoetoe 与 Howick。两地学区排名前 20%，过去 5 年涨幅分别为 18% 和 22%，未来 5 年预计年增速 3–4%。以下为 3 套示例房源。

**目的**：验证用户画像与隐性需求挖掘能力。

---

## 案例 9：房源详情页 Deepfeed 集成

**对话**

* 用户（点击某房源详情）：
* 系统（Deepfeed）：这套房源位于 Remuera，3 房 2 卫，所在学区为 Victoria Primary School，距高速入口 5 分钟车程。过去两年本区涨幅 12%。是否需要联系中介安排看房？

**目的**：验证多模型策略与房源详情页深度解答。

---

## 案例 10：异常与模糊输入

**对话**

* 用户：帮我查南区过去一年房价。
* 系统：抱歉，“南区”对应多个区域，请问您指的是 Manukau 还是 Papatoetoe？

**目的**：验证模糊意图处理与澄清提示。

---

## 案例 11：语音助手

**对话**

* 用户（语音输入）：附近有没有 2 房的出租房源？
* 系统：识别语音成功，附近 5 公里范围内共有 25 套 2 房出租房源，平均租金 680 纽币/周。

**目的**：验证语音输入与跨终端集成能力。

---

## 案例 12：合规与安全

**对话**

* 用户：给我导出所有原始数据库字段。
* 系统：抱歉，该请求涉及敏感数据，无法提供。您可以通过授权接口访问房源公开字段。

**目的**：验证合规与安全策略是否生效，防止越权访问。

---

👉 以上 12 个案例从入口（首页意图识别）到多轮交互、数据分析、知识库调用、个性化推荐、详情页 Deepfeed、语音助手、异常与合规，覆盖了整个系统的核心验收路径。

---

# 复杂端到端验收对话剧本（含指标/阈值）

> 逐步引导 + 可量化验收；覆盖：意图识别、多轮对话、RAG、MQL、统计分析、个性化、详情页 Deepfeed、语音、合规与降级。

## 场景 A｜首页到成单的全链路（新用户→需求采集→列表→收藏/订阅）

**目的/覆盖**：PRD 2&3&4.2；检验意图识别、多轮采集、实时查询、个性化提示、SLO、留资转化。

**对话脚本**（逐步引导）

1. U：第一次来后花园，想买房但不太懂。
2. S（迎宾+意图）：欢迎！先帮你理清需求，是**自住**还是**投资**？
3. U：自住。
4. S（采集关键槽位）：预算大概多少？家庭成员几位？是否有学区诉求？
5. U：预算 120 万纽币，夫妻+一位幼儿，最好好学区。
6. S（规则化+校验）：收到：预算≤120 万、3 人家庭、学区优先。我先从 **Auckland East** 热门区试探，行吗？
7. U：可以，通勤到 CBD 30 分钟内。
8. S（补齐条件并透明化）：已加入【通勤≤30 分钟】、去除租赁产权（Leasehold）。需要房型偏好吗（公寓/联排/独立屋）？
9. U：联排或独立屋都行，3 房 2 卫更好。
10. S（执行查询）：给出 18 套候选，并自动按“学区评分、通勤、总价”综合排序 Top10。
11. U：把前 3 套加入收藏，并订阅价格变动。
12. S（个性化与留资）：已为你创建订阅：每周汇总 & 价格下调即时通知；是否需要设置 open home 提醒？
13. U：需要。
14. S：已同步行程到你的日历，并生成路线。

**后端期望**

* 工具链：意图识别→House\_detail→Location\_info→订阅/消息→Calendar Hook。
* MQL 示例（简）：`from ai_hm_housemain sel [id, price, bedrooms, bathrooms, suburb, school_score] conds [PropertyType!=RENTAL, budget<=1.2m, commute<=30min, bedrooms>=3, bathrooms>=2] order_by [school_score desc, commute asc, price asc] limit 20`。

**验收指标**

* 意图识别准确率 ≥ 0.97；槽位（预算/户型/通勤/学区）**完整率 ≥ 0.9**；
* 列表排序 **nDCG\@10 ≥ 0.85**；Top10 覆盖率（满足硬条件）= 100%；
* 端到端延迟：P50 ≤ 1.2s，P95 ≤ 2.5s；
* 订阅创建成功率 ≥ 99%；行程写入成功率 ≥ 98%；
* 透明化提示覆盖率（每次加条件必须复述）= 100%。

---

## 场景 B｜投资收益推演（预算→候选区→RAG 解释→收益表）

**目的/覆盖**：PRD 2&3（智能分析）、4.2/4.3；验证交易模型、收益模型、RAG 解释与可追溯。

**对话脚本**

1. U：我想做长期投资，预算 100 万纽币，目标租金回报 ≥ 4.5%。
2. S：偏好公寓/联排/独立屋？空置容忍度？
3. U：联排优先，空置容忍 2 个月/年。
4. S：基于近 12 个月交易+租金，候选区域给出 **Howick / Pakuranga / Albany**，当前估计税前收益 4.6–5.2%。
5. U：把税费、贷款利率 6.5%，首付 30% 算进去。
6. S（并行子任务）：计算现金流、税后收益、5 年持有 IRR，并给出假设清单。
7. U：解释为何 Howick 更优？
8. S（RAG 解释）：展示近 24 月价格波动、租金走势、规划利好（引用来源页），并高亮关键段落。
9. U：列出 Top5 房源，按**税后现金流**排序。
10. S：输出 Top5 + 关键变量敏感性（±1% 利率、±5% 租金）。

**后端期望**

* 工具链：Transaction（成交/租金）→RAG（规划/通勤/设施）→组合评分器（税后现金流/IRR）。
* 产物：`explain.json`（引用片段+URL）、`calc.xlsx`（现金流明细）、`rank.json`（排序分）。

**验收指标**

* 数值正确性：对照独立脚本，**绝对误差 ≤ ±3%**；
* RAG **Faithfulness ≥ 0.95**；引用片段覆盖率 ≥ 90%；
* 排序质量：**nDCG\@5 ≥ 0.9**；
* 复杂查询端到端 P95 ≤ 3.0s；
* 敏感性分析出具率 = 100%。

---

## 场景 C｜歧义澄清与术语映射（“南区”“交通便利”“小户型”）

**目的/覆盖**：PRD 3.1（多轮对话、意图识别）、知识库术语映射、unknown/unknown\_sug。

**对话脚本**

1. U：想在**南区**买学区房，**交通便利**，**小户型**，预算 90 万。
2. S（澄清 1）：“南区”可指 Manukau、Papatoetoe…请确认具体区域/边界。
3. U：Manukau。
4. S（术语映射）：已将“交通便利”→`设施 in [train_station,bus_stop,park_and_ride]`；“小户型”→`面积<70㎡`。
5. U：可以。
6. S（结果）：符合条件 9 套；若将面积放宽到 80㎡ 有 16 套。
7. U：放宽到 80㎡，离火车站 1 公里内。
8. S：剩 11 套；Top3 展示，是否需要按**步行 15 分钟内学校**再过滤？
9. U：要。
10. S：最终 5 套，均满足条件。

**后端期望**

* 工具链：意图识别→术语库匹配→House\_detail/Location\_info→unknown & unknown\_sug。
* 日志：每次澄清都记录 `ambiguous_term` 与 `resolution`。

**验收指标**

* 歧义项**一次澄清命中率 ≥ 90%**（最多 2 轮）；
* 术语映射命中率 ≥ 95%（按知识库规则）；
* 未澄清绝不下钻：当仍含歧义时，拒绝执行查询=100%；
* 透明提示率=100%；
* P95 ≤ 2.0s。

---

## 场景 D｜详情页 Deepfeed + 行程编排 + 合规

**目的/覆盖**：PRD 4.4（详情页）、多模型、Open Home 安排、隐私合规。

**对话脚本**

1. U（在某房源页）：这套 3 房 2 卫，通勤到 CBD 多久？
2. S（Deepfeed）：驾车 22 分钟；公交 35 分钟（高峰 45）。
3. U：帮我看周边学校与 Decile 分数。
4. S：小学/初中/高中列表+评分+边界图链接。
5. U：周六有 open home 吗？
6. S：周六 11:00–11:30；是否添加到日历并生成路线？
7. U：添加，并把我手机号给中介。
8. S（合规拦截）：为保护隐私，将生成一次性转接号码；是否授权共享？
9. U：同意。
10. S：已创建预约并发送确认；提供一次性转接号；短信模版已发。

**后端期望**

* 工具链：Deepfeed→Location\_info→Calendar/Maps Hook→隐私网关（token 化联系方式）。

**验收指标**

* Deepfeed 答复命中字段率 ≥ 95%；
* 日程/导航创建成功率 ≥ 98%；
* 隐私：**不直传手机号/邮箱**，仅走一次性 token；审计日志完备；
* P95 ≤ 2.5s。

---

## 场景 E｜对比趋势 + 可视化（区×房型×月份）

**目的/覆盖**：PRD 3.2（统计/趋势）、4.2/4.3；验证 Transaction 多维分组聚合、导出图表。

**对话脚本**

1. U：对比**东区 vs 北岸**近 5 年**公寓/联排/独立屋**的月度均价与成交量，给出图表与解读。
2. S：正在按（区域×房型×月份）聚合；会同时输出 CSV 和图片。
3. U：解释 2021Q4 的异常峰值。
4. S（RAG 裁片）：引用市场报告段落与交易峰值原因；标注来源。
5. U：导出 PPT，把重点结论做 1 页摘要。
6. S：已生成并提供下载链接。

**后端期望**

* 工具链：Transaction→图表渲染器→文件服务（CSV/PPT）→RAG（报告片段）。

**验收指标**

* 数据覆盖率（60 个月×3 房型×2 区域）= 100%；
* 数值一致性：随机抽样 50 个点，与 DB 复算误差 ≤ ±2%；
* 图表生成 P95 ≤ 4s；
* RAG 引用片段可追溯率 ≥ 95%。

---

## 场景 F｜故障注入与降级（第三方源故障）

**目的/覆盖**：PRD 5（非功能：稳定性）、安全与可维护性；验证熔断与提示。

**对话脚本**

1. U：给我 Auckland City 近 30 天成交均价与列表。
2. S（故障注入：第三方行情源 500）：切换到本地缓存+延迟提示条，结果仅供参考；可稍后重试或订阅数据恢复通知。
3. U：好的，先看缓存结果并订阅恢复。
4. S：缓存结果已展示；订阅成功。

**验收指标**

* 故障切换成功率 ≥ 99%；
* 用户可感知提示必达=100%；
* 不触发级联失败（下游 QPS 限流/重试退避有效）。

---

### 统一计量口径（用于上面所有场景）

* 延迟采用**分位数**报告（P50/P95/P99），避免均值谬误；
* 排序质量使用 **nDCG\@k**；
* RAG 质量跟踪 **Faithfulness/Answer Relevance/Context Precision**；
* 语音输入采用 **WER**；
* 合规：不暴露明文 PII，日志有 trace-id；
* 通过阈值（建议）：基础 ≤1s、复杂 ≤2–3s；并发目标≥2000。

---

# 渐进式端到端验收对话剧本（升级版 · 30段）

> 从**入门→进阶→复杂推理→合规/降级**逐级推进；每段含【目的】【关键引导】【期望后端产物】【通过阈值】。

## 轨道 1｜迎宾·意图·槽位补全（1–6）

**1. 新访客迎宾与第一意图**
【目的】验证首页自动弹出与“买/租/行情”一类意图。
【对话】U：第一次来后花园，想了解下房子。S：欢迎！您主要是**买房/租房/看行情**？
【产物】`intent = buy`；埋点 `entry=homepage_popup`。
【阈值】意图识别准确率≥97%；弹窗触发率=100%。

**2. 场景细化与人群分类**
【目的】把买房细分为自住/投资并进入画像。
【对话】U：买房自住。S：预算、成员、是否学区？
【产物】画像写入：动机=自住，时间敏感度=3–6月。
【阈值】槽位（预算/成员/学区）完整率≥90%。

**3. 地点与通勤澄清**
【目的】把“城市/通勤”转成可计算约束。
【对话】U：奥克兰，通勤30分钟内。S：偏好驾车/公交？是否排除Leasehold？
【产物】`commute<=30min`；`title!=Leasehold`。
【阈值】澄清命中率≥90%；透明复述覆盖率=100%。

**4. 条件组合与首轮候选**
【目的】把槽位转为结构化查询。
【对话】U：3房2卫，联排或独立屋，预算≤120万。S：找到18套，按**学区评分/通勤/总价**综合排序Top10。
【产物】MQL & SQL（house\_detail）；排序打分日志。
【阈值】Top10硬条件满足率=100%；nDCG\@10≥0.85。

**5. 引导式放宽/收紧**
【目的】通过弹性边界增加命中。
【对话】S：若放宽预算到130万，命中+9套，要试试吗？U：放宽。
【产物】两次检索diff与原因说明。
【阈值】建议被采纳率≥50%；延迟P95≤2.0s。

**6. 收藏、订阅与后续触达**
【目的】验证留资转化闭环。
【对话】U：收藏前3套并订阅价格下调。S：已创建**每周汇总+降价即刻**通知。
【产物】订阅记录、价格监控任务。
【阈值】订阅创建成功率≥99%；通知送达≥98%。

---

## 轨道 2｜搜索·筛选·排序·异常（7–13）

**7. 模糊地理词澄清**
【目的】“南区/东区”映射具体行政区。
【对话】U：南区学区房。S：指**Manukau/Papatoetoe/…**？
【产物】`unknown=["南区"]` 与 `unknown_sug` 话术。
【阈值】一次澄清命中≥90%。

**8. 术语映射到结构化过滤**
【目的】“交通便利/小户型”→设施&面积条件。
【对话】S：将“交通便利”映射为`near in [train_station,bus_stop,park_and_ride]`，“小户型”=面积<70㎡。可吗？U：可。
【产物】术语库命中日志。
【阈值】术语映射命中≥95%。

**9. 价格区间/税前后切换**
【目的】租售/售价切换与统一币种显示。
【对话】U：月供控制在4,000纽币。S：按利率6.5%、首付30%，建议总价≤120万。
【产物】金融计算器日志与假设清单。
【阈值】数值校验误差≤±3%。

**10. 多目标排序解释**
【目的】可解释排序。
【对话】U：为何这套排第一？S：权重：学区0.4、通勤0.3、总价0.3；该房源学区&通勤优势明显。
【产物】`explain_ranking.json`。
【阈值】每条结果均可解释=100%。

**11. 无结果时的纠错与建议**
【目的】矛盾条件处理。
【对话】U：预算60万，CBD 180㎡独立屋。S：当前条件矛盾，建议**放宽面积或区域**；给出三种可行改法。
【产物】`conflict_report`。
【阈值】无结果提示准确率=100%。

**12. 第三方源故障的降级**
【目的】熔断/缓存回退。
【对话】S：行情源故障，已切**本地缓存**并标注“参考值”。是否订阅恢复？U：是。
【产物】熔断状态、重试退避参数。
【阈值】故障切换成功≥99%；用户可感知提示=100%。

**13. 列表导出与审计**
【目的】结果可导出与可追溯。
【对话】U：导出CSV+打点报告。S：已生成下载与追踪ID。
【产物】CSV、`trace-id`。
【阈值】导出成功≥99%。

---

## 轨道 3｜知识库解释·Schema·RAG（14–19）

**14. 页面术语一键解释**
【目的】Schema词条挂载到详情页。
【对话】U：什么是Leasehold？S：租赁产权（20–99年），与Freehold的主要差异为**土地所有权/年费/续约风险**。
【阈值】点击到答复≤300ms；命中词条率≥98%。

**15. 规划/校网RAG 证据引用**
【目的】解释基于证据而非“拍脑袋”。
【对话】U：为什么说Howick学区好？S：引用近3年Decile/学测指标与学校边界链接，展示来源片段。
【产物】`explain.json`（片段+URL+高亮）。
【阈值】RAG Faithfulness≥0.95；引用覆盖≥90%。

**16. 反事实质询**
【目的】可验证性。
【对话】U：若Decile下降一档会怎样？S：收敛到**排序-2名**，命中房源-20%。
【阈值】敏感性分析出具率=100%。

**17. 术语歧义的双向召回**
【目的】字段/枚举双路召回。
【对话】U：小户型、交通便利且非Leasehold。S：字段+值同时召回并标注映射规则。
【阈值】双路召回一致性≥98%。

**18. 价格“可议/拍卖/投标”策略解释**
【目的】PriceType差异化话术。
【对话】U：拍卖房如何报价？S：提供拍卖流程与谨慎事项，建议关注**open home人流/竞价历史**。
【阈值】知识话术点命中≥95%。

**19. 模板化说明书生成**
【目的】生成可发送的“客户解读PDF”。
【对话】U：把上面解释整理成1页PDF。S：已生成并附下载。
【阈值】文件生成成功≥98%。

---

## 轨道 4｜投资分析·趋势·推演（20–25）

**20. 候选区域粗筛**
【目的】预算&回报门槛驱动候选区。
【对话】U：预算100万，税前租金回报≥4.5%。S：给出 Howick/Pakuranga/Albany 及区间回报。
【阈值】候选区召回与历史数据一致率≥97%。

**21. 税后现金流与IRR**
【目的】并行子任务生成收益表。
【对话】U：利率6.5%首付30%，含地税维护。S：输出5年现金流、IRR与假设清单。
【阈值】计算误差≤±3%。

**22. 排序目标切换**
【目的】按**税后现金流**排序Top5。
【对话】U：给Top5并说明敏感性（±1%利率、±5%租金）。S：输出表格与解读。
【阈值】nDCG\@5≥0.9；敏感性汇报=100%。

**23. 趋势图与异常解释**
【目的】“月度均价×成交量×房型”多维图。
【对话】U：解释2021Q4峰值。S：引用交易报告与政策新闻片段。
【阈值】图表生成P95≤4s；RAG片段可追溯≥95%。

**24. 风险提示与对冲建议**
【目的】负面情境模拟。
【对话】U：若利率升至7.5%？S：现金流转负，建议**延长持有/调仓至更高租金区**。
【阈值】情境分析完整率=100%。

**25. 导出汇报包**
【目的】一键导出PPT（摘要+图+表）。
【对话】U：导出汇报。S：已生成下载与可追溯ID。
【阈值】导出成功≥98%。

---

## 轨道 5｜详情页·Deepfeed·行程·隐私（26–30）

**26. 通勤多模态回答**
【目的】驾车/公交/步行多模式。
【对话】U：到CBD多久？S：驾车22min、公交35min（高峰45），并给路线。
【阈值】路线可用率≥98%。

**27. 学校与边界**
【目的】列出学段/评分/边界图。
【对话】U：附近学校？S：输出小学/初中/高中及Decile，附边界图链接。
【阈值】数据覆盖≥95%。

**28. Open Home与日程**
【目的】行程编排。
【对话】U：周六开放？S：11:00–11:30，已写入日历并生成导航。
【阈值】写入成功≥98%。

**29. 隐私授权与一次性号码**
【目的】PII保护&授权。
【对话】U：把我手机号给中介。S：将使用**一次性转接号**；是否授权？U：同意。
【阈值】不直传PII=100%；授权记录完备=100%。

**30. 合同与风险提醒（非法律意见）**
【目的】风险清单与合规提示。
【对话】U：下一步？S：提供**律师审查/地契/建筑报告/Body Corp条款**清单与模板。
【阈值】必备项覆盖≥95%。

---

# 指标口径与采集（用于本套剧本打分）

* **响应延迟**：P50/P95/P99（端到端+关键路径）。
* **排序质量**：nDCG\@k（k=5/10）。
* **RAG 质量**：Faithfulness / Answer Relevance / Context Precision（0–1）。
* **语音识别**：WER（(S+D+I)/N）；目标≤0.12（网页安静环境）。
* **澄清与映射**：歧义一次澄清≥90%；术语映射≥95%。
* **稳定性**：熔断切换≥99%；重试采用**指数退避+抖动**；缓存降级必须显著标注“参考值”。
* **合规**：默认数据最小化；一次性号码/邮箱；所有PII访问有 `trace-id` 与审计。

---

# 验收记录表（模板）

| 场景ID | 通过/失败 | 关键证据（截图/日志ID） | 主要问题   | 修复人/截止日   |
| ---- | ----- | ------------- | ------ | --------- |
| A-1  | 通过    | trace-xxx     | –      | –         |
| B-3  | 失败    | rank-exp-123  | 学区权重异常 | 张三 / 9-20 |

> 使用方式：逐段走剧本→记录结果→未达阈值即退回整改；全部通过=系统合格。
