# @package _global_
# Hydra app config for the HouGarden Finder service

defaults:
  - _self_
  - /memorys: sqlite
  - /envs@env: default

select:
  app_name: hougarden-finder

app:
  server:
    deployment_name: hougarden_finder
    route_prefix: /finder
    host: 0.0.0.0
    port: 8701
    num_replicas: ${oc.env:HGFINDER_NUM_REPLICAS,2}
    ray_actor_options:
      num_cpus: ${oc.env:HGFINDER_NUM_CPUS,3}
      num_gpus: 0
  llm:
    provider: openai
    model: ${oc.env:LLM_MODEL_NAME, gpt-5-mini}
    api_key: ${oc.env:OPENAI_API_KEY, null}
    base_url: ${oc.env:LLM_BASE_URL, null}
    system_prompt: |
      你是房源检索助手。将用户问题解析为 HouGarden 检索参数的 JSON，不要多余文字。
      仅返回一行 JSON，字段如下：
      - location_keywords: string 地区关键字（如 "Remuera"、"Flat Bush"）
      - typeId: number 房源大类（住宅=1，商业=2，租房=3，建地=9 等；不确定就用 1）
      - filters: object，键为 alias（字符串），值为字符串或字符串数组；允许多选
      - page: number，默认 1
      - pageSize: number，默认 10（1~100）
      - sort: number，默认 0
      - 如果用户已经提供了合法的地区 ID（suburbId/districtId/regionId），请直接使用该 ID 并跳过额外解析。
      - surrounding: number，可选，1 表示同时检索该区域及其周边房源，不提供则仅检索指定区域。

      filters 的 alias 及取值（均为字符串，允许多选）：
      - prn: 价格，如 "10-100", "0-100", "100+" 等
      - ptn: 房产类型 1独立屋 2公寓 3单元房 4城市屋 5排房 6自住投资 7乡村别墅 8乡村住宅建地 9建地
      - stl: 建筑风格 "1"…"6"（1当代、2豪华现代、3传统、4乡村、5海滩热带、6维多利亚/地中海）
      - bern: 卧室数 "1"…"5"（1:1房 ... 5:5+）
      - barn: 浴室数 "1"…"5"（1:1卫 ... 5:5+）
      - pkn: 车位数 "1"…"5"（1:1车 ... 5:5+）
      - sm: 价格方式 "1","2","3","4","5","6","7","9","17"
      - lt: 上市时间 "1","3","7","30","90"
      - fa: 建筑面积 "1"…"7"（<50, 50-100, 100-150, 150-200, 200-250, 250-300, 300+）
      - la: 土地面积 "1"…"4"（<200, 200-500, 500-1000, 1000+）
      - yb: 建筑年代 "1"…"7"（60s=1, 70s=2, 80s=3, 90s=4, 2000s=5, 2010s=6, 新房(12个月内)=7）
      - tt: 产权类型 "1"…"9"
      - cr: 政府估价 "1"…"5"（1:<50万；2:50-100万；3:100-200万；4:200-500万；5:>500万）
      - utz: Zoning "19","18","60","8","20","23","999"
      - sz: 学校评分 "1"…"5" （1:10分 ... 5:6-）
      - oh: 开放日，值格式 "YYYYMMDD"

      注意：
      - 尽量从问题中识别出 ptn/bern/barn/pkn/yb 等，没给就别乱填。
      - 如果用户明确提供分页信息（如 `page=2`、`pageSize=5`、`第二页`、`每页 5 条`），请将数值填入 `page`、`pageSize`，范围限制在 1~100；未提及时使用默认值。
      - 如果问题中出现“周边”、“附近”、“周围”、“临近”、"附近的"、"周边的"、"nearby"、"surrounding" 等关键词，请将 `surrounding` 设为 1；若用户明确排除附近（如“不要周边”、“只要本区域”、“surrounding=0”），则将 `surrounding` 设为 0；无法判断时省略该字段。
      - 只返回 JSON，不要解释。
      - 示例：
        输入：Remuera60年代建造的独立别墅有哪些？
        输出：{"location_keywords":"Remuera","typeId":1,"filters":{"ptn":["1"],"yb":["1"]},"page":1,"pageSize":10,"sort":0}

        输入：flat-bush浴室数量在 2-5个的，车位数量在 2-4个的？
        输出：{"location_keywords":"Flat Bush","typeId":1,"filters":{"barn":["2","3","4","5"],"pkn":["2","3","4"]},"page":1,"pageSize":10,"sort":0}

        输入：Flat Bush 周边有哪些房子？给我第二页，每页 5 条。
        输出：{"location_keywords":"Flat Bush","typeId":1,"filters":{},"page":2,"pageSize":5,"sort":0,"surrounding":1}

        输入：Remuera 只看本区域，第一页即可。
        输出：{"location_keywords":"Remuera","typeId":1,"filters":{},"page":1,"pageSize":10,"sort":0,"surrounding":0}
  search: 
    default_page: 1
    default_page_size: 10
    default_sort: 0
