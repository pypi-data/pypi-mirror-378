{% macro compare_visu(test, reference) %}
{% if test and reference %}
<div style="width:100%;height:20px">
  <div class="test-bg-80" style="width:{{100*(test|abs)/([(test|abs), (reference|abs)]|max)}}%;height:10px"></div>
  <div class="refe-bg-80" style="width:{{100*(reference|abs)/([(test|abs), (reference|abs)]|max)}}%; height:10px"></div>
</div>
{% endif %}
{% endmacro %}

{% macro kpi_card(name, test, reference, status, err) %}
<div class="kpi-card">
  <div class="text-xs text-gray-500">{{ name }}</div>
    <div>
      <div class="kpi kpi-{{ status }} text-2xl">
        {% if test == reference %}
        =
        {% elif err %}
          {% if err.is_relative %}
            {% set err_per = err.value*100 %}
            {{ ("%." + ( "2" if err_per < 1 else "0" ) + "f")|format(err.value*100) }}%
          {% else %}
            {{ err.value }}
          {% endif %}
        {% else %}
        â‰ˆ
        {% endif %}
      </div>
    </div>
    <div class="py-2">{{ compare_visu(test, reference) }}</div>
    <div class="kpi number test-bg-20" title="Test">{{test}}</div>
    <div class="kpi number refe-bg-20" title="Reference">{{reference}}</div>
</div>
{% endmacro %}
