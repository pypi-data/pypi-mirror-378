repos:
  # Built-in hooks for basic file checks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        exclude: ^tests/.*\.py$
      - id: end-of-file-fixer
        exclude: ^tests/.*\.py$
      - id: check-added-large-files
        args: ['--maxkb=5000']
      - id: detect-private-key
      - id: check-yaml
        exclude: ^buildspec/|^helm/
      - id: check-json
      - id: check-merge-conflict
      - id: debug-statements

  # Code formatting with Black
  - repo: https://github.com/psf/black
    rev: 24.4.2
    hooks:
      - id: black
        language_version: python3.12
        exclude: ^(migrations/|docs/|examples/evaluation_reports/)

  # Import sorting with isort
  - repo: https://github.com/pycqa/isort
    rev: 5.13.2
    hooks:
      - id: isort
        args: ["--profile", "black", "--line-length", "88"]
        exclude: ^(migrations/|docs/)

  # Remove unused imports and variables
  - repo: https://github.com/PyCQA/autoflake
    rev: v2.2.1
    hooks:
      - id: autoflake
        args:
          - --remove-all-unused-imports
          - --remove-unused-variables
          - --ignore-init-module-imports
          - --in-place
        exclude: ^(migrations/|docs/|__init__.py)

  # Fast linting with flake8 (lighter than pylint)
  - repo: https://github.com/pycqa/flake8
    rev: 7.0.0
    hooks:
      - id: flake8
        args:
          - "--max-line-length=88"
          - "--extend-ignore=E203,W503,F541,F401,F841,F811,W291,E501,E722,F821,E402"
          - "--exclude=migrations,docs,build,dist,.git,__pycache__,.tox,.eggs,*.egg,examples,tests/conftest.py"
        exclude: ^(migrations/|docs/|examples/|tests/conftest.py)

  # Optional: Type checking with mypy (commented out for performance)
  # - repo: https://github.com/pre-commit/mirrors-mypy
  #   rev: v1.8.0
  #   hooks:
  #     - id: mypy
  #       args: [--ignore-missing-imports, --no-strict-optional, --allow-untyped-defs]
  #       exclude: ^(tests/|migrations/|docs/)

  # Fast tests only (skip slow integration tests)
  - repo: local
    hooks:
      - id: pytest-fast
        name: fast tests
        entry: pytest
        args: [
          "tests/",
          "-x", # stop on first failure
          "--tb=short",
          "-q", # quiet output
          "-m", "not integration", # skip integration tests
          "--disable-warnings"
        ]
        language: system
        types: [python]
        pass_filenames: false
        stages: [pre-commit]

  # Full test suite (only on push)
  - repo: local
    hooks:
      - id: pytest-full
        name: full test suite with coverage
        entry: pytest
        args: [
          "tests/",
          "--cov=modelhub",
          "--cov-report=term-missing",
          "--cov-fail-under=75",
          "-v"
        ]
        language: system
        types: [python]
        pass_filenames: false
        stages: [pre-push]

  # Lightweight linting (only on push to avoid slowdowns)
  - repo: local
    hooks:
      - id: pylint-errors
        name: pylint (errors only)
        entry: pylint
        args: [
          "--errors-only",
          "--disable=import-error,no-name-in-module,no-value-for-parameter,no-self-argument",
          "modelhub/"
        ]
        language: system
        types: [python]
        pass_filenames: false
        stages: [pre-push]
