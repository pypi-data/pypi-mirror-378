/*! For license information please see 6165.e65d3660fd53621b06c3.js.LICENSE.txt */
"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[6165,4389,6770,5723],{38358:(e,t,i)=>{i.d(t,{w:()=>a});var n=i(17523),r=i(85194);function a(e){if((0,r.S)(e)){const t=(0,n.parse)(e.mdx);return{...e,mdx:t}}return"dateRange"===e.type?{...e,startDate:e.startDate?new Date(e.startDate):void 0,endDate:e.endDate?new Date(e.endDate):void 0}:e}},41218:(e,t,i)=>{i.d(t,{L:()=>n});const n=["KPIValue","KPIGoal","KPIStatus","KPITrend","KPIStart","KPIExpiry"]},73611:(e,t,i)=>{i.d(t,{S:()=>n});const n=i(41218).L.map((e=>e.toLowerCase()))},64755:(e,t,i)=>{function n(e,t){return!(!e||!t)&&e.dimensionName===t.dimensionName&&e.hierarchyName===t.hierarchyName&&e.levelName===t.levelName}i.d(t,{M:()=>n})},78748:(e,t,i)=>{i.d(t,{F:()=>n});class n extends Error{serverKey;constructor(e){super(`The server: "${e}" does not contain any cube.`),this.serverKey=e}}},10353:(e,t,i)=>{i.r(t),i.d(t,{addHierarchyToExpansionChainInMapping:()=>x,assignFieldsToCorrespondingAttribute:()=>We,assignFieldsToFirstAvailableAttribute:()=>ke,canAddHierarchyToAttribute:()=>Y,canAddMeasureToAttribute:()=>p,canAddMoreFieldsToAttribute:()=>d,canAddNamedSetToAttribute:()=>X,deriveMappingFromMdx:()=>nt,deserializeWidgetState:()=>Ce,doCoordinatesExistInCube:()=>se,doesWidgetUseNamedSet:()=>pe,driveFiltersFromState:()=>ye,ensureValidHiddenSubTotalsQueryContextEntry:()=>S,findMappingFieldForHierarchy:()=>oe,findServerKey:()=>he,getAttributeType:()=>m,getAxisNameForAttributeRole:()=>E,getCoordinatesOfLevelBeforeInExpansionChain:()=>g,getFirstAttributeName:()=>l,getGenericMapping:()=>je,getHiddenSubtotalsLevelCoordinatesFromQueryContext:()=>w,getIndexOfAddedFieldOnMdxAxis:()=>q,getMappingOfSwitchedDataVisualizationWidget:()=>Re,getMeasureIndex:()=>H,getNumericAttributes:()=>K,getQueryAndMappingAfterNamedSetAdded:()=>Z,getQueryTotalsMetaData:()=>C,getSpecificMapping:()=>De,getSwitchAvailability:()=>_e,getTargetCube:()=>Ee,getUpdatedWidgetStateAfterNamedSetAdded:()=>ee,getWidgetStateWithUpdatedQueryAndMapping:()=>b,groupAttributes:()=>He,isAllMeasuresInMapping:()=>s,isCompositeHierarchyInMapping:()=>f,isDataVisualizationWidgetPlugin:()=>fe,isDataVisualizationWidgetState:()=>Ne,isExpansionChain:()=>J,isHierarchyInMapping:()=>N,isKpiPropertyInMapping:()=>_,isMeasureInMapping:()=>c,isNamedSetInMapping:()=>$,isWidgetStateWithStyle:()=>xe,isWidgetWithQueryState:()=>ce,moveFieldInMapping:()=>j,moveFieldInMdx:()=>z,removeHierarchyFromExpansionChainInMapping:()=>D,updateHiddenSubTotalsQueryContextEntry:()=>F,updateQueryContextEntry:()=>O,useCube:()=>Te,useIsQueryLazyLoaded:()=>Ue,useSwitchedWidgetState:()=>ze,widgetReducer:()=>me});var n=i(90147),r=i(17523),a=i(31529);const s=e=>"allMeasures"===e.type;function o(e){const{mapping:t,attributes:i,attributeName:r,indexInMappedFields:o,measureName:d,doesSupportMeasuresRedirection:u}=e;return(0,n.produce)(t,(e=>{const n={type:"measure",measureName:d};if(e[r].splice(o,0,n),u&&!(0,a.findKey)(t,(e=>e.find((e=>s(e)))))){const t=(0,a.findKey)(i,(e=>"secondaryOrdinal"===e.role));t&&e[t].push({type:"allMeasures"})}}))}const d=({mapping:e,attributeName:t,attributes:i})=>(i[t].maxNumberOfFields||1/0)>e[t].length,u={primaryNumeric:"numeric",primaryOrdinal:"ordinal",secondaryNumeric:"numeric",secondaryOrdinal:"ordinal",subplot:"ordinal"};function m(e){return u[e]}const c=e=>"measure"===e.type,p=({measureName:e,mapping:t,attributeName:i,attributes:n})=>!!d({mapping:t,attributeName:i,attributes:n})&&("numeric"===m(n[i].role)&&!t[i].some((t=>c(t)&&t.measureName===e)));function l(e,t,i){return Object.keys(t).find((n=>m(t[n].role)===i&&d({mapping:e,attributeName:n,attributes:t})))}const h=(e,{activeMeasureName:t,pluginKey:i,properties:a,cube:s,widgetPlugin:d,attributeName:u,indexInMappedFields:m})=>{const{mapping:c}=e,h=d.attributes??{},y=u??l(c,h,"numeric"),f=e.query.mdx??(0,r.getDefaultMdxSelect)(s.name);return y&&p({measureName:t,mapping:c,attributeName:y,attributes:h})?(0,n.produce)(e,(e=>{e.query.mdx=(0,r.addCalculatedMeasure)(f,{calculatedMeasureName:t,expression:(0,r.createActiveMeasureExpression)(i,a)},s),e.mapping=o({mapping:c,attributes:h,attributeName:y,measureName:t,indexInMappedFields:m??c[y].length,doesSupportMeasuresRedirection:d.doesSupportMeasuresRedirection})})):e};var y=i(7827);const f=e=>"compositeHierarchy"===e.type,N=e=>"hierarchy"===e.type,x=({cube:e,mapping:t,targetAttributeName:i,hierarchyCoordinates:r,indexOfExpansionChainInMappedFields:a,indexOfHierarchyInExpansionChain:s})=>(0,n.produce)(t,(t=>{const n=t[i][a],o=(0,y.q)(r,e),d=Object.keys(o.levels)[o.slicing?0:1];N(n)?t[i][a]={type:"compositeHierarchy",hierarchies:[{dimensionName:n.dimensionName,hierarchyName:n.hierarchyName,levelName:n.levelName,expandedDownTo:n.expandedDownTo},{dimensionName:r.dimensionName,hierarchyName:r.hierarchyName,levelName:d}]}:f(n)&&n.hierarchies.splice(s,0,{dimensionName:r.dimensionName,hierarchyName:r.hierarchyName,levelName:d})})),g=({mapping:e,attributeName:t,indexOfExpansionChainInMappedFields:i,indexOfHierarchyInExpansionChain:n})=>{const r=e[t][i];if(!f(r)&&!N(r))throw new Error(`The field: ${JSON.stringify(r,null,2)}, is neither a composite hierarchy nor a hierarchy.`);const a=N(r)?r:r.hierarchies[n-1];return{...a,levelName:a.expandedDownTo??a.levelName}};function b(e,{mapping:t,mdx:i,queryContext:r,serverKey:a}){return(0,n.produce)(e,(e=>{e.mapping=t,e.query.mdx=i,e.serverKey=a,e.queryContext=r,e.switchedTo&&(e.widgetKey=e.switchedTo,delete e.switchedTo)}))}const v={},M=(e,{dimensionName:t,hierarchyName:i,cube:n,serverKey:a,widgetPlugin:s,indexOfExpansionChainInMappedFields:o,indexOfHierarchyInExpansionChain:d,attributeName:u})=>{const{mapping:m,queryContext:c}=e,p=e.query.mdx??(0,r.getDefaultMdxSelect)(n.name),h=s.attributes??v,y=u??l(m,h,"ordinal");if(!y)return e;const[f,N]=function({cube:e,mapping:t,mdx:i,hierarchyCoordinates:n,targetAttributeName:a,indexOfExpansionChainInMappedFields:s,indexOfHierarchyInExpansionChain:o}){const d=g({mapping:t,attributeName:a,indexOfExpansionChainInMappedFields:s,indexOfHierarchyInExpansionChain:o});return[x({cube:e,mapping:t,targetAttributeName:a,hierarchyCoordinates:n,indexOfExpansionChainInMappedFields:s,indexOfHierarchyInExpansionChain:o}),(0,r.addHierarchyToExpansionChain)(i,{cube:e,hierarchyCoordinates:n,coordinatesOfLevelBefore:d})]}({cube:n,mapping:m,mdx:p,hierarchyCoordinates:{dimensionName:t,hierarchyName:i},targetAttributeName:y,indexOfExpansionChainInMappedFields:o,indexOfHierarchyInExpansionChain:d});return b(e,{mapping:f,mdx:N,serverKey:a,queryContext:c})};var I=i(64755);function w(e){const t=e?.find((({key:e})=>"mdx.hiddensubtotals"===e))?.value;return(t?t.split(","):[]).map((e=>{const[t,i,n]=(0,r.unquote)(e);return{dimensionName:t,hierarchyName:i,levelName:n}}))}function C(e,{cube:t,queryContext:i}){const n={},s=function(e){const t=e?.find((({key:e})=>"mdx.hiddengrandtotals"===e))?.value;return t?t.split(","):[]}(i),o=w(i);return e?.axes.forEach((e=>{const i=(0,r.getAxisTotalsMetaData)(e,t),d=i.isGrandTotalHidden||s.includes(String((0,r.getAxisId)(e.name))),u=(0,a.intersectionWith)(i.levelsWithToggleableTotals,[...i.levelsWithHiddenTotals,...o],I.M);n[e.name]={...i,isGrandTotalHidden:d,levelsWithHiddenTotals:u}})),n}function O(e,t){const i=e.findIndex((({key:e})=>e===t.key));-1===i?e.push(t):e[i]=t}function F(e,{levelsWithHiddenTotals:t}){O(e,{value:(0,a.uniqWith)(t,I.M).map(r.getLevelUniqueName).join(","),key:"mdx.hiddensubtotals"})}function S(e,{mdx:t,cube:i}){if(!e)return;const n=w(e),r=C(t,{cube:i,queryContext:e}),s=Object.values(r).flatMap((e=>e.levelsWithToggleableTotals));F(e,{levelsWithHiddenTotals:(0,a.intersectionWith)(n,s,I.M)})}function E(e,t){if("numeric"===m(e))return(0,r.getMeasuresAxisName)(t);switch(e){case"primaryOrdinal":return"ROWS";case"secondaryOrdinal":case"subplot":return"COLUMNS";default:throw new Error(`Unknown ordinal attribute role: "${e}". Supported ordinal roles are ["primaryOrdinal", "secondaryOrdinal", "subplot"]`)}}const A=(e,t)=>{switch(e.type){case"hierarchy":case"namedSet":return 1;case"allMeasures":return t?1:0;case"compositeHierarchy":return e.hierarchies.length;default:return 0}},q=({targetAttributeName:e,indexInMappedFields:t,mapping:i,attributes:n,mdx:r})=>{const s=E(n[e].role,r);let o=0;const d=(0,a.some)(n,((e,t)=>"numeric"===m(e.role)&&i[t].length>0));e:for(const a in n){const u=n[a],c=i[a];if("ordinal"===m(u.role)&&E(u.role,r)===s)for(let i=0;i<c.length;i++){if(a===e&&i===t)break e;const n=c[i];o+=A(n,d)}}return o},T={},P=(e,{dimensionName:t,hierarchyName:i,levelName:a,cube:s,serverKey:o,widgetPlugin:d,doesIncludeCalculatedMembers:u,doesIncludeTotals:m,attributeName:c,indexInMappedFields:p})=>{const{mapping:h,queryContext:f}=e,x=e.query.mdx??(0,r.getDefaultMdxSelect)(s.name),g=d.attributes??T,v=c??l(h,g,"ordinal");if(!v)return e;const M=h[v].length,[I,C,O]=function({attributes:e,cube:t,mapping:i,mdx:a,queryContext:s,indexInMappedFields:o,targetAttributeName:d,dimensionName:u,hierarchyName:m,levelName:c,doesIncludeCalculatedMembers:p,doesIncludeTotals:l}){const h=(0,n.produce)(i,(e=>{const t={type:"hierarchy",dimensionName:u,hierarchyName:m,levelName:c};e[d].splice(o,0,t)})),{role:f}=e[d],x=E(f,a),g=q({targetAttributeName:d,indexInMappedFields:o,mapping:h,attributes:e,mdx:a}),b=(0,r.addLevel)(a,{axisName:x,cube:t,dimensionName:u,hierarchyName:m,levelName:c,indexOnAxis:g,doesIncludeCalculatedMembers:p});if(l)return[h,b,s];const v=(0,y.q)({dimensionName:u,hierarchyName:m},t),M=v.levels[c].index,I=Object.values(v.levels).filter((e=>{const t=v.slicing?0:1;return e.index>=t&&e.index<=M})).map((e=>({hierarchyName:m,dimensionName:u,levelName:e.name}))),C=o===h[d].length-1;if(0!==o&&C){const e=h[d][o-1];e&&N(e)&&I.push({hierarchyName:e.hierarchyName,dimensionName:e.dimensionName,levelName:e.levelName})}const O=w(s);if(0===I.length)return[h,b,s];const A=(0,n.produce)(s??[],(e=>{F(e,{levelsWithHiddenTotals:[...O,...I]}),S(e,{mdx:b,cube:t})}));return[h,b,A]}({attributes:g,cube:s,mapping:h,mdx:x,queryContext:f,targetAttributeName:v,dimensionName:t,hierarchyName:i,levelName:a,indexInMappedFields:p??M,doesIncludeCalculatedMembers:u,doesIncludeTotals:m});return b(e,{mapping:I,mdx:C,queryContext:O,serverKey:o})},K=e=>(0,a.pickBy)(e,(e=>"numeric"===m(e.role))),H=({attributeName:e,indexInMappedFields:t,mapping:i,attributes:n})=>{let r=t;const a=Object.keys(K(n));return a.slice(0,a.indexOf(e)).forEach((e=>{r+=i[e].length})),r},k=(e,{cube:t,measureName:i,serverKey:n,widgetPlugin:a,attributeName:s,indexInMappedFields:d})=>{const{mapping:u}=e,m=a.attributes??{},c=s??l(u,m,"numeric"),h=e.query.mdx??(0,r.getDefaultMdxSelect)(t.name);if(c&&p({measureName:i,mapping:u,attributeName:c,attributes:m})){const s=u[c].length,[m,p]=function({attributeName:e,cube:t,mapping:i,mdx:n,measureName:a,indexInMappedFields:s,widgetPlugin:d}){const u=d.attributes??{},m=o({mapping:i,attributes:u,attributeName:e,measureName:a,indexInMappedFields:s,doesSupportMeasuresRedirection:d.doesSupportMeasuresRedirection});return[m,(0,r.addMeasure)(n,{cube:t,measureName:a,measureIndex:H({attributeName:e,indexInMappedFields:s,mapping:m,attributes:u})})]}({cube:t,mapping:u,mdx:h,attributeName:c,measureName:i,indexInMappedFields:d??s,widgetPlugin:a});return b(e,{mapping:m,mdx:p,serverKey:n,queryContext:e.queryContext})}return e};function L(e,t){return"kpiProperty"===e.type&&e.underlyingMeasureName===t||"measure"===e.type&&e.measureName===t}const W=(e,{measureName:t,attributeName:i,indexInMappedFields:n})=>{if(i&&void 0!==n)return e[i][n]&&L(e[i][n],t)?{indexInMappedFields:n,attributeName:i}:void 0;if(i){const n=e[i].findIndex((e=>L(e,t)));return-1===n?void 0:{indexInMappedFields:n,attributeName:i}}for(const i in e){const r=W(e,{measureName:t,attributeName:i,indexInMappedFields:n});if(r)return r}},D=({mapping:e,attributeName:t,indexOfExpansionChainInMappedFields:i,indexOfHierarchyInExpansionChain:r})=>{if(0===r)throw new Error("The first hierarchy of an expansion chain cannot be removed.");return(0,n.produce)(e,(e=>{const n=e[t][i];if(!f(n))throw new Error("There is no expansion chain to remove a hierarchy from.");2===n.hierarchies.length?e[t][i]={type:"hierarchy",...n.hierarchies[0]}:n.hierarchies.splice(r,1)}))},j=({mapping:e,cube:t,fromPosition:i,toPosition:r})=>{const a=e[i.sectionName][i.tileIndex];let s=e;if(e[i.sectionName]&&(s="subtileIndex"in i?D({mapping:s,attributeName:i.sectionName,indexOfExpansionChainInMappedFields:i.tileIndex,indexOfHierarchyInExpansionChain:i.subtileIndex+1}):(0,n.produce)(s,(e=>{e[i.sectionName].splice(i.tileIndex,1)}))),"subtileIndex"in r){if(!(N(a)||f(a)&&"subtileIndex"in i))throw new Error(`Cannot move field ${JSON.stringify(a,null,2)} to an expansion chain, as it does not represent a hierarchy.`);const e="subtileIndex"in i?i.subtileIndex:void 0,{dimensionName:n,hierarchyName:o}=f(a)?a.hierarchies[e+1]:a;s=x({cube:t,mapping:s,targetAttributeName:r.sectionName,hierarchyCoordinates:{dimensionName:n,hierarchyName:o},indexOfExpansionChainInMappedFields:r.tileIndex,indexOfHierarchyInExpansionChain:r.subtileIndex+1})}else s=(0,n.produce)(s,(e=>{e[r.sectionName].splice(r.tileIndex,0,f(a)&&"subtileIndex"in i?{...a.hierarchies[i.subtileIndex+1],type:"hierarchy",expandedDownTo:void 0}:a)}));return s};var R=i(79607);function _(e){return"kpiProperty"===e.type}const $=e=>"namedSet"===e.type;function B({mdx:e,cube:t,field:i}){if(f(i))throw new Error("Nested composite hierarchies are not supported.");return(0,r.removeHierarchyFromExpansionChain)(e,{cube:t,hierarchyCoordinates:{hierarchyName:i.hierarchyName,dimensionName:i.dimensionName}})}function U({cube:e,hierarchyCoordinates:t,fromPosition:i,mapping:n,mdx:a,toPosition:s}){const o=g({mapping:n,attributeName:i.sectionName,indexOfExpansionChainInMappedFields:i.tileIndex,indexOfHierarchyInExpansionChain:s.subtileIndex+1});return(0,r.addHierarchyToExpansionChain)(a,{cube:e,hierarchyCoordinates:t,coordinatesOfLevelBefore:o})}function z({attributes:e,cube:t,fromPosition:i,toPosition:n,mapping:a,mdx:o,updatedMapping:d}){const u=function({fromPosition:e,mapping:t}){const i=t[e.sectionName][e.tileIndex];if((0,R.o)(e)){if(!f(i))throw new Error(`The field mapped to attribute ${e.sectionName} at index ${e.tileIndex} is not a composite hierarchy: ${JSON.stringify(t[e.sectionName],null,2)} `);return{type:"hierarchy",...i.hierarchies[e.subtileIndex+1]}}return i}({fromPosition:i,mapping:a}),m=c(u)||_(u),[p,l]=[{position:i,mapping:a},{position:n,mapping:d}].map((({position:t,mapping:i})=>q({targetAttributeName:t.sectionName,attributes:e,indexInMappedFields:t.tileIndex,mapping:i,mdx:o}))),{role:h}=e[i.sectionName],{role:y}=e[n.sectionName],x=E(h,o),g=E(y,o),b=i.sectionName===n.sectionName&&i.tileIndex===n.tileIndex&&(0,R.o)(i)&&(0,R.o)(n),v=g===x&&p===l,M=((0,R.o)(i)||(0,R.o)(n))&&i.tileIndex===n.tileIndex;let I=o;if(N(u)&&b){const e=B({cube:t,field:u,mdx:o});return U({cube:t,hierarchyCoordinates:{dimensionName:u.dimensionName,hierarchyName:u.hierarchyName},fromPosition:i,toPosition:n,mapping:a,mdx:e})}if(v&&!m&&!M)return o;if(s(u))return(0,r.moveAllMeasures)(o,{axisName:g,cube:t,indexOnAxis:l});if(m){const s=H({attributeName:i.sectionName,indexInMappedFields:i.tileIndex,mapping:a,attributes:e}),m=H({attributeName:n.sectionName,indexInMappedFields:n.tileIndex,mapping:d,attributes:e});if(s!==m){if(c(u)){const{measureName:e}=u;return(0,r.moveMeasure)(o,{cube:t,measureName:e,measureIndex:m})}if(_(u)){const{underlyingMeasureName:e}=u;return(0,r.moveMeasure)(o,{cube:t,measureName:e,measureIndex:m})}}}if(N(u)||f(u)){const{dimensionName:e,hierarchyName:s,levelName:d}=N(u)?u:u.hierarchies[0];I=(0,R.o)(i)?B({mdx:o,cube:t,field:u}):(0,r.removeHierarchy)(I,{cube:t,dimensionName:e,hierarchyName:s}),I=(0,R.o)(n)?U({cube:t,mapping:a,mdx:I,toPosition:n,fromPosition:i,hierarchyCoordinates:{dimensionName:e,hierarchyName:s}}):(0,r.addLevel)(I,{cube:t,dimensionName:e,hierarchyName:s,levelName:d,indexOnAxis:l,axisName:g})}return $(u)?(0,r.moveNamedSet)(I,{cube:t,setName:u.name,indexOnAxis:l,axisName:g}):I}const Q=(e,{measureName:t,cube:i,serverKey:n,widgetPlugin:s,from:o,to:d})=>{const{mapping:u,queryContext:m}=e,c=e.query.mdx??(0,r.getDefaultMdxSelect)(i.name),p=s.attributes??{},l=W(u,{measureName:t,...o});if(!l)return e;const h={sectionName:l.attributeName,tileIndex:l.indexInMappedFields},y={sectionName:d.attributeName,tileIndex:d.indexInMappedFields??u[d.attributeName].length};if((0,a.isEqual)(h,y))return e;const f=j({mapping:u,cube:i,fromPosition:h,toPosition:y});return b(e,{mapping:f,mdx:z({attributes:p,cube:i,fromPosition:h,toPosition:y,mapping:u,mdx:c,updatedMapping:f}),queryContext:m,serverKey:n})};function J(e){return N(e)&&Boolean(e.expandedDownTo)||f(e)}var V=i(59441);const G=({dimensionName:e,hierarchyName:t,attributeName:i,mapping:n,cube:a})=>n[i].some((i=>(({dimensionName:e,hierarchyName:t,field:i,cube:n})=>N(i)?i.dimensionName===e&&i.hierarchyName===t:f(i)?i.hierarchies.some((i=>i.dimensionName===e&&i.hierarchyName===t)):!!$(i)&&(0,r.getCubeNamedSetHierarchies)(i.name,{cube:n}).some((i=>(0,V.q)(i,{hierarchyName:t,dimensionName:e}))))({field:i,dimensionName:e,hierarchyName:t,cube:a}))),Y=({dimensionName:e,hierarchyName:t,mapping:i,attributeName:n,indexInMappedFields:r,indexOfHierarchyInExpansionChain:a,attributes:s,mdx:o,cube:u})=>{const c=void 0!==a;if(!c&&!d({mapping:i,attributeName:n,attributes:s}))return!1;if("numeric"===m(s[n].role))return!1;if(G({dimensionName:e,hierarchyName:t,attributeName:n,mapping:i,cube:u}))return!1;const p=E(s[n].role,o);if(Object.entries(s).some((([r,a])=>r!==n&&(!(E(a.role,o)===p)&&G({dimensionName:e,hierarchyName:t,attributeName:r,mapping:i,cube:u})))))return!1;const l=i[n].findIndex(J);if(c){const e=i[n].at(-1);return!!e&&(-1===l&&r===i[n].length-1&&!$(e)||l===r)}return!(-1!==l&&r>l)},X=({setName:e,mapping:t,attributeName:i,indexInMappedFields:n,indexOfHierarchyInExpansionChain:a,attributes:s,mdx:o,cube:d})=>!(void 0!==a)&&(0,r.getCubeNamedSetHierarchies)(e,{cube:d}).every((({dimensionName:e,hierarchyName:r})=>Y({dimensionName:e,hierarchyName:r,mapping:t,attributeName:i,indexInMappedFields:n,attributes:s,mdx:o,cube:d})));function Z({attributes:e,attributeName:t,cube:i,mapping:a,mdx:s,indexInMappedFields:o,setName:d}){const u=(0,n.produce)(a,(e=>{const i={type:"namedSet",name:d};e[t].splice(o,0,i)})),{role:m}=e[t],c=E(m,s);return[u,(0,r.addNamedSet)(s,{axisName:c,cube:i,setName:d,indexOnAxis:q({targetAttributeName:t,indexInMappedFields:o,mapping:u,attributes:e,mdx:s})})]}const ee=(e,{attributes:t,setName:i,cube:n,serverKey:a})=>{const{mapping:s}=e,o=l(s,t,"ordinal");if(!o)return e;const d=e.query.mdx??(0,r.getDefaultMdxSelect)(n.name),u=s[o];if(!X({setName:i,mapping:s,attributeName:o,attributes:t,indexInMappedFields:u.length,mdx:d,cube:n}))return e;const[m,c]=Z({attributeName:o,attributes:t,cube:n,mapping:s,mdx:d,setName:i,indexInMappedFields:u.length});return b(e,{mapping:m,mdx:c,serverKey:a,queryContext:e.queryContext})},te=(e,{targetWidgetKey:t})=>(0,n.produce)(e,(e=>{t===e.widgetKey?delete e.switchedTo:e.switchedTo=t}));var ie=i(44858),ne=i(87885),re=i(47780),ae=i(80827);const se=(e,t)=>{try{"levelName"in e?(0,ie.r)(e,t):(0,y.q)(e,t)}catch(e){if(e instanceof ne.O||e instanceof re.h||e instanceof ae.W)return!1;throw e}return!0};function oe(e,{dimensionName:t,hierarchyName:i}){for(const n in e)for(let r=0;r<e[n].length;r++){const a=e[n][r];if(N(a)&&(0,V.q)(a,{dimensionName:t,hierarchyName:i}))return{attributeName:n,fieldIndex:r,type:"hierarchy"};if(f(a))for(let e=0;e<a.hierarchies.length;e++){const s=a.hierarchies[e];if((0,V.q)(s,{dimensionName:t,hierarchyName:i}))return{attributeName:n,fieldIndex:r,hierarchyIndex:e,type:"compositeHierarchy"}}}}const de=(e,{dimensionName:t,hierarchyName:i,cube:a,attributeName:s,indexInMappedFields:o})=>{const{mapping:d,query:u}=e;return(0,n.produce)(e,(e=>{if(u.mdx){const n=!se({dimensionName:t,hierarchyName:i},a);e.query.mdx=n?(0,r.unsafeRemoveHierarchy)(u.mdx,{dimensionName:t,hierarchyName:i},a):(0,r.removeHierarchy)(u.mdx,{cube:a,dimensionName:t,hierarchyName:i}),S(e.queryContext,{mdx:e.query.mdx,cube:a})}if(s&&o)e.mapping[s].splice(o,1);else{const n=oe(d,{dimensionName:t,hierarchyName:i});if(!n)return;e.mapping[s??n.attributeName].splice(o??n.fieldIndex,1)}}))},ue=(e,{measureName:t,cube:i,attributeName:o,indexInMappedFields:d})=>{const{mapping:u,query:m}=e,p=W(u,{measureName:t,attributeName:o,indexInMappedFields:d});return p?(0,n.produce)(e,(e=>{m.mdx&&(e.query.mdx=(0,r.removeMeasure)(m.mdx,{cube:i,measureName:t})),e.mapping=function(e,{attributeName:t,indexInMappedFields:i}){return(0,n.produce)(e,(e=>{if(e[t].splice(i,1),!(0,a.findKey)(e,(e=>e.find((e=>c(e)))))){const t=(0,a.findKey)(e,(e=>e.find((e=>s(e)))));t&&(0,a.remove)(e[t],(e=>s(e)))}}))}(u,{attributeName:p.attributeName,indexInMappedFields:p.indexInMappedFields})})):e};function me(e,t){switch(t.type){case"measureAdded":return k(e,t);case"measureMoved":return Q(e,t);case"measureRemoved":return ue(e,t);case"levelAdded":return P(e,t);case"hierarchyAddedToExpansionChain":return M(e,t);case"namedSetAdded":return ee(e,t);case"hierarchyRemoved":return de(e,t);case"widgetSwitched":return te(e,t);case"activeMeasureAdded":return h(e,t)}}function ce(e){return"query"in e}function pe({widgetState:e,setName:t,cube:i}){if(!ce(e))return!1;const n=e.query.mdx;return!!n&&Boolean((0,r.findDescendant)(n,(e=>(0,r.isMdxNamedSetCompoundIdentifier)(e,{setName:t,cube:i}))))}var le=i(556);function he({cubeName:e,dataModels:t}){const i=[];for(const n in t)for(const r of Object.values(t[n].catalogs))for(const t in r.cubes){if(t===e)return n;i.push(t)}throw new le.N(e,i)}function ye(e){ce(e)&&(delete e.areFiltersDrivenByMdx,e.query?.mdx&&(e.query.mdx=(0,r.removeAllFilters)(e.query.mdx)))}const fe=e=>"dataVisualization"===e.category,Ne=(e,t)=>{if(e.widgetKey!==t.key)throw new Error(`Expected widgetPlugin's key to be ${e.widgetKey} but was ${t.key}`);return fe(t)};function xe(e){return"style"in e}var ge=i(41218),be=i(73611);class ve extends Error{attributeName;serializedMappingField;constructor(e,t){super(`Can not deserialize the "${t}" field with stringified value "${e}" in mapping.`),this.attributeName=t,this.serializedMappingField=e}}const Me=/^\[.*\]$/,Ie=e=>"mapping"in e;var we=i(38358);function Ce(e){const t=function(e){return Ie(e)?(0,n.produce)(e,(e=>{const t=e.mapping;return Object.entries(t).forEach((([t,i])=>{const n=i.map((e=>{if("ALL_MEASURES"===e)return{type:"allMeasures"};if(e.startsWith("[Measures]."))return{type:"measure",measureName:(0,r.unquote)(e)[1]};if(e.startsWith("KPI")){const t=function(e){const t=new Error(`Unable to parse string "${e}" as a KPI property.`),i=e.indexOf("(");let n=1,r=i+1;for(;n>0&&r<e.length;)"("===e[r]&&n++,")"===e[r]&&n--,r++;if(n>0)throw t;const a=r-1,s=e.slice(0,i),o=e.slice(i+1,a),d=e.slice(a+3),u=ge.L.find(((e,t)=>be.S[t]===s.toLowerCase()));if(!u)throw t;return{kpiName:o,kpiPropertyName:u,underlyingMeasureName:d}}(e);return{type:"kpiProperty",propertyName:t.kpiPropertyName,kpiName:t.kpiName,underlyingMeasureName:t.underlyingMeasureName}}if(e.indexOf(" => ")>-1){const t=e.split(" => "),i=[];for(let e=0;e<t.length;e++){const[n,a,s]=(0,r.unquote)(t[e]),o=i.at(-1);(0,V.q)({dimensionName:n,hierarchyName:a},o)?o.expandedDownTo=s:i.push({dimensionName:n,hierarchyName:a,levelName:s})}return 1===i.length?{type:"hierarchy",...i[0]}:{type:"compositeHierarchy",hierarchies:i}}if(Me.test(e)){const t=(0,r.unquote)(e);if(1===t.length)return{type:"namedSet",name:t[0]};const[i,n,a]=t;return{levelName:a,dimensionName:i,hierarchyName:n,type:"hierarchy"}}throw new ve(e,t)}));e.mapping[t]=n})),e})):e}(function(e){const t={...e,filters:e.filters?.map(we.w)};return void 0===t.filters&&delete t.filters,ce(e)&&ce(t)&&e.query.mdx&&(t.query={...e.query,mdx:(0,r.parse)(e.query.mdx)}),t}(function(e){if(!xe(e))return e;const t=e.style?.tupleImpactingRowStyle;if(!t)return e;const i={...e.style,tupleImpactingRowStyle:t.map((e=>{const t=(0,r.unquote)(e);return 2===t.length&&"Measures"===t[0]?{dimensionName:"Measures",hierarchyName:"Measures",namePath:[t[1]]}:{dimensionName:t[0],hierarchyName:t[1],namePath:t.slice(2)}}))};return{...e,style:i}}(e)));return t}var Oe=i(66474),Fe=i(78748),Se=i(17323);function Ee({dataModels:e,serverKey:t,cubeName:i,lastUsedCube:n}){const r=Object.keys(e);if(0===r.length)throw new Oe.d({existingServerKeys:r});if(t&&!r.includes(t))throw new Oe.d({serverKey:t,existingServerKeys:r});if(t&&i){const n=e[t];return{cube:(0,Se.W)(n,i),dataModel:n,serverKey:t}}if(t&&!i){const i=e[t],n=function({serverKey:e,dataModel:t}){const i=Object.values(t.catalogs).find((({cubes:e})=>Object.values(e).length>0));if(void 0===i)throw new Fe.F(e);return Object.values(i.cubes)[0]}({serverKey:t,dataModel:i});return{serverKey:t,dataModel:i,cube:n}}if(!t&&i)return Ee({dataModels:e,serverKey:he({cubeName:i,dataModels:e}),cubeName:i});if(n)try{return Ee({dataModels:e,serverKey:n.serverKey,cubeName:n.cubeName})}catch(e){if(!(e instanceof Oe.d||e instanceof le.N))throw e}return Ee({dataModels:e,serverKey:r[0]})}var Ae=i(42711),qe=i(52625);function Te(e){const t=function(){const e=(0,Ae.W)(),t=(0,qe.A)();return({initialCubeName:i,serverKey:n,...a})=>Ee({cubeName:ce(a)&&a.query.mdx?(0,r.getCubeName)(a.query.mdx):i,serverKey:n,dataModels:e,lastUsedCube:t})}();return t(e)}var Pe=i(93345),Ke=i(12343);function He(e){const t=Object.entries(e).map((([e,t])=>({...t,name:e}))),i=(0,a.groupBy)(t,(e=>m(e.role)));return(0,a.mapValues)(i,(e=>(0,a.groupBy)(e,"role")))}const ke=(e,t,i)=>{for(let n=0;n<t.length&&0!==i.length;n++){const r=t[n],a=r.maxNumberOfFields||1/0;for(;e[r.name].length<a&&i.length>0;){const t=i.shift();t&&e[r.name].push(t)}}};function Le(e,t){return t.doesSupportMeasuresRedirection?e:e.filter((e=>!s(e)))}function We({mapping:e,attributes:t,fields:i,unmappedFields:n,widgetPlugin:r}){i.forEach(((i,a)=>{const s=Le(i,r),o=t[a];if(o){const t=o.maxNumberOfFields||1/0;s.forEach((i=>{e[o.name].length<t?e[o.name].push(i):n.push(i)}))}else n.push(...s)}))}function De(e,t){const i=t.attributes??{},n=(0,a.mapValues)(i,(()=>[])),r=He(i);return Object.entries(e).forEach((([e,i])=>{const s=[],o=r?.[e]||[];if(Object.entries(i).forEach((([e,i])=>{const r=[],a=o?.[e]||[];We({mapping:n,attributes:a,fields:i,unmappedFields:r,widgetPlugin:t}),r.length>0&&ke(n,a,s),s.push(...r)})),s.length>0&&ke(n,(0,a.flatten)(Object.values(o)),s),s.length>0)throw new Error(`The chosen widget type does not support the current mapping: too many chosen ${e} fields.`)})),n}function je(e,t){const i={};return Object.entries(t).forEach((([t,n])=>{const r=m(n.role);(0,a.defaultsDeep)(i,{[r]:{[n.role]:[]}}),i[r][n.role].push(e[t]||[])})),i}function Re(e,t,i){const n=e.mapping,o=t.attributes||{},d=i.attributes||{},u=t.doesSupportMeasuresRedirection,m=i.doesSupportMeasuresRedirection,c=De(je(n,o),i);if(u&&!m){const e=(0,a.findKey)(c,(e=>e.some(s)));e&&(c[e]=c[e].filter((e=>!s(e))))}else if(!u&&m){const t=e.query.mdx,i="ROWS"===(t&&(0,r.getMeasuresAxisName)(t))?"primaryOrdinal":"secondaryOrdinal",n=(0,a.findKey)(d,(e=>e.role===i));n&&c[n].push({type:"allMeasures"})}return c}function _e(e,t,i){const n=Object.entries(e).reduce(((e,[n,r])=>{const a=m(t[n].role),s=Le(r,i);return{...e,[a]:e[a]+s.length}}),{numeric:0,ordinal:0}),r=i.attributes||{},a=Object.values(r).reduce(((e,t)=>{const i=m(t.role);return{...e,[i]:e[i]+(t.maxNumberOfFields||1/0)}}),{numeric:0,ordinal:0});return n.numeric>a.numeric?{status:"tooManyNumeric",maxNumberOfFields:a.numeric}:n.ordinal>a.ordinal?{status:"tooManyOrdinal",maxNumberOfFields:a.ordinal}:{status:"ok"}}var $e=i(6208),Be=i(61386);function Ue({queryId:e,widgetState:t}){return i=(0,$e.J)({queryId:e,serverKey:t&&ce(t)?t.serverKey:void 0}),!(!i?.data||!(0,Be.isCellSet)(i.data))&&i.data.axes.some((({range:e})=>e&&!e.entireAxis));var i}function ze(e,t){const[i]=(0,Ke.useWidgetPlugins)(e?[e.widgetKey]:[]),r=e&&Ne(e,i)?e.switchedTo:void 0,a=Ue({queryId:t,widgetState:e}),[s]=(0,Ke.useWidgetPlugins)(r?[r]:[]);return(0,Pe.useMemo)((()=>{const t=void 0!==s?.lazyLoading;if(!(e&&Ne(e,i)&&fe(i)&&s&&fe(s))||a&&!t)return e;const r=Re(e,i,s);return(0,n.produce)(e,(e=>{e.widgetKey=s.key,Reflect.deleteProperty(e,"switchedTo"),e.mapping=r}))}),[s,i,e,a])}var Qe=i(71128);class Je extends Error{}const Ve=({dimensionName:e,hierarchyName:t,levelName:i})=>(0,r.quote)(e,t,i),Ge=({levels:e,expansionChains:t,cube:i})=>{const n=[],r=e.slice(),s=t.slice();for(;r.length>0;){const t=r.shift(),o=(0,a.remove)(s,(([e])=>(0,I.M)(e,t)));if(o.length>1)throw new Je(`The level ${Ve(t)} belongs to several expansion chains: ${JSON.stringify(o.map((e=>e.map(Ve))),null,2)}`);if(0===o.length)n.push({type:"hierarchy",...t});else{const s=[t];o[0].slice(1).forEach((t=>{if(!(0,a.remove)(r,(e=>(0,I.M)(e,t)))[0]){const i=Ve(t),n=JSON.stringify(e.map(Ve));throw new Je(`The level ${i} is in an expansion chain, but does not contribute to the axis dimensionality: ${n}.`)}const n=s.at(-1);if((0,V.q)(n,t)){const e=(0,ie.r)(t,i).name;n.expandedDownTo=e}else s.push(t)})),n.push(s.length>1?{type:"compositeHierarchy",hierarchies:s}:{type:"hierarchy",...s[0]})}}if(s.length>0)throw new Je(`Some expansion chains are incompatible with the levels used on the axis:\n      Incompatible expansion chains: ${JSON.stringify(s.map((e=>e.map(Ve))))}\n      Levels used on axis: ${JSON.stringify(e.map(Ve))}\n      `);return n},Ye=(e,t)=>(0,I.M)(e.at(-1),t.fromLevel)?"right":!!(0,I.M)((0,a.first)(e),t.toLevel)&&"left";function Xe(e,t=[]){if(0===e.length)return t;if(0===t.length){const i=e.pop();t.push([i.fromLevel,i.toLevel])}for(let i=0;i<e.length;i++){const n=e[i];for(const r of t){const a=Ye(r,n);if(a)return e.splice(i,1),"right"===a?r.push(n.toLevel):r.unshift(n.fromLevel),Xe(e,t)}}return[...t,...Xe(e)]}function Ze(e){return Xe(e.slice())}var et=i(67034);const tt=(e,t)=>(0,a.uniqWith)(e.map((({tupleCoordinates:e,toLevel:i})=>{const n=e.at(-1);if((0,et.t)(n))throw new Je("'Expand by' under a measure is not supported.");const{dimensionName:r,hierarchyName:a,namePath:s}=n,o=(0,y.q)({dimensionName:r,hierarchyName:a},t),d=s.length-1;return{fromLevel:{dimensionName:r,hierarchyName:a,levelName:Object.keys(o.levels)[d]},toLevel:i}})),a.isEqual),it=["value","goal","start","expiry","status","trend"];function nt({mdx:e,cube:t,widgetPlugin:i}){const{attributes:n,doesSupportMeasuresRedirection:s}=i;if(!n)throw new Error("Cannot derive a mapping from Mdx for a widget plugin which does not define attributes.");if(!e)return i.initialState.mapping;const o=function({mdx:e,cube:t,shouldIncludeAllMeasures:i=!0}){const[n,s]=[r.axisIds.rows,r.axisIds.columns].map((i=>{const n=(e?.axes||[]).find((({name:e})=>(0,r.getAxisId)(e)===i));if(void 0===n)return[];const a=(0,r.getLevels)(n,{cube:t}).filter((e=>(0,y.q)(e,t).slicing||"ALL"!==e.levelName));try{const e=(0,r.getExpandedTuples)(n,t),i=Ze(tt(e,t));return Ge({levels:a,expansionChains:i,cube:t})}catch(e){if(e instanceof Je)return a.map((e=>({...e,type:"hierarchy"})));throw e}})),o=(0,r.getMeasureNames)(e),d=(0,r.getCalculatedMeasures)(e),u=o.map((e=>{const i=(0,r.quote)("Measures",e),n=!1===(0,Qe.D)(e,t)?.visible;let s;const o=d[e]?.properties.find((({name:e})=>"MEMBER_CAPTION"===e||"CAPTION"===e))?.expression;if(void 0!==o&&(0,r.isMdxLiteral)(o)&&(s=o.value),n)for(const n of Object.values(t.kpis))for(const t of it)if(n[t]===i)return[{type:"kpiProperty",kpiName:n.name,propertyName:`KPI${(0,a.capitalize)(t)}`,underlyingMeasureName:e}];return s?[{measureName:e,type:"measure",caption:s}]:[{measureName:e,type:"measure"}]}));if(i)if(0===o.length)s.unshift({type:"allMeasures"});else{const t=(0,r.getMeasuresAxisName)(e),i=(0,r.getMeasuresPositionOnAxis)((0,r.getAxisByName)(e,t));((0,r.getAxisId)(t)===r.axisIds.rows?n:s).splice(i,0,{type:"allMeasures"})}return{numeric:{primaryNumeric:u},ordinal:{primaryOrdinal:[n],secondaryOrdinal:[s]}}}({mdx:e,cube:t,shouldIncludeAllMeasures:s});return De(o,i)}},74389:(e,t,i)=>{i.d(t,{FD:()=>o,FK:()=>a,Y:()=>s});var n=i(65723),r=i(42369),a=(i(93345),i(77619),i(4674),i(21880),i(48785),n.Fragment);function s(e,t,i){return r.h.call(t,"css")?n.jsx(r.E,(0,r.c)(e,t),i):n.jsx(e,t,i)}function o(e,t,i){return r.h.call(t,"css")?n.jsxs(r.E,(0,r.c)(e,t),i):n.jsxs(e,t,i)}},62921:(e,t,i)=>{var n=i(93345),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,i){var n,a={},u=null,m=null;for(n in void 0!==i&&(u=""+i),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(m=t.ref),t)s.call(t,n)&&!d.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:r,type:e,key:u,ref:m,props:a,_owner:o.current}}t.Fragment=a,t.jsx=u,t.jsxs=u},65723:(e,t,i)=>{e.exports=i(62921)}}]);