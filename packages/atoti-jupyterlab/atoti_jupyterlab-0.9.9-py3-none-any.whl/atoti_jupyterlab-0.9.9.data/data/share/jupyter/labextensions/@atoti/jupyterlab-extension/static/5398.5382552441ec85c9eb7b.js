/*! For license information please see 5398.5382552441ec85c9eb7b.js.LICENSE.txt */
(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[5398,4389,6770,5723],{15398:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>pn});var i=n(3161),s=n(89594),r=n(76228),o=n(92338),a=n(16513),l=n(47216),d=n(74602),c=n(94692),u=n(90193);const g=[u.toolContentEditor,u.toolFiltersEditor,u.toolStyleEditor].map((e=>{const{shortcut:t,...n}=e;return n})),h="en-US",p={default:"en-US"},m=e=>{if(!e)return h;const t=e.get("locale").composite,n=p[t];return void 0===n?(console.error(`Atoti does not support JupyterLab's ${t} locale, falling back to ${h}.`),h):n},y=async(e,{pluginRegistry:t})=>{const[i,{default:s}]=await Promise.all([(0,u.fetchTranslations)(e),n(20625)(`./${e}.js`)]);return{...i,...(0,u.getPluginsTranslations)(t,e),...(0,u.getToolsTranslations)([...g],e),...(0,c.treeToFlatMap)(s)}};class f{static async create({pluginRegistry:e,settingRegistry:t}){const n=await t.load("@jupyterlab/translation-extension:plugin"),i=m(n),s=await y(i,{pluginRegistry:e});return new f({initialConfig:{locale:i,messages:s},pluginRegistry:e,translationSettings:n})}_changed=new d.Signal(this);_config;constructor({initialConfig:e,pluginRegistry:t,translationSettings:n}){this._config=e,n.changed.connect((async()=>{const e=m(n),i=await y(e,{pluginRegistry:t});this._config={locale:e,messages:i},this._changed.emit()}))}get changed(){return this._changed}get config(){return this._config}}const w=async e=>{e.theme||(await new Promise((t=>{const n=()=>{e.themeChanged.disconnect(n),t(void 0)};e.themeChanged.connect(n)})),await w(e))};class C{static async create(e){await w(e);const t=()=>!e.theme||e.isLight(e.theme)?u.lightActiveViamTheme:u.darkActiveViamTheme,n=t();return new C({initialTheme:n,syncTheme:t,themeManager:e})}_changed=new d.Signal(this);_theme;constructor({initialTheme:e,syncTheme:t,themeManager:n}){this._theme=e,n.themeChanged.connect((()=>{this._theme=t(),this._changed.emit()}))}get changed(){return this._changed}get theme(){return this._theme}}var v=n(87315),b=n(29012);class S{listeners=new Set;async run(){await Promise.all([...this.listeners].map((async e=>{await e()})))}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}}var k=n(74389),T=n(58997),M=n(38412),x=n(93345),I=n(56155),D=n(5140),Y=n(7628),P=n(50892),E=n(58597);const W="Content-Type",_="application/json",$=(e,{requestInit:t={}}={})=>async(n,{body:i,contentType:s=_,method:r,signal:o}={})=>{const a=`${e}${n.startsWith("/")?n:`/${n}`}`,l=await fetch(a,{...t,body:i,headers:{...t.headers,...s?{[W]:s}:void 0},method:r,signal:o});if(!l.ok){const e=await l.json();throw console.error(e),new Error(`Unexpected response status: ${l.status}`)}const d=l.headers.get(W)===_;let c=await(d?l.json():l.text());return d&&"object"==typeof c&&"success"===c.status&&"data"in c&&(c=c.data),c},j=E.PageConfig.getBaseUrl(),{hostname:R,protocol:L}=new URL(j),F=async(e,{jupyterServerProxyEnabled:t,signal:n})=>{const i=((e,{jupyterServerProxyEnabled:t})=>{const{hostname:n,pathname:i,port:s,protocol:r}=new URL(e),o=i&&"/"!==i?[i]:[],a=s||("https:"===r?"443":"80"),l=[];t&&l.push(E.URLExt.join(j,"proxy",["localhost","127.0.0.1","0.0.0.0"].includes(n)?a:`${n}:${a}`,...o));const d=`${"https:"===L?L:r}//${R}${a?`:${a}`:""}`;d!==e&&l.push(d),l.push(e);const c=R.split(".");return c.length>2&&l.push(`${L}//${[`${c[0]}-${a}`,...c.slice(1)].join(".")}`),l})(e,{jupyterServerProxyEnabled:t});for(const e of i)try{const t=$(e);return{sessionUrl:e,versions:await t("versions/rest",{signal:n})}}catch{}throw new Error("Cannot reach the session "+(1===i.length?`from ${i[0]}`:`from any of these URLs: ${i}`))},O=e=>e.apis.atoti?.versions[0],U=(e,t="")=>{if(""===t){const{pathname:t}=new URL(e);return`${e}${""===t||"/"===t?"":"/"}`}return`${e}/${t}`};var A=n(31529);class B{static async create({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionUrl:i,signal:s}){const{sessionUrl:r,versions:o}=await F(i,{jupyterServerProxyEnabled:e,signal:s}),a=null===t?void 0:{credentials:"include",headers:t,mode:"cors"},l=$(r,{requestInit:a}),[d,c,g]=["content","jwt","pivot"].map((e=>{const t=[`activeviam/${e}`,e];for(const e of t)if(e in o.apis)return o.apis[e].versions[0]}));if(!c)throw new Error(`Missing \`jwt\` service in ${Object.keys(o.apis)}.`);if(!g)throw new Error(`Missing \`pivot\` service in ${Object.keys(o.apis)}.`);const h=(0,u.createAtotiClient)({requestInit:a,serverVersion:o.serverVersion,serviceVersion:g,url:r}),p=(e=>{const t=e?.Authorization||e?.authorization;return"string"==typeof t&&t.startsWith("Jwt ")?t:void 0})(t),[{token:m}]=await Promise.all([p?Promise.resolve({token:p}):l(`${c.restPath}/token`),h.loadDataModel({signal:s})]),y=(0,u.getUserFromJwt)(m),f=d?(0,u.createContentClient)({requestInit:a,serverVersion:o.serverVersion,serviceVersion:d,url:r}):void 0;return new B({atotiClient:h,contentClient:f,fetch:l,id:n,user:y,versions:o})}atotiClient;contentClient;fetch;id;user;versions;_disposed=new d.Signal(this);_isDisposed=!1;subscriberCount=0;stopSyncingDataModel;constructor({atotiClient:e,contentClient:t,fetch:n,id:i,user:s,versions:r}){this.atotiClient=e,this.contentClient=t,this.fetch=n,this.id=i,this.stopSyncingDataModel=O(r)?(0,l.syncDataModel)(e):A.noop,this.user=s,this.versions=r}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),this.atotiClient.disconnect(),this.stopSyncingDataModel(),d.Signal.clearData(this))}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}subscribe(){return this.subscriberCount++,()=>{this.subscriberCount--,0===this.subscriberCount&&this.dispose()}}}const N=({children:e,description:t,icon:n,id:i})=>{const{formatMessage:s}=(0,P.useIntl)();return(0,k.Y)("div",{css:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"center"},children:(0,k.Y)(M.Empty,{description:(0,k.FD)("span",{css:{color:"var(--jp-ui-font-color1)"},children:[(0,k.Y)("span",{css:{fontSize:"var(--jp-ui-font-size2)"},children:s({id:`${i}.title`})}),(0,k.Y)("br",{}),(0,k.Y)("span",{css:{color:"var(--jp-ui-font-color2)",fontSize:"var(--jp-ui-font-size1)"},children:t??s({id:`${i}.description`})})]}),image:n,imageStyle:{fontSize:42,height:60},children:e})})};var K=n(77051);const z=({hasSnapshot:e})=>e?(0,k.Y)(N,{icon:(0,k.Y)(K.CameraOutlined,{}),id:"widget.snapshotSelected"}):(0,k.Y)(N,{icon:(0,k.Y)(K.ApiOutlined,{}),id:"widget.waitingForConnection"}),H=(e,t)=>{const n=(0,x.useCallback)((t=>e?(e.connect(t),()=>{e.disconnect(t)}):A.noop),[e]);return(0,x.useSyncExternalStore)(n,t)},q=(e,{property:t,sender:n})=>H(e,(()=>{if(n)return n[t]})),V=(0,x.createContext)(void 0),Q=()=>{const e=(0,x.useContext)(V);if(!e)throw new Error("Missing session clients.");return e},J=(0,x.createContext)(void 0),G=({children:e,sessionId:t})=>{const n=Q(),i=H(n.changed,(()=>n.get(t))),s=(0,x.useMemo)((()=>{const e={};return i&&(e[l.defaultServerKey]=i.atotiClient),e}),[i]);return i?(0,k.Y)(u.UserProvider,{value:i.user,children:(0,k.Y)(u.ClientsProvider,{value:{atoti:s},children:(0,k.Y)(J.Provider,{value:i,children:e})})}):(0,k.Y)(z,{})},X=()=>{const e=(0,x.useContext)(J);if(!e)throw new Error("Missing session client.");return e};class Z{_changed=new d.Signal(this);sessionClients={};sessionClientCreations={};get changed(){return this._changed}get(e){return this.sessionClients[e]}async getOrCreate({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionUrl:i,signal:s}){const r=this.get(n);if(r){const{atotiClient:e}=r;return"disconnected"===e.connectionStatus&&await e.connect(),r}n in this.sessionClientCreations||(this.sessionClientCreations[n]=(async()=>{const r=await B.create({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionUrl:i,signal:s}),o=()=>{Reflect.deleteProperty(this.sessionClients,n),this._changed.emit(),r.disposed.disconnect(o)};r.disposed.connect(o),this.sessionClients[n]=r,Reflect.deleteProperty(this.sessionClientCreations,n),this._changed.emit()})()),await this.sessionClientCreations[n];const o=this.sessionClients[n];if(!o)throw new Error("Missing session client.");return o}}const ee=e=>"mapping"in e;var te=n(92377),ne=n(90147);class ie{onChange;index=0;states;constructor(e,t){this.onChange=t,this.states=[e]}get current(){return this.states[this.index]}get canRedo(){return this.index<this.states.length-1}get canUndo(){return this.index>0}set(e){e!==this.current&&(this.index++,this.states.length=this.index,this.states.push(e),this.onChange())}redo(){if(!this.canRedo)throw new Error("Cannot redo");this.index++,this.onChange()}undo(){if(!this.canUndo)throw new Error("Cannot undo");this.index--,this.onChange()}}const se="atoti",re="height",oe="widget",ae=360,le=e=>e.getMetadata(se)??void 0,de=e=>{const t=e[oe];return{...e,[oe]:t?(0,u.deserializeWidgetState)(t):void 0}},ce=e=>{const t=e[oe];return{...e,[oe]:t?(0,u.serializeWidgetState)(t):void 0}},ue=e=>le(e)?.[re]??ae;class ge{cellModel;_changed=new d.Signal(this);_isDeferredChanged=new d.Signal(this);_isDeferred=!1;_isDisposed=!1;disconnectFromCellMetadataChangedSignal;undoableState;updatingState=!1;widgetPlugins;constructor(e,{widgetPlugins:t}){this.cellModel=e;const n=le(this.cellModel);this.undoableState=new ie(n?de(n):void 0,(()=>{this.updatingState=!0;try{this.current?this.cellModel.setMetadata(se,ce(this.current)):this.cellModel.deleteMetadata(se)}finally{this.updatingState=!1}this._changed.emit()}));const i=(e,{key:t,newValue:n})=>{t!==se||this.updatingState||(this.current=((e,t)=>{if(!t)return;const n=de(t);return e?(i=e,s=n,(0,ne.produce)(i,(e=>{const t=(0,te.compare)(e,s);(0,te.applyPatch)(e,t)}))):n;var i,s})(this.current,n))};this.cellModel.metadataChanged.connect(i),this.disconnectFromCellMetadataChangedSignal=()=>{this.cellModel.metadataChanged.disconnect(i)},this.widgetPlugins=t}get defaultWidgetState(){return this.widgetPlugins[0].initialState}get canRedo(){return this.undoableState.canRedo}get canUndo(){return this.undoableState.canUndo}get changed(){return this._changed}get current(){return this.undoableState.current}set current(e){this.undoableState.set(e)}dispose(){this.isDisposed||(this._isDisposed=!0,this.disconnectFromCellMetadataChangedSignal(),d.Signal.clearData(this))}get isDeferred(){return this._isDeferred}set isDeferred(e){this._isDeferred=e,this._isDeferredChanged.emit()}get isDeferredChanged(){return this._isDeferredChanged}get isDisposed(){return this._isDisposed}setHeight(e){this.setMetadataProperty(re,e)}setWidgetState(e){this.setMetadataProperty(oe,e)}redo(){this.undoableState.redo()}undo(){this.undoableState.undo()}setMetadataProperty(e,t){const{current:n}=this;this.current={...n,[e]:t}}}const he=e=>{const t=q(e.isDeferredChanged,{property:"isDeferred",sender:e}),n=(0,x.useCallback)((t=>{e.isDeferred=t}),[e]);return{isDeferred:t,setIsDeferred:n}},pe=e=>{const t=(0,x.useCallback)((t=>{e.setWidgetState(t)}),[e]),{[oe]:n}=q(e.changed,{property:"current",sender:e})??{};return{setWidgetState:t,widgetState:n}},me=(0,x.createContext)(void 0),ye=()=>{const e=(0,x.useContext)(me);if(!e)throw new Error("Missing widget state trackers.");return e},fe=(0,x.createContext)(void 0),we=({cellModel:e,children:t,hasSnapshot:n})=>{const i=ye(),s=H(i.created,(()=>i.get(e)));return s?(0,k.Y)(fe.Provider,{value:s,children:t}):(0,k.Y)(z,{hasSnapshot:n})},Ce=()=>{const e=(0,x.useContext)(fe);if(!e)throw new Error("Missing widget state tracker.");return e};class ve{_created=new d.Signal(this);widgetPlugins;widgetStateTrackers=new WeakMap;constructor({widgetPlugins:e}){this.widgetPlugins=e}get created(){return this._created}get(e){return this.widgetStateTrackers.get(e)}getOrCreate(e){return this.widgetStateTrackers.has(e)||(this.widgetStateTrackers.set(e,new ge(e,{widgetPlugins:this.widgetPlugins})),this._created.emit()),this.get(e)}}const be=(0,x.createContext)(void 0),Se=(0,x.createContext)(!1),ke=(0,x.createContext)(void 0),Te=({children:e,value:{dataModelClickListeners:t,intlTracker:n,jupyterLab:i,jupyterServerProxyEnabled:s,notebookTracker:r,pluginRegistry:o,popupContainer:a,sessionClients:l,themeTracker:d,widgetStateTrackers:c}})=>{const{locale:g,messages:h}=q(n.changed,{property:"config",sender:n}),p=q(d.changed,{property:"theme",sender:d}),m="atoti-popup-container";return(0,k.FD)(k.FK,{children:[(0,Y.createPortal)((0,k.Y)(u.ThemeProvider,{value:p,children:(0,k.Y)("div",{id:m})}),a),(0,k.Y)(M.ConfigProvider,{getPopupContainer:()=>document.querySelector(`#${m}`),children:(0,k.Y)(I.DndProvider,{backend:D.HTML5Backend,children:(0,k.Y)(P.IntlProvider,{locale:g,messages:h,children:(0,k.Y)(u.ThemeProvider,{css:{height:"100%"},value:p,children:(0,k.Y)(u.PluginsProvider,{value:o,children:(0,k.Y)(u.DataModelClickListenersProvider,{initialValue:t,children:(0,k.Y)(be.Provider,{value:i,children:(0,k.Y)(Se.Provider,{value:s,children:(0,k.Y)(ke.Provider,{value:r,children:(0,k.Y)(V.Provider,{value:l,children:(0,k.Y)(me.Provider,{value:c,children:e})})})})})})})})})})})]})},Me=()=>{const e=(0,x.useContext)(be);if(!e)throw new Error("Missing JupyterLab.");return e},xe=()=>(0,x.useContext)(Se),Ie=()=>{const e=(0,x.useContext)(ke);if(!e)throw new Error("Missing notebook tracker.");return e},De=(0,x.createContext)(null),Ye=De.Provider,Pe=()=>{const e=(0,x.useContext)(De);if(!e)throw new Error("Missing widget environment.");return e},Ee=(e,t)=>{for(let n=0;n<e.length;n++){const i=e.get(n);if(t(i))return i}},We="text/html",_e=l.version.split(".",1).pop(),$e=`application/vnd.atoti.link.v${_e}+json`,je=`application/vnd.atoti.widget.v${_e}+json`,Re=`application/vnd.atoti.convert-mdx-query-result-to-widget.v${_e}+json`,Le=({children:e})=>{const[t,n]=(0,x.useState)(),i=(0,x.useRef)(null);return(0,x.useEffect)((()=>{const e=i.current;e&&void 0===t&&n(null!==e.closest(".jp-LinkedOutputView"))}),[t]),void 0===t?(0,k.Y)("div",{ref:i}):e(t)};var Fe=n(35829),Oe=n(12343),Ue=n(99871);const Ae=e=>{const{formatMessage:t}=(0,P.useIntl)(),{widgetKey:n}=(0,u.useSwitchedWidgetState)(e);return t({id:`aui.plugins.widget.${n}.defaultName`})};var Be=n(98396);const Ne="atoti-exclude-from-snapshot",Ke=async({code:e,notebookTracker:t,state:n})=>{const i=t.currentWidget;if(!i)throw new Error("Notebook has no current panel.");const s=i.model;if(!s)throw new Error("Current notebook panel has no model.");const o=i.content;if(s.sharedModel.insertCell(o.activeCellIndex+1,(({code:e,state:t})=>({cell_type:"code",execution_count:null,metadata:{[se]:ce({[oe]:t})},outputs:[],source:e}))({code:e,state:n})),o.activeCellIndex++,!o.activeCell||!(0,v.isCodeCellModel)(o.activeCell.model))throw new Error("A code cell has just been inserted and activated, expected the the current active cell to be a code cell.");const a=o.activeCell;return await r.NotebookActions.run(o,i.sessionContext),a},ze=e=>{const t=q(e.activeCellChanged,{property:"activeCell",sender:e});if(t&&(0,v.isCodeCellModel)(t.model))return t.model},He=()=>{const e=Ie(),t=ze(e),{cellModel:n}=Pe();return t===n},qe=({onChange:e,widgetState:t})=>{if(!e)throw new Error("Missing `onChange` prop.");const n=Ae(t),[i,s]=(0,x.useState)(t.name??n);(0,x.useEffect)((()=>{s(t.name??n)}),[n,t.name]);const r=(0,x.useCallback)((()=>{if(i&&i!==n)e({...t,name:i});else{const{name:i,...r}=t;s(n),e(r)}}),[n,e,s,i,t]);return(0,k.Y)(Ue.TitleInput,{css:{height:"100%",padding:2},isPlaceholder:!t.name,isStrictlySized:!1,value:i,onBlur:r,onChange:s})},Ve=[],Qe=({onChange:e,queryId:t,widgetState:n})=>{const{widgetKey:i}=(0,u.useSwitchedWidgetState)(n),[s]=(0,Oe.useWidgetPlugins)([i]),r=(0,Fe.useTitleBarButtonPlugins)(s.titleBarButtons??Ve);return He()?(0,k.Y)("div",{className:Ne,css:{display:"flex",justifySelf:"end"},children:r.map((({Component:i,key:s})=>(0,k.Y)(i,{css:{marginRight:8},queryId:t,widgetState:n,onWidgetChange:e},s)))}):null},Je=e=>(0,k.FD)("div",{css:{display:"flex",fontSize:16,height:36,justifyContent:"space-between"},children:[(0,k.Y)(qe,{...e}),(0,k.Y)(Qe,{...e})]}),Ge=(0,u.withWidgetLoadingBar)((e=>{const t=(0,x.forwardRef)(((t,n)=>(0,k.FD)("div",{ref:n,css:{height:"100%"},children:[(0,k.Y)(Je,{...t}),(0,k.Y)("div",{css:{height:"calc(100% - 36px)"},children:(0,k.Y)(e,{...t})})]}))),n=e.displayName??e.name??"Unknown";return t.displayName=`withTitleBar(${n})`,t})(u.Widget));var Xe=n(77227);const Ze=({error:e})=>{const t=Ce(),{formatMessage:n}=(0,P.useIntl)();return(0,k.FD)(N,{description:String(e),icon:(0,k.Y)(K.MehOutlined,{}),id:"widget.errored",children:[(0,k.FD)(M.Button,{danger:!0,onClick:()=>{t.current=void 0},children:[(0,k.Y)(K.ClearOutlined,{})," ",n({id:"widget.reset"})]}),t.canUndo?(0,k.FD)(M.Button,{css:{marginLeft:"4px !important",marginTop:"4px !important"},onClick:()=>{t.undo()},children:[(0,k.Y)(K.UndoOutlined,{})," ",n({id:"aui.plugins.titlebar-button.undo.key"})]}):null]})},et=({children:e,widgetLoadingTracker:t})=>{const n=(0,x.useCallback)((async e=>{t&&await t.handleError(e)}),[t]),i=Ce(),s=pe(i);return(0,k.Y)(Xe.ErrorBoundary,{FallbackComponent:Ze,resetKeys:[s],onError:n,children:e})},tt=({children:e})=>{const{formatMessage:t}=(0,P.useIntl)(),n=He(),{[l.defaultServerKey]:i}=(0,u.useConnectionStatuses)(),[s,r]=(0,x.useState)(!1),o=(0,x.useCallback)((()=>{r(!0)}),[]),a="disconnected"===i;return(0,x.useEffect)((()=>{r(!a)}),[a]),(0,k.FD)(x.Fragment,{children:[n&&a&&!s?(0,k.Y)("div",{css:{padding:4,position:"absolute",width:"100%",zIndex:1},children:(0,k.Y)(M.Alert,{closable:!0,showIcon:!0,className:Ne,message:t({id:"widget.sessionDisconnected"}),type:"warning",onClose:o})}):null,e]})},nt=({children:e,widgetLoadingTracker:t})=>(0,k.Y)(tt,{children:(0,k.Y)(et,{widgetLoadingTracker:t,children:e})}),it=()=>{const e=(0,x.useRef)(null),{cellModel:{id:t}}=Pe(),n=Ce(),{isDeferred:i}=he(n),{setWidgetState:s,widgetState:r=n.defaultWidgetState}=pe(n);return(0,x.useEffect)((()=>{const t=e.current;if(!t)throw new Error("Expected div to have been mounted and ref to have been set.");(e=>{let t=e;for(;t;)if(({parentElement:t}=t),t?.classList?.contains("jp-OutputArea-child"))return void(t.style.height="100%");throw new Error("Expected to find right parent element before exhausting them all.")})(t)}),[]),(0,k.Y)(Ge,{ref:e,isDeferred:i,queryId:t,widgetState:r,onChange:s})},st=()=>{const{cellModel:e,mimeModel:t,sessionId:n}=Pe();return(0,k.Y)(we,{cellModel:e,hasSnapshot:Boolean(t.data[We]),children:(0,k.Y)(G,{sessionId:n,children:(0,k.Y)(nt,{children:(0,k.Y)(it,{})})})})};var rt=n(62795);class ot{widgetId;sessionClient;toldLoadingDone=!1;constructor({sessionClient:e,widgetId:t}){this.sessionClient=e,this.widgetId=t}async done(){const e=O(this.sessionClient.versions);if(this.toldLoadingDone||!e)return;this.toldLoadingDone=!0;const t=`${e.restPath}/widgets/${this.widgetId}/loading`;await this.sessionClient.fetch(t,{method:"DELETE"})}async handleError(e){await this.done()}}class at{_changed=new d.Signal(this);cellModels;messages=new WeakMap;constructor({cellModels:e}){this.cellModels=e}get changed(){return this._changed}get(e){return this.messages.get(e)}register(e){this._changed.emit(),e.registerCommTarget("atoti-widget",((e,{content:{data:t}})=>{const n=t;try{const{cellId:e}=n,t=[...this.cellModels].find((({id:t})=>e===t));if(!t)throw new Error(`Missing model for cell #${e}`);if(!(0,v.isCodeCellModel)(t))throw new Error(`Expected cell #${e} to be a code cell`);const i=Ee(t.outputs,(e=>void 0!==e.data[je]));if(!i)throw new Error(`Expected cell #${e} to have a widget output`);this.messages.set(i,n),this._changed.emit()}catch(e){console.error(e)}}))}}const lt="atoti-sidebar",dt=({jupyterLab:e})=>{e.shell.activateById(lt)};var ct=n(40391),ut=n(35256);const gt=({children:e,collapsedTitle:t,expandedTitle:n,isDisabled:i,isExpanded:s,onToggled:r})=>{const o=(0,u.useTheme)(),a=(0,x.useCallback)((()=>{r&&r(!s)}),[s,r]);return s?(0,k.FD)(k.FK,{children:[(0,k.FD)("div",{css:{alignItems:"center",backgroundColor:o.alternateBackgroundColor,borderBottom:`1px solid ${o.grayScale[5]}`,cursor:"pointer",display:"flex",height:20,justifyContent:"space-between",padding:8},onClick:a,children:[(0,k.Y)("div",{css:{fontSize:"11px",textTransform:"uppercase",width:"100%"},children:n}),(0,k.Y)("div",{css:{color:o.textColor},children:!i&&(0,k.Y)(K.DoubleLeftOutlined,{})})]}),(0,k.Y)("div",{css:{height:"calc(100% - 20px)"},children:e})]}):(0,k.FD)("div",{css:{height:"100%"},onClick:a,children:[(0,k.Y)("div",{css:{alignItems:"center",backgroundColor:o.alternateBackgroundColor,borderBottom:`1px solid ${o.cellBorderColor}`,borderRight:`1px solid ${o.cellBorderColor}`,display:"flex",height:20,justifyContent:"center"},children:(0,k.Y)("div",{css:{cursor:"pointer"},children:(0,k.Y)(K.DoubleRightOutlined,{})})}),(0,k.Y)("div",{css:{backgroundColor:o.alternateBackgroundColor,borderRight:`1px solid ${o.cellBorderColor}`,cursor:"pointer",height:"100%",textAlign:"center",whiteSpace:"nowrap"},children:t})]})};var ht=n(67373);const pt=({isQueryLazyLoaded:e,selectedWidgetState:t,widgetOption:n})=>{const{formatMessage:i}=(0,P.useIntl)(),s=void 0===t?"":t.name??i({id:`aui.plugins.widget.${(0,u.isWidgetWithQueryState)(t)&&!t.widgetKey.startsWith("drillthrough")?t.switchedTo??t.widgetKey:t.widgetKey}.defaultName`}),r=i({id:`aui.plugins.widget.${n.key}.key`}),o=void 0!==n.lazyLoading;return(0,k.Y)(k.FK,{children:i({id:"aui.dataVisualization.switchDisabled"},{maxNumberOfFields:n.maxNumberOfFields,nameOfSelectedWidget:s,nameOfTargetWidgetPlugin:r,reason:e&&!o?"lazyLoading":"tooManyFields",type:n.disabledType})})},{OptGroup:mt,Option:yt}=M.Select,ft=({onChange:e,queryId:t,widgetState:n})=>{const{formatMessage:i}=(0,P.useIntl)(),s=(0,u.useTheme)(),r=(0,ht.useIsQueryLazyLoaded)({queryId:t,widgetState:n}),o=(e=>{const t=(0,u.useWidgetPlugins)(e),n=(0,x.useMemo)((()=>{const e=[];for(const n of t)(0,ht.isDataVisualizationWidgetPlugin)(n)&&e.push(n);return e}),[t]);return n})((0,u.useWidgetPluginKeys)()),{mapping:a,widgetKey:l}=(0,u.useSwitchedWidgetState)(n),{attributes:d}=o.find((({key:e})=>e===l)),c=(0,x.useMemo)((()=>{const e={};for(const t of Object.values(o)){const o=t.subCategory??"misc";e[o]||=[];const l=t.Icon??K.QuestionOutlined,{maxNumberOfFields:c,status:u}=(0,ht.getSwitchAvailability)(a,d,t),g=r&&!t.lazyLoading||"ok"!==u;e[o].push((0,k.Y)(yt,{disabled:g,value:t.key,children:(0,k.FD)(M.Tooltip,{title:g?(0,k.Y)(pt,{isQueryLazyLoaded:r,selectedWidgetState:n,widgetOption:{...t,disabledType:"tooManyNumeric"===u?"numeric":"ordinal",isSwitchDisabled:g,maxNumberOfFields:c}}):void 0,children:[(0,k.Y)(l,{css:{color:s.primaryColor,marginRight:4}})," ",i({id:`aui.plugins.widget.${t.key}.key`})]})},t.key))}return e}),[d,o,i,r,a,s.primaryColor,n]);return(0,k.Y)(M.Select,{css:{height:28,width:"100%"},listHeight:30*Object.keys(o).length,value:l,onChange:t=>{e((0,ne.produce)(n,(e=>{t===e.widgetKey?delete e.switchedTo:e.switchedTo=t})))},children:Object.entries(c).map((([e,t])=>(0,k.Y)(mt,{label:i({id:`aui.dataVisualization.category.${e}`}),children:t},e)))})},wt=()=>{const e=Ce(),{isDeferred:t,setIsDeferred:n}=he(e),{formatMessage:i}=(0,P.useIntl)();return(0,k.Y)("div",{css:{alignItems:"center",display:"flex",flexDirection:"row",height:26,justifyContent:"flex-end"},children:(0,k.Y)(M.Checkbox,{checked:t,onChange:e=>{n(e.target.checked)},children:i({id:"sidebar.deferUpdates"})})})},Ct=({activeToolKey:e,onActiveToolKeyChanged:t,tools:n})=>(0,k.Y)(M.Tabs,{css:{".ant-tabs-nav-operations":{".ant-tabs-nav-more":{alignItems:"center",display:"flex"},margin:"0 !important",padding:"0 !important"},"div.ant-tabs-tab-btn span.tab-item-label":{display:"none"}},activeKey:e,items:n.map((e=>({key:e.key,label:(0,k.Y)("span",{css:{".anticon":{marginRight:"0 !important"},display:"flex"},children:(0,k.Y)(e.icon,{})})}))),tabBarStyle:{height:20,marginTop:5,paddingLeft:8},type:"card",onTabClick:t}),vt=({cellId:e})=>{const{formatMessage:t}=(0,P.useIntl)(),n=(0,u.useTheme)(),i=Ce(),{setWidgetState:s,widgetState:r=i.defaultWidgetState}=pe(i),o=(0,u.useSwitchedWidgetState)(r),[a,d]=(0,x.useState)(240),[c,h]=(0,x.useState)("contentEditor"),{cube:{name:p}}=(0,u.useCube)(o),[m,y]=(0,x.useState)(!0),{component:f}=g.find((({key:e})=>e===c)),w=`1px solid ${n.cellBorderColor}`;return(0,k.FD)("div",{css:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"flex-end"},children:[ee(o)?(0,k.Y)("div",{css:{borderBottom:w,padding:"6px 8px"},children:(0,k.Y)(ft,{queryId:e,widgetState:o,onChange:s})}):null,(0,k.Y)("div",{css:{borderBottom:w,height:`calc(100% - ${26+(ee(o)?41:0)+1}px)`},children:(0,k.FD)(u.Resizable,{minSize:m?100:34,size:m?a??240:34,onResizeEnd:d,children:[(0,k.Y)(gt,{collapsedTitle:(0,k.Y)("div",{css:{backgroundColor:n.alternateBackgroundColor,display:"inline-block",marginTop:70,textTransform:"uppercase",transform:"rotate(-90deg)",width:15},children:t({id:"aui.dataModel"})}),expandedTitle:t({id:"aui.dataModel"}),isExpanded:m,onToggled:y,children:(0,k.Y)("div",{css:{display:"flex",height:"100%",width:"100%"},children:(0,k.Y)(u.DataModelTree,{cubeName:p,marginLeft:8,serverKey:l.defaultServerKey})})}),(0,k.FD)("div",{css:{height:"100%"},children:[(0,k.Y)("div",{css:{alignItems:"center",backgroundColor:n.alternateBackgroundColor,borderBottom:`1px solid ${n.grayScale[5]}`,display:"flex",fontSize:"11px",height:20,padding:8,textTransform:"uppercase"},children:t({id:"aui.tools"})}),(0,k.Y)(Ct,{activeToolKey:c,tools:g,onActiveToolKeyChanged:h}),(0,k.Y)("div",{css:{height:"calc(100% - 33px)",padding:"0px 8px"},children:(0,k.Y)(f,{widgetState:o,queryId:e,onWidgetChange:s})})]})]})}),(0,k.Y)(wt,{})]})},bt=()=>{const e=Ie(),t=ze(e),n=(e=>{q(e?.outputs.changed,{property:"length",sender:e?.outputs});const t=e?Ee(e.outputs,(e=>void 0!==e.data[je])):void 0;if(!t)return;const{data:n}=t;return{hasSnapshot:We in n,widgetOutput:n[je]}})(t);if(!t||!n)return(0,k.Y)(N,{icon:(0,k.Y)(u.IconPuzzle,{}),id:"sidebar.noWidgetSelected"});const{hasSnapshot:i,widgetOutput:s}=n;return(0,k.Y)(we,{cellModel:t,hasSnapshot:i,children:(0,k.Y)(G,{sessionId:s.sessionId,children:(0,k.Y)(et,{children:(0,k.Y)(vt,{cellId:t.id})})})})},St="atoti-icon",kt="jp-SideBar-tabIcon",Tt=`.${St}.${kt}`;class Mt extends ut.Widget{constructor(e){super(),this.id=lt,this.title.caption="Atoti",this.title.iconClass=`${kt} ${St}`;const t=s.ReactWidget.create((0,k.FD)(x.Fragment,{children:[(0,k.Y)(ct.Global,{styles:{[Tt]:{backgroundColor:"var(--md-grey-700)",backgroundImage:"none",maskImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 256 256'%3E%3Cpath fill='%23fff' d='M165.883 208.19h-75.8l-7.342 25.99H30.456l72.467-213.997h49.82l72.759 213.996h-52.267Zm-10.991-38.818-27.21-94.467-26.904 94.467Z'/%3E%3C/svg%3E%0A\");",maskPosition:"center",maskRepeat:"no-repeat",maskSize:"contain"},[`[data-jp-theme-light="false"] ${Tt}`]:{backgroundColor:"var(--md-grey-300)"}}}),(0,k.Y)(Te,{value:e,children:(0,k.Y)(bt,{})})]})),{style:n}=t.node;n.height="100%",n.padding="0";const i=new ut.PanelLayout;i.addWidget(t),this.layout=i}}const xt=({widgetLoadingTracker:e,widgetRef:t})=>{const{cellModel:{id:n}}=Pe(),i=Ce(),{isDeferred:s,setIsDeferred:r}=he(i),{setWidgetState:o,widgetState:a}=pe(i),d=a??i.defaultWidgetState,c=(p=e,(0,x.useEffect)((()=>()=>{(async()=>{await p.done()})()}),[p]),(0,x.useCallback)((async()=>{await p.done()}),[p])),g=(e=>{const{cellModel:{id:t},mimeModel:n,preSaveSubscribe:i}=Pe(),s=(0,x.useRef)(!1),r=Ce(),{widgetState:{name:o}={}}=pe(r),a=(0,x.useCallback)((e=>{const{[We]:t,...i}=n.data;n.setData({data:e?{...i,[We]:`<img height="${e.height}" width="${e.width}" src="${e.src}" />`}:i})}),[n]),{error:d}=(0,u.useQueryResult)({queryId:t,serverKey:l.defaultServerKey});return(0,x.useEffect)((()=>{let t=!1;const n=i((async()=>{let n;if(s.current&&!d&&e.current)try{const t=Date.now(),{clientHeight:i,clientWidth:s}=e.current;n={height:i,src:await(async e=>await(0,Be.domToPng)(e,{filter:e=>!(e=>e.nodeType===e.ELEMENT_NODE)(e)||!e.classList.contains(Ne),scale:window.devicePixelRatio??1}))(e.current),width:s};const r=Date.now();console.debug(`Snapshotted widget "${o}" in ${(r-t)/1e3} seconds.`)}catch(e){throw new Error("Failed to snapshot widget",{cause:e})}t||a(n)}));return()=>{t=!0,n()}}),[d,o,i,a,e]),(0,x.useCallback)((()=>{s.current=!0}),[])})(t),h=(0,x.useCallback)((()=>{c(),g()}),[c,g]);var p;(e=>{const t=Me();(0,x.useEffect)((()=>{e&&dt({jupyterLab:t})}),[e,t])})(void 0===a),(e=>{(0,x.useEffect)((()=>()=>{e(!1)}),[e])})(r),(()=>{const e=X();(0,x.useEffect)((()=>e.subscribe()),[e])})();const m=He();return(0,k.Y)(Ge,{isDeferred:s,queryId:n,widgetState:d,isSelected:m,onLoaded:h,onChange:o})};var It=n(8598);const Dt=":",Yt=`atoti${Dt}`,Pt=e=>void 0!==e,Et=(...e)=>{if(!window.__UNSTABLE_DATA_TEST_IDS_ENABLED__)return;const t=e.at(-1);if((0,A.isPlainObject)(t)){const n=t["data-testid"],i=e.slice(0,-1).filter(Pt);if(n){const e=n.replace(Yt,"");return`${Yt}${[...i.filter(Pt),e].join(Dt)}`}return`${Yt}${i.join(Dt)}`}return`${Yt}${e.filter(Pt).join(Dt)}`},Wt="atoti-resize-handle",_t=(0,x.forwardRef)((({children:e},t)=>{const n=Ce(),{height:i,setHeight:s}=(e=>{const t=(0,x.useCallback)((t=>{e.setHeight(t)}),[e]),{height:n=ae}=q(e.changed,{property:"current",sender:e})??{};return{height:n,setHeight:t}})(n),{widgetState:{name:r}={}}=pe(n),o=(0,u.useTheme)();return(0,k.Y)(ct.ClassNames,{children:({css:n})=>(0,k.Y)(It.Resizable,{handleClasses:{bottom:`${Wt} ${n({backgroundColor:o.grayScale[6],borderRadius:2,borderTop:"unset",height:"4px !important",marginBottom:6,marginLeft:"calc(50% - 16px)",opacity:.4,width:"32px !important"})}`},size:{height:i,width:"100%"},enable:{bottom:!0,bottomLeft:!1,bottomRight:!1,left:!1,right:!1,top:!1,topLeft:!1,topRight:!1},css:{[`&:hover .${Wt}`]:{display:"inherit"},overflow:"hidden",paddingBottom:8},onResizeStop:(e,t,n,r)=>{s(i+r.height)},children:(0,k.Y)("div",{ref:t,css:{height:"100%"},"data-testid":Et("Widget",r),children:e})})})})),$t=({html:e})=>{const t=(0,P.useIntl)(),{cellModel:n}=Pe(),i=(e=>le(e)?.[oe]?.name??void 0)(n);return(0,k.Y)("div",{dangerouslySetInnerHTML:{__html:e},css:{cursor:"help"},"data-testid":Et("WidgetSnapshot",i),title:t.formatMessage({id:"widget.snapshotSelected.description"})})},jt=()=>{const e=(0,x.useRef)(null),{cellModel:t,mimeModel:n,sessionId:i}=Pe(),s=(()=>{const e=xe(),t=Q(),{cellModel:n,mimeModel:i,sessionId:s,sessionUrl:r,widgetComm:o}=Pe(),a=ye(),l=((e,t)=>H(e.changed,(()=>e.get(t))))(o,i),{error:d,result:c}=(0,rt.useAsyncAbortable)((async i=>{if(!l)return;const{sessionHeaders:o,widgetId:d}=l,c=await t.getOrCreate({jupyterServerProxyEnabled:e,sessionHeaders:o,sessionId:s,sessionUrl:r,signal:i});return a.getOrCreate(n),new ot({sessionClient:c,widgetId:d})}),[n,e,t,s,r,l,a]);return d??c})(),r=ye().get(t);return s instanceof Error?(0,k.Y)("div",{css:{height:ue(t)},children:(0,k.Y)(N,{description:s.message,icon:(0,k.Y)(K.DisconnectOutlined,{}),id:"widget.connectionFailed"})}):s&&r?(0,k.Y)(we,{cellModel:t,children:(0,k.Y)(_t,{ref:e,children:(0,k.Y)(G,{sessionId:i,children:(0,k.Y)(nt,{widgetLoadingTracker:s,children:(0,k.Y)(xt,{widgetLoadingTracker:s,widgetRef:e})})})})}):n.data[We]?(0,k.Y)($t,{html:n.data[We]}):(0,k.Y)("div",{css:{height:ue(t)},children:(0,k.Y)(z,{})})},Rt=()=>(0,k.Y)(Le,{children:e=>e?(0,k.Y)(st,{}):(0,k.Y)(jt,{})});class Lt extends r.NotebookTools{cellModels;cleanUpFunctions=[];preSaveSubscribe;root;sharedContext;widgetComm;constructor({cellModels:e,preSaveSubscribe:t,sharedContext:n,widgetComm:i}){super({tracker:n.notebookTracker}),this.cellModels=e,this.preSaveSubscribe=t,this.root=(0,T.H)(this.node),this.sharedContext=n,this.widgetComm=i}async renderModel(e){const t=((e,{cellModels:t})=>{for(const n of t)if((0,v.isCodeCellModel)(n)&&Ee(n.outputs,(t=>t===e)))return n;throw new Error(`Could not find matching cell for model: ${JSON.stringify(e)}`)})(e,{cellModels:this.cellModels}),n=e.data[je],{sessionId:i,sessionUrl:s}=n;this.root.render((0,k.Y)(Te,{value:this.sharedContext,children:(0,k.Y)(Ye,{value:{cellModel:t,mimeModel:e,preSaveSubscribe:this.preSaveSubscribe,sessionId:i,sessionUrl:s,widgetComm:this.widgetComm},children:(0,k.Y)(Rt,{})})})),this.cleanUpFunctions.push((()=>{this.root.unmount()}))}handleEvent(e){if(e instanceof MouseEvent&&!e.shiftKey&&e.target){const t=new MouseEvent("contextmenu",{bubbles:!0,clientX:e.clientX,clientY:e.clientY,shiftKey:!0});e.stopPropagation(),e.preventDefault(),t.initEvent(t.type,!0,!0),e.target.dispatchEvent(t)}}onAfterAttach(){const e={capture:!0};this.node.addEventListener("contextmenu",this,e),this.cleanUpFunctions.push((()=>{this.node.removeEventListener("contextmenu",this,e)}))}onBeforeDetach(){for(const e of this.cleanUpFunctions)e()}}class Ft{sharedContext;constructor(e){this.sharedContext=e}createNew(e,t){const n=(e=>{let{save:t}=e;t=t.bind(e);const n=new S;return e.save=async()=>{try{await n.run()}catch(e){console.error("Pre save hook failed to run",e)}await t()},n.subscribe.bind(n)})(t),{content:i,model:s}=e;if(null===s)throw new Error("Session model should not be null at this time");const{cells:r}=s,o=new at({cellModels:r});i.rendermime.addFactory({createRenderer:()=>new Lt({cellModels:r,preSaveSubscribe:n,sharedContext:this.sharedContext,widgetComm:o}),defaultRank:0,mimeTypes:[je],safe:!1});const{sessionContext:a}=t,l=(e,{newValue:t})=>{t&&o.register(t)};a.kernelChanged.connect(l);const d=((e,{cellModels:t})=>(n,i)=>{if("idle"===i)for(const n of[...t].filter((t=>{const n=e.get(t);return n?.current&&(0,v.isCodeCellModel)(t)&&t.outputs.length>0&&!Ee(t.outputs,(e=>"error"===e.type||void 0!==e.data[je]))})))e.get(n).current=void 0})(this.sharedContext.widgetStateTrackers,{cellModels:r});return a.statusChanged.connect(d),new b.DisposableDelegate((()=>{a.kernelChanged.disconnect(l),a.statusChanged.disconnect(d)}))}}var Ot=n(834);const Ut="convert-mdx-query-result-to-widget",At=`atoti:${Ut}`,Bt=".jp-Notebook .jp-CodeCell .dataframe",Nt=e=>{const{activeCell:t}=e,n=t&&(0,v.isCodeCellModel)(t.model)&&Ee(t.model.outputs,(e=>void 0!==e.data[Re]));return n?n.data[Re]:void 0},Kt=E.URLExt.join(E.PageConfig.getBaseUrl(),"server-proxy","servers-info"),zt=async()=>{try{if((await fetch(Kt)).ok)return!0}catch{}return!1},Ht=({output:{path:e,sessionUrl:t}})=>{const n=xe(),{error:i,result:s}=(0,rt.useAsyncAbortable)((async e=>{const{sessionUrl:i}=await F(t,{jupyterServerProxyEnabled:n,signal:e});return i}),[n,t]);if(void 0!==i)return(0,k.Y)("div",{css:{paddingLeft:"var(--jp-code-padding)"},children:i.message});if(void 0===s)return null;const r=U(s,e);return(0,k.Y)("div",{css:{paddingLeft:"var(--jp-code-padding)"},children:(0,k.Y)("pre",{children:(0,k.Y)("a",{css:{":hover":{color:"var(--jp-content-link-color)",textDecoration:"underline"},color:"var(--jp-content-link-color)"},"data-testid":Et("Link"),href:r,target:"_blank",rel:"noopener noreferrer",children:r})})})};class qt extends r.NotebookTools{root;sharedContext;constructor(e){super({tracker:e.notebookTracker}),this.root=(0,T.H)(this.node),this.sharedContext=e}async renderModel(e){this.root.render((0,k.Y)(Te,{value:this.sharedContext,children:(0,k.Y)(Ht,{output:e.data[$e]})}))}onBeforeDetach(){this.root.unmount()}}class Vt{sharedContext;constructor(e){this.sharedContext=e}createNew(e,t){return e.content.rendermime.addFactory({createRenderer:()=>new qt(this.sharedContext),defaultRank:0,mimeTypes:[$e],safe:!1}),new b.DisposableSet}}var Qt=n(61386),Jt=n(17523),Gt=n(28650);const Xt="open-drillthrough",Zt={key:Xt,translations:{"en-US":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {on {member}}\n          }"}},useMenuItem:e=>{const{selection:t,widgetState:n}=e,{cube:i}=(0,u.useCube)(n),{formatMessage:s}=(0,P.useIntl)(),r=Me(),o=Ie(),{mimeModel:a}=Pe(),{widgetCreationCode:d}=a.data[je],c=(0,x.useMemo)((()=>{if((0,Gt.canOpenDrillthroughOnSelection)(t))return t.cells[0].tuple.filter((e=>"Measures"===e.dimensionName||!(0,Qt.isTotal)((0,u.getHierarchy)(e,i),e)))}),[i,t]),g=(0,x.useMemo)((()=>{if(!c)return;const e=c.filter((e=>"Measures"!==e.dimensionName));return s({id:`aui.plugins.menu-item.${Xt}.openDrillthrough`},{member:e.length>0?(0,Qt.getTupleCaption)(e,{captionForTotals:s({id:"aui.total"}),cube:i,hasOnlyCaptionForLeafLevels:!0,separator:", "}):void 0})}),[s,c,i]),{execute:h,loading:p}=(0,rt.useAsyncCallback)((async()=>{if(g&&c&&n.query.mdx){const e=(0,Gt.getDrillthroughWidgetFilters)({sourceWidgetFilters:n.filters,tuple:c}),t={...u.pluginWidgetDrillthroughTable.initialState,filters:e,initialCubeName:i.name,query:{...u.pluginWidgetDrillthroughTable.initialState.query,mdx:(0,Jt.getDefaultMdxDrillthrough)(i.name)},serverKey:l.defaultServerKey};dt({jupyterLab:r}),await Ke({code:d,notebookTracker:o,state:t})}}));if(c&&n.query.mdx)return{disabled:p,icon:(0,k.Y)(u.IconDrillthrough,{css:{marginRight:8}}),label:g,onClick:h}}},{Link:en,Text:tn}=M.Typography,nn="save-widget-in-app",sn={key:nn,translations:{"en-US":{errorMessage:"Widget could not be saved in app",saveWidgetInApp:"Save widget in app",successDescription:"Go to <a>the app</a>, create or open a dashboard, and open the <b>Insert > <i>icon</i> Saved widgets</b> menu to find your widget.",successMessage:"Widget saved in app",unsupportedSession:"Widgets can only be saved in sessions started with Atoti Python SDK."}},useMenuItem:e=>{const{notification:t}=M.App.useApp(),{formatMessage:n,locale:i,messages:s}=(0,P.useIntl)(),{url:r}=(0,u.useAtotiClient)(l.defaultServerKey),{contentClient:o,versions:a}=X(),{username:d}=(0,u.useUser)(),{widgetState:c}=e,g=Ae(c),{execute:h,loading:p}=(0,rt.useAsyncCallback)((async()=>{const{name:e,widgetKey:a,...l}=(0,u.serializeWidgetState)(c),h=[d];try{await o.createFile({content:l,metaData:{name:e??g,version:0,widgetKey:a},owners:h,pathToParentFolder:[],readers:h,type:"widget"});const d=U(r);t.success({description:(0,k.Y)(P.IntlProvider,{locale:i,messages:s,children:(0,k.Y)(P.FormattedMessage,{id:`aui.plugins.menu-item.${nn}.successDescription`,values:{a:e=>(0,k.Y)(en,{href:d,target:"_blank",rel:"noopener noreferrer",children:e}),b:e=>(0,k.Y)(tn,{strong:!0,children:e}),i:()=>(0,k.Y)(u.IconPuzzle,{})}})}),message:n({id:`aui.plugins.menu-item.${nn}.successMessage`})})}catch(e){console.error(e),t.error({description:String(e),message:n({id:`aui.plugins.menu-item.${nn}.errorMessage`})})}})),m=o&&O(a),y=!m||p,f=m?void 0:n({id:`aui.plugins.menu-item.${nn}.unsupportedSession`});return{disabled:y,icon:(0,k.Y)(K.DeliveredProcedureOutlined,{}),label:n({id:`aui.plugins.menu-item.${nn}.saveWidgetInApp`}),onClick:h,title:f}}},rn=e=>(0,A.keyBy)(e,"key"),on=["undo","redo"],an=(e,{notebookTracker:t,widgetStateTrackers:n})=>()=>{const{disabledTextColor:i}=(0,u.useTheme)(),s=ze(t),r=H(n.created,(()=>s&&n.get(s))),{formatMessage:o}=(0,P.useIntl)();q(r?.changed,{property:"current",sender:r});let a=!1;r&&(a="undo"===e?r.canUndo:r.canRedo);const l=(0,x.useCallback)((()=>{a&&r&&("undo"===e?r.undo():r.redo())}),[a,r]),[d,c]=(0,x.useState)(!1),g=(0,x.useCallback)((()=>{c(!0)}),[]),h=(0,x.useCallback)((()=>{c(!1)}),[]),p=o(a?{id:`aui.plugins.titlebar-button.${e}.key`}:{id:`aui.plugins.titlebar-button.${e}.nothingToUndoRedo`}),m="undo"===e?K.UndoOutlined:K.RedoOutlined;return(0,k.Y)(M.Tooltip,{placement:"bottom",title:p,open:d,children:(0,k.Y)(m,{css:{color:a?void 0:i,cursor:a?void 0:"not-allowed !important",padding:"0px 4px"},onClick:l,onMouseEnter:g,onMouseLeave:h})})},ln=[u.pluginWidgetPivotTable,u.pluginWidgetTreeTable,u.pluginWidgetTable,u.pluginWidgetKpi,u.pluginWidgetPlotlyLineChart,u.pluginWidgetPlotlyAreaChart,u.pluginWidgetPlotlyStackedAreaChart,u.pluginWidgetPlotly100StackedAreaChart,u.pluginWidgetPlotlyStackedColumnChart,u.pluginWidgetPlotlyClusteredColumnChart,u.pluginWidgetPlotly100StackedColumnChart,u.pluginWidgetPlotlyColumnsAndLinesChart,u.pluginWidgetPlotlyStackedBarChart,u.pluginWidgetPlotlyClusteredBarChart,u.pluginWidgetPlotly100StackedBarChart,u.pluginWidgetPlotlyPieChart,u.pluginWidgetPlotlyDonutChart,u.pluginWidgetPlotlyScatterPlot,u.pluginWidgetPlotlyRadarChart,u.pluginWidgetPlotlyWaterfallChart,u.pluginWidgetPlotlyBulletChart,u.pluginWidgetPlotlyGaugeChart,u.pluginWidgetPlotlyTreeMap,u.pluginWidgetDrillthroughTable];u.pluginWidgetDrillthroughTable.cellStyle=u.pluginCellStyleDrillthroughTable.key,u.pluginWidgetDrillthroughTable.contextMenuItems=[u.pluginMenuItemSortDrillthroughTableAscendingly.key,u.pluginMenuItemSortDrillthroughTableDescendingly.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemExportDrillthroughToCsv.key];const dn=ln.filter((({key:e})=>e.startsWith("plotly"))),cn=new Set(["bar","column","line"]);for(const e of dn)e.contextMenuItems=[u.pluginMenuItemFilterOnSelection.key,Zt.key,u.pluginMenuItemSortChartAscendingly.key,u.pluginMenuItemSortChartDescendingly.key,u.pluginMenuItemRemoveSort.key,...e.subCategory&&cn.has(e.subCategory)?[u.pluginMenuItemShowHideChartTotals.key]:[],u.pluginMenuItemCopyQuery.key,u.pluginMenuItemExportToCsv.key];u.pluginWidgetPivotTable.cell=u.pluginCellPivotTable.key,u.pluginWidgetPivotTable.cellStyle=u.pluginCellStylePivotTable.key,u.pluginWidgetTable.cell=u.pluginCellTable.key,u.pluginWidgetTable.cellStyle=u.pluginCellStyleTable.key,u.pluginWidgetTreeTable.cell=u.pluginCellTreeTable.key,u.pluginWidgetTreeTable.cellStyle=u.pluginCellStylePivotTable.key;const un=[u.pluginMenuItemFilterOnSelection.key,Zt.key,u.pluginMenuItemRemoveSort.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemHideColumns.key,u.pluginMenuItemShowHideTotals.key,u.pluginMenuItemExportToCsv.key];for(const e of[u.pluginWidgetPivotTable,u.pluginWidgetTreeTable])e.contextMenuItems=[u.pluginMenuItemSortPivotTableAscendingly.key,u.pluginMenuItemSortPivotTableDescendingly.key,...un];u.pluginWidgetTable.contextMenuItems=[u.pluginMenuItemSortTableAscendingly.key,u.pluginMenuItemSortTableDescendingly.key,...un],u.pluginWidgetKpi.contextMenuItems=[u.pluginMenuItemFilterOnSelection.key,Zt.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemShowHideTotals.key,u.pluginMenuItemExportToCsv.key];for(const e of ln)e.contextMenuItems.push(sn.key),e.titleBarButtons=[...on];const gn=async({settingRegistry:e})=>{const t="windowingMode",n="defer";await e.set("@jupyterlab/notebook-extension:tracker",t,n),console.debug(`Updated the ${t} setting to ${n} to make all widgets snapshotable.`)},hn={async activate(e,t,n,i,s,r){window.localStorage.getItem("_atotiEnableTestIds")===JSON.stringify(!0)&&(window.__UNSTABLE_DATA_TEST_IDS_ENABLED__=!0);const o=e,{docRegistry:d,shell:c}=o;console.debug(`Activating Atoti Python SDK extension ${l.version} (relying on Atoti UI ${a.atotiUIVersion})`);const g=new ve({widgetPlugins:ln}),h=(({notebookTracker:e,widgetStateTrackers:t})=>on.map((n=>({Component:an(n,{notebookTracker:e,widgetStateTrackers:t}),key:n,translations:{"en-US":{key:"undo"===n?"Undo":"Redo",nothingToUndoRedo:"Nothing to "+("undo"===n?"undo":"redo")}}}))))({notebookTracker:t,widgetStateTrackers:g}),p=(({undoRedoTitleBarButtonPlugins:e,widgetPlugins:t})=>({cell:rn([u.pluginCellPivotTable,u.pluginCellTable,u.pluginCellTreeTable]),"cell-style":rn([u.pluginCellStyleDrillthroughTable,u.pluginCellStylePivotTable,u.pluginCellStyleTable]),"menu-item":rn([u.pluginMenuItemCopyQuery,u.pluginMenuItemExportDrillthroughToCsv,u.pluginMenuItemExportToCsv,u.pluginMenuItemFilterOnSelection,Zt,sn,u.pluginMenuItemRemoveSort,u.pluginMenuItemHideColumns,u.pluginMenuItemShowHideChartTotals,u.pluginMenuItemShowHideTotals,u.pluginMenuItemSortDrillthroughTableAscendingly,u.pluginMenuItemSortDrillthroughTableDescendingly,u.pluginMenuItemSortChartAscendingly,u.pluginMenuItemSortChartDescendingly,u.pluginMenuItemSortPivotTableAscendingly,u.pluginMenuItemSortPivotTableDescendingly,u.pluginMenuItemSortTableAscendingly,u.pluginMenuItemSortTableDescendingly]),"titlebar-button":rn(e),widget:rn(t)}))({undoRedoTitleBarButtonPlugins:h,widgetPlugins:ln}),[m,y,w,v]=await Promise.all([f.create({pluginRegistry:p,settingRegistry:n}),zt(),gn({settingRegistry:n}),C.create(i)]),b=(()=>{const e=document.createElement("div");return document.body.append(e),e})(),S=new Z,k={dataModelClickListeners:{byDefault:new Set,regular:new Set},intlTracker:m,jupyterLab:o,jupyterServerProxyEnabled:y,notebookTracker:t,pluginRegistry:p,popupContainer:b,sessionClients:S,themeTracker:v,widgetStateTrackers:g},T=new Mt(k);c.add(T,"left",{rank:700}),r&&r.add(T,"atoti-sidebar"),d.addWidgetExtension("Notebook",new Ft(k)),d.addWidgetExtension("Notebook",new Vt(k)),(({commandPalette:e,intlTracker:t,jupyterLab:n,notebookTracker:i,sessionClients:s,widgetStateTrackers:r})=>{n.commands.addCommand(At,{async execute(){const{mdx:e,sessionId:t,widgetCreationCode:o}=Nt(i),a={...u.pluginWidgetPivotTable.initialState,serverKey:l.defaultServerKey},d=await Ke({code:o,notebookTracker:i,state:a}),c=s.get(t);if(!c)throw new Error("The execution of the created cell should have created the corresponding SessionClient.");const g=r.get(d.model);if(!g)throw new Error("The execution of the created cell should have created the corresponding WidgetStateTracker.");const h=await(async e=>e.dataModel?e.dataModel:new Promise((t=>{const n=e.subscribeToDataModel((()=>{const{dataModel:i}=e;i&&(n(),t(i))}))})))(c.atotiClient),{widgetStateDerivedFromMdx:p}=(0,Ot.deriveStateFromMdx)({dataModels:{[l.defaultServerKey]:h},mdx:(0,u.parse)(e),widgetPlugin:u.pluginWidgetPivotTable,widgetState:a});g.setWidgetState(p),dt({jupyterLab:n})},isVisible:()=>void 0!==Nt(i),label:()=>(0,P.createIntl)(t.config).formatMessage({id:`commands.${Ut}.caption`})}),n.contextMenu.addItem({command:At,selector:Bt}),n.contextMenu.addItem({selector:Bt,type:"separator"}),e&&e.addItem({category:"Notebook Cell Operations",command:At})})({commandPalette:s,intlTracker:m,jupyterLab:o,notebookTracker:t,sessionClients:S,widgetStateTrackers:g})},autoStart:!0,id:"atoti",optional:[s.ICommandPalette,i.ILayoutRestorer],requires:[r.INotebookTracker,o.ISettingRegistry,s.IThemeManager]},pn=hn},20625:(e,t,n)=>{var i={"./en-US.js":[12024,2024]};function s(e){if(!n.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],s=t[0];return n.e(t[1]).then((()=>n(s)))}s.keys=()=>Object.keys(i),s.id=20625,e.exports=s},74389:(e,t,n)=>{"use strict";n.d(t,{FD:()=>a,FK:()=>r,Y:()=>o});var i=n(65723),s=n(42369),r=(n(93345),n(77619),n(4674),n(21880),n(48785),i.Fragment);function o(e,t,n){return s.h.call(t,"css")?i.jsx(s.E,(0,s.c)(e,t),n):i.jsx(e,t,n)}function a(e,t,n){return s.h.call(t,"css")?i.jsxs(s.E,(0,s.c)(e,t),n):i.jsxs(e,t,n)}},58997:(e,t,n)=>{"use strict";var i=n(7628);t.H=i.createRoot,i.hydrateRoot},62921:(e,t,n)=>{"use strict";var i=n(93345),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,n){var i,r={},d=null,c=null;for(i in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:s,type:e,key:d,ref:c,props:r,_owner:a.current}}t.Fragment=r,t.jsx=d,t.jsxs=d},65723:(e,t,n)=>{"use strict";e.exports=n(62921)}}]);