"use strict";(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[866],{75499:(e,t,o)=>{o.d(t,{Kl:()=>D});var n=o(74389),r=o(31529),l=o(93345),a=o(31875),i=o(76686),s=o(45064),u=o(63177),c=o(14291),d=o(99871),p=o(834),h=o(74667),m=o(95889);const f=({subplotsMetaData:e,horizontalLimit:t,verticalLimit:o,style:r})=>{const{formatMessage:l}=(0,m.useIntl)(),a=e.horizontal.keys.length,i=e.vertical.keys.length,s=a>t,u=s&&i>o?l({id:"aui.dataVisualization.subplots.tooManyHorizontalAndVerticalSubplots"},{horizontalSubplotLimit:t,verticalSubplotLimit:o,horizontalSubplotTotal:a,verticalSubplotTotal:i,horizontalSubplotLevelName:e.horizontal.levelName,verticalSubplotLevelName:e.vertical.levelName}):l({id:"aui.dataVisualization.subplots.tooManySubplots"},{limit:s?t:o,total:s?a:i,areTooManyHorizontalSubplots:s,subplotLevelName:s?e.horizontal.levelName:e.vertical.levelName});return(0,n.Y)(h.Alert,{message:`${u} ${l({id:"aui.dataVisualization.subplots.editQuery"})}`,showIcon:!0,banner:!0,style:{...r,zIndex:1},type:"warning"})};var g=o(842),y=o(72259),b=o(91230),v=o(61386),C=o(67034),I=o(32867),x=o(88384);const S={left:"unset",right:0,transform:"translateY(-50%) translateX(100%) rotate(90deg)"},w={right:"unset",left:0,transform:"translateY(-50%) translateX(-100%) rotate(-90deg)"};var z=o(3551),T=o(99988);const k=36,M=(0,l.lazy)((()=>Promise.all([o.e(3280),o.e(8410),o.e(2843)]).then(o.bind(o,98410)))),L=e=>(0,n.Y)(l.Suspense,{fallback:(0,n.Y)("div",{children:"Loading..."}),children:(0,n.Y)(M,{...e})});function D(e){const t=(0,l.useMemo)((()=>e.onSelectionChange||(()=>{})),[e.onSelectionChange]),o=(0,l.useRef)(null),[h,M]=(0,l.useState)(null),D=(0,p.useIsContextMenuOpen)(),Y=e.widgetState?.plotly?.layout,N=e.widgetState?.plotly?.config,P=e.widgetState?.plotly?.data,E=(0,l.useMemo)((()=>function(e,t={}){const{additionalTraces:o,commonTraceOverride:n,overridesByTraceIndex:l,overridesByTraceKey:a}=t;return[...e.map(((e,t)=>(0,r.defaultsDeep)({},a?.[e._key],l?.[t],n,e))),...o?(0,r.cloneDeep)(o):[]]}(e.traces,P)),[e.traces,P]),O=function(e){const{backgroundColor:t,textColor:o,black:n}=e;return(0,l.useMemo)((()=>function({backgroundColor:e,textColor:t,black:o}){return{bgColor:e,fontColor:t,hoverBgColor:o,hoverFontColor:e,zeroLineColor:(0,i.j)(t,.5),lineColor:(0,i.j)(t,.25),gridColor:(0,i.j)(t,.25)}}({backgroundColor:t,textColor:o,black:n})),[t,o,n])}((0,s.DP)()),B=(0,l.useMemo)((()=>function({config:e,configOverrides:t}){return(0,r.defaultsDeep)((0,r.cloneDeep)(t),e,{displaylogo:!1,modeBarButtonsToRemove:["resetScale2d","toggleSpikelines","hoverClosestCartesian","hoverCompareCartesian","toggleHover"]})}({configOverrides:N,config:e.config})),[N,e.config]),[_,R]=(0,l.useState)([]),[F,V]=(0,l.useState)({}),[j,q]=(0,l.useState)([]),H=(0,l.useRef)(null);(0,l.useEffect)((()=>{try{const o=(0,T.d)({selectedPointsByTrace:_,traces:E,data:e.data});t(o)}catch(e){e instanceof T.I&&R([])}}),[_,E,e.data,t]);const K=e.metaData.subplots.horizontal.limit,Q=e.metaData.subplots.vertical.limit,$=e.metaData.subplots.horizontal.keys.length>K||e.metaData.subplots.vertical.keys.length>Q,X=(0,l.useMemo)((()=>$?{height:e.size.height-k,width:e.size.width}:e.size),[$,e.size]),A=(0,l.useMemo)((()=>function({chartThemeValues:e,layoutOverrides:t,layout:o,hiddenLabels:n,size:l}){return(0,r.defaultsDeep)((0,r.cloneDeep)(t),o,{colorway:z.Y,plot_bgcolor:e.bgColor,paper_bgcolor:e.bgColor,font:{color:e.fontColor},hoverlabel:{bgcolor:e.hoverBgColor,bordercolor:e.hoverBgColor,font:{color:e.hoverFontColor}},hovermode:"closest",margin:{t:30,r:0,b:40},xaxis:{automargin:!0,zerolinecolor:e.zeroLineColor,linecolor:e.lineColor,gridcolor:e.gridColor,range:[]},yaxis:{automargin:!0,zerolinecolor:e.zeroLineColor,linecolor:e.lineColor,gridcolor:e.gridColor,range:[]},hiddenlabels:n,...l})}({chartThemeValues:O,layoutOverrides:Y,layout:e.layout,hiddenLabels:j,size:X})),[O,Y,e.layout,j,X]),[U,W,G]=(0,d.useMousePosition)(),J=(0,l.useMemo)((()=>E.map(((e,t)=>({...(0,r.omit)(e,"cellsIndices"),selectedpoints:_[t],...F[e._key]})))),[E,_,F]),Z=function({cube:e,data:t,hierarchyIndicesInCellSet:o,hoveredPoint:n,traces:r,style:a}){const{formatMessage:i}=(0,m.useIntl)(),s=i({id:"aui.total"});return(0,l.useMemo)((()=>{if(null===n)return[];const l=r[n.traceIndex].cellsIndices[n.pointIndex];if(!l)return[];const i=[];return l.forEach((e=>{const{columnIndex:n,rowIndex:r,cellIndex:l}=e,s=(0,v.getTuple)({columnIndex:n,data:t,hierarchyIndicesInCellSet:o,rowIndex:r});if(s){const e=t.cells[l],o=s.find(C.t),n=o?a?.measures?.[o.namePath[0]]:void 0;i.push({tuple:s,formattedValue:(0,I.m)({valueFormattedByAtotiServer:e.formattedValue,numericFieldStyle:n,value:Number(e.value)})})}})),(0,x.F)({cube:e,tuplesAndFormattedValues:i,captionForTotals:s})}),[e,t,r,o,n,a,s])}({cube:e.cube,data:e.data,hierarchyIndicesInCellSet:e.metaData.hierarchyIndicesInCellSet,hoveredPoint:h,traces:e.traces,style:e.widgetState.style}),{placement:ee,style:te,arrowStyle:oe}=function({hoveredPoint:e,container:t,tooltipContent:o}){const[n,r,a]=(0,l.useMemo)((()=>{if(null===e||null===t)return[null,null,null];const o=t.getBoundingClientRect();return[e.offsetY,e.offsetX+18,o.width-e.offsetX+18]}),[e,t]);return(0,l.useMemo)((()=>{if(null===n||null===r||null===a||null===t)return{placement:"left",style:{opacity:0},arrowStyle:S};const e=22*o.length+12;return r>a?{placement:"left",style:{top:n-e/2+"px !important",right:`${a}px !important`,left:"unset !important",paddingLeft:"unset"},arrowStyle:S}:{placement:"right",style:{top:n-e/2+"px !important",right:"unset !important",left:`${r}px !important`,paddingRight:"unset"},arrowStyle:w}}),[n,r,a,t,o])}({hoveredPoint:h,container:H.current,tooltipContent:Z}),ne=$?(0,n.Y)(f,{style:{height:k},subplotsMetaData:e.metaData.subplots,horizontalLimit:K,verticalLimit:Q}):null;return(0,n.Y)(l.Fragment,{children:(0,n.FD)("div",{className:"atoti-ui-plot","data-number-of-cells":e.data.cells.length,css:{height:"100%",position:"relative",width:"100%",":focus":{outline:"none"},".ant-tooltip":{maxWidth:"unset",...te},".ant-tooltip-arrow":oe},tabIndex:0,onMouseDown:()=>{H.current&&H.current.focus()},onKeyUp:e=>{"Escape"===e.key&&R([])},ref:H,children:[ne,(0,n.Y)(d.Tooltip,{open:!D&&Z.length>0,title:(0,n.Y)(a.U,{content:Z}),placement:ee,getPopupContainer:()=>H.current||document.body,overlayStyle:{maxWidth:350},children:(0,n.Y)("div",{css:{position:"absolute",top:$?k:0,bottom:0,left:0,right:0,".js-plotly-plot":{height:"100%"},".plot-container-plotly":{height:"100%"},"@media print":{".modebar-container":{display:"none"}}},onContextMenu:t=>{e.onContextMenu?.(t),t.preventDefault()},children:(0,n.Y)(L,{config:B,data:J,layout:A,onInitialized:function(t,o){e.onInitialized&&e.onInitialized(t,o),e.onLoaded&&(0,c.R)(e.onLoaded)},onClick:function(t){if(t&&t.event){const{event:o}=t,n=t.points[0];switch(o.button){case 0:e.onClick?e.onClick(o,n):function(e,t){const o=e[u.P?"metaKey":"ctrlKey"],n=(0,b.h)(_,t,{type:"click",numberOfTraces:E.length,isCtrlPressed:o});R(n)}(o,n);break;case 2:!function(e,t){const o=(0,b.h)(_,t,{type:"contextmenu",numberOfTraces:E.length});o!==_&&R(o),e.wasHandled=!0}(o,n)}}},onSelected:function(e){if(e){const t=e.points.reduce(((e,{curveNumber:t,pointIndex:o})=>(e[t].push(o),e)),(0,g.L)(E.length));R(t)}},onHover:e=>{W(),o.current=setTimeout((()=>{if(G(),e&&H.current){const t=H.current.getBoundingClientRect(),o=e.points[0],{curveNumber:n}=o,r=(0,y.q)(o);M({traceIndex:n,pointIndex:r,offsetX:U.current?.x-t.left,offsetY:U.current?.y-t.top})}}),300)},onUnhover:function(){G(),M(null),o.current&&(clearTimeout(o.current),o.current=null)},onUpdate:function(e){e.data.some((e=>e.visible!==F[e._key]?.visible))&&V(e.data.reduce(((e,t)=>({...e,[t._key]:{visible:t.visible}})),{})),e.layout.hiddenlabels&&!(0,r.isEqual)(e.layout.hiddenlabels,j)&&q(e.layout.hiddenlabels)}})})})]})})}},842:(e,t,o)=>{o.d(t,{L:()=>r});var n=o(31529);function r(e){return(0,n.range)(e).map((()=>[]))}},72259:(e,t,o)=>{function n(e){const{pointIndex:t,pointNumber:o}=e;return void 0!==t?t:o}o.d(t,{q:()=>n})},91230:(e,t,o)=>{o.d(t,{h:()=>i});var n=o(31529),r=o(842),l=o(72259);function a({numberOfTraces:e,curveNumber:t,indexInTrace:o}){const n=(0,r.L)(e);return n[t]=[o],n}function i(e,t,{type:o,isCtrlPressed:r,numberOfTraces:i}){const{curveNumber:s}=t,u=(0,l.q)(t);if(0===e.length)return a({numberOfTraces:i,curveNumber:s,indexInTrace:u});const c=(e[s]??[]).includes(u);if("contextmenu"===o)return c?e:a({numberOfTraces:i,curveNumber:s,indexInTrace:u});if(r){const t=(0,n.cloneDeep)(e);return c?t[s].splice(t[s].indexOf(u),1):t[s].push(u),t}return c&&1===(0,n.sumBy)(e,(e=>e.length))?[]:a({numberOfTraces:i,curveNumber:s,indexInTrace:u})}},99988:(e,t,o)=>{o.d(t,{I:()=>r,d:()=>l});var n=o(61386);class r extends Error{}const l=({selectedPointsByTrace:e,traces:t,data:o})=>{const l=(0,n.getHierarchyIndicesInCellSet)(o),a=[];return e.forEach(((e,i)=>{t[i]&&a.push(...(({selectedPoints:e,cellsIndices:t,data:o,hierarchyIndicesInCellSet:l})=>{const a=[];return e.forEach((e=>{(t[e]||[]).forEach((i=>{if(!i)throw new r(`The point at index ${e} is marked as selected but it exceeds the number of points on the chart: ${t.length}`);{const{columnIndex:e,rowIndex:t,cellIndex:r}=i,s=(0,n.getTuple)({columnIndex:e,rowIndex:t,data:o,hierarchyIndicesInCellSet:l});if(s){const e=o.cells[r];a.push({tuple:s,value:e.value})}}}))})),a})({selectedPoints:e,cellsIndices:t[i].cellsIndices,data:o,hierarchyIndicesInCellSet:l}))})),{cells:a}}},32376:(e,t,o)=>{o.d(t,{c:()=>h});var n=o(74389),r=o(40570),l=o(93345),a=o(61386),i=o(12343),s=o(99871),u=o(834),c=o(67373),d=o(39081),p=o(50794);function h(e){return t=>{const{cube:o}=(0,c.useCube)(t.widgetState),{widgetState:h,queryResult:m,onLoaded:f,onChange:g}=t,y=t.queryResult.data,b=(0,l.useMemo)((()=>Boolean(y&&0===y.cells.length)),[y]),v=(0,l.useMemo)((()=>(0,u.isMappingEmpty)(h?.mapping)),[h?.mapping]),C=(0,l.useRef)(null),I=(0,s.useDebouncedComponentSize)(C),x=(0,i.useWidgetPlugin)(h.widgetKey),{attributes:S}=x,w=(0,l.useMemo)((()=>{const e=S?(0,u.getSafeMapping)(h.mapping,S):h.mapping;return{...h,mapping:e}}),[h,S]),z=(0,p.r)(w,m,o);if(m.error){if((0,a.isErrorInQueryResultOfType)(m.error,"QueryTimeoutException"))throw new a.QueryTimeoutError(m.error);throw new a.QueryError(m.error)}return function({isEmpty:e,onLoaded:t}){(0,l.useEffect)((()=>{e&&void 0!==t&&t()}),[])}({isEmpty:v||b,onLoaded:f}),(0,n.Y)("div",{ref:C,css:r.css`
          height: 100%;
        `,children:o&&y&&z&&!v&&!b?(0,n.Y)(e,{...t,widgetState:w,cube:o,data:y,metaData:z,size:I}):(0,n.Y)(d.u,{...b?{reason:"noData",widgetState:w,onStateChange:g}:{reason:"noQuery"}})})}}}}]);