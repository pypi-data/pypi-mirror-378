<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>readme</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="README_files/libs/clipboard/clipboard.min.js"></script>
<script src="README_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="README_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="README_files/libs/quarto-html/popper.min.js"></script>
<script src="README_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="README_files/libs/quarto-html/anchor.min.js"></script>
<link href="README_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="README_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="README_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="README_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="README_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="cendat-a-python-helper-for-the-census-api" class="level1">
<h1>cendat: A Python Helper for the Census API</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p><code>cendat</code> is a Python library designed to simplify the process of exploring and retrieving data from the U.S. Census Bureau’s API. It provides a high-level, intuitive workflow for discovering available datasets, filtering geographies and variables, and fetching data concurrently.</p>
<p>The library handles the complexities of the Census API’s structure, such as geographic hierarchies and inconsistent product naming, allowing you to focus on getting the data you need.</p>
<p>You can find regular <code>cendat</code> updates and musings on the <a href="https://mostlyunoriginal.github.io/posts.html#category=cendat">developer blog</a>.</p>
</section>
<section id="workflow" class="level2">
<h2 class="anchored" data-anchor-id="workflow">Workflow</h2>
<p>The library is designed around a simple, four-step “List -&gt; Set -&gt; Get -&gt; Convert/Analyze” workflow:</p>
<ol type="1">
<li><strong>List</strong>: Use the <code>list_*</code> methods (<code>list_products</code>, <code>list_geos</code>, <code>list_groups</code>, <code>list_variables</code>) with patterns to explore what’s available and filter down to what you need.</li>
<li><strong>Set</strong>: Use the <code>set_*</code> methods (<code>set_products</code>, <code>set_geos</code>, <code>set_groups</code>, <code>set_variables</code>) to lock in your selections. You can call these methods without arguments to use the results from your last “List” call. The <code>describe_groups</code> method is especially helpful for variable selection in programs with many variables, like the ACS.</li>
<li><strong>Get</strong>: Call the <code>get_data()</code> method to build and execute all the necessary API calls. This method handles complex geographic requirements automatically and utilizes thread pooling for speed.</li>
<li><strong>Convert &amp; Analyze</strong>: Use the <code>to_polars()</code> or <code>to_pandas()</code> methods on the response object to get your data in a ready-to-use DataFrame format. The response object also includes a powerful <code>tabulate()</code> method for quick, Stata-like frequency tables.</li>
</ol>
<hr>
</section>
</section>
<section id="installation" class="level1">
<h1>Installation</h1>
<p>You can install <code>cendat</code> using pip.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install cendat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The library has optional dependencies for converting the response data into pandas or polars DataFrames. You can install the support you need:</p>
<section id="install-with-pandas-support" class="level3">
<h3 class="anchored" data-anchor-id="install-with-pandas-support">Install with pandas support</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install cendat<span class="pp">[</span><span class="ss">pandas</span><span class="pp">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="install-with-geopandas-support" class="level3">
<h3 class="anchored" data-anchor-id="install-with-geopandas-support">Install with geopandas support</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install cendat<span class="pp">[</span><span class="ss">geopandas</span><span class="pp">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="install-with-polars-support" class="level3">
<h3 class="anchored" data-anchor-id="install-with-polars-support">Install with polars support</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install cendat<span class="pp">[</span><span class="ss">polars</span><span class="pp">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="install-with-all-three" class="level3">
<h3 class="anchored" data-anchor-id="install-with-all-three">Install with all three</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install cendat<span class="pp">[</span><span class="ss">all</span><span class="pp">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<hr>
</section>
</section>
<section id="api-reference" class="level1">
<h1>API Reference</h1>
<section id="cendathelper-class" class="level2">
<h2 class="anchored" data-anchor-id="cendathelper-class"><code>CenDatHelper</code> Class</h2>
<p>This is the main class for building and executing queries.</p>
<section id="init__self-yearsnone-keynone" class="level3">
<h3 class="anchored" data-anchor-id="init__self-yearsnone-keynone"><code>__init__(self, years=None, key=None)</code></h3>
<p>Initializes the helper object.</p>
<ul>
<li><strong><code>years</code></strong> (<code>int</code> | <code>list[int]</code>, optional): The year or years of interest. Can be a single integer or a list of integers. Defaults to <code>None</code>.</li>
<li><strong><code>key</code></strong> (<code>str</code>, optional): Your Census API key. Providing a key is recommended to avoid strict rate limits. Defaults to <code>None</code>.</li>
</ul>
</section>
<section id="set_yearsself-years" class="level3">
<h3 class="anchored" data-anchor-id="set_yearsself-years"><code>set_years(self, years)</code></h3>
<p>Sets the primary year or years for data queries.</p>
<ul>
<li><strong><code>years</code></strong> (<code>int</code> | <code>list[int]</code>): The year or years to set.</li>
</ul>
</section>
<section id="load_keyself-keynone" class="level3">
<h3 class="anchored" data-anchor-id="load_keyself-keynone"><code>load_key(self, key=None)</code></h3>
<p>Loads a Census API key for authenticated requests.</p>
<ul>
<li><strong><code>key</code></strong> (<code>str</code>, optional): The API key to load.</li>
</ul>
</section>
<section id="list_productsself-yearsnone-patternsnone-to_dictstrue-logicall-match_intitle" class="level3">
<h3 class="anchored" data-anchor-id="list_productsself-yearsnone-patternsnone-to_dictstrue-logicall-match_intitle"><code>list_products(self, years=None, patterns=None, to_dicts=True, logic=all, match_in='title')</code></h3>
<p>Lists available data products, filtered by year and search patterns.</p>
<ul>
<li><strong><code>years</code></strong> (<code>int</code> | <code>list[int]</code>, optional): Filters products available for the specified year(s). Defaults to the years set on the object.</li>
<li><strong><code>patterns</code></strong> (<code>str</code> | <code>list[str]</code>, optional): Regex pattern(s) to search for within the product metadata.</li>
<li><strong><code>to_dicts</code></strong> (<code>bool</code>): If <code>True</code> (default), returns a list of dictionaries with full product details. If <code>False</code>, returns a list of product titles.</li>
<li><strong><code>logic</code></strong> (<code>callable</code>): The logic to use when multiple patterns are provided. Can be <code>all</code> (default) or <code>any</code>.</li>
<li><strong><code>match_in</code></strong> (<code>str</code>): The field to match patterns against. Can be <code>'title'</code> (default) or <code>'desc'</code>.</li>
</ul>
</section>
<section id="set_productsself-titlesnone" class="level3">
<h3 class="anchored" data-anchor-id="set_productsself-titlesnone"><code>set_products(self, titles=None)</code></h3>
<p>Sets the active data products for the session and unsets any previously set variables, geos, and groups.</p>
<ul>
<li><strong><code>titles</code></strong> (<code>str</code> | <code>list[str]</code>, optional): The title or list of titles of the products to set. If <code>None</code>, it sets all products from the last <code>list_products()</code> call.</li>
</ul>
</section>
<section id="list_geosself-to_dictsfalse-patternsnone-logicall" class="level3">
<h3 class="anchored" data-anchor-id="list_geosself-to_dictsfalse-patternsnone-logicall"><code>list_geos(self, to_dicts=False, patterns=None, logic=all)</code></h3>
<p>Lists available geographies for the currently set products.</p>
<ul>
<li><strong><code>to_dicts</code></strong> (<code>bool</code>): If <code>True</code>, returns a list of dictionaries with full geography details. If <code>False</code> (default), returns a list of unique summary level (<code>sumlev</code>) strings.</li>
<li><strong><code>patterns</code></strong> (<code>str</code> | <code>list[str]</code>, optional): Regex pattern(s) to search for within the geography description.</li>
<li><strong><code>logic</code></strong> (<code>callable</code>): The logic to use when multiple patterns are provided. Can be <code>all</code> (default) or <code>any</code>.</li>
</ul>
</section>
<section id="set_geosself-valuesnone-bysumlev" class="level3">
<h3 class="anchored" data-anchor-id="set_geosself-valuesnone-bysumlev"><code>set_geos(self, values=None, by='sumlev')</code></h3>
<p>Sets the active geographies for the session.</p>
<ul>
<li><strong><code>values</code></strong> (<code>str</code> | <code>list[str]</code>, optional): The geography values to set. If <code>None</code>, sets all geos from the last <code>list_geos()</code> call.</li>
<li><strong><code>by</code></strong> (<code>str</code>): The key to use for matching <code>values</code>. Must be either <code>'sumlev'</code> (default) or <code>'desc'</code>.</li>
</ul>
</section>
<section id="list_groupsself-to_dictstrue-patternsnone-logicall-match_indescription" class="level3">
<h3 class="anchored" data-anchor-id="list_groupsself-to_dictstrue-patternsnone-logicall-match_indescription"><code>list_groups(self, to_dicts=True, patterns=None, logic=all, match_in='description')</code></h3>
<p>Lists available variable groups for the currently set products. Not all products have groups, in which case the resulting list will be empty.</p>
<ul>
<li><strong><code>to_dicts</code></strong> (<code>bool</code>): If <code>True</code> (default), returns a list of dictionaries with full group details. If <code>False</code>, returns a list of unique group names.</li>
<li><strong><code>patterns</code></strong> (<code>str</code> | <code>list[str]</code>, optional): Regex pattern(s) to search for within the group metadata.</li>
<li><strong><code>logic</code></strong> (<code>callable</code>): The logic to use when multiple patterns are provided. Can be <code>all</code> (default) or <code>any</code>.</li>
<li><strong><code>match_in</code></strong> (<code>str</code>): The field to match patterns against. Can be <code>'description'</code> (default) or <code>'name'</code>.</li>
</ul>
</section>
<section id="set_groupsself-namesnone" class="level3">
<h3 class="anchored" data-anchor-id="set_groupsself-namesnone"><code>set_groups(self, names=None)</code></h3>
<p>Sets the active variable groups for the session. If the call to <code>set_groups</code> results in a single group for each product vintage and all group variables are wanted, <code>set_variables</code> may be skipped.</p>
<ul>
<li><strong><code>names</code></strong> (<code>str</code> | <code>list[str]</code>, optional): The name or list of names of the groups to set. If <code>None</code>, sets all groups from the last <code>list_groups()</code> call.</li>
</ul>
</section>
<section id="describe_groupsself-groupsnone" class="level3">
<h3 class="anchored" data-anchor-id="describe_groupsself-groupsnone"><code>describe_groups(self, groups=None)</code></h3>
<p>Print hierarchically-nested group descriptions to facilitate variable selection.</p>
<ul>
<li><strong><code>groups</code></strong> (<code>str</code> | <code>list[str]</code>, optional): The name or list of names of the groups to describe. If <code>None</code>, describes all set groups or reports an error with instructions to set groups or use the <code>groups</code> parameter.</li>
</ul>
</section>
<section id="list_variablesself-to_dictstrue-patternsnone-logicall-match_inlabel-groupsnone" class="level3">
<h3 class="anchored" data-anchor-id="list_variablesself-to_dictstrue-patternsnone-logicall-match_inlabel-groupsnone"><code>list_variables(self, to_dicts=True, patterns=None, logic=all, match_in='label', groups=None)</code></h3>
<p>Lists available variables for the currently set products.</p>
<ul>
<li><strong><code>to_dicts</code></strong> (<code>bool</code>): If <code>True</code> (default), returns a list of dictionaries with full variable details. If <code>False</code>, returns a list of unique variable names.</li>
<li><strong><code>patterns</code></strong> (<code>str</code> | <code>list[str]</code>, optional): Regex pattern(s) to search for within the variable metadata.</li>
<li><strong><code>logic</code></strong> (<code>callable</code>): The logic to use when multiple patterns are provided. Can be <code>all</code> (default) or <code>any</code>.</li>
<li><strong><code>match_in</code></strong> (<code>str</code>): The field to match patterns against. Can be <code>'label'</code> (default), <code>'name'</code> or <code>'concept'</code>.</li>
<li><strong><code>groups</code></strong> (<code>str</code> | <code>list[str]</code>, optional): Variable groups within which the listing will be limited. Groups provided here override whatever groups may be set, and set groups will be used if this is <code>None</code>.</li>
</ul>
</section>
<section id="set_variablesself-namesnone" class="level3">
<h3 class="anchored" data-anchor-id="set_variablesself-namesnone"><code>set_variables(self, names=None)</code></h3>
<p>Sets the active variables for the session. If exactly one group is set for each product vintage and all group variables are wanted, <code>set_variables</code> may be skipped. Doing so allows for more than the standard API max of 50 variables.</p>
<ul>
<li><strong><code>names</code></strong> (<code>str</code> | <code>list[str]</code>, optional): The name or list of names of the variables to set. If <code>None</code>, sets all variables from the last <code>list_variables()</code> call.</li>
</ul>
</section>
<section id="get_dataself-withinus-max_workers100-timeout30-preview_onlyfalse-include_namesfalse-include_geoidsfalse-include_attributesfalse" class="level3">
<h3 class="anchored" data-anchor-id="get_dataself-withinus-max_workers100-timeout30-preview_onlyfalse-include_namesfalse-include_geoidsfalse-include_attributesfalse"><code>get_data(self, within='us', max_workers=100, timeout=30, preview_only=False, include_names=False, include_geoids=False, include_attributes=False)</code></h3>
<p>Executes the API calls based on the set parameters and retrieves the data.</p>
<ul>
<li><strong><code>within</code></strong> (<code>str</code> | <code>dict</code> | <code>list[dict]</code>, optional): Defines the geographic scope of the query.
<ul>
<li>For <strong>aggregate</strong> data, this can be a dictionary filtering parent geographies (e.g., <code>{'state': '06'}</code> for California). A list of dictionaries can be provided to query multiple scopes.</li>
<li>For <strong>microdata</strong>, this must be a dictionary specifying the target geography and its codes (e.g., <code>{'public use microdata area': ['7701', '7702']}</code>).</li>
<li>Defaults to <code>'us'</code> for nationwide data where applicable.</li>
</ul></li>
<li><strong><code>max_workers</code></strong> (<code>int</code>, optional): The maximum number of concurrent threads to use for making API calls. For requests generating thousands of calls, it’s wise to keep this value lower (e.g., <code>&lt; 100</code>) to avoid server-side connection issues. Defaults to <code>100</code>.</li>
<li><strong><code>timeout</code></strong> (<code>int</code>, optional): Request timeout in seconds for each API call. Defaults to <code>30</code>.</li>
<li><strong><code>preview_only</code></strong> (<code>bool</code>): If <code>True</code>, builds the list of API calls but does not execute them. Useful for debugging. Defaults to <code>False</code>.</li>
<li><strong><code>include_names</code></strong> (<code>bool</code>): If <code>True</code>, includes geography name (<code>NAME</code>) in API request–this variable is a special keyword understood by the data endpoint but is not included in <code>variables.json</code> and is therefore not discoverable through <code>list_variables()</code>. Note that NAME requests for microdata products will be ignored (with a message). Defaults to <code>False</code>.</li>
<li><strong><code>include_geoids</code></strong> (<code>bool</code>): If <code>True</code>, includes geography ID (<code>GEO_ID</code>) in API request–this variable is a special keyword understood by the data endpoint but is not included in <code>variables.json</code> and is therefore not discoverable through <code>list_variables()</code>. Note that GEO_ID requests for microdata products will be ignored (with a message). Defaults to <code>False</code>.</li>
<li><strong><code>include_attributes</code></strong> (<code>bool</code>): If <code>True</code>, includes attributes associated with set variables (e.g., margins of error) in API request if available. Defaults to <code>False</code>.</li>
<li><strong><code>include_geometry</code></strong> (<code>bool</code>): If <code>True</code>, concurrent queries are issued to the TIGERweb REST Services for eligible products and geographies. Defaults to <code>False</code>. Note that only aggregate data products and certain geographies (currently <code>region: 020</code>, <code>division: 030</code>, <code>state: 040</code>, <code>county: 050</code>, <code>county subdivision: 060</code>, <code>census tract: 140</code>, <code>census block group: 150</code>, and <code>place: 160</code>) are supported.</li>
<li><strong><code>in_place</code></strong> (<code>bool</code>): If <code>True</code>, data and geometries are not purged from the instantiated helper object’s <code>params</code> and the method returns <code>None</code>. Defaults to <code>False</code>.</li>
</ul>
<hr>
</section>
</section>
<section id="cendatresponse-class" class="level2">
<h2 class="anchored" data-anchor-id="cendatresponse-class"><code>CenDatResponse</code> Class</h2>
<p>A container for the data returned by <code>CenDatHelper.get_data()</code>.</p>
<section id="to_polarsself-schema_overridesnone-concatfalse-destringfalse" class="level3">
<h3 class="anchored" data-anchor-id="to_polarsself-schema_overridesnone-concatfalse-destringfalse"><code>to_polars(self, schema_overrides=None, concat=False, destring=False)</code></h3>
<p>Converts the raw response data into a list of Polars DataFrames.</p>
<ul>
<li><strong><code>schema_overrides</code></strong> (<code>dict</code>, optional): A dictionary mapping column names to Polars data types to override the inferred schema. Example: <code>{'POP': pl.Int64}</code>.</li>
<li><strong><code>concat</code></strong> (<code>bool</code>): If <code>True</code>, concatenates all resulting DataFrames into a single DataFrame. Defaults to <code>False</code>.</li>
<li><strong><code>destring</code></strong> (<code>bool</code>): If <code>True</code>, attempts to convert string representations of numbers into native numeric types. Defaults to <code>False</code>.</li>
</ul>
</section>
<section id="to_pandasself-dtypesnone-concatfalse-destringfalse" class="level3">
<h3 class="anchored" data-anchor-id="to_pandasself-dtypesnone-concatfalse-destringfalse"><code>to_pandas(self, dtypes=None, concat=False, destring=False)</code></h3>
<p>Converts the raw response data into a list of Pandas DataFrames.</p>
<ul>
<li><strong><code>dtypes</code></strong> (<code>dict</code>, optional): A dictionary mapping column names to Pandas data types, which is passed to the <code>.astype()</code> method. Example: <code>{'POP': 'int64'}</code>.</li>
<li><strong><code>concat</code></strong> (<code>bool</code>): If <code>True</code>, concatenates all resulting DataFrames into a single DataFrame. Defaults to <code>False</code>.</li>
<li><strong><code>destring</code></strong> (<code>bool</code>): If <code>True</code>, attempts to convert string representations of numbers into native numeric types. Defaults to <code>False</code>.</li>
</ul>
</section>
<section id="to_gpdself-dtypesnone-destringfalse-join_strategyleft" class="level3">
<h3 class="anchored" data-anchor-id="to_gpdself-dtypesnone-destringfalse-join_strategyleft"><code>to_gpd(self, dtypes=None, destring=False, join_strategy='left')</code></h3>
<p>Converts the raw response data into a single Pandas GeoDataFrame with geometries included.</p>
<ul>
<li><strong><code>dtypes</code></strong> (<code>dict</code>, optional): A dictionary mapping column names to Pandas data types, which is passed to the <code>.astype()</code> method. Example: <code>{'POP': 'int64'}</code>.</li>
<li><strong><code>destring</code></strong> (<code>bool</code>): If <code>True</code>, attempts to convert string representations of numbers into native numeric types. Defaults to <code>False</code>.</li>
<li><strong><code>join_strategy</code></strong> (<code>str</code>): Determines how geometries are joined onto data. Can be <code>'left'</code> (default) or <code>'outer'</code>. Note that <code>'left'</code> may result in data rows with no geometries. This can happen for data products with no directly matching TIGERweb map server, and generally should not be the case for ACS or Decennial (&gt; 2010) products.</li>
</ul>
</section>
<section id="tabulateself-variables-strat_bynone-weight_varnone-weight_divnone-wherenone-logicall-digits1" class="level3">
<h3 class="anchored" data-anchor-id="tabulateself-variables-strat_bynone-weight_varnone-weight_divnone-wherenone-logicall-digits1"><code>tabulate(self, *variables, strat_by=None, weight_var=None, weight_div=None, where=None, logic=all, digits=1)</code></h3>
<p>Generates and prints a frequency table.</p>
<ul>
<li><strong><code>*variables</code></strong> (<code>str</code>): One or more column names to include in the tabulation.</li>
<li><strong><code>strat_by</code></strong> (<code>str</code>, optional): A column name to stratify the results by. Percentages and cumulative stats will be calculated within each stratum. Defaults to <code>None</code>.</li>
<li><strong><code>weight_var</code></strong> (<code>str</code>, optional): The name of the column to use for weighting. If <code>None</code>, each row has a weight of 1. Defaults to <code>None</code>.</li>
<li><strong><code>weight_div</code></strong> (<code>int</code>, optional): A positive integer to divide the weight by, useful for pooled tabulations across multiple product vintages. <code>weight_var</code> must be provided if this is used. Defaults to <code>None</code>.</li>
<li><strong><code>where</code></strong> (<code>str</code> | <code>list[str]</code>, optional): A string or list of strings representing conditions to filter the data before tabulation. Each condition should be in a format like <code>"variable operator value"</code> (e.g., <code>"AGE &gt; 30"</code>) or <code>"variable1 / variable2 operator value"</code> (e.g., <code>"B17001_002E / B17001_001E &lt; 0.01"</code>). Defaults to <code>None</code>.</li>
<li><strong><code>logic</code></strong> (<code>callable</code>): The function to apply when multiple <code>where</code> conditions are provided. Use <code>all</code> for AND logic (default) or <code>any</code> for OR logic.</li>
<li><strong><code>digits</code></strong> (<code>int</code>): The number of decimal places to display for floating-point numbers in the output table. Defaults to <code>1</code>.</li>
</ul>
<hr>
</section>
</section>
</section>
<section id="usage-examples" class="level1">
<h1>Usage Examples</h1>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> cendat <span class="im">import</span> CenDatHelper</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>load_dotenv()</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --- ACS PUMS ANALYSIS ---</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Initialize and set up the query</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>cdh <span class="op">=</span> CenDatHelper(years<span class="op">=</span>[<span class="dv">2022</span>], key<span class="op">=</span>os.getenv(<span class="st">"CENSUS_API_KEY"</span>))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>cdh.list_products(patterns<span class="op">=</span><span class="vs">r"acs/acs1/pums</span><span class="dv">\b</span><span class="vs">"</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>cdh.set_products()</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>cdh.set_geos(values<span class="op">=</span><span class="st">"state"</span>, by<span class="op">=</span><span class="st">"desc"</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>cdh.set_variables(names<span class="op">=</span>[<span class="st">"SEX"</span>, <span class="st">"AGEP"</span>, <span class="st">"ST"</span>, <span class="st">"PWGTP"</span>])</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Get data for two states</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> cdh.get_data(</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    within<span class="op">=</span>{<span class="st">"state"</span>: [<span class="st">"06"</span>, <span class="st">"48"</span>]}, <span class="co"># California and Texas</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create a stratified tabulation</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Age Distribution by Sex, Stratified by State"</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>response.tabulate(</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SEX"</span>, <span class="st">"AGEP"</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    strat_by<span class="op">=</span><span class="st">"ST"</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    weight_var<span class="op">=</span><span class="st">"PWGTP"</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    where<span class="op">=</span><span class="st">"AGEP &gt; 17"</span> <span class="co"># Filter for adults</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Convert to DataFrame for further analysis</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> response.to_polars(concat<span class="op">=</span><span class="va">True</span>, destring<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.head())</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co"># --- ACS 5YR AGGREGATE ANALYSIS ---</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>cdh <span class="op">=</span> CenDatHelper(key<span class="op">=</span>os.getenv(<span class="st">"CENSUS_API_KEY"</span>))</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>cdh.list_products(years<span class="op">=</span>[<span class="dv">2023</span>], patterns<span class="op">=</span><span class="vs">r"acs/acs5</span><span class="ch">\)</span><span class="vs">"</span>)</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>cdh.set_products()</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>cdh.list_groups(patterns<span class="op">=</span><span class="st">"sex by age"</span>)</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>cdh.set_groups(<span class="st">"B17001"</span>)</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>cdh.describe_groups()</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>cdh.set_variables([<span class="st">"B17001_001E"</span>, <span class="st">"B17001_002E"</span>])</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>cdh.set_geos([<span class="st">"160"</span>])</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> cdh.get_data(</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    include_names<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    include_attributes<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> response.to_polars(concat<span class="op">=</span><span class="va">True</span>, destring<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>df.glimpse()</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="co"># --- ACS 5YR AGGREGATE ANALYSIS ---</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>cdh <span class="op">=</span> CenDatHelper(key<span class="op">=</span>os.getenv(<span class="st">"CENSUS_API_KEY"</span>))</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>cdh.list_products(years<span class="op">=</span>[<span class="dv">2023</span>], patterns<span class="op">=</span><span class="vs">r"/acs/acs5</span><span class="ch">\)</span><span class="vs">"</span>)</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>cdh.set_products()</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>cdh.set_variables(<span class="st">"B01001_001E"</span>)  <span class="co"># total population</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>cdh.set_geos(<span class="st">"150"</span>)</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> cdh.get_data()</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a><span class="co"># how many counties</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>response.tabulate(<span class="st">"state"</span>, where<span class="op">=</span><span class="st">"B01001_001E &gt; 10_000"</span>)</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a><span class="co"># how many people in those counties</span></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>response.tabulate(<span class="st">"state"</span>, weight_var<span class="op">=</span><span class="st">"B01001_001E"</span>, where<span class="op">=</span><span class="st">"B01001_001E &gt; 10_000"</span>)</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a><span class="co"># --- CPS MICRODATA ANALYSIS ---</span></span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>cdh <span class="op">=</span> CenDatHelper(key<span class="op">=</span>os.getenv(<span class="st">"CENSUS_API_KEY"</span>))</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>cdh.list_products(years<span class="op">=</span>[<span class="dv">2022</span>, <span class="dv">2023</span>], patterns<span class="op">=</span><span class="st">"/cps/tobacco"</span>)</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>cdh.set_products()</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>cdh.list_groups()</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>cdh.set_variables([<span class="st">"PEA1"</span>, <span class="st">"PEA3"</span>, <span class="st">"PWNRWGT"</span>])</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>cdh.set_geos(<span class="st">"state"</span>, <span class="st">"desc"</span>)</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> cdh.get_data(within<span class="op">=</span>{<span class="st">"state"</span>: [<span class="st">"06"</span>, <span class="st">"48"</span>]})</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>response.tabulate(</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PEA1"</span>,</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PEA3"</span>,</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>    strat_by<span class="op">=</span><span class="st">"state"</span>,</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>    weight_var<span class="op">=</span><span class="st">"PWNRWGT"</span>,</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>    weight_div<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a><span class="co"># --- ACS ANALYSIS: see Colorado incorporated places with very low poverty across years ---</span></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>cdh <span class="op">=</span> CenDatHelper(key<span class="op">=</span>os.getenv(<span class="st">"CENSUS_API_KEY"</span>))</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>cdh.list_products(years<span class="op">=</span>[<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>], patterns<span class="op">=</span><span class="vs">r"acs/acs5</span><span class="ch">\)</span><span class="vs">"</span>)</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>cdh.set_products()</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>cdh.list_groups(patterns<span class="op">=</span><span class="st">"sex by age"</span>)</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>cdh.set_groups([<span class="st">"B17001"</span>])</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>cdh.describe_groups()</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>cdh.set_geos([<span class="st">"160"</span>])</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> cdh.get_data(</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>    include_names<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>    within<span class="op">=</span>{<span class="st">"state"</span>: <span class="st">"08"</span>},</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>response.tabulate(</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>    <span class="st">"NAME"</span>,</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B17001_002E"</span>,</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B17001_001E"</span>,</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>    where<span class="op">=</span>[</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>        <span class="st">"B17001_001E &gt; 1_000"</span>,</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a>        <span class="st">"B17001_002E / B17001_001E &lt; 0.01"</span>,</span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>        <span class="st">"'CDP' not in NAME"</span>,</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>    weight_var<span class="op">=</span><span class="st">"B17001_001E"</span>,</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>    strat_by<span class="op">=</span><span class="st">"vintage"</span>,</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a><span class="co"># --- ACS ANALYSIS: get race group variables and geometry for regions in 2011 ---</span></span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>cdh <span class="op">=</span> CenDatHelper(key<span class="op">=</span>os.getenv(<span class="st">"CENSUS_API_KEY"</span>))</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a>cdh.list_products(years<span class="op">=</span>[<span class="dv">2011</span>], patterns<span class="op">=</span><span class="vs">r"acs/acs5</span><span class="ch">\)</span><span class="vs">"</span>)</span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>cdh.set_products()</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>cdh.list_groups(patterns<span class="op">=</span><span class="vs">r"</span><span class="dv">^</span><span class="vs">race"</span>)</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>cdh.set_groups([<span class="st">"B02001"</span>])</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>cdh.describe_groups()</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>cdh.set_geos([<span class="st">"020"</span>])</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> cdh.get_data(</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>    include_names<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>    include_geometry<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> response.to_gpd(destring<span class="op">=</span><span class="va">True</span>, join_strategy<span class="op">=</span><span class="st">"inner"</span>)</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>