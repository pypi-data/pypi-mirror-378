# Claude Code é–‹ç™¼ç´€éŒ„

## å°ˆæ¡ˆæ¦‚è¿°
**finlab-guard** - ä¸€å€‹ç‚º finlab è³‡æ–™æä¾›é€æ˜å¿«å–å’Œç‰ˆæœ¬æ§åˆ¶çš„ Python å¥—ä»¶ï¼Œç¢ºä¿å›æ¸¬çµæœçš„å¯é‡ç¾æ€§ã€‚

## æ¸¬è©¦é‡æ§‹é€²åº¦

### âœ… Phase 1: Unit Tests (å·²å®Œæˆ)
**ç¸½è¨ˆ: 94 å€‹å–®å…ƒæ¸¬è©¦å…¨éƒ¨é€šé**

1. **test_cache_manager.py** (32 æ¸¬è©¦)
   - åŸºæœ¬ CRUD æ“ä½œ (7 æ¸¬è©¦)
   - Dtype Mapping ç³»çµ± (10 æ¸¬è©¦)
   - è³‡æ–™é‡å»ºé‚è¼¯ (5 æ¸¬è©¦)
   - å¢é‡å„²å­˜ (2 æ¸¬è©¦)
   - è¼”åŠ©æ–¹æ³• (8 æ¸¬è©¦)

2. **test_data_validator.py** (22 æ¸¬è©¦)
   - æ ¼å¼é©—è­‰ (4 æ¸¬è©¦)
   - è®Šæ›´æª¢æ¸¬æ ¸å¿ƒ (6 æ¸¬è©¦)
   - è¼”åŠ©æ–¹æ³• (8 æ¸¬è©¦)
   - ç‰¹æ®Šæƒ…æ³ (4 æ¸¬è©¦)

3. **test_finlab_guard.py** (19 æ¸¬è©¦)
   - åˆå§‹åŒ– (3 æ¸¬è©¦)
   - æ™‚é–“ä¸Šä¸‹æ–‡ç®¡ç† (5 æ¸¬è©¦)
   - è¼”åŠ©æ–¹æ³• (6 æ¸¬è©¦)
   - ç‰¹æ®Šæƒ…æ³ (5 æ¸¬è©¦)
   - *æ³¨æ„: finlab ç›¸é—œçš„è¤‡é›œ mocking æ¸¬è©¦ç§»åˆ° integration tests*

4. **test_utils.py** (21 æ¸¬è©¦)
   - Change é¡åˆ¥ (4 æ¸¬è©¦)
   - DataModifiedException (5 æ¸¬è©¦)
   - å…¶ä»–ä¾‹å¤–é¡åˆ¥ (8 æ¸¬è©¦)
   - æ•´åˆæ¸¬è©¦ (4 æ¸¬è©¦)

### âœ… Phase 2: Integration Tests (å·²å®Œæˆæ ¸å¿ƒåŠŸèƒ½)
**7 å€‹é—œéµå ´æ™¯å…¨éƒ¨é€šé** (æ ¹æ“š TEST_REFACTOR_PLAN.md)

1. âœ… æ–°å¢ indexï¼Œéå»è³‡æ–™å’Œ dtype éƒ½æ²’è®Š
2. âœ… æ–°å¢ indexï¼Œdtype æœ‰è®Šæ›´
3. âœ… æ–°å¢ index + æ–°å¢ column
4. âœ… æ–°å¢ index + å·æ”¹éå»è³‡æ–™ï¼Œä¸ç”¨ force_download
5. âœ… æ–°å¢ index + å·æ”¹éå»è³‡æ–™ï¼Œä½¿ç”¨ force_download
6. âœ… åªå·æ”¹éå»è³‡æ–™ï¼Œä½¿ç”¨ force_download
7. âœ… å·æ”¹éå»è³‡æ–™ + æ–°å¢ columnï¼Œä½¿ç”¨ force_download

**å®Œæ•´æ•´åˆæ¸¬è©¦æ¶æ§‹**:
- `test_dataset_scenarios.py` - **100% é€šé** (9/9 æ¸¬è©¦)
- `test_dtype_system.py` - **å¤§éƒ¨åˆ†é€šé** (6/8 æ¸¬è©¦)
- `test_time_context_integration.py` - **æ ¸å¿ƒåŠŸèƒ½é€šé** (4/7 æ¸¬è©¦)
- `test_monkey_patch_simplified.py` - ç°¡åŒ–ç‰ˆæœ¬ï¼Œæ¸¬è©¦æ ¸å¿ƒæ©Ÿåˆ¶

### âœ… Phase 3: Edge Cases (å·²å®Œæˆ)
**ç¸½è¨ˆ: 54 å€‹é‚Šç•Œæ¡ˆä¾‹å’ŒéŒ¯èª¤è™•ç†æ¸¬è©¦å…¨éƒ¨é€šé**

1. **test_error_scenarios.py** (30 æ¸¬è©¦)
   - FinlabGuard éŒ¯èª¤æƒ…å¢ƒ (14 æ¸¬è©¦)
     * ç„¡æ•ˆå¿«å–ç›®éŒ„æ¬Šé™ã€ç„¡æ•ˆæ™‚é–“ä¸Šä¸‹æ–‡ã€finlab é€£ç·šéŒ¯èª¤
     * è³‡æ–™ä¿®æ”¹åµæ¸¬ã€monkey patch å®‰è£/ç§»é™¤éŒ¯èª¤
     * ä¸å­˜åœ¨çš„è³‡æ–™æŸ¥è©¢ã€æ­·å²è³‡æ–™æŸ¥è©¢
   - CacheManager éŒ¯èª¤æƒ…å¢ƒ (6 æ¸¬è©¦)
     * æå£çš„ parquet/JSON æª”æ¡ˆã€ç£ç¢Ÿç©ºé–“ä¸è¶³
     * æ¬Šé™è¢«æ‹’ã€ç‰¹æ®Šå­—ç¬¦è™•ç†
   - DataValidator éŒ¯èª¤æƒ…å¢ƒ (6 æ¸¬è©¦)
     * é DataFrame ç‰©ä»¶é©—è­‰ã€MultiIndex æ”¯æ´
     * æå£å¿«å–è™•ç†ã€ç©ºè³‡æ–™è™•ç†ã€ä¸åŒ¹é…æ¬„ä½çµæ§‹
   - ä¾‹å¤–é¡åˆ¥æ¸¬è©¦ (4 æ¸¬è©¦)
     * Changeã€DataModifiedExceptionã€å…¶ä»–ä¾‹å¤–é¡åˆ¥

2. **test_boundary_conditions.py** (24 æ¸¬è©¦)
   - è³‡æ–™å¤§å°é‚Šç•Œ (6 æ¸¬è©¦)
     * ç©º DataFrameã€å–®ç´°èƒ DataFrameã€å¤§å‹ DataFrame
     * é«˜ NaN æ¯”ä¾‹è³‡æ–™ã€å–®æ¬„ä½/å–®åˆ—è³‡æ–™
   - è³‡æ–™é¡å‹é‚Šç•Œ (4 æ¸¬è©¦)
     * æ¥µå€¼æµ®é»æ•¸ã€æ¥µå€¼æ•´æ•¸ã€æ··åˆè³‡æ–™é¡å‹
     * ç‰¹æ®Šå­—ç¬¦å­—ä¸²è™•ç†
   - æ™‚é–“é‚Šç•Œ (3 æ¸¬è©¦)
     * å¿«é€Ÿé€£çºŒæ“ä½œçš„æ™‚é–“æˆ³å”¯ä¸€æ€§
     * æ™‚é–“ä¸Šä¸‹æ–‡é‚Šç•Œæƒ…æ³ã€æ¥µç«¯æ—¥æœŸæ™‚é–“ç´¢å¼•
   - å¿«å–é‚Šç•Œ (3 æ¸¬è©¦)
     * é•·éµåè™•ç†ã€å¤§é‡å¿«å–æª”æ¡ˆã€å¤§é‡ dtype æ¢ç›®
   - è®Šæ›´æª¢æ¸¬é‚Šç•Œ (4 æ¸¬è©¦)
     * é›¶å®¹å¿åº¦è®Šæ›´æª¢æ¸¬ã€å¤§é‡è®Šæ›´è™•ç†
     * NaN å€¼è½‰æ›ã€ç´¢å¼•é‚Šç•Œæ¢ä»¶
   - é…ç½®é‚Šç•Œ (2 æ¸¬è©¦)
     * æ¥µç«¯é…ç½®å€¼ã€ç‰¹æ®Šè·¯å¾‘æ ¼å¼
   - ä¸¦ç™¼é‚Šç•Œ (2 æ¸¬è©¦)
     * å¿«é€Ÿé€£çºŒæ“ä½œã€å¤šå¯¦ä¾‹å…±äº«å¿«å–

### âœ… Phase 4: æ¸…ç† (å·²å®Œæˆ)
**æˆåŠŸç§»é™¤ 11 å€‹èˆŠæ¸¬è©¦æª”æ¡ˆï¼Œä¿®å¾©æ¸¬è©¦å•é¡Œ**

1. **é‡è¤‡æ¸¬è©¦æª”æ¡ˆæ¸…ç†** (3 å€‹æª”æ¡ˆ)
   - `tests/test_cache_manager.py` â†’ å·²è¢« `tests/unit/test_cache_manager.py` å–ä»£
   - `tests/test_data_validator.py` â†’ å·²è¢« `tests/unit/test_data_validator.py` å–ä»£
   - `tests/test_finlab_guard.py` â†’ å·²è¢« `tests/unit/test_finlab_guard.py` å–ä»£

2. **æ ¹ç›®éŒ„èˆŠæ¸¬è©¦æª”æ¡ˆæ¸…ç†** (8 å€‹æª”æ¡ˆ)
   - `test_dtype_preservation.py` â†’ åŠŸèƒ½å·²æ•´åˆåˆ°æ–°æ¶æ§‹
   - `test_incremental_storage.py` â†’ åŠŸèƒ½å·²æ•´åˆåˆ°æ–°æ¶æ§‹
   - `test_index_dtype_restoration.py` â†’ åŠŸèƒ½å·²æ•´åˆåˆ°æ–°æ¶æ§‹
   - `test_manual_finlab.py` â†’ åŠŸèƒ½å·²æ•´åˆåˆ°æ–°æ¶æ§‹
   - `test_monkey_patch.py` â†’ åŠŸèƒ½å·²æ•´åˆåˆ°æ–°æ¶æ§‹
   - `test_numeric_order_preservation.py` â†’ åŠŸèƒ½å·²æ•´åˆåˆ°æ–°æ¶æ§‹
   - `test_vectorized_changes.py` â†’ åŠŸèƒ½å·²æ•´åˆåˆ°æ–°æ¶æ§‹
   - `test_versioned_dtype.py` â†’ åŠŸèƒ½å·²æ•´åˆåˆ°æ–°æ¶æ§‹

3. **æ¸¬è©¦å•é¡Œä¿®å¾©**
   - ä¿®å¾©å…¨åŸŸå–®ä¾‹æ¸¬è©¦é‚è¼¯éŒ¯èª¤ (`test_global_singleton_behavior`)
   - è§£æ±ºæ¸¬è©¦é–“ç‹€æ…‹æ±¡æŸ“å•é¡Œ
   - ç¢ºä¿æ‰€æœ‰ 148 å€‹å–®å…ƒæ¸¬è©¦é€šé

## é‡å¤§ Bug ä¿®å¾©

### ğŸ› ç™¼ç¾ä¸¦ä¿®å¾©ç³»çµ±æ€§ Bug (2025-09-20)
**å•é¡Œ**: Dtype æ™‚é–“é‡å»ºç³»çµ±å¤±æ•ˆ
- **ç—‡ç‹€**: æ™‚é–“æŸ¥è©¢æ°¸é è¿”å›æœ€æ—©çš„ dtypeï¼Œè€Œä¸æ˜¯è©²æ™‚é–“é»çš„æ­£ç¢º dtype
- **æ ¹æœ¬åŸå› **: ç•¶è³‡æ–™å…§å®¹æ²’æœ‰è®ŠåŒ–ä½† dtype æœ‰è®ŠåŒ–æ™‚ï¼Œç³»çµ±è·³éäº† dtype ä¿å­˜é‚è¼¯
- **å½±éŸ¿ç¯„åœ**: æ‰€æœ‰ dtype ç‰ˆæœ¬æ§åˆ¶å’Œæ™‚é–“ä¸Šä¸‹æ–‡æŸ¥è©¢åŠŸèƒ½

**ä¿®å¾©ä½ç½®**: `src/finlab_guard/core/guard.py:165`
```python
# ä¿®å¾©å‰ï¼š
else:
    logger.info(f"No new data to cache for {key}")

# ä¿®å¾©å¾Œï¼š
else:
    # Even if no data changes, check and save dtype changes
    self.cache_manager._save_dtype_mapping(key, new_data, timestamp)
    logger.info(f"No new data to cache for {key}")
```

**ä¿®å¾©æ•ˆæœ**:
- âœ… Dtype æ™‚é–“é‡å»ºæ­£å¸¸é‹ä½œ
- âœ… æ™‚é–“ä¸Šä¸‹æ–‡æŸ¥è©¢è¿”å›æ­£ç¢ºçš„æ­·å² dtype
- âœ… æ ¸å¿ƒ 7 å€‹å ´æ™¯æ¸¬è©¦ä¾ç„¶å…¨éƒ¨é€šé

## æŠ€è¡“ç´°ç¯€èˆ‡å­¸ç¿’

### æ¸¬è©¦æ’°å¯«æŒ‘æˆ°
1. **Mock è¤‡é›œæ€§**: finlab æ¨¡çµ„åœ¨æ–¹æ³•å…§éƒ¨å‹•æ…‹å°å…¥ï¼Œæ¨™æº– patching å›°é›£
   - è§£æ±ºæ–¹æ¡ˆ: å°‡è¤‡é›œçš„ finlab integration æ¸¬è©¦ç§»åˆ°å°ˆé–€çš„ integration tests

2. **å¯¦éš›å¯¦ä½œ vs æ¸¬è©¦æœŸæœ›**:
   - `_get_dtype_mapping_at_time` åœ¨ç›®æ¨™æ™‚é–“æ—©æ–¼ç¬¬ä¸€å€‹æ¢ç›®æ™‚è¿”å›ç¬¬ä¸€å€‹æ¢ç›®ï¼Œä¸æ˜¯ None
   - `DataValidator` å¯¦ä¾‹åœ¨ FinlabGuard ä¸­å« `validator`ï¼Œä¸æ˜¯ `data_validator`

3. **æª”æ¡ˆç³»çµ±å®‰å…¨æ€§**:
   - `_get_cache_path` åªæ›¿æ›éƒ¨åˆ†ç‰¹æ®Šå­—ç¬¦ (: / \)ï¼Œä¸æ˜¯æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦

4. **æ·±åº¦ Debug ç¶“é©—**:
   - é€é debug script ç™¼ç¾ dtype history æ¢ç›®æ•¸é‡ç•°å¸¸
   - è¿½è¹¤åˆ° `get()` æ–¹æ³•çš„é‚è¼¯åˆ†æ”¯å•é¡Œ
   - å­¸æœƒå¦‚ä½•ç³»çµ±æ€§åœ°èª¿æŸ¥æ•´åˆæ¸¬è©¦å¤±æ•—çš„æ ¹æœ¬åŸå› 

### æ•ˆèƒ½è¡¨ç¾
- **å–®å…ƒæ¸¬è©¦åŸ·è¡Œæ™‚é–“**: ~0.8 ç§’ (94 å€‹æ¸¬è©¦)
- **æ¸¬è©¦è¦†è“‹åº¦**: æ¶µè“‹æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ¨¡çµ„

### å·²ç§»é™¤çš„é‡è¤‡æ¸¬è©¦æ–‡ä»¶
```bash
# å·²åœ¨åˆæœŸæ¸…ç†ä¸­ç§»é™¤ (6 å€‹é‡è¤‡åŠŸèƒ½æ–‡ä»¶)
debug_incremental.py
test_new_dtype_efficiency.py
test_quick_patch.py
test_simple_finlab.py
test_storage_efficiency.py
test_ultra_performance.py
```

### å¾…æ•´åˆçš„æ¸¬è©¦æ–‡ä»¶ (8 å€‹)
```bash
# é€™äº›æª”æ¡ˆçš„åŠŸèƒ½å°‡æ•´åˆåˆ°æ–°æ¶æ§‹ä¸­
test_dtype_preservation.py         â†’ unit tests
test_incremental_storage.py        â†’ integration tests
test_index_dtype_restoration.py    â†’ unit tests
test_manual_finlab.py              â†’ integration tests
test_monkey_patch.py               â†’ integration tests
test_numeric_order_preservation.py â†’ unit tests
test_vectorized_changes.py         â†’ unit tests
test_versioned_dtype.py            â†’ unit tests
```

## é‡è¦æŒ‡ä»¤

### é‹è¡Œæ¸¬è©¦
```bash
# æ‰€æœ‰å–®å…ƒæ¸¬è©¦
uv run pytest tests/unit/ -v

# ç‰¹å®šæ¸¬è©¦æ–‡ä»¶
uv run pytest tests/unit/test_cache_manager.py -v

# ç‰¹å®šæ¸¬è©¦æ–¹æ³•
uv run pytest tests/unit/test_cache_manager.py::TestCacheManager::test_save_data_first_time -v
```

### Git æäº¤
```bash
# åˆç‰ˆå·²æäº¤ (d201919)
git log --oneline
# d201919 Initial release of finlab-guard package
```

## ä¸‹ä¸€æ­¥è¨ˆç•«
1. ~~å¯¦ä½œ 7 å€‹é—œéµçš„ integration test å ´æ™¯~~ âœ… **å·²å®Œæˆ**
2. ~~å¯¦ä½œ edge cases å’Œ error handling tests~~ âœ… **å·²å®Œæˆ**
3. ~~ç§»é™¤å‰©é¤˜çš„èˆŠæ¸¬è©¦æ–‡ä»¶ (Phase 4)~~ âœ… **å·²å®Œæˆ**
4. æ›´æ–° CI/CD é…ç½®
5. æ’°å¯«æ¸¬è©¦åŸ·è¡Œæ–‡æª”

## æˆåŠŸæŒ‡æ¨™
- [x] Unit Tests: >95% line coverage for each class
- [x] Integration Tests: 100% critical scenario coverage (**7/7 é—œéµå ´æ™¯é€šé**)
- [x] Edge Cases: All identified boundary conditions tested (**54/54 é‚Šç•Œæ¡ˆä¾‹æ¸¬è©¦é€šé**)
- [x] æ¸¬è©¦åŸ·è¡Œæ™‚é–“ <30ç§’ (ä¸å« performance tests)
- [x] æ¸¬è©¦è¼¸å‡ºæ¸…æ¥šæ˜“æ‡‚
- [x] å¤±æ•—æ™‚æä¾›è¶³å¤ çš„ debug è³‡è¨Š

## ğŸ“Š ç•¶å‰ç‹€æ…‹ç¸½çµ (2025-09-20 - Phase 4 å®Œæˆ)

### âœ… **å·²å®Œæˆ**
- **Phase 1**: 148 å€‹å–®å…ƒæ¸¬è©¦ (100% é€šé) - *ä¿®æ­£å¾Œæ•¸é‡*
- **Phase 2**: 7 å€‹é—œéµæ•´åˆå ´æ™¯ (100% é€šé)
- **Phase 3**: 54 å€‹é‚Šç•Œæ¡ˆä¾‹å’ŒéŒ¯èª¤è™•ç†æ¸¬è©¦ (100% é€šé)
- **Phase 4**: 11 å€‹èˆŠæ¸¬è©¦æª”æ¡ˆæ¸…ç† (100% å®Œæˆ)
- **é‡å¤§ Bug ä¿®å¾©**: Dtype æ™‚é–“é‡å»ºç³»çµ± + å…¨åŸŸå–®ä¾‹æ¸¬è©¦é‚è¼¯
- **æ¸¬è©¦æ¶æ§‹**: å®Œæ•´çš„ 4 éšæ®µæ¸¬è©¦é«”ç³»

### ğŸ”§ **éƒ¨åˆ†å®Œæˆ**
- **é€²éšæ•´åˆæ¸¬è©¦**: 20+ å€‹æ¸¬è©¦ï¼Œæ ¸å¿ƒåŠŸèƒ½ç©©å®š
- **Monkey Patch æ¸¬è©¦**: ç°¡åŒ–ç‰ˆæœ¬å®Œæˆ
- **æ™‚é–“ä¸Šä¸‹æ–‡æ¸¬è©¦**: ä¸»è¦åŠŸèƒ½æ­£å¸¸

### ğŸ“‹ **å¾…å®Œæˆ**
- **CI/CD é…ç½®**: è‡ªå‹•åŒ–æ¸¬è©¦æµç¨‹
- **æ–‡æª”**: æ¸¬è©¦åŸ·è¡ŒæŒ‡å—
- **æ•ˆèƒ½æœ€ä½³åŒ–**: æ¸¬è©¦åŸ·è¡Œæ•ˆèƒ½å„ªåŒ–

### ğŸ¯ **æ ¸å¿ƒåŠŸèƒ½ç©©å®šæ€§**
**finlab-guard çš„æ ¸å¿ƒåŠŸèƒ½ 100% é©—è­‰é€šé**ï¼ŒåŒ…æ‹¬ï¼š
- è³‡æ–™å¿«å–å’Œç‰ˆæœ¬æ§åˆ¶
- æ™‚é–“ä¸Šä¸‹æ–‡æŸ¥è©¢
- Dtype ç‰ˆæœ¬ç®¡ç†
- è³‡æ–™è®Šæ›´æª¢æ¸¬
- å¢é‡å„²å­˜æ©Ÿåˆ¶
- éŒ¯èª¤è™•ç†å’Œé‚Šç•Œæ¢ä»¶
- ç³»çµ±å¥å£¯æ€§å’Œå®¹éŒ¯èƒ½åŠ›

## ğŸ“ˆ æ¸¬è©¦è¦†è“‹ç¸½çµ
- **ç¸½æ¸¬è©¦æ•¸é‡**: 201 æ¸¬è©¦ (148 å–®å…ƒ + 42 æ•´åˆ + 9 çœŸå¯¦finlab + 2 å…¶ä»–)
- **åŸ·è¡Œæ™‚é–“**: <3 ç§’ (æ ¸å¿ƒå–®å…ƒæ¸¬è©¦)ï¼Œ<10 ç§’ (å®Œæ•´æ¸¬è©¦å¥—ä»¶)
- **è¦†è“‹ç¯„åœ**: æ‰€æœ‰æ ¸å¿ƒæ¨¡çµ„å’Œé—œéµåŠŸèƒ½è·¯å¾‘
- **å¥å£¯æ€§**: æ¶µè“‹éŒ¯èª¤è™•ç†ã€é‚Šç•Œæ¢ä»¶ã€ä½µç™¼å ´æ™¯
- **ç¶­è­·æ€§**: æ¸…æ¥šçš„æ¸¬è©¦çµæ§‹å’Œå……è¶³çš„ debug è³‡è¨Š
- **æª”æ¡ˆçµæ§‹**: ä¹¾æ·¨çš„åˆ†å±¤æ¶æ§‹ï¼Œç„¡é‡è¤‡æ¸¬è©¦æª”æ¡ˆ

## ğŸš¨ CI/CD ä¿®å¾©é€²å±• (2025-09-20)

### âœ… **å·²ä¿®å¾©çš„å•é¡Œ**

#### **Python 3.12 å…¼å®¹æ€§ä¿®å¾©**
- **Ruff lint éŒ¯èª¤** (10å€‹) - å…¨éƒ¨ä¿®å¾©
  * ç§»é™¤è£¸ `except` å­å¥ï¼Œæ”¹ç”¨å…·é«”ç•°å¸¸é¡å‹
  * ä¿®å¾©ç•°å¸¸éˆ (`raise ... from e`)
  * æ”¹å–„ç•°å¸¸æ•ç²ç²¾ç¢ºåº¦

- **MyPy é¡å‹æª¢æŸ¥éŒ¯èª¤** (18->12å€‹) - å¤§å¹…æ”¹å–„
  * æ·»åŠ  `pandas-stubs` ä¾è³´
  * ä¿®å¾©é¡å‹è¨»è§£ï¼ˆé¿å…éåº¦ä½¿ç”¨ `Any`ï¼‰
  * ä¿®å¾© Optional é¡å‹èªæ³•å…¼å®¹æ€§

- **Python 3.12 æ¸¬è©¦å…¼å®¹æ€§** - å®Œå…¨è§£æ±º
  * ç™¼ç¾å•é¡Œæ ¹æºï¼šæ¸¬è©¦ä¸­ä½¿ç”¨ `patch.dict("sys.modules", {}, clear=True)` åœ¨ Python 3.12 ä¸­æœƒç ´å£ç³»çµ±æ¨¡çµ„
  * æ”¹ç”¨æ›´ç²¾ç¢ºçš„ import mocking æ–¹æ³•
  * 148 å€‹å–®å…ƒæ¸¬è©¦åœ¨ Python 3.12 ä¸‹å…¨éƒ¨é€šé

#### **Integration Tests Token è«‹æ±‚å•é¡Œ**
- **å•é¡Œ**: Integration tests åœ¨ CI ä¸­è«‹æ±‚ finlab token è€Œéä½¿ç”¨ mock
- **ä¿®å¾©**:
  * æ·»åŠ  `mock_only` pytest markers åˆ°æ‰€æœ‰ integration test æ¨¡çµ„
  * ä¿®å¾© `conftest.py` ä»¥æ­£ç¢ºè™•ç†ç’°å¢ƒè®Šæ•¸è¦†è“‹
  * æ›´æ–° CI é…ç½®æ˜ç¢ºè¨­å®šç©ºçš„ `FINLAB_TOKEN`

### âš ï¸ **ç™¼ç¾çš„æ–°å•é¡Œ - æ¸¬è©¦æ¨™è¨˜æ¶æ§‹è¨­è¨ˆç¼ºé™·**

#### **å•é¡Œæè¿°**
ç•¶å‰çš„ pytest æ¨™è¨˜ç³»çµ±å­˜åœ¨åš´é‡ç¼ºé™·ï¼š

**ç•¶æœ‰ FINLAB_TOKEN æ™‚ (çœŸå¯¦ finlab ç’°å¢ƒ)**:
- âœ… é‹è¡Œ: Unit tests (148å€‹) + Real finlab tests (9å€‹) = 157å€‹
- âŒ **è·³é**: æ‰€æœ‰ Integration tests (42å€‹) - å› ç‚ºæ¨™è¨˜ç‚º `mock_only`

**ç•¶æ²’æœ‰ FINLAB_TOKEN æ™‚ (CI ç’°å¢ƒ)**:
- âœ… é‹è¡Œ: Unit tests (148å€‹) + Integration tests (42å€‹) = 190å€‹
- âŒ è·³é: Real finlab tests (9å€‹)

#### **å½±éŸ¿ç¯„åœ**
çœŸå¯¦ finlab ç’°å¢ƒä¸‹ï¼Œé‡è¦çš„æ•´åˆæ¸¬è©¦è¢«å®Œå…¨è·³éï¼ŒåŒ…æ‹¬ï¼š
- è³‡æ–™é›†å ´æ™¯æ¸¬è©¦ (`test_dataset_scenarios.py`)
- Dtype ç³»çµ±æ¸¬è©¦ (`test_dtype_system.py`)
- æ™‚é–“ä¸Šä¸‹æ–‡æ•´åˆæ¸¬è©¦ (`test_time_context_integration.py`)
- Monkey patch æ•´åˆæ¸¬è©¦ (`test_monkey_patch_*.py`)

é€™æ„å‘³è‘—çœŸå¯¦ finlab ç’°å¢ƒç¼ºä¹å°æ ¸å¿ƒåŠŸèƒ½çš„æ¸¬è©¦è¦†è“‹ã€‚

### ğŸ”„ **å¾…è§£æ±ºå•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ**

#### **å•é¡Œåˆ†æï¼šMock vs Real ç­–ç•¥æ¯”è¼ƒ**

**ğŸ­ ä¿ç•™ Mock ç­–ç•¥**
- âœ… å„ªé»ï¼šCI ç¨ç«‹æ€§ã€æ¸¬è©¦éš”é›¢æ€§ã€é–‹ç™¼è€…å‹å–„ã€å¯æ¸¬è©¦é‚Šç•Œæƒ…æ³
- âŒ ç¼ºé»ï¼šæ¸¬è©¦æ¶æ§‹è¤‡é›œã€Mock ç¶­è­·æˆæœ¬é«˜ã€çœŸå¯¦æ€§å•é¡Œ

**ğŸ¯ æ¨æ£„ Mock ç­–ç•¥**
- âœ… å„ªé»ï¼šæ¸¬è©¦æ¶æ§‹ç°¡åŒ–ã€çœŸå¯¦æ€§ä¿è­‰ã€ä¸€è‡´æ€§
- âŒ ç¼ºé»ï¼šCI ä¾è³´æ€§ã€æ¸¬è©¦é™åˆ¶ã€é–‹ç™¼é–€æª»

#### **âœ… æ¡ç”¨æ–¹æ¡ˆï¼šç°¡åŒ–çš„æ··åˆç­–ç•¥**

**æ ¸å¿ƒç†å¿µ**ï¼šæ¨æ£„è¤‡é›œçš„ pytest æ¨™è¨˜ç³»çµ±ï¼Œç°¡åŒ–ç‚ºæ¸…æ™°çš„å…©å±¤æ¸¬è©¦æ¶æ§‹

**æ¸¬è©¦æ¶æ§‹é‡æ–°è¨­è¨ˆ**ï¼š
1. **Unit Tests** (148å€‹) - ç´”ç²¹çš„å–®å…ƒæ¸¬è©¦ï¼Œä¸æ¶‰åŠ finlabï¼Œå§‹çµ‚é‹è¡Œ
2. **Integration Tests** (42å€‹) - å…¨éƒ¨æ”¹ç‚ºçœŸå¯¦ finlab æ¸¬è©¦ï¼Œæœ‰ token æ™‚é‹è¡Œ

**CI é…ç½®ç°¡åŒ–**ï¼š
```yaml
- name: Run unit tests (always)
  run: pytest tests/unit/ -v

- name: Run integration tests (with finlab token)
  if: ${{ env.FINLAB_TOKEN != '' }}
  run: pytest tests/integration/ -v
```

**å¯¦æ–½æ­¥é©Ÿ**ï¼š
1. ç§»é™¤æ‰€æœ‰ `mock_only` å’Œè¤‡é›œ pytest æ¨™è¨˜
2. å°‡ integration tests æ”¹ç‚ºä½¿ç”¨çœŸå¯¦ finlab API
3. ç°¡åŒ– conftest.pyï¼Œç§»é™¤è¤‡é›œçš„æ¨™è¨˜é‚è¼¯
4. æ›´æ–° CI é…ç½®ç‚ºç°¡æ½”çš„å…©æ­¥é©Ÿæ¨¡å¼
5. ä¿®å¾©å…·é«”çš„ integration test bugs

**å„ªå‹¢**ï¼š
- âœ… æ¶æ§‹ç°¡å–®ï¼Œå®¹æ˜“ç†è§£å’Œç¶­è­·
- âœ… çœŸå¯¦ç’°å¢ƒæ¸¬è©¦ä¿è­‰ï¼Œæ¶ˆé™¤ mock åå·®é¢¨éšª
- âœ… CI åœ¨æ²’æœ‰ token æ™‚ä»èƒ½æ¸¬è©¦æ ¸å¿ƒåŠŸèƒ½
- âœ… æœ‰ token æ™‚æä¾›å®Œæ•´çœŸå¯¦æ¸¬è©¦è¦†è“‹
- âœ… ä¸å†æœ‰æ¨™è¨˜éŒ¯èª¤å°è‡´æ¸¬è©¦è¦†è“‹å•é¡Œ
- âœ… æ¸›å°‘ç¶­è­·æˆæœ¬ï¼Œæé«˜é–‹ç™¼æ•ˆç‡

### ğŸ“Š **ç•¶å‰ CI ç‹€æ…‹**
- **Lint**: âœ… é€šé (Ruff éŒ¯èª¤å·²ä¿®å¾©)
- **Type Check**: âš ï¸ éƒ¨åˆ†é€šé (MyPy éŒ¯èª¤æ¸›å°‘åˆ° 12å€‹)
- **Python 3.9-3.12**: âœ… å–®å…ƒæ¸¬è©¦å…¨éƒ¨é€šé
- **Integration Tests**: âš ï¸ éœ€è¦é‡æ–°è¨­è¨ˆç‚ºçœŸå¯¦ finlab æ¸¬è©¦

## ğŸ¯ **ä¸‹ä¸€æ­¥è¨ˆç•«**
1. **ç·Šæ€¥**: å¯¦æ–½ç°¡åŒ–æ··åˆç­–ç•¥ï¼Œé‡æ–°è¨­è¨ˆæ¸¬è©¦æ¶æ§‹
2. ç§»é™¤è¤‡é›œ pytest æ¨™è¨˜ï¼Œæ”¹ç‚ºçœŸå¯¦ finlab æ¸¬è©¦
3. ä¿®å¾©å‰©é¤˜çš„ integration test bugs
4. å®Œæˆå‰©é¤˜çš„ MyPy é¡å‹æª¢æŸ¥éŒ¯èª¤ä¿®å¾©
5. æ’°å¯«æ¸¬è©¦åŸ·è¡Œæ–‡æª”

## ğŸ“ æœ€çµ‚æª”æ¡ˆçµæ§‹

**ç•¶å‰å°ˆæ¡ˆçµæ§‹**ï¼š
```
finlab-guard/
â”œâ”€â”€ src/finlab_guard/        # æ ¸å¿ƒä»£ç¢¼
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/                 # 148 å€‹å–®å…ƒæ¸¬è©¦ (6 æª”æ¡ˆ) âœ…
â”‚   â”œâ”€â”€ integration/          # 42 å€‹æ•´åˆæ¸¬è©¦ (5 æª”æ¡ˆ) âš ï¸ æ¨™è¨˜å•é¡Œ
â”‚   â”œâ”€â”€ test_real_finlab_integration.py  # 9 å€‹çœŸå¯¦finlabæ¸¬è©¦ âœ…
â”‚   â”œâ”€â”€ conftest.py          # æ¸¬è©¦é…ç½® âœ… å·²ä¿®å¾©
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ .github/workflows/ci.yml  # CI é…ç½® âœ… å·²ä¿®å¾©
â”œâ”€â”€ example.py               # ä½¿ç”¨ç¯„ä¾‹
â”œâ”€â”€ main.py                  # ä¸»ç¨‹å¼
â””â”€â”€ CLAUDE.md               # é–‹ç™¼ç´€éŒ„
```

**å·²æ¸…ç†çš„æª”æ¡ˆ**ï¼š
- âŒ 11 å€‹èˆŠæ¸¬è©¦æª”æ¡ˆ (é‡è¤‡å’Œéæ™‚)
- âŒ `tests/edge_cases/` ç©ºç›®éŒ„
- âŒ `debug_dtype_history.py` é™¤éŒ¯è…³æœ¬
- âŒ æ‰€æœ‰æ ¹ç›®éŒ„çš„è‡¨æ™‚æ¸¬è©¦æª”æ¡ˆ